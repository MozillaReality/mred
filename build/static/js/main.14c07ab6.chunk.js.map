{"version":3,"sources":["vr/ToasterManager.js","utils.js","common/GridEditorApp.js","SelectionManager.js","common/HSLUVColorPicker.js","vr/AuthModule.js","TreeItemProvider.js","common/StringEditor.js","common/EnumEditor.js","common/ArrayEditor.js","common/PropSheet.js","syncgraph/utils.js","common/TreeTable.js","metadoc/Dimension.js","metadoc/MetadocCanvas.js","syncgraph/UndoQueue.js","metadoc/EventCoalescer.js","syncgraph/PubnubSyncWrapper.js","common/Dialog.js","syncgraph/MissingDocDialog.js","syncgraph/SyncGraphProvider.js","common/InputManager.js","metadoc/RectDef.js","metadoc/CircleDef.js","metadoc/TextDef.js","metadoc/ImageDef.js","metadoc/Common.js","vr/defs/ObjectDef.js","vr/defs/CubeDef.js","vr/defs/SphereDef.js","vr/defs/PlaneDef.js","vr/GLTFLoader.js","vr/defs/ModelDef.js","vr/defs/BG360Def.js","vr/defs/TextDef.js","vr/defs/Image2DDef.js","vr/defs/GroupDef.js","vr/defs/GPUParticles.js","vr/defs/ParticlesDef.js","vr/defs/ImageAnchorDef.js","vr/defs/GeoAnchorDef.js","vr/defs/HudAnchorDef.js","vr/Common.js","vr/GLTFAssetView.js","vr/GeoAssetView.js","metadoc/AssetView.js","vr/AssetActions.js","vr/dialogs/AddImageAssetDialog.js","metadoc/PageCanvasView.js","metadoc/PresentationApp.js","syncgraph/GraphAccessor.js","metadoc/Editor1.js","vr/TransformControls.js","vr/defs/SceneDef.js","vr/ToasterNotification.js","vr/ScriptManager.js","common/tween.js","vr/XRSupport.js","vr/OrbitControls.js","vr/VRCanvas.js","vr/TranslationArrow.js","vr/TranslateControl.js","vr/panel2d/panel2d.js","vr/panel2d/component2d.js","vr/panel2d/button2d.js","vr/panel2d/group2d.js","vr/3dof.js","vr/Actions.js","vr/ImmersiveVREditor.js","vr/dialogs/AddGLTFAssetDialog.js","vr/dialogs/AddGLBAssetDialog.js","vr/dialogs/AddAudioAssetDialog.js","vr/dialogs/UnsavedDocumentDialog.js","vr/dialogs/OpenFileDialog.js","vr/dialogs/OpenAssetDialog.js","vr/ScriptEditor.js","vr/dialogs/OpenScriptDialog.js","vr/Templates.js","common/QRCanvas.js","vr/dialogs/QRDialog.js","vr/dialogs/PasswordDialog.js","vr/dialogs/GithubAuthDialog.js","vr/ErrorCatcher.js","vr/AssetsManager.js","vr/VREditor.js","vr/ImmersivePlayer.js","App.js","index.js"],"names":["module","exports","adds","add","note","this","forEach","cb","onAdd","push","offAdd","filter","n","parseOptions","opts","loc","document","location","search","substring","split","part","keyval","on","elem","type","addEventListener","toFlatString","obj","JSON","stringify","makePoint","x","y","minus","pt","divide","v","multiply","idivide","Math","floor","distance","dx","dy","sqrt","equals","toString","concat","setQuery","oldOpts","final","Object","keys","key","query","map","join","window","history","pushState","toQueryString","GridLayout","props","clss","leftWidth","rightWidth","showLeft","showRight","style","gridTemplateColumns","react_default","a","createElement","className","children","Toolbar","cls","left","right","bottom","top","center","middle","scroll","Panel","transparent","Spacer","ToggleButton","selected","rest","objectWithoutProperties","assign","MenuPopup","es","actions","act","i","divider","enabled","disabled","onClick","PopupManager","hide","fun","icon","title","GridEditorApp","_this","classCallCheck","possibleConstructorReturn","getPrototypeOf","call","toggleLeftPane","e","setState","state","toggleRightPane","onMouseDownLeft","preventDefault","stopPropagation","dragSide","onMouseMove","onMouseUp","onMouseDownRight","cursor","clientX","clientY","innerWidth","removeEventListener","GridEditorApp_GridLayout","GridEditorApp_Toolbar","GridEditorApp_Spacer","bottomText","onMouseDown","Component","SELECTION_MANAGER","src_SelectionManager","SelectionManager","listeners","dropTarget","clip","index","indexOf","splice","value","node","fire","length","dropType","HSLUVColorPicker","mousePress","canvasToPoint","lightness","redraw","pressed","mouseMove","mouseUp","drawPicker","drawSlider","drawIndicator","livalToCanvas","l","mouseToCanvas","bounds","target","getBoundingClientRect","mousePressSlider","sliderPressed","hue","canvasToHue","setTimeout","mouseMoveSlider","mouseUpSlider","close","color","hsluv","hsluvToHex","onSelect","comps","hexToHsluv","console","log","canvasBounds","canvas","h","height","w","width","c","getContext","j","fillStyle","fillRect","g","cp","strokeStyle","strokeRect","lineWidth","slider","hueToCanvas","indicator","_this2","display","flexDirection","alignItems","ref","can","USER_CHANGE","AuthModule","AuthModuleSingleton","login","res","win","open","url","authCallback","focus","logout","localStorage","clear","doclistSupported","msg","setUserData","data","payload","ToasterMananager","supported","docDeleteSupported","assetUploadSupported","scriptEditingSupported","passwordSupported","connected","serverID","random","isLoggedIn","fetch","getInfoURL","then","json","info","authentication","assetUpload","scriptEditing","replace","getJSON","getUserURL","success","getItem","password","_this3","setItem","accessToken","getAccessToken","options","mode","cache","headers","method","Content-Type","TREE_ITEM_PROVIDER","EXPANDED_CHANGED","STRUCTURE_CHANGED","STRUCTURE_ADDED","STRUCTURE_REMOVED","PROPERTY_CHANGED","CLEAR_DIRTY","SAVED","DOCUMENT_SWAPPED","URLS","BASE","getDocsURL","getAssetsURL","getScriptsURL","TreeItemProvider","genID","prefix","save","getSceneRoot","payload_obj","doc","getDocType","id","getDocId","payload_string","docid","body","doctype","catch","hasChildren","item","getChildren","expanded_map","SERVER_URL","init","list","current","isExpanded","def","Error","root","provider","setDocument","warn","makeEmptyRoot","spath","generateSelectionPath","Selection","getSelection","newsel","findNodeFromSelectionPath","setSelection","file","Promise","rej","FormData","append","size","name","xml","XMLHttpRequest","onreadystatechange","readyState","status","response","responseType","setRequestHeader","send","child","parent","sibling","StringEditor","_Component","_getPrototypeOf2","_len","arguments","args","Array","_key","apply","keypressed","charCode","onCommit","inherits","createClass","prop","hasHints","getHints","multiline","onChange","onBlur","onKeyPress","EnumPicker","Rend","renderer","items","values","val","DefaultEnumRenderer","EnumEditor","show","EnumEditor_EnumPicker","calculateValues","calculateRenderer","selectValue","renderValue","proxy","getRendererForEnum","getKey","vals","getValuesForEnum","ArrayEditor","addValue","showEditor","enumChanged","arr","slice","renderValues","renderEditor","Renderer","deleteItem","EnumEditor_EnumEditor","TYPES","STRING","NUMBER","BOOLEAN","ENUM","COLOR","GROUP","PropEditor","changed","isType","isLive","setValue","updateNum","checked","customChanged","colorChanged","commit","hasOwnProperty","min","max","isNaN","parseFloat","numberKeyDown","shiftKey","booleanChanged","arrayChanged","openColorEditor","HSLUVColorPicker_HSLUVColorPicker","getValue","nextProps","nextState","getType","selMan","isCustom","createCustomEditor","isLocked","StringEditor_StringEditor","step","hints","incrementValue","onKeyDown","backgroundColor","ArrayEditor_ArrayEditor","PropSheet","selection","h2","hand","s","off","_this4","calculateGroups","calculateProps","getName","renderIndeterminate","PropSheet_PropEditor","isIndeterminate","getFullSelection","first","prov","getProperties","A","B","pa","find","pb","multi","MultiPropProxy","match","addSubProxy","PropProxy","p","group_keys","getGroupKeys","subs","sub","same","custom","locked","live","setPropertyValue","group","listToArray","prototype","createGraphObjectFromObject","graph","createObject","fetchGraphObject","objid","getPropertiesForObject","getPropertyValue","propToArray","CH","len","getArrayLength","ch","getElementAt","insertAsFirstChild","setProperty","insertAfter","insertAsLastChild","prev","removeFromParent","array","findIndex","removeElement","error","ContextMenu","menu","TreeTableItem","addToSelection","onContextMenu","calculateContextMenu","TreeTable_ContextMenu","toggleItemCollapsed","onDragStart","onDragOver","onDragEnd","onDrop","isSelected","getDropTarget","getDropType","arrow","data-nodeid","depth","getRendererForItem","renderDragBars","canBeMoved","draggable","TreeTable","dataTransfer","effectAllowed","setData","parentNode","setDragImage","dropEffect","dragTarget","internalDrag","canAddExternalChild","setDropTarget","setDropType","canAddChild","canBeSibling","getDataGraph","src","dst","parent2","acceptDrop","generateChildren","chs","listener","other_listener","sel","newProps","TreeTable_TreeTableItem","UNITS","PIXEL","matches","short","MILLIMETER","DEFAULT_DPI","Dimension","unit","scale","dpi","px_per_in","MetadocCanvas","selectionChanged","getPageSize","getSelectedPage","as","getRawGraph","page","drawPage","hsnap","vsnap","restore","toCanvas","shape","findShape","mouseDown","pauseQueue","shapeid","shapeobj","initial","start","layer","getSelectedLayer","snap","process","cmd","unpauseQueue","onRawChange","rect","prevProps","drawLayer","drawShape","getShapeDef","draw","isInside","reverse","_this5","border","EDGES","LEFT","RIGHT","CENTER","TOP","MIDDLE","BOTTOM","NONE","snaps","SNAP_THRESHOLD","isNearH","abs","isNearV","getBounds","nearH","nearV","require","SET_PROPERTY","CREATE_PROPERTY","DELETE_PROPERTY","CREATE_OBJECT","DELETE_OBJECT","INSERT_ELEMENT","DELETE_ELEMENT","UndoQueue","op","last","host","getHostId","seq","nextSeq","timestamp","Date","now","entry","entryid","object","prevValue","makeGUID","EventCoalescer","rawlisteners","fireRaw","paused","buffer","bufferOp","settings","publishKey","subscribeKey","PubnubSyncWrapper","handleGraphChange","pubnub","PubNub","getServerID","addListener","operation","category","sendHistoryRequest","message","m","handleMessage","subscribe","channels","calculateChannelName","calculateLoggerChannelName","sendMessage","unsubscribe","stop","str","uuid","publish","channel","hist","getHistory","count","chunk","evt","handleGetHistory","handleReceiveHistory","_console","publisher","getUUID","toConsumableArray","PubnubLogger","_console2","from","_console3","ConsoleLogger","_console4","_console5","Dialog","clickedScrim","scrim","onScrimClick","visible","bodyStyle","MissingDocDialog","cancel","DialogManager","okay","createNewDocument","Dialog_Dialog","grow","DocGraph","CommandGenerator","SyncGraphProvider","getDocTitle","getDocHistory","getDocGraph","getObjectByProperty","DocGraphToObjectGraph","coalescer","syncdoc","hasPropertyValue","expanded","docLoaded","resolve","toggleConnected","unpause","pause","isConnected","performUndo","undoqueue","canUndo","undo","performRedo","canRedo","redo","datalisteners","loadDoc","propKey","oldValue","newValue","showMissingDocDialog","makeDocFromServerHistory","setupDocFlow","shutdown","submit","clearSelection","newDocId","setDocTitle","MissingDocDialog_MissingDocDialog","InputManager","keyDown","m2","bindings","b","keyCode","valid","modifiers","mod","MODIFIERS","COMMAND","metaKey","SHIFT","some","dispatchEvents","binding","bind","KEYS","S","Z","C","V","X","LEFT_ARROW","RIGHT_ARROW","RectDef","rx","ry","fillColor","c0","c1","c2","c3","beginPath","moveTo","lineTo","quadraticCurveTo","closePath","fill","newOrigin","CircleDef","radius","arc","PI","pow","TextDef","text","horizontalAlign","HORIZONTAL_ALIGNMENT","verticalAlign","VERTICAL_ALIGNMENT","BASELINE","autoFit","fontSize","fontFamily","STANDARD_FONTS","SANSSERIF","fontWeight","FONT_WEIGHTS","NORMAL","fontStyle","FONT_STYLES","_this$calculateLines","calculateLines","lines","size_px","total_height","total_width","line","lines_height","xoff","yoff","fillText","font","measureText","reduce","total","_this$calculateLines2","insideRect","_this$calculateLines3","ImageDef","asset","isImageCached","drawImage","getCachedImage","requestImageCache","PROP_DEFS","subtype","format","pageSize","SHAPE_DEFS","circle","image","ICONS","plane","model","cut","copy","paste","delete","SERIF","MONOSPACE","BOLD","ITALIC","OBLIQUE","isShapeType","ObjectDef","position","z","rotation","material","set","parseInt","tx","ty","tz","COUNTER","CubeDef","scene","OBJ_TYPES","cube","rz","sx","sy","sz","createArray","NONE_ASSET","Mesh","BoxGeometry","MeshLambertMaterial","userData","clickable","attachAsset","esm_get","geometry","tex","assetsManager","getTexture","side","DoubleSide","SphereDef","SphereBufferGeometry","PlaneDef","THREE","GLTFLoader","manager","undefined","DefaultLoadingManager","GLTFRegistry","objects","get","remove","removeAll","constructor","crossOrigin","load","onLoad","onProgress","onError","scope","path","LoaderUtils","extractUrlBase","loader","FileLoader","setResponseType","parse","setCrossOrigin","setPath","content","extensions","decodeText","Uint8Array","BINARY_EXTENSION_HEADER_MAGIC","EXTENSIONS","KHR_BINARY_GLTF","GLTFBinaryExtension","version","extensionsUsed","KHR_LIGHTS","GLTFLightsExtension","KHR_MATERIALS_COMMON","GLTFMaterialsCommonExtension","KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS","GLTFMaterialsPbrSpecularGlossinessExtension","time","GLTFParser","scenes","cameras","animations","timeEnd","lights","lightId","lightNode","light","Color","fromArray","DirectionalLight","PointLight","SpotLight","AmbientLight","constantAttenuation","intensity","linearAttenuation","quadraticAttenuation","decay","fallOffAngle","angle","fallOffExponent","getMaterialType","MeshPhongMaterial","MeshBasicMaterial","extendParams","materialParams","parser","khrMaterial","pending","materialValues","diffuseFactor","opacity","diffuseTexture","assignTexture","specularFactor","specular","specularTexture","shininessFactor","shininess","all","BINARY_EXTENSION_HEADER_LENGTH","BINARY_EXTENSION_CHUNK_TYPES","BIN","headerView","DataView","header","magic","getUint32","chunkView","chunkIndex","byteLength","chunkLength","chunkType","contentArray","byteOffset","specularGlossinessParams","ShaderMaterial","params","pbrSpecularGlossiness","shader","ShaderLib","uniforms","UniformsUtils","clone","specularMapParsFragmentChunk","glossinessMapParsFragmentChunk","specularMapFragmentChunk","glossinessMapFragmentChunk","lightPhysicalFragmentChunk","fragmentShader","roughness","metalness","roughnessMap","metalnessMap","setHex","glossiness","specularMap","glossinessMap","vertexShader","defines","STANDARD","isArray","emissive","glossinessFactor","specularGlossinessTexture","specGlossIndex","createMaterial","fog","isGLTFSpecularGlossinessMaterial","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalScale","displacementMap","displacementScale","displacementBias","alphaMap","envMap","envMapIntensity","refractionRatio","derivatives","cloneMaterial","source","il","refreshUniforms","camera","uvScaleMap","offset","repeat","diffuse","multiplyScalar","isWebGLRenderTarget","texture","matrix","matrixAutoUpdate","setUvTransform","uvTransform","offsetRepeat","flipEnvMap","isCubeTexture","USE_GLOSSINESSMAP","USE_ROUGHNESSMAP","WEBGL_CONSTANTS","WEBGL_COMPONENT_TYPES","Number","Matrix3","Matrix4","Vector2","Vector3","Vector4","Texture","5120","Int8Array","5121","5122","Int16Array","5123","Uint16Array","5125","Uint32Array","5126","Float32Array","WEBGL_FILTERS","9728","NearestFilter","9729","LinearFilter","9984","NearestMipMapNearestFilter","9985","LinearMipMapNearestFilter","9986","NearestMipMapLinearFilter","9987","LinearMipMapLinearFilter","WEBGL_WRAPPINGS","33071","ClampToEdgeWrapping","33648","MirroredRepeatWrapping","10497","RepeatWrapping","WEBGL_TEXTURE_FORMATS","6406","AlphaFormat","6407","RGBFormat","6408","RGBAFormat","6409","LuminanceFormat","6410","LuminanceAlphaFormat","WEBGL_TEXTURE_DATATYPES","UnsignedByteType","32819","UnsignedShort4444Type","32820","UnsignedShort5551Type","33635","UnsignedShort565Type","WEBGL_TYPE_SIZES","BackSide","FrontSide","NeverDepth","LessDepth","EqualDepth","LessEqualDepth","GreaterEqualDepth","NotEqualDepth","AlwaysDepth","AddEquation","SubtractEquation","ReverseSubtractEquation","ZeroFactor","OneFactor","SrcColorFactor","OneMinusSrcColorFactor","SrcAlphaFactor","OneMinusSrcAlphaFactor","DstAlphaFactor","OneMinusDstAlphaFactor","DstColorFactor","OneMinusDstColorFactor","SrcAlphaSaturateFactor","SCALAR","VEC2","VEC3","VEC4","MAT2","MAT3","MAT4","PATH_PROPERTIES","translation","weights","INTERPOLATION","CUBICSPLINE","InterpolateSmooth","LINEAR","InterpolateLinear","STEP","InterpolateDiscrete","ALPHA_MODES","resolveURL","test","addMorphTargets","mesh","meshDef","primitiveDef","accessors","targets","morphAttributes","normal","morphTargets","positionAttribute","normalAttribute","attributeName","POSITION","attributes","jl","setXYZ","getX","getY","getZ","morphNormals","updateMorphTargets","morphTargetInfluences","isPrimitiveEqual","indices","attribA","attribB","keysA","keysB","getCachedGeometry","newPrimitive","cached","primitive","primitiveCache","textureLoader","TextureLoader","fileLoader","markDefs","getMultiDependencies","dependencies","nodeDefs","nodes","skinDefs","skins","meshDefs","meshes","meshReferences","meshUses","skinIndex","skinLength","joints","isBone","nodeIndex","nodeLength","nodeDef","skin","isSkinnedMesh","getDependency","cacheKey","dependency","charAt","toUpperCase","getDependencies","defs","types","results","pendings","loadBuffer","bufferIndex","bufferDef","buffers","uri","reject","loadBufferView","bufferViewIndex","bufferViewDef","bufferViews","loadAccessor","accessorIndex","accessorDef","pendingBufferViews","bufferView","sparse","bufferAttribute","itemSize","TypedArray","componentType","elementBytes","BYTES_PER_ELEMENT","itemBytes","byteStride","normalized","ib","InterleavedBuffer","InterleavedBufferAttribute","BufferAttribute","itemSizeIndices","TypedArrayIndices","byteOffsetIndices","byteOffsetValues","sparseIndices","sparseValues","setArray","setX","setY","setZ","setW","loadTexture","textureIndex","URL","webkitURL","textureDef","textures","images","sourceURI","isObjectURL","blob","Blob","mimeType","createObjectURL","Loader","Handlers","revokeObjectURL","flipY","internalFormat","sampler","samplers","magFilter","minFilter","wrapS","wrapT","textureName","loadMaterial","materialIndex","materialType","materialDef","materials","materialExtensions","khcExtension","sgExtension","pbrMetallicRoughness","MeshStandardMaterial","metallicRoughness","baseColorFactor","baseColorTexture","metallicFactor","roughnessFactor","metallicRoughnessTexture","doubleSided","alphaMode","alphaTest","alphaCutoff","normalTexture","occlusionTexture","strength","emissiveFactor","emissiveTexture","encoding","sRGBEncoding","extras","loadGeometries","primitives","geometries","BufferGeometry","attributeId","addAttribute","setIndex","loadMesh","meshIndex","Group","depthTest","uv2","uv","useVertexColors","useFlatShading","useSkinning","useMorphTargets","vertexColors","VertexColors","needsUpdate","flatShading","SkinnedMesh","skinning","drawMode","TriangleStripDrawMode","TriangleFanDrawMode","LineSegments","Line","LineLoop","Points","onBeforeRender","loadCamera","cameraIndex","cameraDef","aspectRatio","xfov","yfov","PerspectiveCamera","radToDeg","znear","zfar","OrthographicCamera","xmag","ymag","loadSkin","skinDef","skinEntry","inverseBindMatrices","accessor","loadAnimation","animationIndex","animationDef","tracks","input","parameters","output","inputAccessor","outputAccessor","TypedKeyframeTrack","updateMatrix","NumberKeyframeTrack","QuaternionKeyframeTrack","VectorKeyframeTrack","targetName","interpolation","outputAccessorValues","getW","targetNames","traverse","isMesh","AnimationUtils","arraySlice","AnimationClip","loadNode","Bone","isGroup","Object3D","PropertyBinding","sanitizeNodeName","applyMatrix","quaternion","loadScene","buildNodeHierachy","nodeId","parentObject","allNodes","bones","boneInverses","jointId","jointNode","mat","Skeleton","matrixWorld","sceneIndex","sceneDef","Scene","nodeIds","ModelDef","clicker","enter","scriptManager","exit","accessObject","exists","getAssetURL","getLogger","gltf","computeBoundingSphere","bs","boundingSphere","BG360Def","bg360","imageOffsetAngle","imageCropStartAngle","imageCropEndAngle","onBeforeCompile","matShader","customize","cssStyle","div","innerHTML","classList","setAttribute","divLayer","WebLayer3D","pixelRatio","devicePixelRatio","onLayerCreate","graphid","refresh","previewUpdate","update","regenerateText","Image2DDef","img2d","ratio","GroupDef","GPUParticleShader","UPDATEABLE_ATTRIBUTES","GPUParticles","blending","NormalBlending","PARTICLE_COUNT","maxParticles","PARTICLE_CURSOR","DPR","particleUpdate","onTick","reverseTime","fadeIn","fadeOut","rand","sprite","particleSpriteTex","ctx","CanvasTexture","depthWrite","uTime","uScale","tSprite","defaultAttributeValues","particlePositionsStartTime","particleVelColSizeLife","setDynamic","particleSystem","frustumCulled","attr","getAttribute","updateRange","ttime","geometryUpdate","dispose","old","velocity","acceleration","endColor","positionStartAttribute","startTimeAttribute","velocityAttribute","accelerationAttribute","colorAttribute","endcolorAttribute","sizeAttribute","lifeTimeAttribute","lifetime","sizeRandomness","r","ParticlesDef","particles","pointSize","startColor","positionRandomness","baseVelocity","velocityRandomness","baseColor","colorRandomness","AdditiveBlending","system","spawnParticle","tick","attachTexture","updateSprite","ImageAnchorDef","imageanchor","reactivate","targetImage","imageRealworldWidth","recType","REC_TYPES","SCENE_START","preview","PlaneBufferGeometry","toRad","updateImagePreview","sgp","getGraphObjectById","callback","fireEventAtTarget","startImageRecognizer","stopImageRecognizer","GeoAnchorDef","geoanchor","targetGeoLocation","startGeoTracker","stopGeoTracker","HudAnchorDef","_ObjectDef","hudanchor","getCamera","getThreeObject","stdhints","description","defaultFloor","padding","borderWidth","borderRadius","textColor","borderColor","drawBackground","scriptBody","defaultScene","latitude","longitude","altitude","useAltitude","autoRecenter","SIMPLE_COLORS","sphere","TOTAL_OBJ_TYPES","SCENE","ASSET","BEHAVIOR","BEHAVIOR_SCRIPT","ASSETS_LIST","BEHAVIORS_LIST","ROOT","is3DObjectType","canHaveShape","canBeDeleted","get3DObjectDef","degrees","MIME_TYPES","PNG","JPEG","MP3","AAC","JAVASCRIPT","GLB","MP4","ASSET_TYPES","IMAGE","GLTF","AUDIO","VIDEO","GEOLOCATION","isImageType","toLowerCase","ITEM_ICONS","assets","behavior","behavior_script","audio","video","geolocation","parseBehaviorScript","contents","Function","GLTFAssetView","renderThree","render","initThreeJS","sceneContainer","background","innerHeight","antialias","setPixelRatio","setSize","gammaOutput","vr","appendChild","domElement","vrmanager","VRManager","aspect","updateProjectionMatrix","setAnimationLoop","normalize","GeoAssetView","context","loadCurrentLocation","navigator","getCurrentPosition","coords","quick_setPropertyValue","onMapClick","latlng","lat","lng","updateLocation","ll","latLng","lon","marker","setLatLng","mymap","panTo","d","nextContext","setView","tileLayer","maxZoom","attribution","addTo","customIcon","divIcon","AssetView","renderAsset","alt","controls","playsInline","GLTFAssetView_GLTFAssetView","GeoAssetView_GeoAssetView","addImageAssetFromExpandedURL","assetId","supportsAssetUpload","getAssetsObject","insertChildLast","img","addImageAssetFromFile","ToasterManager","uploadFile","ans","addGLBAssetFromFile","addAudioAssetFromURL","fileType","lastIndexOf","AddImageAssetDialog","view","fileInput","files","switchLocal","switchRemote","selectedFile","typedURL","React","createRef","GridEditorApp_ToggleButton","renderSelectedPanel","PageCanvasView","handleKeypress","onNext","onPrev","tabIndex","PresentationApp","docSwapped","pageIndex","pages","getPages","PageCanvasView_PageCanvasView","GraphAccessor","hasObject","o","insertFirstChild","id2","createProperty","EnumTitleRenderer","STANDARD_PAGE_SIZES","PageSizeRenderer","MetadocEditor","getApp","PresentationApp_PresentationApp","assertThisInitialized","Editor1_MetadocApp","getTitle","getObjectById","addShape","make","addRect","addCircle","addText","addImage","addImageAssetFromURL","deleteSelection","getSelectedShape","deleteSelectedAsset","cutSelection","setClipboard","copySelection","pasteSelection","obj1","getClipboard","obj2","cloneShape","exportSVG","svg","renderSVGWrapper","renderSVGChildren","link","href","encodeURIComponent","download","click","exportPNG","toDataURL","newView","openPresentationView","showAddImageAssetDialog","AddImageAssetDialog_AddImageAssetDialog","imagecache","rect1","out","copyPropDef","margin","rootobj","parts","trim","parseDimension","toSVGString","tgt","t","complete","Image","onload","MetadocApp","_this6","canvasSelected","showAddPopup","acts","addPage","addLayer","GridEditorApp_MenuPopup","getSelectedRoot","zoomIn","zoom","zoomOut","im","addKeyBinding","_this7","attachKeyEvents","GridEditorApp_GridEditorApp","GridEditorApp_Panel","TreeTable_TreeTable","renderCenterPane","PropSheet_PropSheet","MetadocCanvas_MetadocCanvas","AssetView_AssetView","TransformControls","_gizmo","TransformControlsGizmo","_plane","TransformControlsPlane","defineProperty","changeEvent","mouseDownEvent","mouseUpEvent","objectChangeEvent","ray","Raycaster","_tempVector","_tempVector2","_tempQuaternion","Quaternion","_unit","Y","_identityQuaternion","_alignVector","pointStart","pointEnd","rotationAxis","rotationAngle","cameraPosition","cameraQuaternion","cameraScale","parentPosition","parentQuaternion","parentScale","worldPositionStart","worldQuaternionStart","worldScaleStart","worldPosition","worldQuaternion","worldScale","eye","_positionStart","_quaternionStart","_scaleStart","propName","defaultValue","propValue","dispatchEvent","getPointer","event","pointer","changedTouches","button","onContext","onPointerHover","pointerHover","onPointerDown","onPointerMove","pointerDown","pointerMove","onPointerUp","pointerUp","attach","detach","axis","updateMatrixWorld","decompose","dragging","setFromCamera","intersect","intersectObjects","picker","planeIntersect","space","rotationSnap","round","point","applyQuaternion","inverse","translationSnap","setFromMatrixPosition","dot","ROTATION_SPEED","distanceTo","cross","angleTo","setFromAxisAngle","getMode","setMode","setTranslationSnap","setRotationSnap","setSpace","create","isTransformControls","gizmoMaterial","gizmoLineMaterial","LineBasicMaterial","linewidth","matInvisible","matHelper","matRed","matGreen","matBlue","matWhiteTransperent","matYellowTransparent","matCyanTransparent","matMagentaTransparent","matLineRed","matLineGreen","matLineBlue","matLineCyan","matLineMagenta","matLineYellow","matLineGray","matLineYellowTransparent","arrowGeometry","CylinderBufferGeometry","scaleHandleGeometry","BoxBufferGeometry","lineGeometry","Float32BufferAttribute","CircleGeometry","vertices","cos","sin","gizmoTranslate","XYZ","OctahedronBufferGeometry","XY","YZ","XZ","pickerTranslate","helperTranslate","START","END","DELTA","gizmoRotate","E","XYZE","helperRotate","AXIS","pickerRotate","TorusBufferGeometry","gizmoScale","XYZX","XYZY","XYZZ","pickerScale","helperScale","setupGizmo","gizmoMap","gizmo","tag","tempGeometry","tempVector","tempEuler","Euler","alignVector","zeroVector","lookAtMatrix","tempQuaternion","tempQuaternion2","identityQuaternion","unitX","unitY","unitZ","helper","handles","handle","eyeDistance","setFromRotationMatrix","lookAt","atan2","multiplyQuaternions","showX","showY","showZ","_opacity","_color","lerp","setFromEuler","isTransformControlsGizmo","wireframe","dirVector","tempMatrix","isTransformControlsPlane","SceneDef","setDefaultFloor","sceneAnchor","chNode","chObj","ToasterNotification","notification","SceneGraphProvider","beh","SystemFacade","logger","tween","getTweenManager","globalStorage","storage","getGraphObjectByName","trusted","_event","isTrusted","AssetFacade","playMedia","playMediaAsset","stopMediaAsset","getCurrentScene","fireSceneLifecycleEvent","navigateScene","fireMessageAtTarget","captureEvent","ScriptManager","sceneGraphProvider","running","system_cache","bubbling","getAllScenes","graphTarget","getParsedBehaviorAsset","getSystemFacadeFromCache","startTime","deltaTime","lastTime","session","err","stopRunning","fireLifecycleEvent","destroyListeners","getBehaviorsForObject","makeSystemFacade","Tween","WaitTween","dur","duration","ActionTween","fn","ForeverTween","diff","PROP_TYPES","SINGLE","COMPOUND","LERP_TYPES","ELASTIC","easeLinear","to","PropTween","property","propertyType","lerp_type","lerpType","loop","loopCount","reversed","autoReverse","easeOutElastic","ClipTween","speed","mixer","action","clipAction","findByName","setLoop","Infinity","play","setEffectiveTimeScale","prevTime","ParallelTween","isAlive","SequentialTween","_this8","_startNext","cur","TweenManager","Cesium","XRGeospatialAnchor","XRSupport","imageDetectorMap","geoAnchorMap","_workingMatrix","mat4","_identity","_vec","vec3","lastFrameTime","device","xrCanvas","xrContext","_anchoredNodes","Map","that","xr","requestDevice","xrDevice","requestSession","outputContext","alignEUS","worldSensing","xrSession","useEstimatedElevation","nonStandard_setNumberOfTrackedImages","compatibleXRDevice","baseLayer","XRWebGLLayer","userAnimationCallback","requestFrameOfReference","frameOfReference","headFrameOfReference","eyeLevelFrameOfReference","__handleAnimationFrame","_handleAnimationFrame","requestAnimationFrame","frame","ended","pose","getDevicePose","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_step","_iterator","views","Symbol","iterator","next","done","getViewport","projectionMatrix","getViewMatrix","return","anchor","uid","modelMatrix","_handleAnchorUpdateCallback","_handleAnchorUpdate","_handleAnchorDeleteCallback","_handleAnchorDelete","_createSceneAnchor","asyncToGenerator","regenerator_default","mark","_callee","sceneNode","eyeLevel","newAnchor","wrap","_context","abrupt","sent","getTransformTo","addAnchor","addAnchoredNode","_x","_x2","_removeAnchorFromNode","removeAnchor","det","realWorldWidth","_fetchImage","idata","getImageData","documentURI","nonStandard_createDetectionImage","anchorName","nonStandard_activateDetectionImage","anchorStyle","nonStandard_deactivateDetectionImage","lla","Cartographic","createGeoAnchor","getDefaultElevation","getDeviceCartographic","cartographic","_removeAnchorForNode","details","anchoredNode","_mozillaXRViewer","OrbitControls","quat","quatInverse","lastPosition","lastQuaternion","minDistance","maxDistance","minZoom","minPolarAngle","maxPolarAngle","minAzimuthAngle","maxAzimuthAngle","enableDamping","dampingFactor","enableZoom","zoomSpeed","enableRotate","rotateSpeed","enablePan","keyPanSpeed","autoRotate","autoRotateSpeed","enableKeys","UP","mouseButtons","ORBIT","MOUSE","ZOOM","PAN","target0","position0","zoom0","getPolarAngle","spherical","phi","getAzimuthalAngle","theta","saveState","reset","STATE","setFromUnitVectors","up","setFromVector3","rotateLeft","sphericalDelta","makeSafe","panOffset","setFromSpherical","zoomChanged","distanceToSquared","EPS","onMouseWheel","onTouchStart","onTouchEnd","onTouchMove","startEvent","endEvent","ROTATE","DOLLY","TOUCH_ROTATE","TOUCH_DOLLY","TOUCH_PAN","Spherical","rotateStart","rotateEnd","rotateDelta","panStart","panEnd","panDelta","dollyStart","dollyEnd","dollyDelta","getZoomScale","rotateUp","panLeft","objectMatrix","setFromMatrixColumn","panUp","pan","deltaX","deltaY","element","isPerspectiveCamera","targetDistance","tan","fov","clientHeight","isOrthographicCamera","clientWidth","dollyIn","dollyScale","dollyOut","handleMouseDownRotate","handleMouseDownDolly","handleMouseDownPan","subVectors","handleMouseMoveRotate","handleMouseMoveDolly","handleMouseMovePan","handleMouseWheel","handleKeyDown","touches","pageX","pageY","handleTouchStartRotate","handleTouchStartDolly","handleTouchStartPan","handleTouchMoveRotate","handleTouchMoveDolly","handleTouchMovePan","EventDispatcher","defineProperties","noZoom","noRotate","noPan","noKeys","staticMoving","dynamicDampingFactor","Adapter","getSelectedSceneObject","findNode","getCachedBehaviorAsset","sound","audioListener","setBuffer","setVolume","playing_audio","tweenManager","MOVE_SPEED","VRCanvas","moveCameraForward","moveCameraBackward","handleKeyPress","recenterOnSelection","orbitControls","cam","transformChanged","transformDraggingChanged","sc","obj_node_map","rebuildNode","sceneObj","setCurrentSceneWrapper","transformControls","findSceneObjectParent","clickedCanvas","raycaster","getCurrentSceneWrapper","findKnownParent","performClickAction","previewUpdateNodes","current_scene_wrapper","inset","makeNode","insertNodeMapping","addSceneWrapper","wrapper","supportsARKit","setupRenderer","animationLoopWithCamera","animationLoop","saveOrbitControlsState","updateScene","checkAspectRatio","viewMatrix","matrixWorldNeedsUpdate","removeNodeMapping","updateProperty","populateNode","stopAllMedia","resetSceneGraph","stopRecognizers","startRecognizers","startRunning","startFirstScene","boxSizing","flex","overflow","ToasterNotification_ToasterNotification","nodeid","obj3d","orbit_state","restoreOrbitControlsState","dump","_this9","graphObj","threeObj","_this10","media","TranslationArrow","control","startHover","endHover","beginDrag","startPoint","intersection","worldToLocal","oldFilter","intersectionFilter","startPosition","POINTER_MOVE","updateDrag","POINTER_RELEASE","endDrag","endPoint","finalPoint","end","makePlane","makeArrow","makeInputGrabber","POINTER_ENTER","POINTER_EXIT","POINTER_PRESS","TranslateControl","_THREE$Group","Panel2D","canvasTexture","redrawHandler","inside","fpt","contains","comp","findAt","POINTER_CLICK","startDrag","dragSphere","moveDrag","Component2D","Button2D","fsize","normalBg","hoverBg","bg","metrics","Group2D","layout","translate","childProps","deg","YAXIS","ThreeDOFController","stagePos","stageRot","states","touchpad","keystates","ArrowLeft","previous","ArrowRight","ArrowUp","ArrowDown","dir","rotateRight","moveForward","moveBackward","applyAxisAngle","_fire","scanGamepads","updateKeys","gamepads","getGamepads","gamepad","startsWith","buttons","axes","down","addScene","deleteObject","isEmpty","newDoc","switcher","generateAddAssetPopup","showAddServerImageDialog","showAddGLTFAssetDialog","showAddGLBAssetDialog","showAddAudioAssetDialog","showOpenAssetDialog","showAddGeoLocationAssetDialog","editor","currentScene","swapScene","Audio","AudioLoader","ImmersiveVREditor","standardViewClickHandler","isRunning","sceneWrappers","initScene","render3","stats","controller","$","querySelector","container","WebGLRenderer","AudioListener","initContent","VR_DETECTED","removeAttribute","innerText","enterVR","updateSceneOp","documentSwapped","selectedNode","VRStats","editable","Pointer","cameraFollowMouse","mouseSimulatesController","enableLaser","laserLength","stick","controller1","tools","panel2d","button2d","setAll","add3DObject","runButton","color_group","group2d","panel","setColor","defaults","nodeObj","AddGLTFAssetDialog","fileinput","multiple","webkitdirectory","AddGLBAssetDialog","AddAudioAssetDialog","addAudioAssetFromFile","UnsavedDocumentDialog","onAnyway","OpenFileDialog","refreshList","loadDocList","docs","docList","dismiss","removeDoc","generateDocUrl","renderDeleteButton","supportsDocDelete","deleteDoc","OpenAssetDialog","loadAssetList","assetList","isVideoType","addVideoAssetFromURL","isGLTFType","addGLBAssetFromURL","removeAssetSource","addAsset","deleteAsset","ScriptEditor","swap","changeText","updateBehaviorAssetContents","fetchBehaviorAssetContents","lib_default","theme","showGutter","OpenScriptDialog","loadScriptList","scripts","addBehaviorAssetFromURL","removeBehaviorAssetSource","addScript","supportsScriptEdit","deleteScript","CUSTOM_BEHAVIOR_SCRIPT","CUSTOM_SCENE_SCRIPT","QRCanvas","QRCode","QRDialog","wurl","QRCanvas_QRCanvas","PasswordDialog","doPasswordLogin","field","GithubAuthDialog","ErrorCatcher","errorInfo","AssetsManager","assets_url_map","videocache","lg","muted","VideoTexture","VREditor","VREditor_VREditorApp","ImmersiveVREditor_ImmersiveVREditor","getBehaviorsObject","setCachedBehaviorAsset","cacheAssetsList","editIn2D","protocol","pathname","QRDialog_QRDialog","editInVR","viewInVR","nodeName","AddAudioAssetDialog_AddAudioAssetDialog","AddGLTFAssetDialog_AddGLTFAssetDialog","AddGLBAssetDialog_AddGLBAssetDialog","showOpenDocumentDialog","OpenFileDialog_OpenFileDialog","OpenAssetDialog_OpenAssetDialog","showOpenBehaviorDialog","OpenScriptDialog_OpenScriptDialog","showPasswordDialog","PasswordDialog_PasswordDialog","showGithubDialog","GithubAuthDialog_GithubAuthDialog","addCustomBehaviorAsset","TEMPLATE","randi","fname","script","addSceneScript","addBehaviorToObject","properties","behaviorCache","scene1","behaviors","behaviorProps","getCachedBehaviorPropDefs","pname","propdef","ndef","realobj","nodeType","acceptsImageAsset","acceptsVideoAsset","withNone","getFirstSceneObject","ov","cmds","canHaveBehavior","isGLTFFile","VREditor_ColorEditor","VREditor_ScaleEditor","VREditorApp","toggleRunning","dirty","UnsavedDocumentDialog_UnsavedDocumentDialog","user","getUsername","bot","ErrorCatcher_ErrorCatcher","showAddAssetPopup","showAddBehaviorPopup","duplicateDocument","VREditor_RunButton","active","renderLoginButton","ScriptEditor_ScriptEditor","VRCanvas_VRCanvas","supportsAuth","supportsPassword","supportsDocList","ScaleEditor","syncChanged","sync","newvals","RunButton","ColorEditor","showPopup","VREditor_ColorPopup","_this11","ColorPopup","_this12","_this13","attachUtilFunctions","ImmersivePlayer","clickedStart","renderThreeWithCamera","startScene","three_map","current_scene","inter","gobj","obj_map","title_map","behavior_map","behavior_assets","pendingAssets","buildRoot","setCurrentScene","initAssets","initObject","initBehaviors","chnode","documentElement","prom","sceneAnchorNode","removeSceneAnchor","createSceneAnchor","updateAnchoredSceneNode","player","sceneid","isPlaying","_this14","createDetectionImage","_this15","addGeoAnchoredNode","App","showProviderList","providers","openNewProvider","sw","ImmersivePlayer_ImmersivePlayer","zIndex","ReactDOM","App_App","getElementById"],"mappings":"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","file":"static/js/main.14c07ab6.chunk.js","sourcesContent":["/**\n * Created by josh on 11/29/16.\n */\nmodule.exports = {\n    adds: [],\n    add: function add(note) {\n        this.adds.forEach(cb => cb(note))\n    },\n    onAdd: function onAdd(cb) {\n        this.adds.push(cb);\n    },\n    offAdd: function offAdd(cb) {\n        this.adds = this.adds.filter(n => n !== cb)\n    }\n}\n","export function parseOptions(opts) {\n    let loc = document.location\n    if (loc.search) {\n        const parts = loc.search.substring(1).split('&')\n        parts.forEach((part)=>{\n            const keyval = part.split('=')\n            opts[keyval[0]] = keyval[1]\n        })\n    }\n    // console.log(opts)\n    // if(typeof opts.switcher === 'string') {\n    //     console.log(\"parsing switcher\")\n    // }\n    return opts;\n}\n\n\nexport const on = (elem,type,cb) => elem.addEventListener(type,cb)\n\nexport function genID(prefix) {\n    return `${prefix}_${Math.floor(Math.random() * 10000)}`\n}\n\nexport function toFlatString(obj) {\n    return JSON.stringify(obj)\n}\n\n/*\nexport function GET_JSON(path, cb) {\n    return new Promise((res,rej) => {\n        console.log(\"fetching\",path);\n        const req = new XMLHttpRequest()\n        req.onreadystatechange = function() {\n            // console.log(\"got\",req.readyState, req.status)\n            if(req.readyState === 4) {\n                if(req.status === 200) return res(JSON.parse(req.responseText));\n                //if anything other than 200, reject it\n                rej(req)\n            }\n            if(req.status === 500) rej(req);\n            if(req.status === 404) rej(req);\n        };\n        req.open(\"GET\",path,true);\n        req.send();\n    });\n}\n\n\nexport function POST_JSON(path, payload) {\n    // console.log(\"POSTING\",path,payload);\n    return new Promise((res,rej)=>{\n        const req = new XMLHttpRequest();\n        req.onreadystatechange = function() {\n            if(req.readyState === 4 && req.status === 200) {\n                try {\n                    res(JSON.parse(req.responseText));\n                } catch(e) {\n                    rej(e);\n                }\n            }\n            if(req.status === 500) rej(req);\n            if(req.status === 404) rej(req);\n        };\n        req.onerror = (e) => rej(e);\n        req.open(\"POST\",path,true);\n        req.setRequestHeader(\"Content-Type\", \"application/json;charset=UTF-8\");\n        if(typeof payload === 'string') {\n            req.send(payload)\n        } else {\n            req.send(JSON.stringify(payload));\n        }\n    })\n}\n */\n\n\nexport function makePoint(x,y) {\n    return {\n        x:x,\n        y:y,\n        minus: function(pt) {\n            return makePoint(this.x-pt.x, this.y-pt.y);\n        },\n        add: function(pt) {\n            return makePoint(this.x+pt.x, this.y+pt.y);\n        },\n        divide: function(v) {\n            return makePoint(this.x/v,this.y/v)\n        },\n        multiply: function(v) {\n            return makePoint(this.x*v,this.y*v)\n        },\n        idivide: function(v) {\n            return makePoint(\n                Math.floor(this.x/v),\n                Math.floor(this.y/v)\n            )\n        },\n        floor: function() {\n            return makePoint(\n                Math.floor(this.x),\n                Math.floor(this.y)\n            )\n        },\n        distance(pt) {\n            const dx = pt.x-this.x;\n            const dy = pt.y-this.y;\n            return Math.sqrt(dx*dx+dy*dy)\n        },\n        equals(pt) {\n            return pt.x === this.x && pt.y === this.y\n        },\n        toString() {\n            return `(${x},${y})`\n        }\n    }\n}\n\n//use only capital letters, 65->90\nexport function genAlphaID(count) {\n    let id = \"\"\n    for(let i=0; i<count; i++) {\n        id += String.fromCharCode(65 + Math.floor(Math.random() * (90 - 65)))\n    }\n    return id\n}\n\nexport function setQuery(obj) {\n    const oldOpts = parseOptions({})\n    const final = {}\n    Object.keys(oldOpts).forEach(key=> final[key] = oldOpts[key])\n    Object.keys(obj).forEach(key=> final[key] = obj[key])\n    const query = Object.keys(final).map((key)=>`${key}=${final[key]}`).join('&')\n    window.history.pushState(obj,'a title','?'+query)\n}\nexport function toQueryString(obj) {\n    return Object.keys(obj).map((key)=>`${key}=${obj[key]}`).join('&')\n}\n\n\nexport function shallowCopy(obj) {\n    const out = {};\n    Object.keys(obj).forEach((key) => out[key] = obj[key])\n    return out;\n}\n","import React, {Component} from 'react'\nimport {PopupManager, VBox} from 'appy-comps'\nimport {makePoint} from '../utils'\n\nconst GridLayout = (props) => {\n    let clss = \"grid fill\";\n    let leftWidth = props.leftWidth\n    let rightWidth = props.rightWidth\n    if (!props.showLeft) {\n        clss += ' hide-left'\n        leftWidth = 0\n    }\n    if (!props.showRight) {\n        clss += ' hide-right'\n        rightWidth = 0\n    }\n    const cols = `\n    [left] ${leftWidth}px\n    [left-resize] 2px\n    [center] auto\n    [right-resize] 2px\n    [right] ${rightWidth}px\n    `\n    const style = {gridTemplateColumns:cols}\n    return <div className={clss} style={style}>{props.children}</div>\n};\n\nexport const Toolbar = (props) => {\n    let cls = \"toolbar\";\n    if (props.left) cls += \" left\";\n    if (props.right) cls += \" right\";\n    if (props.bottom) cls += \" bottom\";\n    if (props.top) cls += \" top\";\n    if (props.center) cls += \" center\";\n    if (props.middle) cls += \" middle\";\n    if (props.scroll) cls += \" scroll\";\n    return <div className={cls}>{props.children}</div>\n};\nexport const Panel = (props) => {\n    let cls = 'panel';\n    if (props.left) cls += \" left\";\n    if (props.right) cls += \" right\";\n    if (props.bottom) cls += \" bottom\";\n    if (props.top) cls += \" top\";\n    if (props.center) cls += \" center\";\n    if (props.middle) cls += \" middle\";\n    if (props.scroll) cls += \" scroll\";\n    if(props.transparent) cls += \" transparent\"\n    return <div className={cls}>{props.children}</div>\n};\nexport const Spacer = (props) => {\n    return <span className='spacer'/>\n};\n\nexport const ToggleButton = (props) => {\n    const {selected, ...rest} = props\n    const clss = selected?\"selected\":\"\"\n    return <button className={clss} {...rest}></button>\n}\n\nexport const MenuPopup = (props) => {\n    return <VBox className={\"popup-menu\"}>\n        {props.actions.map((act,i)=>{\n            if(act.divider) return <div className=\"divider\" key={i}></div>\n            let enabled = false\n            if(typeof act.enabled === 'undefined') enabled = true\n            if(act.enabled === true) enabled = true\n            return <button  key={i}\n                            disabled={!enabled}\n                            onClick={()=>{\n                PopupManager.hide();\n                if(act.fun) act.fun()\n            }}><i className={'fa fa-' + act.icon}/> {act.title}</button>\n        })}\n    </VBox>\n\n}\n\nexport default class GridEditorApp extends Component {\n    constructor(props) {\n        super(props)\n        this.state = {\n            showLeft: true,\n            showRight: true,\n            leftWidth:250,\n            rightWidth:250,\n            dragSide:'none'\n        }\n    }\n    toggleLeftPane = (e) => this.setState({showLeft: !this.state.showLeft})\n    toggleRightPane = (e) => this.setState({showRight: !this.state.showRight})\n    onMouseDownLeft = (e) => {\n        e.preventDefault()\n        e.stopPropagation()\n        this.setState({dragSide:'left'})\n        window.addEventListener('mousemove',this.onMouseMove)\n        window.addEventListener('mouseup',this.onMouseUp)\n    }\n    onMouseDownRight = (e) => {\n        e.preventDefault()\n        e.stopPropagation()\n        this.setState({dragSide:'right'})\n        window.addEventListener('mousemove',this.onMouseMove)\n        window.addEventListener('mouseup',this.onMouseUp)\n    }\n    onMouseMove = (e) => {\n        e.preventDefault()\n        e.stopPropagation()\n        const cursor = makePoint(e.clientX, e.clientY)\n        if(this.state.dragSide === 'left')  this.setState({leftWidth:cursor.x})\n        if(this.state.dragSide === 'right') this.setState({rightWidth:window.innerWidth-cursor.x})\n    }\n    onMouseUp = (e) => {\n        e.preventDefault()\n        e.stopPropagation()\n        window.removeEventListener('mousemove', this.onMouseMove)\n        window.removeEventListener('mouseup', this.onMouseUp)\n    }\n    render() {\n        return <GridLayout showLeft={this.state.showLeft}\n                           showRight={this.state.showRight}\n                           leftWidth={this.state.leftWidth}\n                           rightWidth={this.state.rightWidth}\n        >\n            <Toolbar center bottom>\n                <button className={'fa' + (this.state.showLeft ? ' fa-caret-left' : ' fa-caret-right')}\n                        onClick={this.toggleLeftPane}/>\n                <Spacer/>\n                {this.props.bottomText}\n                <Spacer/>\n                <button className={'fa' + (this.state.showRight ? ' fa-caret-right' : ' fa-caret-left')}\n                        onClick={this.toggleRightPane}/>\n            </Toolbar>\n\n            <div className={'left-resize'}  onMouseDown={this.onMouseDownLeft}/>\n            <div className={'right-resize'} onMouseDown={this.onMouseDownRight}/>\n\n            {this.props.children}\n        </GridLayout>\n    }\n}\n","\n\nexport const SELECTION_MANAGER = {\n    CHANGED:'CHANGED',\n    DROP_TARGET_CHANGED:'DROP_TARGET'\n}\n\nclass SelectionManager {\n    constructor(props) {\n        this.listeners = {};\n        this.selected = [];\n        this.dropTarget = null;\n        this.clip = null\n    }\n    on(type,cb) {\n        if(!this.listeners[type]) this.listeners[type] = [];\n        this.listeners[type].push(cb);\n    }\n    off(type,cb) {\n        const index = this.listeners[type].indexOf(cb)\n        if(index>=0) this.listeners[type].splice(index,1)\n    }\n    fire(type, value) {\n        if(!this.listeners[type]) this.listeners[type] = [];\n        this.listeners[type].forEach((cb) => cb(value));\n    }\n    setSelection(node) {\n        this.selected = [node]\n        this.fire(SELECTION_MANAGER.CHANGED,this)\n    }\n    addToSelection(node) {\n        this.selected.push(node)\n        this.fire(SELECTION_MANAGER.CHANGED,this)\n    }\n    clearSelection() {\n        this.selected = []\n        this.fire(SELECTION_MANAGER.CHANGED,this)\n    }\n    isSelected(node) {\n        return (this.selected.indexOf(node) >= 0)\n    }\n    getSelection() {\n        if(this.selected.length === 0) return null;\n        return this.selected[0];\n    }\n    isEmpty() {\n        return this.selected.length === 0\n    }\n    getFullSelection() {\n        return this.selected\n    }\n    setDropTarget(node) {\n        if(this.dropTarget !== node) {\n            this.dropTarget = node;\n            this.fire(SELECTION_MANAGER.DROP_TARGET_CHANGED, this.dropTarget)\n        }\n    }\n    getDropTarget() {\n        return this.dropTarget\n    }\n    setDropType(type) {\n        this.dropType = type\n    }\n    getDropType() {\n        return this.dropType\n    }\n\n    setClipboard(clip) {\n        this.clip = clip\n    }\n    getClipboard() {\n        return this.clip\n    }\n}\n\nexport default new SelectionManager();\n","import React, { Component } from 'react'\nimport {makePoint} from \"../utils\"\nimport hsluv from 'hsluv'\nimport {PopupManager} from \"appy-comps\"\n\nexport default class HSLUVColorPicker extends Component {\n    constructor(props) {\n        super(props)\n\n        const comps = hsluv.hexToHsluv(props.value)\n        this.state = {\n            hue:comps[0],\n            lightness:comps[1],\n            value:comps[2],\n        }\n        console.log(\"the current value is\",props.value, hsluv.hexToHsluv(props.value))\n    }\n    componentDidMount() {\n        this.redraw();\n    }\n    canvasToPoint(e) {\n        const canvasBounds = this.canvas.getBoundingClientRect()\n        const pt = makePoint(e.clientX, e.clientY).minus(makePoint(canvasBounds.x,canvasBounds.y))\n        const h = this.canvas.height;\n        const w = this.canvas.width;\n        const f = makePoint(pt.x/w*100, pt.y/h*100)\n        return f;\n    }\n    mousePress = (e) => {\n        const pt = this.canvasToPoint(e)\n        this.setState({lightness:pt.x, value:pt.y})\n        this.redraw()\n        this.pressed = true;\n    }\n    mouseMove = (e) => {\n        if(!this.pressed) return\n        const pt = this.canvasToPoint(e)\n        this.setState({lightness:pt.x, value:pt.y})\n        this.redraw()\n    }\n    mouseUp = (e) => {\n        this.pressed = false\n        this.redraw()\n    }\n    redraw = () => {\n        this.drawPicker()\n        this.drawSlider()\n        this.drawIndicator()\n    }\n    drawPicker() {\n        const canvas = this.canvas\n        if(!canvas) return\n        const c = this.canvas.getContext('2d')\n        let w = 100\n        let h = 100\n        const hue = Math.floor(this.state.hue)\n        for(let i=0; i<=4; i++) {\n            for(let j=0; j<=4; j++) {\n                let color = hsluv.hsluvToHex([hue,i*25,j*25])\n                if(color.length > 7) color = '#000000'\n                c.fillStyle = color\n                c.fillRect(i*20,j*20,20,20)\n            }\n        }\n        const g = 20\n        const cp = this.livalToCanvas(this.state.lightness, this.state.value)\n        c.strokeStyle = 'white'\n        c.strokeRect(Math.floor(cp.x/g)*g, Math.floor(cp.y/g)*g,g,g)\n        c.strokeStyle = 'black'\n        c.strokeRect(Math.floor(cp.x/g)*g+1, Math.floor(cp.y/g)*g+1,g-2,g-2)\n\n        c.strokeStyle = 'black';\n        c.lineWidth = 1.0\n        c.strokeRect(0,0,w,h)\n    }\n\n    livalToCanvas = (l,v) => {\n        return makePoint(l/100*100,v/100*100)\n    }\n\n    mouseToCanvas = (e) => {\n        const bounds = e.target.getBoundingClientRect()\n        return makePoint(e.clientX, e.clientY).minus(makePoint(bounds.x,bounds.y))\n    }\n\n    canvasToHue(pt) {\n        return Math.floor(pt.x/this.slider.width*360);\n    }\n    hueToCanvas(hue) {\n        return hue/360*this.slider.width\n    }\n    mousePressSlider = (e) => {\n        this.sliderPressed = true\n        const pt = this.mouseToCanvas(e)\n        const hue = this.canvasToHue(pt)\n        this.setState({hue:hue})\n        setTimeout(this.redraw,100)\n    }\n    mouseMoveSlider = (e) => {\n        if(!this.sliderPressed) return\n        const pt = this.mouseToCanvas(e)\n        const hue = this.canvasToHue(pt)\n        this.setState({hue:hue})\n        setTimeout(this.redraw,100)\n    }\n    mouseUpSlider = () => {\n        this.sliderPressed = false\n    }\n    drawSlider() {\n        const g = 10\n        const c = this.slider.getContext('2d')\n        const w = this.slider.width\n        const h = this.slider.height\n        c.fillStyle = 'red';\n        c.fillRect(0,0,w,h)\n        for(let x=0; x<w; x+=g) {\n            let hue = this.canvasToHue(makePoint(x,0))\n            let color = hsluv.hsluvToHex([hue,100,50])\n            if(color.length > 7) color = '#000000'\n            c.fillStyle = color\n            c.fillRect(x,0,g,h)\n        }\n        c.strokeStyle = 'black'\n        c.lineWidth = 1.0\n        const x = Math.floor(this.hueToCanvas(this.state.hue)/g)*g\n        c.strokeRect(x,0,g,h)\n        c.strokeRect(0,0,w,h)\n    }\n\n    drawIndicator() {\n        const c = this.indicator.getContext('2d')\n        const w = this.indicator.width\n        const h = this.indicator.height\n        let color = hsluv.hsluvToHex([Math.floor(this.state.hue),Math.floor(this.state.lightness),Math.floor(this.state.value)])\n        if(color.length > 7) color = '#000000'\n        c.fillStyle = color\n        c.fillRect(0,0,w,h)\n        c.strokeStyle = 'black'\n        c.lineWidth = 1.0\n        c.strokeRect(0,0,w,h)\n    }\n\n    close = () => {\n        let color = hsluv.hsluvToHex([Math.floor(this.state.hue),Math.floor(this.state.lightness),Math.floor(this.state.value)])\n        if(color.length > 7) color = '#000000'\n        this.props.onSelect(color)\n        PopupManager.hide()\n    }\n\n    render() {\n        return <div style={{\n            display:'flex',\n            flexDirection:'column',\n            alignItems:'center'\n        }}>\n            <canvas\n                ref={(can)=>this.canvas = can}\n                width={100} height={100}\n                onMouseDown={this.mousePress}\n                onMouseMove={this.mouseMove}\n                onMouseUp={this.mouseUp}\n            />\n            <canvas\n                ref={(can)=>this.slider = can}\n                width={100} height={30}\n                onMouseDown={this.mousePressSlider}\n                onMouseMove={this.mouseMoveSlider}\n                onMouseUp={this.mouseUpSlider}\n            />\n            <canvas\n                ref={(can)=>this.indicator = can}\n                width={32} height={32}\n                onClick={this.close}\n            />\n        </div>\n    }\n}","import {getInfoURL, getUserURL} from '../TreeItemProvider'\nimport * as ToasterMananager from './ToasterManager'\nimport {genID} from \"../utils\"\n\nexport const USER_CHANGE = 'USER_CHANGE'\nexport const CONNECTED = \"CONNECTED\"\nclass AuthModuleSingleton {\n    constructor() {\n        this.listeners = {}\n        this.supported = false\n        this.doclistSupported = false\n        this.docDeleteSupported = false\n        this.assetUploadSupported = false\n        this.scriptEditingSupported = false\n        this.passwordSupported = false\n        this.connected = false\n        this.serverID = genID(\"serverid\")\n    }\n    on(type,cb) {\n        if(!this.listeners[type]) this.listeners[type] = []\n        this.listeners[type].push(cb)\n    }\n    fire(type,payload) {\n        if(!this.listeners[type]) this.listeners[type] = []\n        this.listeners[type].forEach(cb => cb(payload))\n    }\n\n    init() {\n        if(this.isLoggedIn()) this.doclistSupported = true\n        fetch(getInfoURL()).then(res => res.json())\n            .then(info => {\n                console.info(\"Server Info:\",info)\n                if(info.authentication === true)      this.supported = true\n                if(info.passwordSupported === true)   this.passwordSupported = true\n                if(info.assetUpload === true)         this.assetUploadSupported = true\n                if(info.scriptEditing === true)       this.scriptEditingSupported = true\n                if(info.docDeleteSupported === true)  this.docDeleteSupported = true\n                this.serverID = getInfoURL().replace(/[\\.\\:\\/]/g,\"\")\n\n\n                this.getJSON(getUserURL()).then(res=>{\n                    if(!res.success) {\n                        this.logout()\n                    } else {\n                        this.fire(USER_CHANGE)\n                        this.doclistSupported = true\n                    }\n                    this.connected = true\n                    this.fire(CONNECTED)\n                }).then(()=>{\n                    this.connected = true\n                    this.fire(CONNECTED)\n                })\n            })\n    }\n    isConnected() {\n        return this.connected\n    }\n\n    isLoggedIn() {\n        if(localStorage.getItem('access-token')) return true\n        return false\n    }\n    supportsPassword() {\n        return this.passwordSupported\n    }\n    supportsAuth() {\n        return this.supported\n    }\n    supportsDocList() {\n        return this.doclistSupported\n    }\n    supportsAssetUpload() {\n        return this.assetUploadSupported\n    }\n    supportsScriptEdit() {\n        return this.scriptEditingSupported\n    }\n    supportsDocDelete() {\n        return this.docDeleteSupported\n    }\n\n    login = (res) => {\n        this.win = window.open(res.url,'_blank')\n        window.addEventListener('message',this.authCallback)\n        if(this.win) this.win.focus()\n    }\n    logout = () => {\n        localStorage.clear()\n        this.doclistSupported = false\n        this.fire(USER_CHANGE)\n    }\n    doPasswordLogin (password) {\n        localStorage.setItem('access-token',password)\n        return this.getJSON(getUserURL()).then(res=>{\n            if(res.success === true) {\n                console.log(\"the logged in response is\", res)\n                this.doclistSupported = true\n                ToasterMananager.add(\"login succeeded\")\n                this.fire(USER_CHANGE)\n            } else {\n                ToasterMananager.add(\"login failed\")\n                localStorage.clear()\n                this.doclistSupported = false\n                this.fire(USER_CHANGE)\n            }\n        })\n\n    }\n    authCallback = (msg) => {\n        this.setUserData(msg.data.payload)\n        this.win.close()\n        window.removeEventListener('message',this.authCallback)\n        this.doclistSupported = true\n        this.fire(USER_CHANGE)\n        ToasterMananager.add(\"login succeeded\")\n    }\n    setUserData(data) {\n        localStorage.setItem('access-token',data.accessToken)\n    }\n    getAccessToken() {\n        return localStorage.getItem('access-token')\n    }\n\n    getUsername() {\n        return this.getAccessToken()\n    }\n\n    getServerID() {\n        return this.serverID\n    }\n\n    fetch(url, options) {\n        options.mode = 'cors'\n        options.cache = 'no-cache'\n        if(!options.headers) options.headers = {}\n        options.headers[\"access-key\"] =  AuthModule.getAccessToken()\n        console.log(\"fetching\",url,'with options',options)\n        return fetch(url,options)\n    }\n    getJSON(url) {\n        return this.fetch(url,{\n            method:'GET',\n            headers: {\n                \"Content-Type\": \"application/json\",\n            }\n        }).then(res => res.json())\n    }\n\n}\n\nexport const AuthModule = new AuthModuleSingleton()\n","import {setQuery} from './utils'\nimport Selection from './SelectionManager'\nimport {AuthModule} from './vr/AuthModule'\n\nexport const TREE_ITEM_PROVIDER = {\n    EXPANDED_CHANGED:'EXPANDED_CHANGED',\n    STRUCTURE_CHANGED:'STRUCTURE_CHANGED',\n    STRUCTURE_ADDED:'STRUCTURE_ADDED',\n    STRUCTURE_REMOVED:'STRUCTURE_REMOVED',\n    PROPERTY_CHANGED:'PROPERTY_CHANGED',\n    CLEAR_DIRTY:'CLEAR_DIRTY',\n    SAVED:'SAVED',\n    DOCUMENT_SWAPPED:'DOCUMENT_SWAPPED',\n}\n\nconst URLS = {\n    BASE:'https://vr.josh.earth/generaled/api/'\n    // BASE:'https://buttered-elk.glitch.me/'\n    // BASE:'http://localhost:1234/'\n}\nexport function getDocsURL() {\n    return URLS.BASE + 'doc/'\n}\nexport function getAssetsURL() {\n    return URLS.BASE + 'asset/'\n}\nexport function getScriptsURL() {\n    return URLS.BASE + 'scripts/'\n}\nexport function getLoginURL() {\n    return URLS.BASE + 'auth/github/login'\n}\nexport function getInfoURL() {\n    return URLS.BASE +'info'\n}\nexport function getUserURL() {\n    return URLS.BASE + 'userinfo'\n}\n\n// export const SERVER_URL = \"http://localhost:30065/doc/\"\n// export const SERVER_URL_ASSETS = \"http://localhost:30065/asset/\"\n// export const SERVER_URL = \"http://localhost:55555/doc/\"\n// export const SERVER_URL = \"https://vr.josh.earth/generaled/api/doc/\"\n// export const BASE_URL = \"http://localhost:55555/\"\n// export const BASE_URL = \"https://vr.josh.earth:55555/\"\n// export const SERVER_URL_ASSETS = \"http://localhost:55555/asset/\"\n// export const SERVER_URL_ASSETS = \"https://vr.josh.earth/generaled/api/asset/\"\n// export const SERVER_URL_ASSETS = \"http://josh.earth:30068/asset/\"\n// export const LOGIN_URL = \"http://localhost:55555/auth/github/login\"\n// export const LOGIN_URL = \"https://vr.josh.earth/generaled/api/auth/github/login\"\n\nclass TreeItemProviderInterface {\n    /** register a listener */\n    on(type, cb) {\n        throw new Error(`interface 'on' not implemented`)\n    }\n\n    /** un-register a listener */\n    off(type, cb) {\n        throw  new Error(\"interface 'off' not implemented\")\n    }\n\n    /** fire an event. internal use */\n    fire(type, value) {\n        throw  new Error(\"interface 'fire' not implemented\")\n    }\n\n    // ============== tree interface\n    /** returns the root of the tree structure */\n    getSceneRoot() {\n        throw new Error(\"interface 'getSceneRoot' not implemented\")\n    }\n    /** delete child node */\n    deleteChild(child) { throw new Error(\"deleteChild not implemented yet\")}\n    /** append child to the parent */\n    appendChild(parent,child) { throw new Error(\"appendChild not implemented yet\")}\n    /** insert child node before a particular other node */\n    insertNodeBefore(node,sibling) { throw new Error(\"insertNodeBefore() not implemented yet\")}\n    /** find a given node by ID */\n    findNodeById(id) { throw new Error(\"findNodeById() not implemented yet\")}\n    /** find the parent of the given node */\n    findParent(node) { throw new Error(\"findParent() not implemented yet\")}\n    /** return true if the given node has children */\n    hasChildren(node) { throw new Error(\"hasChildren() not implemented yet\")}\n    /** returns an array of children for the parent node */\n    getChildren(node) { throw new Error(\"getChildren() not implemented yet\")}\n\n    // ========= Tree View support =========\n\n    /** returns true if item is expanded */\n    isExpanded(item) {\n        throw  new Error(\"interface 'isExpanded' not implemented\")\n    }\n\n    /** return a react component for the context menu of the item in the tree view */\n    calculateContextMenu(item) {\n        throw new Error(\"calculateContextMenu() not implemented yet\")\n    }\n    /** toggles the collapsed state of the item */\n    toggleItemCollapsed(item) {\n        throw new Error(\"toggleItemCollapsed() not implemented yet\")\n    }\n    /** returns a react component to display the item in the tree view */\n    getRendererForItem(item) {\n        throw new Error(\"getRendererForItem() not implemented yet\")\n    }\n\n\n\n    // ================ properties ==================\n    /** set the property value using a prop def */\n    setPropertyValue(item, def, value) {\n        throw new Error(\"interface setPropertyValue not implemented\")\n    }\n    setPropertyValueByName(child,name,value) { throw new Error(`interface 'setPropertyValueByName() not implemented'`)}\n    /** return an array of property definitions for the specified tree item */\n    getProperties(item) { throw new Error(`interface 'getProperties()' not implemented`) }\n\n\n    // ================ doc def stuff\n    getDocId() {  throw new Error(\"getDocId() not implemented\")  }\n    getDocType() {  throw new Error(\"getDocType() not implemented\")  }\n    getApp() { throw new Error(\"getApp() not implemented\")  }\n    getTitle() { throw new Error(\"getTitle() not implemented\") }\n}\n\nexport default class TreeItemProvider extends TreeItemProviderInterface {\n    constructor(options) {\n        super()\n        this.listeners = {};\n        this.expanded_map = {};\n        this.docid = null\n        // URLS.BASE = SERVER_URL\n        if(options.SERVER_URL) {\n            URLS.BASE = `https://${options.SERVER_URL}/`\n        }\n        console.log(\"using server\",URLS.BASE)\n        AuthModule.init()\n    }\n\n    on(type, cb) {\n        if (!this.listeners[type]) this.listeners[type] = [];\n        this.listeners[type].push(cb);\n    }\n\n    fire(type, value) {\n        if (!this.listeners[type]) this.listeners[type] = [];\n        this.listeners[type].forEach((cb) => cb(value));\n    }\n\n    off(type, cb) {\n        if (this.listeners[type]) this.listeners[type] = this.listeners[type].filter(list => list !== cb)\n    }\n\n    isExpanded(item) {\n        if (!item.id) item.id = \"\" + Math.random();\n        if (typeof this.expanded_map[item.id] === 'undefined') this.expanded_map[item.id] = true;\n        return this.expanded_map[item.id];\n    }\n    toggleItemCollapsed(item) {\n        const current = this.isExpanded(item);\n        this.expanded_map[item.id] = !current;\n        this.fire(TREE_ITEM_PROVIDER.EXPANDED_CHANGED,item);\n    }\n\n\n    setPropertyValue(item, def, value) {\n        throw new Error(\"subclass of TreeItemProvider must implement setPropertyValue\")\n    }\n\n    genID = (prefix) => {\n        return `${prefix}_${Math.floor(Math.random() * 1000*1000*1000)}`\n    }\n\n    setDocument(doc, docid) {\n        this.root = doc\n        this.docid = docid\n        this.fire(TREE_ITEM_PROVIDER.STRUCTURE_CHANGED, {\n            provider:this\n        });\n    }\n\n    getDocId() {\n        return this.docid\n    }\n\n    save = () => {\n        console.info(\"saving\",this.getSceneRoot())\n        const payload_obj = {\n            doc:this.getSceneRoot(),\n            type:this.getDocType(),\n            id:this.getDocId()\n        }\n        const payload_string = JSON.stringify(payload_obj,(key,value)=>{\n            if(key === 'parent') return undefined\n            return value\n        })\n        console.info(\"doc is\",payload_string)\n        return AuthModule.fetch(getDocsURL()+this.docid, {\n            method:'POST',\n            body: payload_string,\n            headers: {\n                \"Content-Type\": \"application/json\"\n            },\n        })\n            .then(res => res.json())\n            .then((res)=>{\n            console.log(\"Success result is\",res)\n            setQuery({mode:'edit',doc:this.docid, doctype:this.getDocType()})\n            this.fire(TREE_ITEM_PROVIDER.SAVED,true)\n        }).catch((e)=> console.log(\"error\",e))\n    }\n    loadDoc(docid) {\n        console.log(\"need to load the doc\",docid)\n        AuthModule.getJSON(getDocsURL()+docid).then((payload)=>{\n            console.log(\"got the doc\",payload)\n            if(payload.type !== this.getDocType()) throw new Error(\"incorrect doctype for this provider\",payload.type)\n            this.setDocument(payload.doc,payload.id)\n        }).catch((e)=>{\n            console.warn(\"missing doc\",e)\n            this.setDocument(this.makeEmptyRoot(),this.genID('doc'))\n            setQuery({mode:'edit',doc:this.docid, doctype:this.getDocType()})\n        })\n    }\n    reloadDocument() {\n        const spath = this.generateSelectionPath(Selection.getSelection());\n        console.log(\"got the path\",spath)\n        AuthModule.getJSON(getDocsURL()+this.docid).then((payload)=>{\n            if(payload.type !== this.getDocType()) throw new Error(\"incorrect doctype for this provider\",payload.type)\n            this.setDocument(payload.doc,payload.id)\n            this.fire(TREE_ITEM_PROVIDER.CLEAR_DIRTY,true)\n            const newsel = this.findNodeFromSelectionPath(this.getSceneRoot(),spath)\n            console.log(\"set new selection to \", newsel)\n            Selection.setSelection(newsel)\n        }).catch((e)=>{\n            console.warn(\"couldn't reload the doc\",e)\n        })\n\n    }\n\n    /* required functions for subclasses */\n\n    generateSelectionPath() {\n        throw new Error(\"generateSelectionPath not implemented\")\n    }\n    findNodeFromSelectionPath() {\n        throw new Error(\"findNodeFromSelectionPath not implemented\")\n    }\n    makeEmptyRoot() {\n        throw new Error(\"makeEmptyRoot() not implemented\")\n    }\n\n    getSceneRoot() {\n        return this.root;\n    }\n\n    uploadFile(file) {\n        return new Promise((res,rej)=>{\n            const fd = new FormData()\n            fd.append('file',file)\n            console.info(\"filesize is\",file.size, file.name);\n            const xml = new XMLHttpRequest()\n            xml.onreadystatechange = () => console.log(`ready state = ${xml.readyState} status ${xml.status}`)\n            xml.addEventListener('progress',(e)=>console.log(`progress`))\n            xml.addEventListener('load',(e)=> res(xml.response))\n            xml.addEventListener('error',(e)=>console.log(`error`))\n            xml.addEventListener('abort',(e)=>console.log(`abort`))\n            const url = getAssetsURL()+file.name;\n            console.info(\"uploading to \", url)\n            xml.responseType = 'json'\n            xml.open('POST',url)\n            xml.setRequestHeader('access-key',AuthModule.getAccessToken())\n            xml.send(file)\n        })\n    }\n\n\n    hasChildren = (item) => item && item.children && item.children.length\n    getChildren = (item) => item.children\n\n}\n","import React, {Component} from \"react\";\n\nexport class StringEditor extends Component {\n    keypressed = (e) => {\n        if(e.charCode === 13) this.props.onCommit();\n    }\n\n    render() {\n        const prop = this.props.def;\n        if (prop.hasHints()) {\n            const hints = prop.getHints()\n            if (hints.multiline) {\n                return <textarea value={this.props.value}\n                                 onChange={this.props.onChange}\n                                 onBlur={this.props.onBlur}\n                />\n            }\n        }\n        return <input type='string'\n                      value={this.props.value}\n                      onChange={this.props.onChange}\n                      onKeyPress={this.keypressed}\n                      onBlur={this.props.onBlur}\n        />\n    }\n}","import React, {Component} from \"react\";\nimport {HBox, PopupManager, VBox} from \"appy-comps\";\n\nconst EnumPicker = (props) => {\n    const Rend = props.renderer\n    const items = props.values.map(val=>\n        <HBox\n            key={val}\n            onClick={(e)=>props.onSelect(val)}>\n            <Rend value={val} def={props.def} obj={props.obj} provider={props.provider}/>\n        </HBox>\n    )\n    return <VBox className=\"popup-menu\">{items}</VBox>\n}\n\nconst DefaultEnumRenderer = (props) => {\n    let value = \"\"\n    if(typeof props.value !== 'undefined' && props.value !== null) {\n        value = props.value.toString()\n    }\n    return <span>{value}</span>\n}\n\nexport class EnumEditor extends Component {\n    calculateRenderer() {\n        const proxy = this.props.def\n        const obj = this.props.obj\n        if (!this.props.provider.getRendererForEnum) return DefaultEnumRenderer\n        const renderer = this.props.provider.getRendererForEnum(proxy.getKey(), obj)\n        if (!renderer) return DefaultEnumRenderer\n        return renderer\n    }\n\n    calculateValues() {\n        const vals = this.props.provider.getValuesForEnum(this.props.def.getKey(), this.props.obj, this.props.def)\n        if (!vals) {\n            console.log(`no values for enum ${this.props.def.getKey()}`);\n            return []\n        }\n        return vals\n    }\n\n    open = (e) => {\n        PopupManager.show(<EnumPicker\n            values={this.calculateValues()}\n            renderer={this.calculateRenderer()}\n            onSelect={this.selectValue}\n            provider={this.props.provider}\n        />, e.target)\n    }\n    selectValue = (value) => {\n        PopupManager.hide()\n        this.props.onChange(value)\n    }\n    renderValue = (value) => {\n        const def = this.props.def\n        const obj = this.props.obj\n        const Rend = this.calculateRenderer()\n        return <Rend value={value} def={def} obj={obj} provider={this.props.provider}/>\n    }\n\n    render() {\n        return <button onClick={this.open}>{this.renderValue(this.props.value)}</button>\n    }\n}","import React, {Component} from \"react\";\nimport {VBox} from \"appy-comps\";\nimport {EnumEditor} from \"./EnumEditor\";\n\nconst DefaultEnumRenderer = (props) => {\n    let value = \"\"\n    if(typeof props.value !== 'undefined') {\n        value = props.value.toString()\n    }\n    return <span>{value}</span>\n}\n\nexport class ArrayEditor extends Component {\n    constructor(props) {\n        super(props)\n        this.state = {\n            showEditor: false,\n            value: \"\"\n        }\n\n    }\n\n    calculateRenderer() {\n        const def = this.props.def\n        const obj = this.props.obj\n        if (!this.props.provider.getRendererForEnum) return DefaultEnumRenderer\n        const renderer = this.props.provider.getRendererForEnum(def.key, obj)\n        if (!renderer) return DefaultEnumRenderer\n        return renderer\n    }\n\n    addValue = () => {\n        this.setState({showEditor: true})\n    }\n    enumChanged = (value) => {\n        const arr = this.props.value.slice();\n        arr.push(value)\n        this.props.onChange(arr)\n    }\n\n    render() {\n        // const def = this.props.def\n        // const obj = this.props.obj\n        let value = this.props.value\n        if (!value) value = []\n        return <div>\n            {this.renderValues()}\n            <button onClick={this.addValue} className=\"fa fa-plus\"/>\n            {this.renderEditor()}\n        </div>\n    }\n\n    deleteItem(val) {\n        let arr = this.props.value.slice()\n        arr = arr.filter((v) => v !== val)\n        this.props.onChange(arr)\n    }\n\n    renderValues() {\n        const Renderer = this.calculateRenderer()\n        return <VBox>{this.props.value.map((val, i) => {\n            return <div key={i}>\n                <button className=\"fa fa-minus\" onClick={() => this.deleteItem(val)}/>\n                <Renderer value={val} provider={this.props.provider}/>\n            </div>\n        })}</VBox>\n    }\n\n    renderEditor() {\n        if (!this.state.showEditor) return \"\"\n        const def = this.props.def\n        const obj = this.props.obj\n        return <EnumEditor value={this.state.value}\n                           onChange={this.enumChanged}\n                           def={def}\n                           obj={obj}\n                           provider={this.props.provider}/>\n\n    }\n}\n","import React, {Component} from 'react';\nimport {PopupManager} from 'appy-comps'\n\nimport selMan, {SELECTION_MANAGER} from \"../SelectionManager\";\nimport HSLUVColorPicker from \"./HSLUVColorPicker\";\nimport {TREE_ITEM_PROVIDER} from '../TreeItemProvider'\nimport {StringEditor} from \"./StringEditor\";\nimport {EnumEditor} from \"./EnumEditor\";\nimport {ArrayEditor} from \"./ArrayEditor\";\n\nexport const TYPES = {\n    STRING:'string',\n    NUMBER:'number',\n    BOOLEAN:'boolean',\n    ENUM:'enum',\n    COLOR:'color',\n    GROUP:'group',\n}\n\nclass PropEditor extends Component {\n    constructor(props) {\n        super(props);\n        this.state = {\n            value:props.def.getValue()\n        }\n    }\n    componentWillReceiveProps(nextProps) {\n        if(this.props.def !== nextProps.def) {\n            this.setState({value:nextProps.def.getValue()})\n        }\n    }\n    shouldComponentUpdate(nextProps, nextState) {\n        if(nextProps.def.getType() === 'group') return true\n        if(this.state.value !== nextState.value) return true\n        if(this.props.def.getKey() === nextProps.def.getKey()) {\n            if(this.props.def.getValue() === nextProps.def.getValue()) {\n                return false\n            }\n        }\n        return true\n    }\n    changed = (e) => {\n        if(this.props.def.isType(TYPES.STRING)) {\n            this.setState({value:e.target.value})\n            if(this.props.def.isLive()) {\n                this.props.def.setValue(e.target.value)\n            }\n        }\n        if(this.props.def.isType(TYPES.NUMBER)) this.updateNum(e.target.value)\n        if(this.props.def.isType(TYPES.BOOLEAN)) this.setState({value:e.target.checked})\n    }\n    customChanged = value => {\n        if(this.props.def.isType(TYPES.COLOR)) return this.colorChanged(value)\n        this.setState({value:value})\n        this.props.def.setValue(value)\n    }\n    keypressed = (e) => {\n        if(e.charCode === 13) this.commit();\n    }\n    updateNum = (v) => {\n        const def = this.props.def;\n        if(def.hasHints()) {\n            if(def.getHints().hasOwnProperty('min')) {\n                if(v < def.getHints().min) v = def.getHints().min\n            }\n            if(def.getHints().hasOwnProperty('max')) {\n                if (v > def.getHints().max) v = def.getHints().max\n            }\n        }\n        this.setState({value:v})\n        if(!isNaN(parseFloat(v))) {\n            def.setValue(parseFloat(v))\n        }\n    }\n    numberKeyDown = (e) => {\n        if(e.key === 'ArrowUp' && e.shiftKey) {\n            e.preventDefault()\n            this.updateNum(this.state.value+10)\n        }\n        if(e.key === 'ArrowDown' && e.shiftKey) {\n            e.preventDefault()\n            this.updateNum(this.state.value-10)\n        }\n    }\n    booleanChanged = (e) => {\n        this.setState({value:e.target.checked});\n        this.props.def.setValue(e.target.checked)\n    }\n    enumChanged = (value) => {\n        this.setState({value:value})\n        this.props.def.setValue(value)\n    }\n    arrayChanged = (value) => {\n        this.setState({value:value})\n        this.props.def.setValue(value)\n    }\n    colorChanged = (color) => {\n        this.setState({value:color});\n        this.props.def.setValue(color)\n    }\n    commit = () => {\n        this.props.def.setValue(this.state.value)\n    }\n    openColorEditor = (e) => {\n        PopupManager.show(<HSLUVColorPicker onSelect={this.colorChanged} value={this.state.value}/>, e.target)\n    }\n    render() {\n        const prop = this.props.def;\n        const obj = selMan.getSelection();\n        const provider = this.props.provider\n        if (prop.isCustom()) return this.props.provider.createCustomEditor(this.props.item, prop, provider, this.state.value, this.customChanged)\n        if (prop.isLocked()) return <i>{prop.getValue()}</i>\n        if (prop.isType(TYPES.STRING))  return <StringEditor value={this.state.value}\n                                 onChange={this.changed}\n                                 onBlur={this.commit} onCommit={this.commit}\n                                 def={prop} obj={obj}\n                                 provider={this.props.provider}/>\n        if (prop.isType(TYPES.NUMBER))  {\n            let step = 1\n            if(prop.hasHints()) {\n                const hints = prop.getHints()\n                if (hints.incrementValue) {\n                    step = hints.incrementValue\n                }\n            }\n            return <input type='number'\n                          value={this.state.value}\n                          onChange={this.changed}\n                          onKeyPress={this.keypressed}\n                          onKeyDown={this.numberKeyDown}\n                          onBlur={this.commit}\n                          step={step}/>\n        }\n        if (prop.isType(TYPES.BOOLEAN)) return <input type='checkbox'\n                                                  checked={this.state.value}\n                                                  onChange={this.booleanChanged}/>\n        if (prop.isType(TYPES.ENUM)) return <EnumEditor value={this.state.value} onChange={this.enumChanged} def={prop} obj={obj} provider={this.props.provider}/>\n        if (prop.isType(TYPES.COLOR)) return <button style={{ backgroundColor:this.state.value}} onClick={this.openColorEditor}>{this.state.value}</button>\n        if (prop.isType('array')) return <ArrayEditor value={this.state.value} onChange={this.arrayChanged} def={prop} obj={obj} provider={this.props.provider}/>\n        return <b>{prop.getType()}:{prop.getValue()}</b>\n    }\n}\n\n/*class PaletteColorPicker extends Component {\n    chooseColor(c) {\n        this.props.onSelect(c);\n    }\n    render() {\n        const style = {\n            display:'flex',\n            flexDirection:'row',\n            flexWrap:'wrap'\n        }\n        return <div style={style}>\n            {Object.keys(COLORS2).map((key,i) => {\n                let color = COLORS2[key];\n                let scolor = color.toString(16);\n                while(scolor.length < 6) scolor = \"0\"+scolor\n                scolor = '#' +scolor\n                let style = {\n                    backgroundColor:scolor,\n                    color:'red'\n                }\n                return <button key={key}\n                               style={style}\n                               onClick={this.chooseColor.bind(this, scolor)}\n                >&nbsp;</button>\n            })}\n        </div>\n    }\n}\n*/\nexport default class PropSheet extends Component {\n    constructor(props) {\n        super(props)\n        this.state = {\n            selection:null\n        }\n    }\n    componentDidMount() {\n        this.h2 = () => this.setState({selection:selMan.getSelection()})\n        this.props.provider.on(TREE_ITEM_PROVIDER.PROPERTY_CHANGED,this.h2)\n        this.hand = (s) => this.setState({selection:selMan.getSelection()})\n        selMan.on(SELECTION_MANAGER.CHANGED, this.hand)\n    }\n    componentWillUnmount() {\n        selMan.off(SELECTION_MANAGER.CHANGED, this.hand);\n        this.props.provider.off(TREE_ITEM_PROVIDER.PROPERTY_CHANGED,this.h2)\n    }\n    render() {\n        const props = this.calculateGroups(this.calculateProps())\n        const item = selMan.getSelection()\n        return <ul className=\"prop-sheet\">{props.map((prop, i) => {\n            return [\n                <label key={prop.getKey()+'-label'}>{prop.getName()}</label>,\n                this.renderIndeterminate(prop,i),\n                <PropEditor key={prop.getKey()+'-editor'} def={prop} provider={this.props.provider} item={item}/>\n            ]\n        })}</ul>\n    }\n    renderIndeterminate(prop, i) {\n        if(prop.isIndeterminate()) {\n            return <i key={prop.getKey()+'-indeterminate'} className=\"icon fa fa-exclamation-circle\"/>\n        } else {\n            return \"\"\n        }\n    }\n    calculateProps() {\n        const items = selMan.getFullSelection()\n        const first = items[0]\n        const prov = this.props.provider\n        let props = prov.getProperties(first)\n        items.forEach((item)=>{\n            props = calculateIntersection(props, prov.getProperties(item))\n        })\n        return props.map((prop)=>{\n            const multi = new MultiPropProxy(prov, prop.key)\n            items.forEach((item)=>{\n                const p2 = prov.getProperties(item)\n                const match = p2.find(def=>def.key === prop.key)\n                multi.addSubProxy(new PropProxy(prov,item,match))\n            })\n            return multi\n        });\n    }\n\n    calculateGroups(props) {\n        const group_defs = props.filter(p => p.getType() === TYPES.GROUP)\n        group_defs.forEach(def => {\n            const group_keys = def.getGroupKeys()\n            //remove any groups in the group keys of a group def\n            props = props.filter(p => group_keys.indexOf(p.getKey())<0)\n        })\n        return props\n    }\n}\n\n//return items from A that are also in B\nfunction calculateIntersection(A,B) {\n    return  A.filter((pa)=> B.find((pb)=>pa.key===pb.key))\n}\n\n\nclass MultiPropProxy {\n    constructor(provider,key) {\n        this.provider = provider\n        this.key = key\n        this.subs = []\n    }\n    addSubProxy(sub) {\n        this.subs.push(sub)\n    }\n    first() {\n        return this.subs[0]\n    }\n    getName()  { return this.first().getName()  }\n    getValue() { return this.first().getValue() }\n    isCustom() { return this.first().isCustom() }\n    hasHints() { return this.first().hasHints() }\n    getHints() { return this.first().getHints() }\n    isLocked() { return this.first().isLocked() }\n    getType()  { return this.first().getType()  }\n    isType(s)  { return this.first().isType(s)  }\n    isLive()   { return this.first().isLive()   }\n    getKey()   { return this.key                }\n    getGroupKeys() { return this.first().getGroupKeys() }\n    setValue(v) {\n        this.subs.forEach((s)=> s.setValue(v))\n    }\n    isIndeterminate() {\n        let same = true\n        let value = this.first().getValue()\n        this.subs.forEach((s)=>{\n            if(s.getValue() !== value) same = false\n        })\n        return !same;\n    }\n}\n\n\nclass PropProxy {\n    constructor(provider, item, def) {\n        this.provider = provider\n        this.item = item\n        this.def = def\n    }\n    getKey() {\n        return this.def.key\n    }\n    getName() {\n        return this.def.name\n    }\n    isCustom() {\n        return this.def.custom\n    }\n    isLocked() {\n        return this.def.locked\n    }\n    getType() {\n        return this.def.type\n    }\n    getValue() {\n        return this.def.value\n    }\n    isLive() {\n        return this.def.live\n    }\n    isType(type) {\n        return this.def.type === type\n    }\n    setValue(value) {\n        return this.provider.setPropertyValue(this.item,this.def,value)\n    }\n    hasHints() {\n        return this.def.hints\n    }\n    getHints() {\n        return this.def.hints\n    }\n    getGroupKeys() {\n        return this.def.group\n    }\n    isIndeterminate() { return false; }\n}\n","export function listToArray(list) {\n    return Array.prototype.slice.call(list)\n}\nexport function createGraphObjectFromObject(graph, json) {\n    return graph.createObject(json)\n}\n\nexport function fetchGraphObject(graph, objid) {\n    const obj = {}\n    graph.getPropertiesForObject(objid).forEach(key => {\n        obj[key] = graph.getPropertyValue(objid, key)\n    })\n    obj.id = objid\n    return obj\n}\n\nexport function propToArray(doc, CH) {\n    const len = doc.getArrayLength(CH)\n    const ch = []\n    for (let i = 0; i < len; i++) {\n        ch.push(doc.getElementAt(CH, i))\n    }\n    return ch\n}\n\nexport function indexOf(graph, array, target) {\n    const arr = propToArray(graph,array)\n    return arr.findIndex(e => e === target)\n}\n\nexport function insertAsFirstChild(graph, parent, child) {\n    graph.setProperty(child.id,'parent',parent.id)\n    const ch = graph.getPropertyValue(parent.id,'children')\n    graph.insertAfter(ch,null,child.id)\n}\n\nexport function insertAsLastChild(graph, parent, child) {\n    graph.setProperty(child.id,'parent',parent.id)\n    const ch = graph.getPropertyValue(parent.id,'children')\n    const len = graph.getArrayLength(ch)\n    const prev = graph.getElementAt(ch,len-1)\n    graph.insertAfter(ch,prev,child.id)\n}\n\nexport function removeFromParent(graph, obj) {\n    const parent = fetchGraphObject(graph, obj.parent)\n    const n = indexOf(graph, parent.children, obj.id)\n    if (n >= 0) {\n        graph.removeElement(parent.children, n)\n    } else {\n        console.error(\"could not find index for child\", obj, 'in children', parent.children)\n    }\n}\n\n\nexport function cloneShape(graph,shape) {\n    const id = shape.id\n    const id2 = graph.createObject()\n    const props = graph.getPropertiesForObject(id)\n    props.forEach(key => {\n        graph.createProperty(id2,key,graph.getPropertyValue(id,key))\n    })\n    const shape2 = fetchGraphObject(graph,id2)\n    return shape2\n}\n","import React, { Component } from 'react';\nimport selMan, {SELECTION_MANAGER} from \"../SelectionManager\";\nimport {TREE_ITEM_PROVIDER} from '../TreeItemProvider';\nimport {PopupManager, VBox} from \"appy-comps\";\nimport {fetchGraphObject, removeFromParent} from \"../syncgraph/utils\";\nimport {Spacer} from './GridEditorApp'\n\n\nconst ContextMenu = (props) => {\n    return <VBox className={\"popup-menu\"}>\n        {props.menu.map((item,i)=>{\n            if(item.divider) return <div className=\"divider\" key={i}></div>\n            let enabled = false\n            if(typeof item.enabled === 'undefined') enabled = true\n            if(item.enabled === true) enabled = true\n            return <button key={i}\n                           disabled={!enabled}\n                           onClick={()=>{\n                PopupManager.hide()\n                if(item.fun) item.fun()\n            }}\n            ><i className={'fa fa-'+item.icon}/> {item.title}</button>\n        })}\n    </VBox>\n}\n\nclass TreeTableItem extends Component {\n    onSelect = (e)=>  {\n        if(e.shiftKey) {\n            selMan.addToSelection(this.props.node)\n        } else {\n            selMan.setSelection(this.props.node)\n        }\n    }\n    onContextMenu = (e) => {\n        e.preventDefault()\n        e.stopPropagation()\n        selMan.setSelection(this.props.node)\n        if(this.props.provider.calculateContextMenu) {\n            const menu = this.props.provider.calculateContextMenu(this.props.node)\n            PopupManager.show(<ContextMenu menu={menu}/>,e.target)\n        }\n    }\n    toggleItemCollapsed = (e) => {\n        e.preventDefault()\n        e.stopPropagation()\n        this.props.provider.toggleItemCollapsed(this.props.node);\n    }\n    onDragStart = (e) => {\n        this.props.onDragStart(e,this.props.node)\n    }\n    onDragOver = (e) => {\n        this.props.onDragOver(e,this.props.node)\n    }\n    onDragEnd = (e) => {\n        this.props.onDragEnd(e,this.props.node)\n    }\n    onDrop = (e) => {\n        this.props.onDrop(e,this.props.node)\n    }\n    render() {\n        let cls = \"tree-node\";\n        const node = this.props.node\n        if (selMan.isSelected(node)) cls += \" selected\"\n        if (selMan.getDropTarget() === node) {\n            cls += \" drop-target\"\n            if(selMan.getDropType() === 'parent') cls += \" drop-parent\"\n        }\n        let arrow = \"\";\n        const prov = this.props.provider\n        if (prov.hasChildren(node)) {\n            const expanded = prov.isExpanded(node)\n            if (expanded) {\n                arrow = <button className=\"fa fa-caret-down fa-fw borderless\" onClick={this.toggleItemCollapsed}/>;\n            } else {\n                arrow = <button className=\"fa fa-caret-right fa-fw borderless\" onClick={this.toggleItemCollapsed}/>;\n            }\n        } else {\n            arrow = <span className=\"fa fa-fw borderless\"/>\n        }\n\n        return <div className={cls}\n                    onClick={this.onSelect}\n                    onContextMenu={this.onContextMenu}\n                    data-nodeid={node.id}\n                    onDragOver={this.onDragOver}\n                    onDrop={this.onDrop}\n        >\n            <span style={{\n                width:this.props.depth*1.5+'em'\n            }}></span>\n            {arrow}\n            {prov.getRendererForItem(node)}\n            <Spacer/>\n            {this.renderDragBars()}\n        </div>\n    }\n\n    renderDragBars() {\n        if(this.props.provider.canBeMoved && !this.props.provider.canBeMoved(this.props.node))  return \"\"\n        return <span className={\"drag fa fa-bars\"}\n              draggable\n              onDragStart={this.onDragStart}\n              onDragEnd={this.onDragEnd}\n        />\n\n    }\n}\n\n\n\nexport default class TreeTable extends Component {\n    constructor(props) {\n        super(props)\n        this.state = {\n            root:this.props.root,\n            dropTarget:null,\n            selection:null,\n            dragTarget:null,\n            internalDrag:false,\n        }\n    }\n    componentDidMount() {\n        this.listener = this.props.provider.on(TREE_ITEM_PROVIDER.EXPANDED_CHANGED,\n            (item)=>  this.setState({root:this.props.provider.getSceneRoot()}))\n        this.props.provider.on(TREE_ITEM_PROVIDER.STRUCTURE_ADDED,\n            (item)=>  this.setState({root:this.props.provider.getSceneRoot()}))\n        this.props.provider.on(TREE_ITEM_PROVIDER.STRUCTURE_CHANGED,\n            (item)=>  this.setState({root:this.props.provider.getSceneRoot()}))\n\n        this.other_listener = selMan.on(SELECTION_MANAGER.CHANGED, (sel)=> this.setState({selection:sel}))\n        selMan.on(SELECTION_MANAGER.DROP_TARGET_CHANGED, (sel) => this.setState({dropTarget:selMan.getDropTarget()}))\n    }\n    componentWillUnmount() {\n        this.props.provider.off(TREE_ITEM_PROVIDER.EXPANDED_CHANGED, this.listener)\n        selMan.off(SELECTION_MANAGER.CHANGED,this.other_listener)\n    }\n    componentWillReceiveProps(newProps) {\n        if(newProps.root) this.setState({root:newProps.root})\n    }\n\n    onDragStart = (e,item) => {\n        console.log('starting to drag the item',item)\n        e.dataTransfer.effectAllowed = \"move\";\n        e.dataTransfer.setData(\"text/html\", e.target.parentNode);\n        e.dataTransfer.setDragImage(e.target.parentNode, 20, 20);\n        e.dataTransfer.dropEffect = 'move'\n        this.setState({dragTarget:item, internalDrag:true})\n    }\n    onDragOver = (e,item) => {\n        if(!this.state.internalDrag) {\n            e.preventDefault()\n            if(this.props.provider.canAddExternalChild(item,e.dataTransfer)) {\n                selMan.setDropTarget(item)\n                selMan.setDropType('parent')\n            } else {\n                selMan.setDropType(null)\n                selMan.setDropTarget(null)\n            }\n            return\n        }\n        const prov = this.props.provider\n        if(prov.canAddChild(item,this.state.dragTarget)) {\n            //use the rop target as a parent\n            selMan.setDropTarget(item)\n            selMan.setDropType('parent')\n            return\n        } else if(prov.canBeSibling(item,this.state.dragTarget)) {\n            //use the drop target as a sibling\n            selMan.setDropType('sibling')\n            selMan.setDropTarget(item)\n        } else {\n            //no valid target\n            selMan.setDropType(null)\n            selMan.setDropTarget(null)\n        }\n    }\n    onDragEnd = (e,item) => {\n        //handle external case\n        if(!this.state.internalDrag){\n            this.setState({dragTarget:null, internalDrag:false})\n            e.preventDefault()\n            e.stopPropagation()\n            return\n        }\n\n        const graph = this.props.provider.getDataGraph()\n        if(!this.state.dragTarget) return\n        if(!this.state.dropTarget) return\n        const src = fetchGraphObject(graph,this.state.dragTarget)\n        const dst = fetchGraphObject(graph,this.state.dropTarget)\n\n\n        //can't drop onto self\n        if(dst.id === src.id) {\n            this.setState({dragTarget:null, internalDrag:false})\n            selMan.setDropTarget(null)\n            return\n        }\n\n\n        //remove from old location\n        removeFromParent(graph,src)\n\n        const dt = selMan.getDropType()\n        if(dt === 'parent') {\n            graph.setProperty(src.id,'parent',dst.id)\n            graph.insertAfter(dst.children,null,src.id)\n        } else {\n            const parent2 = fetchGraphObject(graph,dst.parent)\n            graph.setProperty(src.id, 'parent', parent2.id)\n            graph.insertAfter(parent2.children, dst.id, src.id)\n        }\n        this.setState({dragTarget:null})\n        selMan.setDropTarget(null)\n    }\n    onDrop = (e,item) => {\n        if(!this.state.internalDrag) {\n            e.stopPropagation()\n            e.preventDefault()\n            this.props.provider.acceptDrop(e,item)\n            this.setState({internalDrag:false, dragTarget:null})\n        }\n        // var data = e.dataTransfer.getData(\"text/html\");\n        // console.log('the dropped data is',data)\n    }\n    render() {\n        if(!this.state.root) return <ul>no root yet</ul>\n        const children = [];\n        this.generateChildren(this.state.root,children,0)\n        return <ul className='tree-table'>\n            {children.map((info,i)=>{\n                return <TreeTableItem key={i}\n                                      node={info.node}\n                                      depth={info.depth}\n                                      provider={this.props.provider}\n                                      selection={this.state.selection}\n                                      onDragStart={this.onDragStart}\n                                      onDragOver={this.onDragOver}\n                                      onDragEnd={this.onDragEnd}\n                                      onDrop={this.onDrop}\n                />\n            })}\n        </ul>\n    }\n\n    generateChildren = (root, chs,depth) => {\n        const prov = this.props.provider\n        chs.push({node:root, depth:depth})\n        if(!prov.hasChildren(root)) return\n        if(!prov.isExpanded(root)) return;\n        prov.getChildren(root).forEach((child)=>{\n            this.generateChildren(child,chs,depth+1)\n        })\n    }\n}\n\n","export const UNITS = {\n    PIXEL:{\n        name:'pixel',\n        matches:['pixel','pixels','px'],\n        short:'px'\n    },\n    MILLIMETER: {\n        name:'millimeter',\n        matches:['mm'],\n        short:'mm'\n    }\n}\nexport const DEFAULT_DPI = 72\n\nexport function parseDimension(str) {\n    if(str.value) str = str.value\n    // console.log(\"parsing dimension\",str)\n\n    const parts = str.trim().match(/(\\d+)\\s*x\\s*(\\d+)\\s*(px|mm)/)\n    // console.log(\"parsed parts\",parts)\n    if(parts[3] === 'px') {\n        return new Dimension(parseInt(parts[1]),parseInt(parts[2]),UNITS.PIXEL)\n    }\n    if(parts[3] === 'mm') {\n        return new Dimension(parseInt(parts[1]),parseInt(parts[2]),UNITS.MILLIMETER)\n    }\n    return new Dimension(100,100,UNITS.PIXEL)\n}\nexport class Dimension {\n    constructor(width,height,unit) {\n        this.width = width\n        this.height = height\n        this.unit = unit\n    }\n\n    as(unit, scale, dpi) {\n        if(this.unit.name === UNITS.MILLIMETER.name && unit.name===UNITS.PIXEL.name) {\n            const in_per_mm = 0.0393701\n            const px_per_in = dpi\n            return new Dimension(\n                this.width*in_per_mm*px_per_in*scale*1,  // 100mm at dpi of 76 is 76 px/in * mm/in 0.0393701\n                this.height*in_per_mm*px_per_in*scale*1,  // 100mm at dpi of 76 is 76 px/in * mm/in 0.0393701\n                unit\n            )\n        }\n        return new Dimension(\n            this.width*scale,\n            this.height*scale,\n            unit,\n        )\n    }\n}","import React, {Component} from \"react\";\nimport SelectionManager, {SELECTION_MANAGER} from \"../SelectionManager\";\nimport {TREE_ITEM_PROVIDER} from \"../TreeItemProvider\";\nimport {fetchGraphObject, propToArray} from \"../syncgraph/utils\";\nimport {makePoint} from '../utils'\nimport {UNITS, DEFAULT_DPI} from \"./Dimension\"\n\n\nexport class MetadocCanvas extends Component {\n    constructor(props) {\n        super(props);\n        this.state = {\n            pressed: false,\n            selection: null,\n            shape:null,\n            hsnap:null,\n            vsnap:null,\n        }\n        props.prov.onRawChange(e => {\n            if (this.props.list === -1) return\n            this.redraw()\n        })\n    }\n\n    selectionChanged = (sel) => this.setState({selection: sel})\n    componentDidMount() {\n        SelectionManager.on(SELECTION_MANAGER.CHANGED, this.selectionChanged)\n        this.props.prov.on(TREE_ITEM_PROVIDER.STRUCTURE_CHANGED, this.redraw)\n    }\n    componentWillUnmount() {\n        SelectionManager.off(SELECTION_MANAGER.CHANGED, this.selectionChanged)\n        this.props.prov.off(TREE_ITEM_PROVIDER.STRUCTURE_CHANGED, this.redraw)\n    }\n\n    toCanvas(e) {\n        const rect = e.target.getBoundingClientRect()\n        return makePoint(\n            Math.floor((e.clientX - rect.left) / this.props.scale),\n            Math.floor((e.clientY - rect.top) / this.props.scale))\n    }\n\n\n    componentDidUpdate(prevProps) {\n        this.redraw()\n    }\n\n    redraw = () => {\n        if(!this.canvas) return\n        const c = this.canvas.getContext('2d')\n        const size = this.props.prov.getPageSize(this.props.prov.getSelectedPage()).as(UNITS.PIXEL,this.props.scale,DEFAULT_DPI)\n        this.canvas.width = size.width\n        this.canvas.height = size.height\n        c.fillStyle = 'white'\n        c.fillRect(0, 0, this.canvas.width, this.canvas.height)\n        c.save()\n        c.scale(this.props.scale, this.props.scale)\n        const graph = this.props.prov.getRawGraph()\n        const page = this.props.prov.getSelectedPage()\n        if(page) this.drawPage(c,graph,page)\n        c.fillStyle = \"rgba(0,255,255,0.5)\"\n        if(this.state.hsnap) c.fillRect(this.state.hsnap.value - 1,0,2,this.canvas.height)\n        if(this.state.vsnap) c.fillRect(0, this.state.vsnap.value - 1,this.canvas.width,2)\n        c.restore()\n    }\n\n    drawPage(c,g,page) {\n        propToArray(g,page.children).forEach(id => this.drawLayer(c,g,fetchGraphObject(g,id)))\n    }\n\n    drawLayer(c,g,layer) {\n        propToArray(g,layer.children).forEach(id => this.drawShape(c,g,fetchGraphObject(g,id)))\n    }\n\n    drawShape(c,g,shape) {\n        const def = this.props.prov.getShapeDef(shape.type)\n        if(def) def.draw(c,g,shape,SelectionManager.getSelection() === shape.id,this.props.prov)\n    }\n\n    isInside(pt, objid) {\n        const graph = this.props.prov.getRawGraph()\n        const shape = fetchGraphObject(graph,objid)\n        const def = this.props.prov.getShapeDef(shape.type)\n        if(def) return def.isInside(pt,shape,this.canvas)\n        return false\n    }\n\n    onClick = (e) => {\n        const pt = this.toCanvas(e)\n        const shape = this.findShape(pt)\n        if (shape) this.props.onSelect(shape)\n    }\n\n    findShape(pt) {\n        const prov = this.props.prov\n        const layer = prov.getSelectedLayer()\n        if (!layer) return null\n        const graph = prov.getRawGraph()\n        const arr = propToArray(graph,layer.children)\n        arr.reverse()\n        return arr.find((ch)=> this.isInside(pt,ch))\n    }\n\n    mouseDown = (e) => {\n        this.props.prov.pauseQueue()\n        const pt = this.toCanvas(e)\n        const shapeid = this.findShape(pt)\n        if (shapeid) {\n            const shapeobj = fetchGraphObject(this.props.prov.getRawGraph(),shapeid)\n            this.setState({\n                pressed: true,\n                initial: makePoint(shapeobj.x,shapeobj.y).minus(pt),\n                start: pt,\n                shape: shapeid,\n            })\n        } else {\n            const layer = this.props.prov.getSelectedLayer()\n            if(layer) SelectionManager.setSelection(layer.id)\n        }\n    }\n    mouseMove = (e) => {\n        if (!this.state.pressed) return\n        let pt = this.toCanvas(e).add(this.state.initial)\n        pt = this.snap(pt)\n        const graph = this.props.prov.getRawGraph()\n        graph.process(this.props.prov.cmd.setProperty(this.state.shape, 'x', pt.x))\n        graph.process(this.props.prov.cmd.setProperty(this.state.shape, 'y', pt.y))\n    }\n    mouseUp = (e) => {\n        this.setState({pressed: false, hsnap:null, vsnap:null})\n        this.props.prov.unpauseQueue()\n    }\n\n    render() {\n        return <div className=\"panel\">\n            <canvas style={{border: '0px solid red'}}\n                    width={100} height={100} ref={(e) => this.canvas = e}\n                    onClick={this.onClick}\n                    onMouseDown={this.mouseDown}\n                    onMouseUp={this.mouseUp}\n                    onMouseMove={this.mouseMove}\n            ></canvas>\n        </div>\n    }\n\n    snap(pt) {\n        const EDGES = {\n            LEFT:'LEFT',\n            RIGHT:'RIGHT',\n            CENTER:'CENTER',\n            TOP:'TOP',\n            MIDDLE:'MIDDLE',\n            BOTTOM:'BOTTOM',\n            NONE:'NONE',\n        }\n\n        const snaps = [\n            {value:0,type:EDGES.LEFT},\n            {value:320,type:EDGES.CENTER},\n            {value:640,type:EDGES.RIGHT},\n            {value:0, type:EDGES.TOP},\n            {value:240, type:EDGES.MIDDLE},\n            {value:480, type:EDGES.BOTTOM},\n        ]\n        const SNAP_THRESHOLD = 20\n        function isNearH(pt,snap) {\n            if(snap.type === EDGES.LEFT && Math.abs(pt.x-snap.value) < SNAP_THRESHOLD) return EDGES.LEFT\n            if(snap.type === EDGES.CENTER && Math.abs(pt.x + pt.width/2 - snap.value) < SNAP_THRESHOLD) return EDGES.CENTER\n            if(snap.type === EDGES.RIGHT && Math.abs(pt.x + pt.width - snap.value) < SNAP_THRESHOLD) return EDGES.RIGHT\n            return EDGES.NONE\n        }\n        function isNearV(pt,snap) {\n            if(snap.type === EDGES.TOP && Math.abs(pt.y-snap.value) < SNAP_THRESHOLD) return EDGES.TOP\n            if(snap.type === EDGES.MIDDLE && Math.abs(pt.y + pt.height/2 -snap.value) < SNAP_THRESHOLD) return EDGES.MIDDLE\n            if(snap.type === EDGES.BOTTOM && Math.abs(pt.y + pt.height -snap.value) < SNAP_THRESHOLD) return EDGES.BOTTOM\n            return EDGES.NONE\n        }\n\n        const graph = this.props.prov.getRawGraph()\n        const shape = fetchGraphObject(graph,this.state.shape)\n        const def = this.props.prov.getShapeDef(shape.type)\n        let hsnap = null\n        let vsnap = null\n        if(def) {\n            const bounds = def.getBounds(pt,shape,this.canvas)\n            for(let i=0; i<snaps.length; i++)  {\n                const snap = snaps[i]\n                const nearH = isNearH(bounds,snap)\n                if(nearH === EDGES.LEFT)   pt.x = snap.value\n                if(nearH === EDGES.CENTER) pt.x = snap.value-bounds.width/2\n                if(nearH === EDGES.RIGHT)  pt.x = snap.value-bounds.width\n\n                const nearV = isNearV(bounds,snap)\n                if(nearV === EDGES.TOP)    pt.y = snap.value\n                if(nearV === EDGES.MIDDLE) pt.y = snap.value-bounds.height/2\n                if(nearV === EDGES.BOTTOM) pt.y = snap.value-bounds.height\n\n                if(nearH !== EDGES.NONE) hsnap = snap\n                if(nearV !== EDGES.NONE) vsnap = snap\n            }\n        }\n        this.setState({hsnap:hsnap, vsnap:vsnap})\n\n        return pt\n    }\n}\n","const {SET_PROPERTY, CREATE_PROPERTY, DELETE_PROPERTY,\n    CREATE_OBJECT, DELETE_OBJECT,\n    INSERT_ELEMENT, DELETE_ELEMENT\n} = require(\"syncing_protocol\");\n\nexport class UndoQueue {\n    constructor(graph) {\n        this.graph = graph\n        this.history = []\n        this.current = -1\n    }\n\n    submit(op) {\n        // console.log(\"UNDOREDO: submit\",op)\n        this.history.push(op)\n        this.current = this.history.length - 1\n    }\n\n    canUndo() {\n        return this.current >= 0\n    }\n\n    canRedo() {\n        return this.current < this.history.length - 1\n    }\n\n    undo() {\n        const last = this.history[this.current]\n        this.current--\n        // console.log(\"undoing\",last)\n        // this.history.forEach(op => console.log(short(op)))\n        if (last.type === SET_PROPERTY) {\n            if (!last.prevValue) {\n                console.warn(\"undoing set property without a previous value!\", last)\n                return\n            }\n            const op = {\n                type: SET_PROPERTY,\n                host: this.graph.getHostId(),\n                seq: this.graph.nextSeq(),\n                timestamp: Date.now(),\n                object: last.object,\n                name: last.name,\n                value: last.prevValue,\n            }\n            this.graph.process(op)\n            return\n        }\n        if (last.type === CREATE_PROPERTY) {\n            const op = {\n                type: DELETE_PROPERTY,\n                host: this.graph.getHostId(),\n                seq: this.graph.nextSeq(),\n                timestamp: Date.now(),\n                object: last.object,\n                name: last.name,\n            }\n            this.graph.process(op)\n            return\n        }\n        if (last.type === CREATE_OBJECT) {\n            const op = {\n                type: DELETE_OBJECT,\n                host: this.graph.getHostId(),\n                seq: this.graph.nextSeq(),\n                timestamp: Date.now(),\n                id: last.id,\n            }\n            this.graph.process(op)\n            return\n        }\n        if (last.type === INSERT_ELEMENT) {\n            const op = {\n                type: DELETE_ELEMENT,\n                host: this.graph.getHostId(),\n                seq: this.graph.nextSeq(),\n                timestamp: Date.now(),\n                array: last.array,\n                entry: last.entryid\n            }\n            this.graph.process(op)\n            return\n        }\n        throw new Error(`undo for type not supported: ${last.type}`)\n    }\n\n    redo() {\n        this.current++\n        const last = this.history[this.current]\n        // console.log(\"redoin\",this.current,last.type,last.name,'=',last.value)\n        if (last.type === SET_PROPERTY) {\n            const op = {\n                type: last.type,\n                host: last.host,\n                seq: this.graph.nextSeq(),\n                timestamp: Date.now(),\n                object: last.object,\n                name: last.name,\n                value: last.value\n            }\n            this.graph.process(op)\n            return\n        }\n        if (last.type === CREATE_PROPERTY) {\n            const op = {\n                type: last.type,\n                host: last.host,\n                seq: this.graph.nextSeq(),\n                timestamp: Date.now(),\n                object: last.object,\n                name: last.name,\n                value: last.value\n            }\n            this.graph.process(op)\n            return\n        }\n        if (last.type === CREATE_OBJECT) {\n            const op = {\n                type: last.type,\n                host: last.host,\n                seq: this.graph.nextSeq(),\n                timestamp: Date.now(),\n                id: last.id,\n            }\n            this.graph.process(op)\n            return\n        }\n        if (last.type === INSERT_ELEMENT) {\n            console.log(\"redoing\", last)\n            const op = {\n                type: last.type,\n                host: last.host,\n                seq: this.graph.nextSeq(),\n                timestamp: Date.now(),\n                array: last.array,\n                value: last.value,\n                entryid: this.graph.makeGUID(),\n                prev: -1,\n            }\n            this.graph.process(op)\n            return\n        }\n        throw new Error(`redo for type not supported: ${last.type}`)\n    }\n\n    dump() {\n        return this.history.map((op, i) => i + \" \" + op.type + \" \" + op.name + \" => \" + op.value)\n    }\n}\n","const {SET_PROPERTY} = require(\"syncing_protocol\");\n\n\nexport class EventCoalescer {\n    constructor(graph) {\n        this.graph = graph\n        this.listeners = []\n        this.rawlisteners = []\n        this.paused = false\n        this.buffer = []\n        this.first = {}\n        this.last = {}\n    }\n\n    pause() {\n        this.paused = true\n    }\n\n    unpause() {\n        this.paused = false\n        this.buffer = []\n        // console.log(\"need to send out set property updates\",this.last)\n        // console.log('the originals are',this.first)\n        Object.keys(this.last).forEach((key) => {\n            Object.keys(this.last[key]).forEach(name => {\n                const op = this.last[key][name]\n                // console.log(\"sending\",short(op))\n                op.prevValue = this.first[key][name].value\n                this.fire(op)\n                this.graph.process(op)\n            })\n        })\n\n        this.first = {}\n        this.last = {}\n\n        // console.log(this.graph.dumpGraph())\n        // this.graph.getHistory().forEach(h => console.log(h.type,h.name,h.value))\n    }\n\n    onChange = cb => this.listeners.push(cb)\n    onRawChange = cb => this.rawlisteners.push(cb)\n    fire = op => this.listeners.forEach(cb => cb(op))\n    fireRaw = op => this.rawlisteners.forEach(cb => cb(op))\n    getPropertiesForObject = (obj) => this.graph.getPropertiesForObject(obj)\n    getArrayLength = (obj) => this.graph.getArrayLength(obj)\n    getElementAt = (obj, index) => this.graph.getElementAt(obj, index)\n    getHostId = () => this.graph.getHostId()\n\n\n    getPropertyValue(obj, key) {\n        // console.log(\"checking\",this.paused,obj,key)\n        if (this.paused && this.last[obj] && this.last[obj][key]) {\n            // console.log(\"returning the raw property values\",this.last[obj][key])\n            return this.last[obj][key].value\n        } else {\n            return this.graph.getPropertyValue(obj, key)\n        }\n    }\n\n    bufferOp(op) {\n        if (!this.first[op.object]) this.first[op.object] = {}\n        if (!this.first[op.object][op.name]) this.first[op.object][op.name] = op\n        if (!this.last[op.object]) this.last[op.object] = {}\n        this.last[op.object][op.name] = op\n        this.buffer.push(op)\n        this.fireRaw(op)\n    }\n\n    process(op) {\n        if (op.type === SET_PROPERTY && this.paused) {\n            this.bufferOp(op)\n        } else {\n            this.fire(op)\n            this.graph.process(op)\n        }\n    }\n}\n","import PubNub from \"pubnub\";\nimport {AuthModule} from '../vr/AuthModule'\nfunction short(op) {\n    let str = `${op.type} ${op.uuid} |  `\n    if(op.name) {\n        str += `${op.name} = ${op.value}  prev = ${op.prevValue}`\n    }\n    return str\n}\nconst settings = {\n    publishKey: 'pub-c-1cba58da-c59a-4b8b-b756-09e9b33b1edd',\n    subscribeKey: 'sub-c-39263f3a-f6fb-11e7-847e-5ef6eb1f4733',\n}\n\nexport class PubnubSyncWrapper {\n    constructor(provider, graph) {\n        if(!provider) throw new Error('created PubnubSyncWrapper without a provider')\n        if(!graph) throw new Error('created PubnubSyncWrapper without a graph')\n        this.paused = false\n        this.buffer = []\n        this.provider = provider\n\n        graph.onChange((e)=>this.handleGraphChange(e))\n\n        this.pubnub = new PubNub(settings)\n    }\n\n    calculateChannelName() {\n        return \"metadoc-docupdate-\" + this.provider.getDocId() + \"_\"+AuthModule.getServerID()\n    }\n    calculateLoggerChannelName() {\n        return \"metadoc-log-\" + this.provider.getDocId()+\"_\"+AuthModule.getServerID()\n    }\n\n    start() {\n        this.pubnub.addListener({\n            status: (e) => {\n                // console.log(e)\n                if (e.operation === 'PNSubscribeOperation' && e.category === 'PNConnectedCategory') {\n                    this.sendHistoryRequest()\n                }\n            },\n            message: (m)=>this.handleMessage(m),\n        })\n\n        this.pubnub.subscribe({channels: [this.calculateChannelName(),this.calculateLoggerChannelName()]})\n    }\n\n    pause() {\n        this.paused = true\n    }\n\n    unpause() {\n        this.paused = false\n        // console.log(\"we need to send the waiting messages\", this.buffer)\n        this.buffer.forEach(op => this.sendMessage(op))\n        this.buffer = []\n        //now request history from the network for anything we missed\n        // this.sendHistoryRequest()\n    }\n\n    shutdown() {\n        this.pubnub.unsubscribe({channels: [this.calculateChannelName()]})\n        this.pubnub.stop()\n    }\n\n    sendMessage(e) {\n        console.log(\"PN_SEND:\", short(e))\n        this.pubnub.publish({\n            channel: this.calculateChannelName(),\n            message: e\n        }, (status, response) => {\n            // console.log(\"published\",status,response)\n        })\n\n    }\n\n    handleGraphChange (e) {\n        // console.log(\"graph changed\",e)\n        const host = this.provider.getDataGraph().getHostId()\n        if (e.host !== host) return\n        if (this.paused) return this.buffer.push(e)\n        this.sendMessage(e)\n    }\n\n    sendHistoryRequest() {\n        // console.log(\"sending a history request\")\n        this.pubnub.publish({\n            channel: this.calculateChannelName(),\n            message: {\n                type: 'GET_HISTORY',\n                host: this.provider.getDataGraph().getHostId()\n            }\n        })\n    }\n\n    handleGetHistory() {\n        // console.log(\"need to send out the history\")\n        const graph = this.provider.getDataGraph()\n        const hist = graph.getHistory().slice()\n        console.log(hist)\n        const chunkSize = 30\n        let count = 0\n        while (hist.length > 0) {\n            if (count > 100) {\n                console.log(\"breaking out. possible infinite loop\")\n                break\n            }\n            count++\n            const chunk = hist.splice(0, chunkSize)\n            console.log(\"sending\", chunk.length, chunk)\n            this.pubnub.publish({\n                channel: this.calculateChannelName(),\n                message: {\n                    type: 'SEND_HISTORY',\n                    host: graph.getHostId(),\n                    history: chunk\n                }\n            }, (status, response) => {\n                console.log(\"published\", status, response)\n            })\n        }\n\n    }\n\n    handleReceiveHistory(msg) {\n        // console.log(\"got some history\", msg.history.length)\n        msg.history.forEach(op => this.provider.getDataGraph().process(op))\n    }\n\n\n    handleMessage (evt) {\n        if (this.paused) return\n//        console.log(\"channel is\",evt.channel)\n        if(evt.channel === this.calculateLoggerChannelName()) {\n            if(evt.publisher !== this.pubnub.getUUID()) {\n                if(evt.message.length) {\n                    console.log(\"REMOTE LOGGER\",...evt.message)\n                } else {\n                    console.log(\"REMOTE LOGGER\", evt.message)\n                }\n            }\n            return\n        }\n        const graph = this.provider.getDataGraph()\n        // console.log('PN_REMOTE',evt)\n        if (evt.message.type === 'GET_HISTORY') {\n            // console.log(\"got a history request\",evt.message.host, graph.getHostId())\n            if (evt.message.host !== graph.getHostId()) {\n                return this.handleGetHistory()\n            }\n            return\n        }\n        if (evt.message.type === 'SEND_HISTORY') {\n            if (evt.message.host !== graph.getHostId()) {\n                return this.handleReceiveHistory(evt.message)\n            }\n            return\n        }\n        const op = evt.message\n        if (!op.host) return console.log(\"received a message without a host\", op)\n        if (!op.timestamp) return console.error(\"received a message without a timestamp\", op)\n        if (op.host && op.host === graph.getHostId()) {\n            // console.log(\"SKIP: my own message came in. ignoring it\")\n            return\n        }\n        console.log(\"REMOTE\", op)\n        graph.process(op)\n    }\n\n    getLogger() {\n        return new PubnubLogger(this.provider.getDocId(),this.pubnub)\n    }\n}\n\n\nexport class PubnubLogger {\n    constructor(docid, pubnub) {\n        this.count = 0\n        this.docid = docid\n        if(!pubnub) {\n            this.pubnub = new PubNub(settings)\n        } else {\n            this.pubnub = pubnub\n        }\n    }\n    calculateLoggerChannelName() {\n        return \"metadoc-log-\" + this.docid+\"_\"+AuthModule.getServerID()\n    }\n    log() {\n        console.log(\"LOGGER\",...arguments)\n        this.pubnub.publish({\n            channel:this.calculateLoggerChannelName(),\n            message:Array.from(arguments).concat(this.count++)\n        })\n    }\n    error () {\n        console.log(\"LOGGER ERROR\",...arguments)\n        this.pubnub.publish({\n            channel:this.calculateLoggerChannelName(),\n            message:Array.from(arguments).concat(this.count++)\n        })\n    }\n}\n\nexport class ConsoleLogger {\n    constructor() {\n\n    }\n    log() {\n        console.log(\"DUMMY LOGGER\",...arguments)\n    }\n    error () {\n        console.log(\"DUMMY LOGGER ERROR\",...arguments)\n    }\n}","import React, {Component} from 'react'\n\nexport  class Dialog extends Component {\n    clickedScrim = (e) => {\n        if(e.target !== this.scrim) return\n        if(this.props.onScrimClick) this.props.onScrimClick(e)\n    }\n    render() {\n        if(!this.props.visible) return <div/>;\n        const bodyStyle = {}\n        if(this.props.width) bodyStyle.width = this.props.width\n        if(this.props.height) bodyStyle.height = this.props.height\n        return <div className={\"ac-dialog-scrim\"} ref={(scrim)=>this.scrim=scrim} onClick={this.clickedScrim}>\n            <div className={\"ac-dialog-body\"} style={bodyStyle}>{this.props.children}</div>\n        </div>\n\n    }\n}\n","import React, {Component} from 'react'\nimport {DialogManager, HBox, VBox} from 'appy-comps'\nimport {Dialog} from '../common/Dialog'\n\nexport class MissingDocDialog extends Component {\n\n    cancel = () => {\n        DialogManager.hide()\n    }\n\n    okay = () => {\n        DialogManager.hide()\n        this.props.provider.createNewDocument(this.props.docid)\n    }\n\n    render() {\n        return <Dialog visible={true} onScrimClick={this.cancel}>\n            <VBox grow>\n                <h3>Document \"<b>{this.props.docid}</b>\" not found</h3>\n                <VBox grow>\n                    Create a new document?\n                </VBox>\n                <HBox>\n                    <button onClick={this.cancel}>cancel</button>\n                    <button onClick={this.okay}>okay</button>\n                </HBox>\n            </VBox>\n        </Dialog>\n    }\n\n}","import TreeItemProvider, {getDocsURL, TREE_ITEM_PROVIDER} from '../TreeItemProvider'\nimport {setQuery, toQueryString} from '../utils'\nimport {UndoQueue} from './UndoQueue'\nimport {EventCoalescer} from '../metadoc/EventCoalescer'\nimport SelectionManager from '../SelectionManager'\nimport {PubnubSyncWrapper} from './PubnubSyncWrapper'\nimport {propToArray} from \"./utils\";\nimport * as ToasterMananager from '../vr/ToasterManager'\nimport {DialogManager} from 'appy-comps'\nimport {MissingDocDialog} from './MissingDocDialog'\nimport React from 'react'\nimport {AuthModule} from '../vr/AuthModule'\n\nconst {DocGraph, CommandGenerator} = require(\"syncing_protocol\");\n\n\nfunction DocGraphToObjectGraph(doc, id) {\n    const props = doc.getPropertiesForObject(id)\n    const obj = {}\n    props.forEach(name => {\n        obj[name] = doc.getPropertyValue(id,name)\n        if(name === 'children') {\n            obj.children = propToArray(doc,obj[name]).map(child => {\n                return DocGraphToObjectGraph(doc,child)\n            })\n        }\n    })\n    obj.id = id\n    return obj\n}\n\n\nexport default class SyncGraphProvider extends TreeItemProvider {\n    constructor(options) {\n        super(options)\n        this.options = options || {}\n        this.mode = options.mode || 'edit'\n        this.datalisteners = []\n        this.rawlisteners = []\n        this.expanded = {}\n\n        if(options.doc) {\n            this.loadDoc(options.doc)\n        } else {\n            this.createNewDocument()\n        }\n    }\n    getDocTitle = () => \"untitled\"\n    getDocHistory = () => this.getDataGraph().getHistory()\n    getDocGraph = () => {\n        const root = this.getDataGraph().getObjectByProperty('type','root')\n        return DocGraphToObjectGraph(this.getDataGraph(),root)\n    }\n    onRawChange = cb => this.rawlisteners.push(cb)\n    getRawGraph = () => this.coalescer\n    getDataGraph = () => this.syncdoc\n    getSceneRoot = () => this.getDataGraph().getObjectByProperty('type','root')\n    hasChildren = (item) => item && this.getDataGraph().hasPropertyValue(item,'children')\n    getChildren = (item) => {\n        const doc = this.getDataGraph()\n        return propToArray(doc,doc.getPropertyValue(item,'children'))\n    }\n    isExpanded = (item) => {\n        if (typeof this.expanded[item] === 'undefined') this.expanded[item] = true;\n        return this.expanded[item]\n    }\n    toggleItemCollapsed(item) {\n        const current = this.isExpanded(item);\n        this.expanded[item] = !current;\n        this.fire(TREE_ITEM_PROVIDER.EXPANDED_CHANGED,item);\n    }\n\n    setPropertyValue(item, def, value) {\n        const op = this.cmd.setProperty(item,def.key,value)\n        op.prevValue = def.value\n        this.getRawGraph().process(op)\n        this.fire(TREE_ITEM_PROVIDER.PROPERTY_CHANGED,{\n            provider: this,\n            child:item,\n            propKey:def.key,\n            oldValue:def.value,\n            newValue:value\n        })\n    }\n\n    save = (e) => {\n        if(e) e.preventDefault()\n        const payload_obj = {\n            history:this.getDocHistory(),\n            type:this.getDocType(),\n            id:this.getDocId(),\n            graph:this.getDocGraph(),\n            title:this.getDocTitle(),\n        }\n        const payload_string = JSON.stringify(payload_obj)\n        ToasterMananager.add('saving')\n        const opts = {\n            type:this.getDocType(),\n            title:this.getDocTitle(),\n        }\n        const url = getDocsURL()+this.getDocId()+'?'+toQueryString(opts)\n        console.log(`saving ${payload_string.length} chars to ${url}`, payload_obj)\n        return AuthModule.fetch(url,{\n            method:'POST',\n            body:payload_string,\n            headers: {\n                \"Content-Type\": \"application/json\"\n            },\n        })\n            .then(res=>res.json())\n            .then(res => {\n                console.log(\"got back result\",res)\n                setQuery({mode:this.mode,doc:this.getDocId(), doctype:this.getDocType()})\n                ToasterMananager.add(res.message)\n                this.fire(TREE_ITEM_PROVIDER.SAVED,true)\n            }).catch((e)=> console.log(\"error\",e))\n    }\n\n    loadDoc(docid) {\n        return AuthModule.getJSON(getDocsURL()+docid)\n            .then((payload)=>{\n                console.log(\"got the payload\",payload)\n                if(!payload.id) return this.showMissingDocDialog(docid)\n                const doc = this.makeDocFromServerHistory(payload.history)\n                this.setupDocFlow(doc,docid)\n            })\n            .catch((e)=> {\n                console.error(\"there was an error loading doc\",docid,e)\n                const doc = new DocGraph()\n                this.makeEmptyRoot(doc)\n                this.setupDocFlow(doc,this.genID('doc'))\n            })\n    }\n\n    createNewDocument(docid) {\n        if(!docid) docid = this.genID(\"doc\")\n        const doc = new DocGraph()\n        this.makeEmptyRoot(doc)\n        this.setupDocFlow(doc,docid)\n    }\n\n    setupDocFlow(doc,docid) {\n        //shut down old network connection\n        if(this.pubnub) this.pubnub.shutdown()\n        this.pubnub = null\n\n        this.syncdoc = doc\n        this.cmd = new CommandGenerator(this.syncdoc)\n        this.root = this.getSceneRoot()\n        this.docid = docid\n        this.undoqueue = new UndoQueue(doc)\n        this.coalescer = new EventCoalescer(this.syncdoc) //sends calls on to sync doc, and fires change event\n        this.coalescer.onChange((op) => this.undoqueue.submit(op))\n\n        this.coalescer.onRawChange(op =>this.rawlisteners.forEach(cb => cb(op)))\n        this.syncdoc.onChange(op => this.rawlisteners.forEach(cb => cb(op)))\n        this.syncdoc.onChange((op)=>{\n            this.fire(TREE_ITEM_PROVIDER.STRUCTURE_CHANGED, { provider:this });\n            this.fire(TREE_ITEM_PROVIDER.PROPERTY_CHANGED, { provider:this });\n        })\n        this.fire(TREE_ITEM_PROVIDER.STRUCTURE_CHANGED, { provider:this });\n        this.fire(TREE_ITEM_PROVIDER.CLEAR_DIRTY,true)\n        SelectionManager.clearSelection()\n        this.pubnub = new PubnubSyncWrapper(this,this.syncdoc)\n        this.pubnub.unpause()\n        this.pubnub.start()\n        this.docLoaded().then(()=>{\n            this.fire(TREE_ITEM_PROVIDER.DOCUMENT_SWAPPED,{provider:this})\n            setQuery({mode:this.mode,doc:this.getDocId(), doctype:this.getDocType()})\n            this.connected = true\n            this.fire(\"CONNECTED\",this.connected)\n        })\n    }\n\n    reloadDocument() {\n        return AuthModule.getJSON(getDocsURL()+this.docid).then((payload)=>{\n            if(payload.type !== this.getDocType()) throw new Error(\"incorrect doctype for this provider\",payload.type)\n            const doc = this.makeDocFromServerHistory(payload.history)\n            this.setupDocFlow(doc,this.docid)\n        }).catch((e)=>{\n            console.error(\"couldn't reload the doc\",e)\n            const doc = new DocGraph()\n            this.makeEmptyRoot(doc)\n            this.setupDocFlow(doc,this.genID('doc'))\n        })\n\n    }\n\n    duplicateDocument() {\n        const newDocId = this.genID(\"doc\")\n        this.save().then(()=> {\n            this.docid = newDocId\n            this.setDocTitle(\"copy of \"+this.getDocTitle())\n            return this.save()\n        }).then(()=>{\n            ToasterMananager.add('duplicating doc')\n            return this.loadDoc(newDocId)\n        })\n    }\n\n    docLoaded = () => {\n        return Promise.resolve()\n    }\n\n    toggleConnected = () => {\n        this.connected = !this.connected\n        if(this.pubnub) {\n            if(this.connected) {\n                this.pubnub.unpause()\n            } else {\n                this.pubnub.pause()\n            }\n        }\n        this.fire(\"CONNECTED\",this.connected)\n    }\n\n    isConnected = () => this.connected\n\n    pauseQueue = () => this.coalescer.pause()\n    unpauseQueue = () => this.coalescer.unpause()\n\n    performUndo = (e) => {\n        if(e && e.preventDefault) e.preventDefault()\n\n        if(this.undoqueue.canUndo()) {\n            this.undoqueue.undo()\n        } else {\n            console.warn(\"at beginnning of the undo queue\")\n        }\n    }\n    performRedo = (e) => {\n        if(e && e.preventDefault) e.preventDefault()\n        if(this.undoqueue.canRedo()) this.undoqueue.redo()\n    }\n\n    makeDocFromServerHistory(history) {\n        const doc = new DocGraph()\n        history.forEach(op => doc.process(op))\n        return doc\n    }\n\n\n    showMissingDocDialog(docid) {\n        DialogManager.show(<MissingDocDialog docid={docid} provider={this}/>)\n    }\n}\n","\nexport default class InputManager {\n    static KEYS = {\n        S:83,\n        Z:90,\n        C:67,\n        V:86,\n        X:88,\n        LEFT_ARROW:37,\n        RIGHT_ARROW:39,\n    }\n    static MODIFIERS = {\n        COMMAND:'COMMAND',\n        SHIFT:'SHIFT'\n    }\n\n    constructor() {\n        this.bindings = []\n        this.listeners = {}\n    }\n\n    addKeyBinding(binding) {\n        this.bindings.push(binding)\n    }\n    addListener(name,cb) {\n        if(!this.listeners[name]) {\n            this.listeners[name] = []\n        }\n        this.listeners[name].push(cb)\n    }\n\n    attachKeyEvents(document) {\n        document.addEventListener('keydown',this.keyDown)\n    }\n\n    keyDown = (e)=>{\n        // console.log(\"-------------\")\n        // console.log(\"got a key press\",e.shiftKey, e.metaKey, e.key, e.keyCode)\n        const matches = this.bindings.filter((b)=>b.key === e.keyCode)\n        // console.log(\"got the bindings\",matches)\n        const m2 = matches.filter((b)=>{\n            let valid = true\n            b.modifiers.forEach((mod)=>{\n                if(mod === InputManager.MODIFIERS.COMMAND && !e.metaKey) {\n                    // console.log(\"missing the meta key\");\n                    valid = false\n                }\n                if(mod === InputManager.MODIFIERS.SHIFT && !e.shiftKey) {\n                    // console.log(\"missing the shift key\");\n                    valid = false\n                }\n            })\n            if(e.shiftKey && !b.modifiers.some(mod=>mod === InputManager.MODIFIERS.SHIFT)) {\n                // console.log(\"shift is down, but missing shift in the def\")\n                valid = false\n            }\n            // console.log(\"still valid\",valid)\n            return valid\n        })\n        // console.log(\"final list is\",m2.length)\n        if(m2.length > 0) {\n            // console.log(\"something matched\")\n            // e.preventDefault()\n            this.dispatchEvents(m2,e)\n        }\n    }\n    dispatchEvents(matches,e) {\n        matches.forEach((bind)=>{\n            if(this.listeners[bind.id]) this.listeners[bind.id].forEach((cb)=>cb?cb(e):null)\n        })\n    }\n}\n","import {fetchGraphObject} from \"../syncgraph/utils\";\n\nexport default class RectDef {\n    make(graph,layer) {\n        return fetchGraphObject(graph,graph.createObject({\n            type:'rect',\n            title:'second rect',\n            x: 100,\n            y: 100,\n            rx:20,\n            ry:20,\n            width: 100,\n            height: 100,\n            fillColor: '#ff00ff',\n            parent:layer.id,\n        }))\n    }\n\n    draw(c,g,shape,selected) {\n        c.fillStyle = 'gray'\n        c.fillStyle = shape.fillColor\n        if(shape.rx > 0 || shape.ry > 0) {\n            const c0 = {x:shape.x,y:shape.y}\n            const c1 = {x:shape.x+shape.width, y:shape.y}\n            const c2 = {x:shape.x+shape.width, y:shape.y+shape.height}\n            const c3 = {x:shape.x, y:shape.y+shape.height}\n            c.beginPath()\n            c.moveTo(c0.x+shape.rx,c0.y)\n            c.lineTo(c1.x-shape.rx,c1.y)\n            c.quadraticCurveTo(c1.x,c1.y, c1.x,c1.y+shape.ry)\n            c.lineTo(c2.x,c2.y-shape.ry)\n            c.quadraticCurveTo(c2.x,c2.y, c2.x-shape.rx,c2.y)\n            c.lineTo(c3.x+shape.rx,c3.y)\n            c.quadraticCurveTo(c3.x,c3.y, c3.x,c3.y-shape.ry)\n            c.lineTo(c0.x,c0.y+shape.ry)\n            c.quadraticCurveTo(c0.x,c0.y, c0.x+shape.rx,c0.y)\n            c.closePath()\n            c.fill()\n        } else {\n            c.fillRect(shape.x, shape.y, shape.width, shape.height)\n        }\n\n        if (selected) {\n            c.strokeStyle = 'red'\n            c.strokeRect(shape.x+0.5,shape.y+0.5,shape.width, shape.height)\n        }\n\n    }\n\n    isInside(pt,shape) {\n        if (pt.x < shape.x) return false\n        if (pt.x > shape.x + shape.width) return false\n        if (pt.y < shape.y) return false\n        if (pt.y > shape.y + shape.height) return false\n        return true\n    }\n\n    getBounds(newOrigin,shape) {\n        return {\n            x:newOrigin.x,\n            y:newOrigin.y,\n            width:shape.width,\n            height:shape.height,\n        }\n    }\n\n    toSVGString(obj) {\n        return `<rect x=\"${obj.x}\" y=\"${obj.y}\" width=\"${obj.width}\" height=\"${obj.height}\" fill=\"${obj.fillColor}\"/>`\n    }\n\n}\n","import {createGraphObjectFromObject, fetchGraphObject} from \"../syncgraph/utils\";\n\nexport default class CircleDef {\n    make(graph,layer) {\n        return fetchGraphObject(graph,createGraphObjectFromObject(graph, {\n            type: 'circle',\n            title: 'circle',\n            x: 100,\n            y: 100,\n            radius: 50,\n            fillColor: '#ffff00',\n            parent: layer.id,\n        }))\n    }\n\n\n    draw(c,g,shape,selected) {\n        c.fillStyle = 'gray'\n        c.fillStyle = shape.fillColor\n        c.beginPath()\n        c.arc(shape.x, shape.y, shape.radius, 0, Math.PI*2)\n        c.fill()\n        if (selected) {\n            c.strokeStyle = 'red'\n            c.strokeRect(shape.x-shape.radius+0.5,shape.y-shape.radius+0.5,shape.radius*2, shape.radius*2)\n        }\n    }\n\n    isInside(pt,shape) {\n        if(Math.pow(shape.x-pt.x,2) + Math.pow(shape.y - pt.y,2) < Math.pow(shape.radius,2)) return true\n        return false\n    }\n\n    getBounds(newOrigin,shape, canvas) {\n        return {\n            x:newOrigin.x,\n            y:newOrigin.y,\n            width:shape.radius*2,\n            height:shape.radius*2,\n        }\n    }\n\n    toSVGString(obj) {\n        return `<circle cx=\"${obj.x}\" cy=\"${obj.y}\" r=\"${obj.radius}\" fill=\"${obj.fillColor}\"/>`\n    }\n\n}\n","import {fetchGraphObject} from \"../syncgraph/utils\";\nimport {FONT_STYLES, FONT_WEIGHTS, HORIZONTAL_ALIGNMENT, STANDARD_FONTS, VERTICAL_ALIGNMENT} from \"./Common\";\n\nexport default class TextDef {\n    make(graph,layer) {\n        const text = fetchGraphObject(graph,graph.createObject({\n            type:'text',\n            title:'text',\n\n            text:'title text',\n\n            horizontalAlign:HORIZONTAL_ALIGNMENT.CENTER,\n            verticalAlign:VERTICAL_ALIGNMENT.BASELINE,\n            autoFit:true,\n            fontSize:30,\n            fontFamily:STANDARD_FONTS.SANSSERIF,\n            fontWeight:FONT_WEIGHTS.NORMAL,\n            fontStyle:FONT_STYLES.NORMAL,\n\n            x: 100,\n            y: 100,\n            width: 200,\n            height: 120,\n            fillColor: '#ff00ff',\n            parent:layer.id,\n        }))\n        return text\n    }\n\n    draw(c,g,shape,selected) {\n        //calculate the general line metrics\n        const {lines, size_px, total_height, total_width} = this.calculateLines(shape,c)\n        //add offsets for alignment\n        lines.forEach((line,i) => {\n            const lines_height = lines.length*size_px\n            line.xoff = 0\n            if(shape.horizontalAlign === HORIZONTAL_ALIGNMENT.LEFT)   line.xoff = 0\n            if(shape.horizontalAlign === HORIZONTAL_ALIGNMENT.CENTER) line.xoff = (total_width - line.width)/2\n            if(shape.horizontalAlign === HORIZONTAL_ALIGNMENT.RIGHT)  line.xoff = total_width  - line.width\n            if(shape.verticalAlign === VERTICAL_ALIGNMENT.TOP)        line.yoff = 0\n            if(shape.verticalAlign === VERTICAL_ALIGNMENT.CENTER)     line.yoff = (total_height- lines_height)/2\n            if(shape.verticalAlign === VERTICAL_ALIGNMENT.BASELINE)   line.yoff = total_height - lines_height\n            if(shape.verticalAlign === VERTICAL_ALIGNMENT.BOTTOM)     line.yoff = total_height - lines_height\n            line.yoff += (i+1)*line.height\n        })\n\n        //draw text\n        c.fillStyle = shape.fillColor\n        lines.forEach((line,i) => c.fillText(line.text,shape.x+line.xoff,shape.y+ line.yoff))\n        //draw outline\n        if (selected) {\n            c.strokeStyle = 'red'\n            c.strokeRect(shape.x + 0.5, shape.y + 0.5, total_width, total_height)\n        }\n    }\n\n    calculateLines(shape,c) {\n        const size_px = parseFloat(shape.fontSize)\n        c.font = `normal ${size_px}px sans-serif`\n        const lines = shape.text.split(\"\\n\").map(text => {\n            return {\n                text:text,\n                width: c.measureText(text).width,\n                height: size_px\n            }\n        })\n\n        let total_width = 0\n        let total_height = 0\n        if(shape.autoFit) {\n            total_width = lines.reduce((max, line) => Math.max(max,line.width),0)\n            total_height = lines.reduce((total,line) => total + line.height,0)\n        } else {\n            total_width = shape.width\n            total_height = shape.height\n        }\n        return {\n            total_width:total_width,\n            total_height: total_height,\n            lines:lines,\n            size_px:size_px\n        }\n    }\n\n    insideRect(pt,x,y,w,h) {\n        if (pt.x < x) return false\n        if (pt.x > x + w) return false\n        if (pt.y < y) return false\n        if (pt.y > y + h) return false\n        return true\n    }\n\n    isInside(pt,shape, canvas) {\n        const c = canvas.getContext('2d')\n        const {total_width, total_height} = this.calculateLines(shape,c)\n        return this.insideRect(pt,shape.x,shape.y,total_width,total_height)\n    }\n\n    getBounds(newOrigin,shape, canvas) {\n        const c = canvas.getContext('2d')\n        const {total_width, total_height} = this.calculateLines(shape,c)\n        return {\n            x:newOrigin.x,\n            y:newOrigin.y,\n            width:total_width,\n            height:total_height,\n        }\n    }\n\n\n    toSVGString(obj) {\n        return `<text x=\"${obj.x}\" y=\"${obj.y}\"\n                     fill=\"${obj.fillColor}\" fontSize=\"${obj.fontSize}\"\n                     fontFamily=\"${obj.fontFamily}\"\n                >${obj.text}</text>`\n    }\n\n}\n","import {fetchGraphObject} from \"../syncgraph/utils\";\n\nexport default class ImageDef {\n    make(graph,layer) {\n        return fetchGraphObject(graph,graph.createObject({\n            type:'image',\n            title:'image',\n            x: 100,\n            y: 100,\n            width: 50,\n            height: 50,\n            asset:0,\n            parent:layer.id,\n        }))\n    }\n\n    draw(c,g,shape,selected, provider) {\n        if(shape.asset) {\n            const src = g.getPropertyValue(shape.asset,'src')\n            if(provider.isImageCached(src)) {\n                c.drawImage(provider.getCachedImage(src),shape.x,shape.y,shape.width,shape.height)\n            } else {\n                provider.requestImageCache(src)\n                c.fillStyle = 'aqua'\n                c.fillRect(shape.x,shape.y,shape.width,shape.height)\n            }\n        } else {\n            c.fillStyle = 'aqua'\n            c.fillRect(shape.x,shape.y,shape.width,shape.height)\n        }\n        if (selected) {\n            c.strokeStyle = 'red'\n            c.strokeRect(shape.x+0.5,shape.y+0.5,shape.width, shape.height)\n        }\n    }\n\n    isInside(pt,shape) {\n        if (pt.x < shape.x) return false\n        if (pt.x > shape.x + shape.width) return false\n        if (pt.y < shape.y) return false\n        if (pt.y > shape.y + shape.height) return false\n        return true\n    }\n    toSVGString(obj,prov) {\n        console.log('serializing',obj,prov)\n        const asset = fetchGraphObject(prov.getDataGraph(),obj.asset)\n        console.log('asset is',asset)\n        // return `<rect x=\"${obj.x}\" y=\"${obj.y}\" width=\"${obj.width}\" height=\"${obj.height}\" fill=\"${obj.fillColor}\"/>`\n        return `<image xlinkHref=\"${asset.src}\"\n                      width=\"${obj.width}\" height=\"${obj.height}\"\n        />`\n\n    }\n}\n","import {TYPES} from \"../common/PropSheet\";\nimport RectDef from \"./RectDef\";\nimport CircleDef from \"./CircleDef\";\nimport TextDef from \"./TextDef\";\nimport ImageDef from \"./ImageDef\";\n\nexport const PROP_DEFS = {\n    title: {\n        key:'title',\n        name:'Title',\n        type:TYPES.STRING\n    },\n    x: {\n        key:'x',\n        name:'X',\n        type:TYPES.NUMBER\n    },\n    y: {\n        key:'y',\n        name:'Y',\n        type:TYPES.NUMBER\n    },\n    rx: {\n        key:'rx',\n        name:'RX',\n        type:TYPES.NUMBER\n    },\n    ry: {\n        key:'ry',\n        name:'RY',\n        type:TYPES.NUMBER\n    },\n    fillColor: {\n        key:'fillColor',\n        name:'color',\n        type:TYPES.COLOR,\n        custom:true,\n    },\n    width: {\n        key:'width',\n        name:'Width',\n        type:TYPES.NUMBER\n    },\n    height: {\n        key:'height',\n        name:'Height',\n        type:TYPES.NUMBER\n    },\n    radius: {\n        key:'radius',\n        name:'Radius',\n        type:TYPES.NUMBER\n    },\n    text: {\n        key:'text',\n        name:'text',\n        type:TYPES.STRING,\n        hints: {\n            multiline:true\n        }\n    },\n    src: {\n        key:'src',\n        name:'src',\n        type:TYPES.STRING,\n    },\n    asset: {\n        key:'asset',\n        name:'asset',\n        type:TYPES.ENUM,\n    },\n    subtype: {\n        key:'subtype',\n        name:'kind',\n        type:TYPES.STRING,\n        locked:true,\n    },\n    format: {\n        key:'format',\n        name:'format',\n        type:TYPES.STRING,\n        locked:true,\n    },\n\n    autoFit: {\n        key:'autoFit',\n        name:'Size to Fit',\n        type:TYPES.BOOLEAN,\n        locked:false,\n    },\n    fontSize: {\n        key:'fontSize',\n        name:'Font Size',\n        type:TYPES.STRING,\n        locked:false,\n    },\n    fontFamily: {\n        key:'fontFamily',\n        name:'Font Family',\n        type:TYPES.ENUM,\n        locked:true,\n    },\n    fontWeight: {\n        key:'fontWeight',\n        name:'Font Weight',\n        type:TYPES.ENUM,\n        locked:true,\n    },\n    fontStyle: {\n        key:'fontStyle',\n        name:'Font Style',\n        type:TYPES.ENUM,\n        locked:true,\n    },\n    horizontalAlign: {\n        key:'horizontalAlign',\n        name:'H Align',\n        type:TYPES.ENUM,\n        locked:false,\n    },\n    verticalAlign: {\n        key:'verticalAlign',\n        name:'V Align',\n        type:TYPES.ENUM,\n        locked:false,\n    },\n    pageSize: {\n        key:'pageSize',\n        name:'Size',\n        type:TYPES.STRING,\n        locked:false,\n        custom:true,\n    }\n}\n\nexport const SHAPE_DEFS = {\n    rect: new RectDef(),\n    circle: new CircleDef(),\n    text: new TextDef(),\n    image: new ImageDef(),\n}\n\nexport const ICONS = {\n    page:'file',\n    layer:'sticky-note',\n    rect:'square',\n    circle:'circle',\n    text:'font',\n    plane:'plane',\n    image:'image',\n    model:'cube',\n    cut:'cut',\n    copy:'copy',\n    paste:'paste',\n    delete:'close'\n}\n\nexport const VERTICAL_ALIGNMENT = {\n    TOP:'TOP',\n    BASELINE:'BASELINE',\n    CENTER:'CENTER',\n    BOTTOM:'BOTTOM',\n}\nexport const HORIZONTAL_ALIGNMENT = {\n    LEFT:'LEFT',\n    CENTER:'CENTER',\n    RIGHT:'RIGHT',\n}\n\nexport const STANDARD_FONTS = {\n    SERIF:'serif',\n    SANSSERIF:'sans-serif',\n    MONOSPACE:'monospace',\n}\n\nexport const FONT_WEIGHTS = {\n    NORMAL:'normal',\n    BOLD:'bold'\n}\n\nexport const FONT_STYLES = {\n    NORMAL:'normal',\n    ITALIC:'italic',\n    OBLIQUE:'oblique'\n}\n\n\n\nexport function isShapeType(type) {\n    if(type === 'rect') return true\n    if(type === 'circle') return true\n    if(type === 'text') return true\n    if(type === 'image') return true\n    return false\n}\n","export default class ObjectDef {\n    updateProperty(node, obj, op, provider) {\n        if (op.name === 'tx') node.position.x = parseFloat(op.value)\n        if (op.name === 'ty') node.position.y = parseFloat(op.value)\n        if (op.name === 'tz') node.position.z = parseFloat(op.value)\n        if (op.name === 'rx') node.rotation.x = parseFloat(op.value)\n        if (op.name === 'ry') node.rotation.y = parseFloat(op.value)\n        if (op.name === 'rz') node.rotation.z = parseFloat(op.value)\n        if (op.name === 'sx') node.scale.x = parseFloat(op.value)\n        if (op.name === 'sy') node.scale.y = parseFloat(op.value)\n        if (op.name === 'sz') node.scale.z = parseFloat(op.value)\n        if (op.name === 'visible') node.visible = op.value\n\n        if (op.name === 'color') {\n            let color = op.value\n            if(color.indexOf('#') === 0) color = color.substring(1)\n            node.material.color.set(parseInt(color,16))\n            return\n        }\n\n    }\n    reset(node, obj) {\n        node.position.set(obj.tx,obj.ty,obj.tz)\n        node.visible = obj.visible\n    }\n}\n","import {fetchGraphObject} from \"../../syncgraph/utils\"\nimport {BoxGeometry, Mesh, MeshLambertMaterial, TextureLoader, DoubleSide, VideoTexture} from 'three'\nimport ObjectDef from './ObjectDef'\nimport {ASSET_TYPES, NONE_ASSET, OBJ_TYPES, PROP_DEFS} from '../Common'\n\nlet COUNTER = 0\n\nexport default class CubeDef extends ObjectDef {\n    make(graph, scene) {\n        if(!scene.id) throw new Error(\"can't create cube w/ missing parent\")\n        return fetchGraphObject(graph,graph.createObject({\n            type:OBJ_TYPES.cube,\n            title:'cube '+COUNTER++,\n            visible:true,\n            width:0.3, height:0.3, depth:0.3,\n            tx:0, ty:0, tz:0,\n            rx:0, ry:0, rz:0,\n            sx:1, sy:1, sz:1,\n            color:'#00ff00',\n            children:graph.createArray(),\n            asset:NONE_ASSET.id,\n            parent:scene.id\n        }))\n    }\n    makeNode(obj, provider) {\n        const node = new Mesh(\n            new BoxGeometry(obj.width, obj.height, obj.depth),\n            new MeshLambertMaterial({color: obj.color})\n        )\n        node.name = obj.title\n        node.userData.clickable = true\n        node.position.set(obj.tx, obj.ty, obj.tz)\n        node.rotation.set(obj.rx,obj.ry,obj.rz)\n        node.scale.set(obj.sx,obj.sy,obj.sz)\n        node.visible = obj.visible\n        this.attachAsset(node, obj, provider)\n        return node\n    }\n\n\n\n    updateProperty(node, obj, op, provider) {\n        if (op.name === 'width' || op.name === 'height' || op.name === 'depth') {\n            node.geometry = new BoxGeometry(obj.width, obj.height, obj.depth)\n            return\n        }\n        if (op.name === PROP_DEFS.asset.key) return this.attachAsset(node, obj, provider)\n        return super.updateProperty(node,obj,op,provider)\n    }\n\n    attachAsset(node, obj, provider) {\n        if(obj.asset === NONE_ASSET.id) {\n            node.material = new MeshLambertMaterial({color: obj.color, side:DoubleSide})\n            return\n        }\n        const tex = provider.assetsManager.getTexture(obj.asset)\n        if(tex) node.material = new MeshLambertMaterial({color: obj.color, side: DoubleSide, map: tex})\n    }\n\n}\n","import {fetchGraphObject} from \"../../syncgraph/utils\";\nimport ObjectDef from './ObjectDef'\nimport {ASSET_TYPES, NONE_ASSET, PROP_DEFS} from '../Common'\nimport {TextureLoader, MeshLambertMaterial, DoubleSide, VideoTexture, Mesh, SphereBufferGeometry} from 'three'\n\nexport default class SphereDef extends ObjectDef {\n    make(graph, scene) {\n        if(!scene.id) throw new Error(\"can't create sphere w/ missing parent\")\n        return fetchGraphObject(graph,graph.createObject({\n            type:'sphere',\n            title:'a sphere',\n            visible:true,\n            radius: 0.3/2,\n            tx:0, ty:0, tz:0,\n            rx:0, ry:0, rz:0,\n            sx:1, sy:1, sz:1,\n            color:'#0000ff',\n            children:graph.createArray(),\n            asset:NONE_ASSET.id,\n            parent:scene.id\n        }))\n    }\n    makeNode(obj, provider) {\n        const node = new Mesh(\n            new SphereBufferGeometry(obj.radius),\n            new MeshLambertMaterial({color: obj.color})\n        )\n        node.name = obj.title\n        node.userData.clickable = true\n        node.position.set(obj.tx, obj.ty, obj.tz)\n        node.rotation.set(obj.rx,obj.ry,obj.rz)\n        node.scale.set(obj.sx,obj.sy,obj.sz)\n        node.visible = obj.visible\n        this.attachAsset(node, obj, provider)\n        return node\n    }\n\n    updateProperty(node, obj, op, provider) {\n        if (op.name === 'radius') node.geometry = new SphereBufferGeometry(op.value)\n        if (op.name === PROP_DEFS.asset.key) return this.attachAsset(node, obj, provider)\n        return super.updateProperty(node,obj,op,provider)\n    }\n\n    attachAsset(node, obj, provider) {\n        if(obj.asset === NONE_ASSET.id) {\n            node.material = new MeshLambertMaterial({color: obj.color, side:DoubleSide})\n            return\n        }\n        const tex = provider.assetsManager.getTexture(obj.asset)\n        if(tex) node.material = new MeshLambertMaterial({color: obj.color, side: DoubleSide, map: tex})\n    }\n}\n","import {fetchGraphObject} from \"../../syncgraph/utils\";\nimport * as THREE from \"three\";\nimport {ASSET_TYPES, NONE_ASSET, PROP_DEFS} from '../Common'\nimport ObjectDef from './ObjectDef'\nimport {MeshLambertMaterial} from 'three'\nimport {DoubleSide} from 'three'\nimport {TextureLoader} from 'three'\nimport {VideoTexture} from 'three'\n\nexport default class PlaneDef extends ObjectDef {\n    make(graph, scene) {\n        if(!scene.id) throw new Error(\"can't create plane w/ missing parent\")\n        return fetchGraphObject(graph,graph.createObject({\n            type:'plane',\n            title:'a plane',\n            visible:true,\n            width: 0.5,\n            height: 0.5,\n            tx:0, ty:0, tz:0,\n            rx:0, ry:0, rz:0,\n            sx:1, sy:1, sz:1,\n            color:'#ffffff',\n            children:graph.createArray(),\n            asset:NONE_ASSET.id,\n            parent:scene.id\n        }))\n    }\n    makeNode(obj, provider) {\n        const node = new THREE.Mesh(\n            new THREE.PlaneBufferGeometry(obj.width,obj.height),\n            new THREE.MeshLambertMaterial({color: obj.color, side: THREE.DoubleSide})\n        )\n        this.attachAsset(node, obj, provider)\n        node.userData.clickable = true\n        // on(node,POINTER_CLICK,e =>SelectionManager.setSelection(node.userData.graphid))\n        node.position.set(obj.tx, obj.ty, obj.tz)\n        node.rotation.set(obj.rx,obj.ry,obj.rz)\n        node.scale.set(obj.sx,obj.sy,obj.sz)\n        node.visible = obj.visible\n        return node\n    }\n\n    updateProperty(node, obj, op, provider) {\n        if (op.name === 'width') node.geometry = new THREE.PlaneBufferGeometry(op.value,obj.height)\n        if (op.name === 'height') node.geometry = new THREE.PlaneBufferGeometry(obj.width,op.value)\n        if (op.name === PROP_DEFS.asset.key) return this.attachAsset(node, obj, provider)\n        return super.updateProperty(node,obj,op,provider)\n    }\n\n    attachAsset(node, obj, provider) {\n        if(obj.asset === NONE_ASSET.id) {\n            node.material = new MeshLambertMaterial({color: obj.color, side:DoubleSide})\n            return\n        }\n        const tex = provider.assetsManager.getTexture(obj.asset)\n        if(tex) {\n            node.material = new MeshLambertMaterial({color: obj.color, side: DoubleSide, map: tex})\n        }\n\n    }\n}\n","/* eslint-disable */\nconst THREE = require('three');//requireimport * as THREE from 'three'\n\n/**\n * @author Rich Tibbett / https://github.com/richtr\n * @author mrdoob / http://mrdoob.com/\n * @author Tony Parisi / http://www.tonyparisi.com/\n * @author Takahiro / https://github.com/takahirox\n * @author Don McCurdy / https://www.donmccurdy.com\n */\n\nconst GLTFLoader = ( function () {\n\n    function GLTFLoader( manager ) {\n\n        this.manager = ( manager !== undefined ) ? manager : THREE.DefaultLoadingManager;\n\n    }\n\n    GLTFLoader.prototype = {\n\n        constructor: GLTFLoader,\n\n        crossOrigin: 'Anonymous',\n\n        load: function ( url, onLoad, onProgress, onError ) {\n\n            var scope = this;\n\n            var path = this.path !== undefined ? this.path : THREE.LoaderUtils.extractUrlBase( url );\n\n            var loader = new THREE.FileLoader( scope.manager );\n\n            loader.setResponseType( 'arraybuffer' );\n\n            loader.load( url, function ( data ) {\n\n                try {\n\n                    scope.parse( data, path, onLoad, onError );\n\n                } catch ( e ) {\n\n                    if ( onError !== undefined ) {\n\n                        onError( e );\n\n                    } else {\n\n                        throw e;\n\n                    }\n\n                }\n\n            }, onProgress, onError );\n\n        },\n\n        setCrossOrigin: function ( value ) {\n\n            this.crossOrigin = value;\n            return this;\n\n        },\n\n        setPath: function ( value ) {\n\n            this.path = value;\n            return this;\n\n        },\n\n        parse: function ( data, path, onLoad, onError ) {\n\n            var content;\n            var extensions = {};\n\n            if ( typeof data === 'string' ) {\n\n                content = data;\n\n            } else {\n\n                var magic = THREE.LoaderUtils.decodeText( new Uint8Array( data, 0, 4 ) );\n\n                if ( magic === BINARY_EXTENSION_HEADER_MAGIC ) {\n\n                    try {\n\n                        extensions[ EXTENSIONS.KHR_BINARY_GLTF ] = new GLTFBinaryExtension( data );\n\n                    } catch ( error ) {\n\n                        if ( onError ) onError( error );\n                        return;\n\n                    }\n\n                    content = extensions[ EXTENSIONS.KHR_BINARY_GLTF ].content;\n\n                } else {\n\n                    content = THREE.LoaderUtils.decodeText( new Uint8Array( data ) );\n\n                }\n\n            }\n\n            var json = JSON.parse( content );\n\n            if ( json.asset === undefined || json.asset.version[ 0 ] < 2 ) {\n\n                if ( onError ) onError( new Error( 'THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported. Use LegacyGLTFLoader instead.' ) );\n                return;\n\n            }\n\n            if ( json.extensionsUsed ) {\n\n                if ( json.extensionsUsed.indexOf( EXTENSIONS.KHR_LIGHTS ) >= 0 ) {\n\n                    extensions[ EXTENSIONS.KHR_LIGHTS ] = new GLTFLightsExtension( json );\n\n                }\n\n                if ( json.extensionsUsed.indexOf( EXTENSIONS.KHR_MATERIALS_COMMON ) >= 0 ) {\n\n                    extensions[ EXTENSIONS.KHR_MATERIALS_COMMON ] = new GLTFMaterialsCommonExtension( json );\n\n                }\n\n                if ( json.extensionsUsed.indexOf( EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS ) >= 0 ) {\n\n                    extensions[ EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS ] = new GLTFMaterialsPbrSpecularGlossinessExtension();\n\n                }\n\n            }\n\n            console.time( 'GLTFLoader' );\n\n            var parser = new GLTFParser( json, extensions, {\n\n                path: path || this.path || '',\n                crossOrigin: this.crossOrigin,\n                manager: this.manager\n\n            } );\n\n            parser.parse( function ( scene, scenes, cameras, animations, asset ) {\n\n                console.timeEnd( 'GLTFLoader' );\n\n                var glTF = {\n                    scene: scene,\n                    scenes: scenes,\n                    cameras: cameras,\n                    animations: animations,\n                    asset: asset\n                };\n\n                onLoad( glTF );\n\n            }, onError );\n\n        }\n\n    };\n\n    /* GLTFREGISTRY */\n\n    function GLTFRegistry() {\n\n        var objects = {};\n\n        return\t{\n\n            get: function ( key ) {\n\n                return objects[ key ];\n\n            },\n\n            add: function ( key, object ) {\n\n                objects[ key ] = object;\n\n            },\n\n            remove: function ( key ) {\n\n                delete objects[ key ];\n\n            },\n\n            removeAll: function () {\n\n                objects = {};\n\n            }\n\n        };\n\n    }\n\n    /*********************************/\n    /********** EXTENSIONS ***********/\n    /*********************************/\n\n    var EXTENSIONS = {\n        KHR_BINARY_GLTF: 'KHR_binary_glTF',\n        KHR_LIGHTS: 'KHR_lights',\n        KHR_MATERIALS_COMMON: 'KHR_materials_common',\n        KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS: 'KHR_materials_pbrSpecularGlossiness'\n    };\n\n    /**\n     * Lights Extension\n     *\n     * Specification: PENDING\n     */\n    function GLTFLightsExtension( json ) {\n\n        this.name = EXTENSIONS.KHR_LIGHTS;\n\n        this.lights = {};\n\n        var extension = ( json.extensions && json.extensions[ EXTENSIONS.KHR_LIGHTS ] ) || {};\n        var lights = extension.lights || {};\n\n        for ( var lightId in lights ) {\n\n            var light = lights[ lightId ];\n            var lightNode;\n\n            var color = new THREE.Color().fromArray( light.color );\n\n            switch ( light.type ) {\n\n                case 'directional':\n                    lightNode = new THREE.DirectionalLight( color );\n                    lightNode.position.set( 0, 0, 1 );\n                    break;\n\n                case 'point':\n                    lightNode = new THREE.PointLight( color );\n                    break;\n\n                case 'spot':\n                    lightNode = new THREE.SpotLight( color );\n                    lightNode.position.set( 0, 0, 1 );\n                    break;\n\n                case 'ambient':\n                    lightNode = new THREE.AmbientLight( color );\n                    break;\n\n            }\n\n            if ( lightNode ) {\n\n                if ( light.constantAttenuation !== undefined ) {\n\n                    lightNode.intensity = light.constantAttenuation;\n\n                }\n\n                if ( light.linearAttenuation !== undefined ) {\n\n                    lightNode.distance = 1 / light.linearAttenuation;\n\n                }\n\n                if ( light.quadraticAttenuation !== undefined ) {\n\n                    lightNode.decay = light.quadraticAttenuation;\n\n                }\n\n                if ( light.fallOffAngle !== undefined ) {\n\n                    lightNode.angle = light.fallOffAngle;\n\n                }\n\n                if ( light.fallOffExponent !== undefined ) {\n\n                    console.warn( 'THREE.GLTFLoader:: light.fallOffExponent not currently supported.' );\n\n                }\n\n                lightNode.name = light.name || ( 'light_' + lightId );\n                this.lights[ lightId ] = lightNode;\n\n            }\n\n        }\n\n    }\n\n    /**\n     * Common Materials Extension\n     *\n     * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/Khronos/KHR_materials_common\n     */\n    function GLTFMaterialsCommonExtension( json ) {\n\n        this.name = EXTENSIONS.KHR_MATERIALS_COMMON;\n\n    }\n\n    GLTFMaterialsCommonExtension.prototype.getMaterialType = function ( material ) {\n\n        var khrMaterial = material.extensions[ this.name ];\n\n        switch ( khrMaterial.type ) {\n\n            case 'commonBlinn' :\n            case 'commonPhong' :\n                return THREE.MeshPhongMaterial;\n\n            case 'commonLambert' :\n                return THREE.MeshLambertMaterial;\n\n            case 'commonConstant' :\n            default :\n                return THREE.MeshBasicMaterial;\n\n        }\n\n    };\n\n    GLTFMaterialsCommonExtension.prototype.extendParams = function ( materialParams, material, parser ) {\n\n        var khrMaterial = material.extensions[ this.name ];\n\n        var pending = [];\n\n        var keys = [];\n\n        // TODO: Currently ignored: 'ambientFactor', 'ambientTexture'\n        switch ( khrMaterial.type ) {\n\n            case 'commonBlinn' :\n            case 'commonPhong' :\n                keys.push( 'diffuseFactor', 'diffuseTexture', 'specularFactor', 'specularTexture', 'shininessFactor' );\n                break;\n\n            case 'commonLambert' :\n                keys.push( 'diffuseFactor', 'diffuseTexture' );\n                break;\n\n            case 'commonConstant' :\n            default :\n                break;\n\n        }\n\n        var materialValues = {};\n\n        keys.forEach( function ( v ) {\n\n            if ( khrMaterial[ v ] !== undefined ) materialValues[ v ] = khrMaterial[ v ];\n\n        } );\n\n        if ( materialValues.diffuseFactor !== undefined ) {\n\n            materialParams.color = new THREE.Color().fromArray( materialValues.diffuseFactor );\n            materialParams.opacity = materialValues.diffuseFactor[ 3 ];\n\n        }\n\n        if ( materialValues.diffuseTexture !== undefined ) {\n\n            pending.push( parser.assignTexture( materialParams, 'map', materialValues.diffuseTexture.index ) );\n\n        }\n\n        if ( materialValues.specularFactor !== undefined ) {\n\n            materialParams.specular = new THREE.Color().fromArray( materialValues.specularFactor );\n\n        }\n\n        if ( materialValues.specularTexture !== undefined ) {\n\n            pending.push( parser.assignTexture( materialParams, 'specularMap', materialValues.specularTexture.index ) );\n\n        }\n\n        if ( materialValues.shininessFactor !== undefined ) {\n\n            materialParams.shininess = materialValues.shininessFactor;\n\n        }\n\n        return Promise.all( pending );\n\n    };\n\n    /* BINARY EXTENSION */\n\n    var BINARY_EXTENSION_BUFFER_NAME = 'binary_glTF';\n    var BINARY_EXTENSION_HEADER_MAGIC = 'glTF';\n    var BINARY_EXTENSION_HEADER_LENGTH = 12;\n    var BINARY_EXTENSION_CHUNK_TYPES = { JSON: 0x4E4F534A, BIN: 0x004E4942 };\n\n    function GLTFBinaryExtension( data ) {\n\n        this.name = EXTENSIONS.KHR_BINARY_GLTF;\n        this.content = null;\n        this.body = null;\n\n        var headerView = new DataView( data, 0, BINARY_EXTENSION_HEADER_LENGTH );\n\n        this.header = {\n            magic: THREE.LoaderUtils.decodeText( new Uint8Array( data.slice( 0, 4 ) ) ),\n            version: headerView.getUint32( 4, true ),\n            length: headerView.getUint32( 8, true )\n        };\n\n        if ( this.header.magic !== BINARY_EXTENSION_HEADER_MAGIC ) {\n\n            throw new Error( 'THREE.GLTFLoader: Unsupported glTF-Binary header.' );\n\n        } else if ( this.header.version < 2.0 ) {\n\n            throw new Error( 'THREE.GLTFLoader: Legacy binary file detected. Use LegacyGLTFLoader instead.' );\n\n        }\n\n        var chunkView = new DataView( data, BINARY_EXTENSION_HEADER_LENGTH );\n        var chunkIndex = 0;\n\n        while ( chunkIndex < chunkView.byteLength ) {\n\n            var chunkLength = chunkView.getUint32( chunkIndex, true );\n            chunkIndex += 4;\n\n            var chunkType = chunkView.getUint32( chunkIndex, true );\n            chunkIndex += 4;\n\n            if ( chunkType === BINARY_EXTENSION_CHUNK_TYPES.JSON ) {\n\n                var contentArray = new Uint8Array( data, BINARY_EXTENSION_HEADER_LENGTH + chunkIndex, chunkLength );\n                this.content = THREE.LoaderUtils.decodeText( contentArray );\n\n            } else if ( chunkType === BINARY_EXTENSION_CHUNK_TYPES.BIN ) {\n\n                var byteOffset = BINARY_EXTENSION_HEADER_LENGTH + chunkIndex;\n                this.body = data.slice( byteOffset, byteOffset + chunkLength );\n\n            }\n\n            // Clients must ignore chunks with unknown types.\n\n            chunkIndex += chunkLength;\n\n        }\n\n        if ( this.content === null ) {\n\n            throw new Error( 'THREE.GLTFLoader: JSON content not found.' );\n\n        }\n\n    }\n\n    /**\n     * Specular-Glossiness Extension\n     *\n     * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/Khronos/KHR_materials_pbrSpecularGlossiness\n     */\n    function GLTFMaterialsPbrSpecularGlossinessExtension() {\n\n        return {\n\n            name: EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,\n\n            specularGlossinessParams: [\n                'color',\n                'map',\n                'lightMap',\n                'lightMapIntensity',\n                'aoMap',\n                'aoMapIntensity',\n                'emissive',\n                'emissiveIntensity',\n                'emissiveMap',\n                'bumpMap',\n                'bumpScale',\n                'normalMap',\n                'displacementMap',\n                'displacementScale',\n                'displacementBias',\n                'specularMap',\n                'specular',\n                'glossinessMap',\n                'glossiness',\n                'alphaMap',\n                'envMap',\n                'envMapIntensity',\n                'refractionRatio',\n            ],\n\n            getMaterialType: function () {\n\n                return THREE.ShaderMaterial;\n\n            },\n\n            extendParams: function ( params, material, parser ) {\n\n                var pbrSpecularGlossiness = material.extensions[ this.name ];\n\n                var shader = THREE.ShaderLib[ 'standard' ];\n\n                var uniforms = THREE.UniformsUtils.clone( shader.uniforms );\n\n                var specularMapParsFragmentChunk = [\n                    '#ifdef USE_SPECULARMAP',\n                    '\tuniform sampler2D specularMap;',\n                    '#endif'\n                ].join( '\\n' );\n\n                var glossinessMapParsFragmentChunk = [\n                    '#ifdef USE_GLOSSINESSMAP',\n                    '\tuniform sampler2D glossinessMap;',\n                    '#endif'\n                ].join( '\\n' );\n\n                var specularMapFragmentChunk = [\n                    'vec3 specularFactor = specular;',\n                    '#ifdef USE_SPECULARMAP',\n                    '\tvec4 texelSpecular = texture2D( specularMap, vUv );',\n                    '\ttexelSpecular = sRGBToLinear( texelSpecular );',\n                    '\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture',\n                    '\tspecularFactor *= texelSpecular.rgb;',\n                    '#endif'\n                ].join( '\\n' );\n\n                var glossinessMapFragmentChunk = [\n                    'float glossinessFactor = glossiness;',\n                    '#ifdef USE_GLOSSINESSMAP',\n                    '\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );',\n                    '\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture',\n                    '\tglossinessFactor *= texelGlossiness.a;',\n                    '#endif'\n                ].join( '\\n' );\n\n                var lightPhysicalFragmentChunk = [\n                    'PhysicalMaterial material;',\n                    'material.diffuseColor = diffuseColor.rgb;',\n                    'material.specularRoughness = clamp( 1.0 - glossinessFactor, 0.04, 1.0 );',\n                    'material.specularColor = specularFactor.rgb;',\n                ].join( '\\n' );\n\n                var fragmentShader = shader.fragmentShader\n                    .replace( '#include <specularmap_fragment>', '' )\n                    .replace( 'uniform float roughness;', 'uniform vec3 specular;' )\n                    .replace( 'uniform float metalness;', 'uniform float glossiness;' )\n                    .replace( '#include <roughnessmap_pars_fragment>', specularMapParsFragmentChunk )\n                    .replace( '#include <metalnessmap_pars_fragment>', glossinessMapParsFragmentChunk )\n                    .replace( '#include <roughnessmap_fragment>', specularMapFragmentChunk )\n                    .replace( '#include <metalnessmap_fragment>', glossinessMapFragmentChunk )\n                    .replace( '#include <lights_physical_fragment>', lightPhysicalFragmentChunk );\n\n                delete uniforms.roughness;\n                delete uniforms.metalness;\n                delete uniforms.roughnessMap;\n                delete uniforms.metalnessMap;\n\n                uniforms.specular = { value: new THREE.Color().setHex( 0x111111 ) };\n                uniforms.glossiness = { value: 0.5 };\n                uniforms.specularMap = { value: null };\n                uniforms.glossinessMap = { value: null };\n\n                params.vertexShader = shader.vertexShader;\n                params.fragmentShader = fragmentShader;\n                params.uniforms = uniforms;\n                params.defines = { 'STANDARD': '' };\n\n                params.color = new THREE.Color( 1.0, 1.0, 1.0 );\n                params.opacity = 1.0;\n\n                var pending = [];\n\n                if ( Array.isArray( pbrSpecularGlossiness.diffuseFactor ) ) {\n\n                    var array = pbrSpecularGlossiness.diffuseFactor;\n\n                    params.color.fromArray( array );\n                    params.opacity = array[ 3 ];\n\n                }\n\n                if ( pbrSpecularGlossiness.diffuseTexture !== undefined ) {\n\n                    pending.push( parser.assignTexture( params, 'map', pbrSpecularGlossiness.diffuseTexture.index ) );\n\n                }\n\n                params.emissive = new THREE.Color( 0.0, 0.0, 0.0 );\n                params.glossiness = pbrSpecularGlossiness.glossinessFactor !== undefined ? pbrSpecularGlossiness.glossinessFactor : 1.0;\n                params.specular = new THREE.Color( 1.0, 1.0, 1.0 );\n\n                if ( Array.isArray( pbrSpecularGlossiness.specularFactor ) ) {\n\n                    params.specular.fromArray( pbrSpecularGlossiness.specularFactor );\n\n                }\n\n                if ( pbrSpecularGlossiness.specularGlossinessTexture !== undefined ) {\n\n                    var specGlossIndex = pbrSpecularGlossiness.specularGlossinessTexture.index;\n                    pending.push( parser.assignTexture( params, 'glossinessMap', specGlossIndex ) );\n                    pending.push( parser.assignTexture( params, 'specularMap', specGlossIndex ) );\n\n                }\n\n                return Promise.all( pending );\n\n            },\n\n            createMaterial: function ( params ) {\n\n                // setup material properties based on MeshStandardMaterial for Specular-Glossiness\n\n                var material = new THREE.ShaderMaterial( {\n                    defines: params.defines,\n                    vertexShader: params.vertexShader,\n                    fragmentShader: params.fragmentShader,\n                    uniforms: params.uniforms,\n                    fog: true,\n                    lights: true,\n                    opacity: params.opacity,\n                    transparent: params.transparent\n                } );\n\n                material.isGLTFSpecularGlossinessMaterial = true;\n\n                material.color = params.color;\n\n                material.map = params.map === undefined ? null : params.map;\n\n                material.lightMap = null;\n                material.lightMapIntensity = 1.0;\n\n                material.aoMap = params.aoMap === undefined ? null : params.aoMap;\n                material.aoMapIntensity = 1.0;\n\n                material.emissive = params.emissive;\n                material.emissiveIntensity = 1.0;\n                material.emissiveMap = params.emissiveMap === undefined ? null : params.emissiveMap;\n\n                material.bumpMap = params.bumpMap === undefined ? null : params.bumpMap;\n                material.bumpScale = 1;\n\n                material.normalMap = params.normalMap === undefined ? null : params.normalMap;\n                if ( params.normalScale ) material.normalScale = params.normalScale;\n\n                material.displacementMap = null;\n                material.displacementScale = 1;\n                material.displacementBias = 0;\n\n                material.specularMap = params.specularMap === undefined ? null : params.specularMap;\n                material.specular = params.specular;\n\n                material.glossinessMap = params.glossinessMap === undefined ? null : params.glossinessMap;\n                material.glossiness = params.glossiness;\n\n                material.alphaMap = null;\n\n                material.envMap = params.envMap === undefined ? null : params.envMap;\n                material.envMapIntensity = 1.0;\n\n                material.refractionRatio = 0.98;\n\n                material.extensions.derivatives = true;\n\n                return material;\n\n            },\n\n            /**\n             * Clones a GLTFSpecularGlossinessMaterial instance. The ShaderMaterial.copy() method can\n             * copy only properties it knows about or inherits, and misses many properties that would\n             * normally be defined by MeshStandardMaterial.\n             *\n             * This method allows GLTFSpecularGlossinessMaterials to be cloned in the process of\n             * loading a glTF model, but cloning later (e.g. by the user) would require these changes\n             * AND also updating `.onBeforeRender` on the parent mesh.\n             *\n             * @param  {THREE.ShaderMaterial} source\n             * @return {THREE.ShaderMaterial}\n             */\n            cloneMaterial: function ( source ) {\n\n                var target = source.clone();\n\n                target.isGLTFSpecularGlossinessMaterial = true;\n\n                var params = this.specularGlossinessParams;\n\n                for ( var i = 0, il = params.length; i < il; i ++ ) {\n\n                    target[ params[ i ] ] = source[ params[ i ] ];\n\n                }\n\n                return target;\n\n            },\n\n            // Here's based on refreshUniformsCommon() and refreshUniformsStandard() in WebGLRenderer.\n            refreshUniforms: function ( renderer, scene, camera, geometry, material, group ) {\n\n                var uniforms = material.uniforms;\n                var defines = material.defines;\n\n                uniforms.opacity.value = material.opacity;\n\n                uniforms.diffuse.value.copy( material.color );\n                uniforms.emissive.value.copy( material.emissive ).multiplyScalar( material.emissiveIntensity );\n\n                uniforms.map.value = material.map;\n                uniforms.specularMap.value = material.specularMap;\n                uniforms.alphaMap.value = material.alphaMap;\n\n                uniforms.lightMap.value = material.lightMap;\n                uniforms.lightMapIntensity.value = material.lightMapIntensity;\n\n                uniforms.aoMap.value = material.aoMap;\n                uniforms.aoMapIntensity.value = material.aoMapIntensity;\n\n                // uv repeat and offset setting priorities\n                // 1. color map\n                // 2. specular map\n                // 3. normal map\n                // 4. bump map\n                // 5. alpha map\n                // 6. emissive map\n\n                var uvScaleMap;\n\n                if ( material.map ) {\n\n                    uvScaleMap = material.map;\n\n                } else if ( material.specularMap ) {\n\n                    uvScaleMap = material.specularMap;\n\n                } else if ( material.displacementMap ) {\n\n                    uvScaleMap = material.displacementMap;\n\n                } else if ( material.normalMap ) {\n\n                    uvScaleMap = material.normalMap;\n\n                } else if ( material.bumpMap ) {\n\n                    uvScaleMap = material.bumpMap;\n\n                } else if ( material.glossinessMap ) {\n\n                    uvScaleMap = material.glossinessMap;\n\n                } else if ( material.alphaMap ) {\n\n                    uvScaleMap = material.alphaMap;\n\n                } else if ( material.emissiveMap ) {\n\n                    uvScaleMap = material.emissiveMap;\n\n                }\n\n                if ( uvScaleMap !== undefined ) {\n\n                    // backwards compatibility\n                    if ( uvScaleMap.isWebGLRenderTarget ) {\n\n                        uvScaleMap = uvScaleMap.texture;\n\n                    }\n\n                    var offset;\n                    var repeat;\n\n                    if ( uvScaleMap.matrix !== undefined ) {\n\n                        // > r88.\n\n                        if ( uvScaleMap.matrixAutoUpdate === true ) {\n\n                            offset = uvScaleMap.offset;\n                            repeat = uvScaleMap.repeat;\n                            var rotation = uvScaleMap.rotation;\n                            var center = uvScaleMap.center;\n\n                            uvScaleMap.matrix.setUvTransform( offset.x, offset.y, repeat.x, repeat.y, rotation, center.x, center.y );\n\n                        }\n\n                        uniforms.uvTransform.value.copy( uvScaleMap.matrix );\n\n                    } else {\n\n                        // <= r87. Remove when reasonable.\n\n                        offset = uvScaleMap.offset;\n                        repeat = uvScaleMap.repeat;\n\n                        uniforms.offsetRepeat.value.set( offset.x, offset.y, repeat.x, repeat.y );\n\n                    }\n\n                }\n\n                uniforms.envMap.value = material.envMap;\n                uniforms.envMapIntensity.value = material.envMapIntensity;\n                uniforms.flipEnvMap.value = ( material.envMap && material.envMap.isCubeTexture ) ? - 1 : 1;\n\n                uniforms.refractionRatio.value = material.refractionRatio;\n\n                uniforms.specular.value.copy( material.specular );\n                uniforms.glossiness.value = material.glossiness;\n\n                uniforms.glossinessMap.value = material.glossinessMap;\n\n                uniforms.emissiveMap.value = material.emissiveMap;\n                uniforms.bumpMap.value = material.bumpMap;\n                uniforms.normalMap.value = material.normalMap;\n\n                uniforms.displacementMap.value = material.displacementMap;\n                uniforms.displacementScale.value = material.displacementScale;\n                uniforms.displacementBias.value = material.displacementBias;\n\n                if ( uniforms.glossinessMap.value !== null && defines.USE_GLOSSINESSMAP === undefined ) {\n\n                    defines.USE_GLOSSINESSMAP = '';\n                    // set USE_ROUGHNESSMAP to enable vUv\n                    defines.USE_ROUGHNESSMAP = '';\n\n                }\n\n                if ( uniforms.glossinessMap.value === null && defines.USE_GLOSSINESSMAP !== undefined ) {\n\n                    delete defines.USE_GLOSSINESSMAP;\n                    delete defines.USE_ROUGHNESSMAP;\n\n                }\n\n            }\n\n        };\n\n    }\n\n    /*********************************/\n    /********** INTERNALS ************/\n    /*********************************/\n\n    /* CONSTANTS */\n\n    var WEBGL_CONSTANTS = {\n        FLOAT: 5126,\n        //FLOAT_MAT2: 35674,\n        FLOAT_MAT3: 35675,\n        FLOAT_MAT4: 35676,\n        FLOAT_VEC2: 35664,\n        FLOAT_VEC3: 35665,\n        FLOAT_VEC4: 35666,\n        LINEAR: 9729,\n        REPEAT: 10497,\n        SAMPLER_2D: 35678,\n        POINTS: 0,\n        LINES: 1,\n        LINE_LOOP: 2,\n        LINE_STRIP: 3,\n        TRIANGLES: 4,\n        TRIANGLE_STRIP: 5,\n        TRIANGLE_FAN: 6,\n        UNSIGNED_BYTE: 5121,\n        UNSIGNED_SHORT: 5123\n    };\n\n    var WEBGL_TYPE = {\n        5126: Number,\n        //35674: THREE.Matrix2,\n        35675: THREE.Matrix3,\n        35676: THREE.Matrix4,\n        35664: THREE.Vector2,\n        35665: THREE.Vector3,\n        35666: THREE.Vector4,\n        35678: THREE.Texture\n    };\n\n    var WEBGL_COMPONENT_TYPES = {\n        5120: Int8Array,\n        5121: Uint8Array,\n        5122: Int16Array,\n        5123: Uint16Array,\n        5125: Uint32Array,\n        5126: Float32Array\n    };\n\n    var WEBGL_FILTERS = {\n        9728: THREE.NearestFilter,\n        9729: THREE.LinearFilter,\n        9984: THREE.NearestMipMapNearestFilter,\n        9985: THREE.LinearMipMapNearestFilter,\n        9986: THREE.NearestMipMapLinearFilter,\n        9987: THREE.LinearMipMapLinearFilter\n    };\n\n    var WEBGL_WRAPPINGS = {\n        33071: THREE.ClampToEdgeWrapping,\n        33648: THREE.MirroredRepeatWrapping,\n        10497: THREE.RepeatWrapping\n    };\n\n    var WEBGL_TEXTURE_FORMATS = {\n        6406: THREE.AlphaFormat,\n        6407: THREE.RGBFormat,\n        6408: THREE.RGBAFormat,\n        6409: THREE.LuminanceFormat,\n        6410: THREE.LuminanceAlphaFormat\n    };\n\n    var WEBGL_TEXTURE_DATATYPES = {\n        5121: THREE.UnsignedByteType,\n        32819: THREE.UnsignedShort4444Type,\n        32820: THREE.UnsignedShort5551Type,\n        33635: THREE.UnsignedShort565Type\n    };\n\n    var WEBGL_SIDES = {\n        1028: THREE.BackSide, // Culling front\n        1029: THREE.FrontSide // Culling back\n        //1032: THREE.NoSide   // Culling front and back, what to do?\n    };\n\n    var WEBGL_DEPTH_FUNCS = {\n        512: THREE.NeverDepth,\n        513: THREE.LessDepth,\n        514: THREE.EqualDepth,\n        515: THREE.LessEqualDepth,\n        516: THREE.GreaterEqualDepth,\n        517: THREE.NotEqualDepth,\n        518: THREE.GreaterEqualDepth,\n        519: THREE.AlwaysDepth\n    };\n\n    var WEBGL_BLEND_EQUATIONS = {\n        32774: THREE.AddEquation,\n        32778: THREE.SubtractEquation,\n        32779: THREE.ReverseSubtractEquation\n    };\n\n    var WEBGL_BLEND_FUNCS = {\n        0: THREE.ZeroFactor,\n        1: THREE.OneFactor,\n        768: THREE.SrcColorFactor,\n        769: THREE.OneMinusSrcColorFactor,\n        770: THREE.SrcAlphaFactor,\n        771: THREE.OneMinusSrcAlphaFactor,\n        772: THREE.DstAlphaFactor,\n        773: THREE.OneMinusDstAlphaFactor,\n        774: THREE.DstColorFactor,\n        775: THREE.OneMinusDstColorFactor,\n        776: THREE.SrcAlphaSaturateFactor\n        // The followings are not supported by Three.js yet\n        //32769: CONSTANT_COLOR,\n        //32770: ONE_MINUS_CONSTANT_COLOR,\n        //32771: CONSTANT_ALPHA,\n        //32772: ONE_MINUS_CONSTANT_COLOR\n    };\n\n    var WEBGL_TYPE_SIZES = {\n        'SCALAR': 1,\n        'VEC2': 2,\n        'VEC3': 3,\n        'VEC4': 4,\n        'MAT2': 4,\n        'MAT3': 9,\n        'MAT4': 16\n    };\n\n    var PATH_PROPERTIES = {\n        scale: 'scale',\n        translation: 'position',\n        rotation: 'quaternion',\n        weights: 'morphTargetInfluences'\n    };\n\n    var INTERPOLATION = {\n        CUBICSPLINE: THREE.InterpolateSmooth,\n        LINEAR: THREE.InterpolateLinear,\n        STEP: THREE.InterpolateDiscrete\n    };\n\n    var STATES_ENABLES = {\n        2884: 'CULL_FACE',\n        2929: 'DEPTH_TEST',\n        3042: 'BLEND',\n        3089: 'SCISSOR_TEST',\n        32823: 'POLYGON_OFFSET_FILL',\n        32926: 'SAMPLE_ALPHA_TO_COVERAGE'\n    };\n\n    var ALPHA_MODES = {\n        OPAQUE: 'OPAQUE',\n        MASK: 'MASK',\n        BLEND: 'BLEND'\n    };\n\n    /* UTILITY FUNCTIONS */\n\n    function resolveURL( url, path ) {\n\n        // Invalid URL\n        if ( typeof url !== 'string' || url === '' ) return '';\n\n        // Absolute URL http://,https://,//\n        if ( /^(https?:)?\\/\\//i.test( url ) ) return url;\n\n        // Data URI\n        if ( /^data:.*,.*$/i.test( url ) ) return url;\n\n        // Blob URL\n        if ( /^blob:.*$/i.test( url ) ) return url;\n\n        // Relative URL\n        return path + url;\n\n    }\n\n    /**\n     * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#default-material\n     */\n    function createDefaultMaterial() {\n\n        return new THREE.MeshStandardMaterial( {\n            color: 0xFFFFFF,\n            emissive: 0x000000,\n            metalness: 1,\n            roughness: 1,\n            transparent: false,\n            depthTest: true,\n            side: THREE.FrontSide\n        } );\n\n    }\n\n    /**\n     * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#morph-targets\n     *\n     * TODO: Implement support for morph targets on TANGENT attribute.\n     *\n     * @param {THREE.Mesh} mesh\n     * @param {GLTF.Mesh} meshDef\n     * @param {GLTF.Primitive} primitiveDef\n     * @param {Array<THREE.BufferAttribute>} accessors\n     */\n    function addMorphTargets( mesh, meshDef, primitiveDef, accessors ) {\n\n        var geometry = mesh.geometry;\n        var material = mesh.material;\n\n        var targets = primitiveDef.targets;\n        var morphAttributes = geometry.morphAttributes;\n\n        morphAttributes.position = [];\n        morphAttributes.normal = [];\n\n        material.morphTargets = true;\n\n        for ( var i = 0, il = targets.length; i < il; i ++ ) {\n\n            var target = targets[ i ];\n            var attributeName = 'morphTarget' + i;\n\n            var positionAttribute, normalAttribute;\n\n            if ( target.POSITION !== undefined ) {\n\n                // Three.js morph formula is\n                //   position\n                //     + weight0 * ( morphTarget0 - position )\n                //     + weight1 * ( morphTarget1 - position )\n                //     ...\n                // while the glTF one is\n                //   position\n                //     + weight0 * morphTarget0\n                //     + weight1 * morphTarget1\n                //     ...\n                // then adding position to morphTarget.\n                // So morphTarget value will depend on mesh's position, then cloning attribute\n                // for the case if attribute is shared among two or more meshes.\n\n                positionAttribute = accessors[ target.POSITION ].clone();\n                var position = geometry.attributes.position;\n\n                for ( var j = 0, jl = positionAttribute.count; j < jl; j ++ ) {\n\n                    positionAttribute.setXYZ(\n                        j,\n                        positionAttribute.getX( j ) + position.getX( j ),\n                        positionAttribute.getY( j ) + position.getY( j ),\n                        positionAttribute.getZ( j ) + position.getZ( j )\n                    );\n\n                }\n\n            } else if ( geometry.attributes.position ) {\n\n                // Copying the original position not to affect the final position.\n                // See the formula above.\n                positionAttribute = geometry.attributes.position.clone();\n\n            }\n\n            if ( positionAttribute !== undefined ) {\n\n                positionAttribute.name = attributeName;\n                morphAttributes.position.push( positionAttribute );\n\n            }\n\n            if ( target.NORMAL !== undefined ) {\n\n                material.morphNormals = true;\n\n                // see target.POSITION's comment\n\n                normalAttribute = accessors[ target.NORMAL ].clone();\n                var normal = geometry.attributes.normal;\n\n                for ( var j = 0, jl = normalAttribute.count; j < jl; j ++ ) {\n\n                    normalAttribute.setXYZ(\n                        j,\n                        normalAttribute.getX( j ) + normal.getX( j ),\n                        normalAttribute.getY( j ) + normal.getY( j ),\n                        normalAttribute.getZ( j ) + normal.getZ( j )\n                    );\n\n                }\n\n            } else if ( geometry.attributes.normal !== undefined ) {\n\n                normalAttribute = geometry.attributes.normal.clone();\n\n            }\n\n            if ( normalAttribute !== undefined ) {\n\n                normalAttribute.name = attributeName;\n                morphAttributes.normal.push( normalAttribute );\n\n            }\n\n        }\n\n        mesh.updateMorphTargets();\n\n        if ( meshDef.weights !== undefined ) {\n\n            for ( var i = 0, il = meshDef.weights.length; i < il; i ++ ) {\n\n                mesh.morphTargetInfluences[ i ] = meshDef.weights[ i ];\n\n            }\n\n        }\n\n    }\n\n    function isPrimitiveEqual( a, b ) {\n\n        if ( a.indices !== b.indices ) {\n\n            return false;\n\n        }\n\n        var attribA = a.attributes || {};\n        var attribB = b.attributes || {};\n        var keysA = Object.keys( attribA );\n        var keysB = Object.keys( attribB );\n\n        if ( keysA.length !== keysB.length ) {\n\n            return false;\n\n        }\n\n        for ( var i = 0, il = keysA.length; i < il; i ++ ) {\n\n            var key = keysA[ i ];\n\n            if ( attribA[ key ] !== attribB[ key ] ) {\n\n                return false;\n\n            }\n\n        }\n\n        return true;\n\n    }\n\n    function getCachedGeometry( cache, newPrimitive ) {\n\n        for ( var i = 0, il = cache.length; i < il; i ++ ) {\n\n            var cached = cache[ i ];\n\n            if ( isPrimitiveEqual( cached.primitive, newPrimitive ) ) {\n\n                return cached.geometry;\n\n            }\n\n        }\n\n        return null;\n\n    }\n\n    /* GLTF PARSER */\n\n    function GLTFParser( json, extensions, options ) {\n\n        this.json = json || {};\n        this.extensions = extensions || {};\n        this.options = options || {};\n\n        // loader object cache\n        this.cache = new GLTFRegistry();\n\n        // BufferGeometry caching\n        this.primitiveCache = [];\n\n        this.textureLoader = new THREE.TextureLoader( this.options.manager );\n        this.textureLoader.setCrossOrigin( this.options.crossOrigin );\n\n        this.fileLoader = new THREE.FileLoader( this.options.manager );\n        this.fileLoader.setResponseType( 'arraybuffer' );\n\n    }\n\n    GLTFParser.prototype.parse = function ( onLoad, onError ) {\n\n        var json = this.json;\n        var parser = this;\n\n        // Clear the loader cache\n        this.cache.removeAll();\n\n        // Mark the special nodes/meshes in json for efficient parse\n        this.markDefs();\n\n        // Fire the callback on complete\n        this.getMultiDependencies( [\n\n            'scene',\n            'animation',\n            'camera'\n\n        ] ).then( function ( dependencies ) {\n\n            var scenes = dependencies.scenes || [];\n            var scene = scenes[ json.scene || 0 ];\n            var animations = dependencies.animations || [];\n            var asset = json.asset;\n            var cameras = dependencies.cameras || [];\n\n            onLoad( scene, scenes, cameras, animations, asset );\n\n        } ).catch( onError );\n\n    };\n\n    /**\n     * Marks the special nodes/meshes in json for efficient parse.\n     */\n    GLTFParser.prototype.markDefs = function () {\n\n        var nodeDefs = this.json.nodes || [];\n        var skinDefs = this.json.skins || [];\n        var meshDefs = this.json.meshes || [];\n\n        var meshReferences = {};\n        var meshUses = {};\n\n        // Nothing in the node definition indicates whether it is a Bone or an\n        // Object3D. Use the skins' joint references to mark bones.\n        for ( var skinIndex = 0, skinLength = skinDefs.length; skinIndex < skinLength; skinIndex ++ ) {\n\n            var joints = skinDefs[ skinIndex ].joints;\n\n            for ( var i = 0, il = joints.length; i < il; i ++ ) {\n\n                nodeDefs[ joints[ i ] ].isBone = true;\n\n            }\n\n        }\n\n        // Meshes can (and should) be reused by multiple nodes in a glTF asset. To\n        // avoid having more than one THREE.Mesh with the same name, count\n        // references and rename instances below.\n        //\n        // Example: CesiumMilkTruck sample model reuses \"Wheel\" meshes.\n        for ( var nodeIndex = 0, nodeLength = nodeDefs.length; nodeIndex < nodeLength; nodeIndex ++ ) {\n\n            var nodeDef = nodeDefs[ nodeIndex ];\n\n            if ( nodeDef.mesh !== undefined ) {\n\n                if ( meshReferences[ nodeDef.mesh ] === undefined ) {\n\n                    meshReferences[ nodeDef.mesh ] = meshUses[ nodeDef.mesh ] = 0;\n\n                }\n\n                meshReferences[ nodeDef.mesh ] ++;\n\n                // Nothing in the mesh definition indicates whether it is\n                // a SkinnedMesh or Mesh. Use the node's mesh reference\n                // to mark SkinnedMesh if node has skin.\n                if ( nodeDef.skin !== undefined ) {\n\n                    meshDefs[ nodeDef.mesh ].isSkinnedMesh = true;\n\n                }\n\n            }\n\n        }\n\n        this.json.meshReferences = meshReferences;\n        this.json.meshUses = meshUses;\n\n    };\n\n    /**\n     * Requests the specified dependency asynchronously, with caching.\n     * @param {string} type\n     * @param {number} index\n     * @return {Promise<Object>}\n     */\n    GLTFParser.prototype.getDependency = function ( type, index ) {\n\n        var cacheKey = type + ':' + index;\n        var dependency = this.cache.get( cacheKey );\n\n        if ( ! dependency ) {\n\n            var fnName = 'load' + type.charAt( 0 ).toUpperCase() + type.slice( 1 );\n            dependency = this[ fnName ]( index );\n            this.cache.add( cacheKey, dependency );\n\n        }\n\n        return dependency;\n\n    };\n\n    /**\n     * Requests all dependencies of the specified type asynchronously, with caching.\n     * @param {string} type\n     * @return {Promise<Array<Object>>}\n     */\n    GLTFParser.prototype.getDependencies = function ( type ) {\n\n        var dependencies = this.cache.get( type );\n\n        if ( ! dependencies ) {\n\n            var parser = this;\n            var defs = this.json[ type + ( type === 'mesh' ? 'es' : 's' ) ] || [];\n\n            dependencies = Promise.all( defs.map( function ( def, index ) {\n\n                return parser.getDependency( type, index );\n\n            } ) );\n\n            this.cache.add( type, dependencies );\n\n        }\n\n        return dependencies;\n\n    };\n\n    /**\n     * Requests all multiple dependencies of the specified types asynchronously, with caching.\n     * @param {Array<string>} types\n     * @return {Promise<Object<Array<Object>>>}\n     */\n    GLTFParser.prototype.getMultiDependencies = function ( types ) {\n\n        var results = {};\n        var pendings = [];\n\n        for ( var i = 0, il = types.length; i < il; i ++ ) {\n\n            var type = types[ i ];\n            var value = this.getDependencies( type );\n\n            value = value.then( function ( key, value ) {\n\n                results[ key ] = value;\n\n            }.bind( this, type + ( type === 'mesh' ? 'es' : 's' ) ) );\n\n            pendings.push( value );\n\n        }\n\n        return Promise.all( pendings ).then( function () {\n\n            return results;\n\n        } );\n\n    };\n\n    /**\n     * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#buffers-and-buffer-views\n     * @param {number} bufferIndex\n     * @return {Promise<ArrayBuffer>}\n     */\n    GLTFParser.prototype.loadBuffer = function ( bufferIndex ) {\n\n        var bufferDef = this.json.buffers[ bufferIndex ];\n        var loader = this.fileLoader;\n\n        if ( bufferDef.type && bufferDef.type !== 'arraybuffer' ) {\n\n            throw new Error( 'THREE.GLTFLoader: ' + bufferDef.type + ' buffer type is not supported.' );\n\n        }\n\n        // If present, GLB container is required to be the first buffer.\n        if ( bufferDef.uri === undefined && bufferIndex === 0 ) {\n\n            return Promise.resolve( this.extensions[ EXTENSIONS.KHR_BINARY_GLTF ].body );\n\n        }\n\n        var options = this.options;\n\n        return new Promise( function ( resolve, reject ) {\n\n            loader.load( resolveURL( bufferDef.uri, options.path ), resolve, undefined, function () {\n\n                reject( new Error( 'THREE.GLTFLoader: Failed to load buffer \"' + bufferDef.uri + '\".' ) );\n\n            } );\n\n        } );\n\n    };\n\n    /**\n     * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#buffers-and-buffer-views\n     * @param {number} bufferViewIndex\n     * @return {Promise<ArrayBuffer>}\n     */\n    GLTFParser.prototype.loadBufferView = function ( bufferViewIndex ) {\n\n        var bufferViewDef = this.json.bufferViews[ bufferViewIndex ];\n\n        return this.getDependency( 'buffer', bufferViewDef.buffer ).then( function ( buffer ) {\n\n            var byteLength = bufferViewDef.byteLength || 0;\n            var byteOffset = bufferViewDef.byteOffset || 0;\n            return buffer.slice( byteOffset, byteOffset + byteLength );\n\n        } );\n\n    };\n\n    /**\n     * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#accessors\n     * @param {number} accessorIndex\n     * @return {Promise<THREE.BufferAttribute|THREE.InterleavedBufferAttribute>}\n     */\n    GLTFParser.prototype.loadAccessor = function ( accessorIndex ) {\n\n        var json = this.json;\n\n        var accessorDef = this.json.accessors[ accessorIndex ];\n\n        var pendingBufferViews = [];\n\n        if ( accessorDef.bufferView !== undefined ) {\n\n            pendingBufferViews.push( this.getDependency( 'bufferView', accessorDef.bufferView ) );\n\n        } else {\n\n            pendingBufferViews.push( null );\n\n        }\n\n        if ( accessorDef.sparse !== undefined ) {\n\n            pendingBufferViews.push( this.getDependency( 'bufferView', accessorDef.sparse.indices.bufferView ) );\n            pendingBufferViews.push( this.getDependency( 'bufferView', accessorDef.sparse.values.bufferView ) );\n\n        }\n\n        return Promise.all( pendingBufferViews ).then( function ( bufferViews ) {\n\n            var bufferView = bufferViews[ 0 ];\n\n            var itemSize = WEBGL_TYPE_SIZES[ accessorDef.type ];\n            var TypedArray = WEBGL_COMPONENT_TYPES[ accessorDef.componentType ];\n\n            // For VEC3: itemSize is 3, elementBytes is 4, itemBytes is 12.\n            var elementBytes = TypedArray.BYTES_PER_ELEMENT;\n            var itemBytes = elementBytes * itemSize;\n            var byteStride = json.bufferViews[ accessorDef.bufferView ].byteStride;\n            var normalized = accessorDef.normalized === true;\n            var array, bufferAttribute;\n\n            // The buffer is not interleaved if the stride is the item size in bytes.\n            if ( byteStride && byteStride !== itemBytes ) {\n\n                // Use the full buffer if it's interleaved.\n                array = new TypedArray( bufferView );\n\n                // Integer parameters to IB/IBA are in array elements, not bytes.\n                var ib = new THREE.InterleavedBuffer( array, byteStride / elementBytes );\n\n                bufferAttribute = new THREE.InterleavedBufferAttribute( ib, itemSize, accessorDef.byteOffset / elementBytes, normalized );\n\n            } else {\n\n                if ( bufferView === null ) {\n\n                    array = new TypedArray( accessorDef.count * itemSize );\n\n                } else {\n\n                    array = new TypedArray( bufferView, accessorDef.byteOffset, accessorDef.count * itemSize );\n\n                }\n\n                bufferAttribute = new THREE.BufferAttribute( array, itemSize, normalized );\n\n            }\n\n            // https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#sparse-accessors\n            if ( accessorDef.sparse !== undefined ) {\n\n                var itemSizeIndices = WEBGL_TYPE_SIZES.SCALAR;\n                var TypedArrayIndices = WEBGL_COMPONENT_TYPES[ accessorDef.sparse.indices.componentType ];\n\n                var byteOffsetIndices = accessorDef.sparse.indices.byteOffset || 0;\n                var byteOffsetValues = accessorDef.sparse.values.byteOffset || 0;\n\n                var sparseIndices = new TypedArrayIndices( bufferViews[ 1 ], byteOffsetIndices, accessorDef.sparse.count * itemSizeIndices );\n                var sparseValues = new TypedArray( bufferViews[ 2 ], byteOffsetValues, accessorDef.sparse.count * itemSize );\n\n                if ( bufferView !== null ) {\n\n                    // Avoid modifying the original ArrayBuffer, if the bufferView wasn't initialized with zeroes.\n                    bufferAttribute.setArray( bufferAttribute.array.slice() );\n\n                }\n\n                for ( var i = 0, il = sparseIndices.length; i < il; i ++ ) {\n\n                    var index = sparseIndices[ i ];\n\n                    bufferAttribute.setX( index, sparseValues[ i * itemSize ] );\n                    if ( itemSize >= 2 ) bufferAttribute.setY( index, sparseValues[ i * itemSize + 1 ] );\n                    if ( itemSize >= 3 ) bufferAttribute.setZ( index, sparseValues[ i * itemSize + 2 ] );\n                    if ( itemSize >= 4 ) bufferAttribute.setW( index, sparseValues[ i * itemSize + 3 ] );\n                    if ( itemSize >= 5 ) throw new Error( 'THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.' );\n\n                }\n\n            }\n\n            return bufferAttribute;\n\n        } );\n\n    };\n\n    /**\n     * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#textures\n     * @param {number} textureIndex\n     * @return {Promise<THREE.Texture>}\n     */\n    GLTFParser.prototype.loadTexture = function ( textureIndex ) {\n\n        var parser = this;\n        var json = this.json;\n        var options = this.options;\n        var textureLoader = this.textureLoader;\n\n        var URL = window.URL || window.webkitURL;\n\n        var textureDef = json.textures[ textureIndex ];\n        var source = json.images[ textureDef.source ];\n        var sourceURI = source.uri;\n        var isObjectURL = false;\n\n        if ( source.bufferView !== undefined ) {\n\n            // Load binary image data from bufferView, if provided.\n\n            sourceURI = parser.getDependency( 'bufferView', source.bufferView ).then( function ( bufferView ) {\n\n                isObjectURL = true;\n                var blob = new Blob( [ bufferView ], { type: source.mimeType } );\n                sourceURI = URL.createObjectURL( blob );\n                return sourceURI;\n\n            } );\n\n        }\n\n        return Promise.resolve( sourceURI ).then( function ( sourceURI ) {\n\n            // Load Texture resource.\n\n            var loader = THREE.Loader.Handlers.get( sourceURI ) || textureLoader;\n\n            return new Promise( function ( resolve, reject ) {\n\n                loader.load( resolveURL( sourceURI, options.path ), resolve, undefined, reject );\n\n            } );\n\n        } ).then( function ( texture ) {\n\n            // Clean up resources and configure Texture.\n\n            if ( isObjectURL === true ) {\n\n                URL.revokeObjectURL( sourceURI );\n\n            }\n\n            texture.flipY = false;\n\n            if ( textureDef.name !== undefined ) texture.name = textureDef.name;\n\n            texture.format = textureDef.format !== undefined ? WEBGL_TEXTURE_FORMATS[ textureDef.format ] : THREE.RGBAFormat;\n\n            if ( textureDef.internalFormat !== undefined && texture.format !== WEBGL_TEXTURE_FORMATS[ textureDef.internalFormat ] ) {\n\n                console.warn( 'THREE.GLTFLoader: Three.js does not support texture internalFormat which is different from texture format. ' +\n                    'internalFormat will be forced to be the same value as format.' );\n\n            }\n\n            texture.type = textureDef.type !== undefined ? WEBGL_TEXTURE_DATATYPES[ textureDef.type ] : THREE.UnsignedByteType;\n\n            var samplers = json.samplers || {};\n            var sampler = samplers[ textureDef.sampler ] || {};\n\n            texture.magFilter = WEBGL_FILTERS[ sampler.magFilter ] || THREE.LinearFilter;\n            texture.minFilter = WEBGL_FILTERS[ sampler.minFilter ] || THREE.LinearMipMapLinearFilter;\n            texture.wrapS = WEBGL_WRAPPINGS[ sampler.wrapS ] || THREE.RepeatWrapping;\n            texture.wrapT = WEBGL_WRAPPINGS[ sampler.wrapT ] || THREE.RepeatWrapping;\n\n            return texture;\n\n        } );\n\n    };\n\n    /**\n     * Asynchronously assigns a texture to the given material parameters.\n     * @param {Object} materialParams\n     * @param {string} textureName\n     * @param {number} textureIndex\n     * @return {Promise}\n     */\n    GLTFParser.prototype.assignTexture = function ( materialParams, textureName, textureIndex ) {\n\n        return this.getDependency( 'texture', textureIndex ).then( function ( texture ) {\n\n            materialParams[ textureName ] = texture;\n\n        } );\n\n    };\n\n    /**\n     * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#materials\n     * @param {number} materialIndex\n     * @return {Promise<THREE.Material>}\n     */\n    GLTFParser.prototype.loadMaterial = function ( materialIndex ) {\n\n        var parser = this;\n        var json = this.json;\n        var extensions = this.extensions;\n        var materialDef = this.json.materials[ materialIndex ];\n\n        var materialType;\n        var materialParams = {};\n        var materialExtensions = materialDef.extensions || {};\n\n        var pending = [];\n\n        if ( materialExtensions[ EXTENSIONS.KHR_MATERIALS_COMMON ] ) {\n\n            var khcExtension = extensions[ EXTENSIONS.KHR_MATERIALS_COMMON ];\n            materialType = khcExtension.getMaterialType( materialDef );\n            pending.push( khcExtension.extendParams( materialParams, materialDef, parser ) );\n\n        } else if ( materialExtensions[ EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS ] ) {\n\n            var sgExtension = extensions[ EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS ];\n            materialType = sgExtension.getMaterialType( materialDef );\n            pending.push( sgExtension.extendParams( materialParams, materialDef, parser ) );\n\n        } else if ( materialDef.pbrMetallicRoughness !== undefined ) {\n\n            // Specification:\n            // https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#metallic-roughness-material\n\n            materialType = THREE.MeshStandardMaterial;\n\n            var metallicRoughness = materialDef.pbrMetallicRoughness;\n\n            materialParams.color = new THREE.Color( 1.0, 1.0, 1.0 );\n            materialParams.opacity = 1.0;\n\n            if ( Array.isArray( metallicRoughness.baseColorFactor ) ) {\n\n                var array = metallicRoughness.baseColorFactor;\n\n                materialParams.color.fromArray( array );\n                materialParams.opacity = array[ 3 ];\n\n            }\n\n            if ( metallicRoughness.baseColorTexture !== undefined ) {\n\n                pending.push( parser.assignTexture( materialParams, 'map', metallicRoughness.baseColorTexture.index ) );\n\n            }\n\n            materialParams.metalness = metallicRoughness.metallicFactor !== undefined ? metallicRoughness.metallicFactor : 1.0;\n            materialParams.roughness = metallicRoughness.roughnessFactor !== undefined ? metallicRoughness.roughnessFactor : 1.0;\n\n            if ( metallicRoughness.metallicRoughnessTexture !== undefined ) {\n\n                var textureIndex = metallicRoughness.metallicRoughnessTexture.index;\n                pending.push( parser.assignTexture( materialParams, 'metalnessMap', textureIndex ) );\n                pending.push( parser.assignTexture( materialParams, 'roughnessMap', textureIndex ) );\n\n            }\n\n        } else {\n\n            materialType = THREE.MeshPhongMaterial;\n\n        }\n\n        if ( materialDef.doubleSided === true ) {\n\n            materialParams.side = THREE.DoubleSide;\n\n        }\n\n        var alphaMode = materialDef.alphaMode || ALPHA_MODES.OPAQUE;\n\n        if ( alphaMode === ALPHA_MODES.BLEND ) {\n\n            materialParams.transparent = true;\n\n        } else {\n\n            materialParams.transparent = false;\n\n            if ( alphaMode === ALPHA_MODES.MASK ) {\n\n                materialParams.alphaTest = materialDef.alphaCutoff !== undefined ? materialDef.alphaCutoff : 0.5;\n\n            }\n\n        }\n\n        if ( materialDef.normalTexture !== undefined ) {\n\n            pending.push( parser.assignTexture( materialParams, 'normalMap', materialDef.normalTexture.index ) );\n\n            materialParams.normalScale = new THREE.Vector2( 1, 1 );\n\n            if ( materialDef.normalTexture.scale !== undefined ) {\n\n                materialParams.normalScale.set( materialDef.normalTexture.scale, materialDef.normalTexture.scale );\n\n            }\n\n        }\n\n        if ( materialDef.occlusionTexture !== undefined ) {\n\n            pending.push( parser.assignTexture( materialParams, 'aoMap', materialDef.occlusionTexture.index ) );\n\n            if ( materialDef.occlusionTexture.strength !== undefined ) {\n\n                materialParams.aoMapIntensity = materialDef.occlusionTexture.strength;\n\n            }\n\n        }\n\n        if ( materialDef.emissiveFactor !== undefined ) {\n\n            if ( materialType === THREE.MeshBasicMaterial ) {\n\n                materialParams.color = new THREE.Color().fromArray( materialDef.emissiveFactor );\n\n            } else {\n\n                materialParams.emissive = new THREE.Color().fromArray( materialDef.emissiveFactor );\n\n            }\n\n        }\n\n        if ( materialDef.emissiveTexture !== undefined ) {\n\n            if ( materialType === THREE.MeshBasicMaterial ) {\n\n                pending.push( parser.assignTexture( materialParams, 'map', materialDef.emissiveTexture.index ) );\n\n            } else {\n\n                pending.push( parser.assignTexture( materialParams, 'emissiveMap', materialDef.emissiveTexture.index ) );\n\n            }\n\n        }\n\n        return Promise.all( pending ).then( function () {\n\n            var material;\n\n            if ( materialType === THREE.ShaderMaterial ) {\n\n                material = extensions[ EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS ].createMaterial( materialParams );\n\n            } else {\n\n                material = new materialType( materialParams );\n\n            }\n\n            if ( materialDef.name !== undefined ) material.name = materialDef.name;\n\n            // Normal map textures use OpenGL conventions:\n            // https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#materialnormaltexture\n            if ( material.normalScale ) {\n\n                material.normalScale.x = - material.normalScale.x;\n\n            }\n\n            // emissiveTexture and baseColorTexture use sRGB encoding.\n            if ( material.map ) material.map.encoding = THREE.sRGBEncoding;\n            if ( material.emissiveMap ) material.emissiveMap.encoding = THREE.sRGBEncoding;\n\n            if ( materialDef.extras ) material.userData = materialDef.extras;\n\n            return material;\n\n        } );\n\n    };\n\n    /**\n     * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#geometry\n     * @param {Array<Object>} primitives\n     * @return {Promise<Array<THREE.BufferGeometry>>}\n     */\n    GLTFParser.prototype.loadGeometries = function ( primitives ) {\n\n        var cache = this.primitiveCache;\n\n        return this.getDependencies( 'accessor' ).then( function ( accessors ) {\n\n            var geometries = [];\n\n            for ( var i = 0, il = primitives.length; i < il; i ++ ) {\n\n                var primitive = primitives[ i ];\n\n                // See if we've already created this geometry\n                var cached = getCachedGeometry( cache, primitive );\n\n                if ( cached ) {\n\n                    // Use the cached geometry if it exists\n                    geometries.push( cached );\n\n                } else {\n\n                    // Otherwise create a new geometry\n                    var geometry = new THREE.BufferGeometry();\n\n                    var attributes = primitive.attributes;\n\n                    for ( var attributeId in attributes ) {\n\n                        var attributeEntry = attributes[ attributeId ];\n\n                        var bufferAttribute = accessors[ attributeEntry ];\n\n                        switch ( attributeId ) {\n\n                            case 'POSITION':\n\n                                geometry.addAttribute( 'position', bufferAttribute );\n                                break;\n\n                            case 'NORMAL':\n\n                                geometry.addAttribute( 'normal', bufferAttribute );\n                                break;\n\n                            case 'TEXCOORD_0':\n                            case 'TEXCOORD0':\n                            case 'TEXCOORD':\n\n                                geometry.addAttribute( 'uv', bufferAttribute );\n                                break;\n\n                            case 'TEXCOORD_1':\n\n                                geometry.addAttribute( 'uv2', bufferAttribute );\n                                break;\n\n                            case 'COLOR_0':\n                            case 'COLOR0':\n                            case 'COLOR':\n\n                                geometry.addAttribute( 'color', bufferAttribute );\n                                break;\n\n                            case 'WEIGHTS_0':\n                            case 'WEIGHT': // WEIGHT semantic deprecated.\n\n                                geometry.addAttribute( 'skinWeight', bufferAttribute );\n                                break;\n\n                            case 'JOINTS_0':\n                            case 'JOINT': // JOINT semantic deprecated.\n\n                                geometry.addAttribute( 'skinIndex', bufferAttribute );\n                                break;\n\n                        }\n\n                    }\n\n                    if ( primitive.indices !== undefined ) {\n\n                        geometry.setIndex( accessors[ primitive.indices ] );\n\n                    }\n\n                    // Cache this geometry\n                    cache.push( {\n\n                        primitive: primitive,\n                        geometry: geometry\n\n                    } );\n\n                    geometries.push( geometry );\n\n                }\n\n            }\n\n            return geometries;\n\n        } );\n\n    };\n\n    /**\n     * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#meshes\n     * @param {number} meshIndex\n     * @return {Promise<THREE.Group|THREE.Mesh|THREE.SkinnedMesh>}\n     */\n    GLTFParser.prototype.loadMesh = function ( meshIndex ) {\n\n        var scope = this;\n        var json = this.json;\n        var extensions = this.extensions;\n\n        var meshDef = this.json.meshes[ meshIndex ];\n\n        return this.getMultiDependencies( [\n\n            'accessor',\n            'material'\n\n        ] ).then( function ( dependencies ) {\n\n            var group = new THREE.Group();\n\n            var primitives = meshDef.primitives;\n\n            return scope.loadGeometries( primitives ).then( function ( geometries ) {\n\n                for ( var i = 0, il = primitives.length; i < il; i ++ ) {\n\n                    var primitive = primitives[ i ];\n                    var geometry = geometries[ i ];\n\n                    var material = primitive.material === undefined\n                        ? createDefaultMaterial()\n                        : dependencies.materials[ primitive.material ];\n\n                    if ( material.aoMap\n                        && geometry.attributes.uv2 === undefined\n                        && geometry.attributes.uv !== undefined ) {\n\n                        console.log( 'THREE.GLTFLoader: Duplicating UVs to support aoMap.' );\n                        geometry.addAttribute( 'uv2', new THREE.BufferAttribute( geometry.attributes.uv.array, 2 ) );\n\n                    }\n\n                    // If the material will be modified later on, clone it now.\n                    var useVertexColors = geometry.attributes.color !== undefined;\n                    var useFlatShading = geometry.attributes.normal === undefined;\n                    var useSkinning = meshDef.isSkinnedMesh === true;\n                    var useMorphTargets = primitive.targets !== undefined;\n\n                    if ( useVertexColors || useFlatShading || useSkinning || useMorphTargets ) {\n\n                        if ( material.isGLTFSpecularGlossinessMaterial ) {\n\n                            var specGlossExtension = extensions[ EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS ];\n                            material = specGlossExtension.cloneMaterial( material );\n\n                        } else {\n\n                            material = material.clone();\n\n                        }\n\n                    }\n\n                    if ( useVertexColors ) {\n\n                        material.vertexColors = THREE.VertexColors;\n                        material.needsUpdate = true;\n\n                    }\n\n                    if ( useFlatShading ) {\n\n                        material.flatShading = true;\n\n                    }\n\n                    var mesh;\n\n                    if ( primitive.mode === WEBGL_CONSTANTS.TRIANGLES ||\n                        primitive.mode === WEBGL_CONSTANTS.TRIANGLE_STRIP ||\n                        primitive.mode === WEBGL_CONSTANTS.TRIANGLE_FAN ||\n                        primitive.mode === undefined ) {\n\n                        if ( useSkinning ) {\n\n                            mesh = new THREE.SkinnedMesh( geometry, material );\n                            material.skinning = true;\n\n                        } else {\n\n                            mesh = new THREE.Mesh( geometry, material );\n\n                        }\n\n                        if ( primitive.mode === WEBGL_CONSTANTS.TRIANGLE_STRIP ) {\n\n                            mesh.drawMode = THREE.TriangleStripDrawMode;\n\n                        } else if ( primitive.mode === WEBGL_CONSTANTS.TRIANGLE_FAN ) {\n\n                            mesh.drawMode = THREE.TriangleFanDrawMode;\n\n                        }\n\n                    } else if ( primitive.mode === WEBGL_CONSTANTS.LINES ) {\n\n                        mesh = new THREE.LineSegments( geometry, material );\n\n                    } else if ( primitive.mode === WEBGL_CONSTANTS.LINE_STRIP ) {\n\n                        mesh = new THREE.Line( geometry, material );\n\n                    } else if ( primitive.mode === WEBGL_CONSTANTS.LINE_LOOP ) {\n\n                        mesh = new THREE.LineLoop( geometry, material );\n\n                    } else if ( primitive.mode === WEBGL_CONSTANTS.POINTS ) {\n\n                        mesh = new THREE.Points( geometry, material );\n\n                    } else {\n\n                        throw new Error( 'THREE.GLTFLoader: Primitive mode unsupported: ' + primitive.mode );\n\n                    }\n\n                    mesh.name = meshDef.name || ( 'mesh_' + meshIndex );\n\n                    if ( useMorphTargets ) {\n\n                        addMorphTargets( mesh, meshDef, primitive, dependencies.accessors );\n\n                    }\n\n                    if ( meshDef.extras !== undefined ) mesh.userData = meshDef.extras;\n                    if ( primitive.extras !== undefined ) mesh.geometry.userData = primitive.extras;\n\n                    // for Specular-Glossiness.\n                    if ( material.isGLTFSpecularGlossinessMaterial === true ) {\n\n                        mesh.onBeforeRender = extensions[ EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS ].refreshUniforms;\n\n                    }\n\n                    if ( primitives.length > 1 ) {\n\n                        mesh.name += '_' + i;\n\n                        group.add( mesh );\n\n                    } else {\n\n                        return mesh;\n\n                    }\n\n                }\n\n                return group;\n\n            } );\n\n        } );\n\n    };\n\n    /**\n     * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#cameras\n     * @param {number} cameraIndex\n     * @return {Promise<THREE.Camera>}\n     */\n    GLTFParser.prototype.loadCamera = function ( cameraIndex ) {\n\n        var camera;\n        var cameraDef = this.json.cameras[ cameraIndex ];\n        var params = cameraDef[ cameraDef.type ];\n\n        if ( ! params ) {\n\n            console.warn( 'THREE.GLTFLoader: Missing camera parameters.' );\n            return;\n\n        }\n\n        if ( cameraDef.type === 'perspective' ) {\n\n            var aspectRatio = params.aspectRatio || 1;\n            var xfov = params.yfov * aspectRatio;\n\n            camera = new THREE.PerspectiveCamera( THREE.Math.radToDeg( xfov ), aspectRatio, params.znear || 1, params.zfar || 2e6 );\n\n        } else if ( cameraDef.type === 'orthographic' ) {\n\n            camera = new THREE.OrthographicCamera( params.xmag / - 2, params.xmag / 2, params.ymag / 2, params.ymag / - 2, params.znear, params.zfar );\n\n        }\n\n        if ( cameraDef.name !== undefined ) camera.name = cameraDef.name;\n        if ( cameraDef.extras ) camera.userData = cameraDef.extras;\n\n        return Promise.resolve( camera );\n\n    };\n\n    /**\n     * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#skins\n     * @param {number} skinIndex\n     * @return {Promise<Object>}\n     */\n    GLTFParser.prototype.loadSkin = function ( skinIndex ) {\n\n        var skinDef = this.json.skins[ skinIndex ];\n\n        var skinEntry = { joints: skinDef.joints };\n\n        if ( skinDef.inverseBindMatrices === undefined ) {\n\n            return Promise.resolve( skinEntry );\n\n        }\n\n        return this.getDependency( 'accessor', skinDef.inverseBindMatrices ).then( function ( accessor ) {\n\n            skinEntry.inverseBindMatrices = accessor;\n\n            return skinEntry;\n\n        } );\n\n    };\n\n    /**\n     * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#animations\n     * @param {number} animationIndex\n     * @return {Promise<THREE.AnimationClip>}\n     */\n    GLTFParser.prototype.loadAnimation = function ( animationIndex ) {\n\n        var json = this.json;\n\n        var animationDef = this.json.animations[ animationIndex ];\n\n        return this.getMultiDependencies( [\n\n            'accessor',\n            'node'\n\n        ] ).then( function ( dependencies ) {\n\n            var tracks = [];\n\n            for ( var i = 0, il = animationDef.channels.length; i < il; i ++ ) {\n\n                var channel = animationDef.channels[ i ];\n                var sampler = animationDef.samplers[ channel.sampler ];\n\n                if ( sampler ) {\n\n                    var target = channel.target;\n                    var name = target.node !== undefined ? target.node : target.id; // NOTE: target.id is deprecated.\n                    var input = animationDef.parameters !== undefined ? animationDef.parameters[ sampler.input ] : sampler.input;\n                    var output = animationDef.parameters !== undefined ? animationDef.parameters[ sampler.output ] : sampler.output;\n\n                    var inputAccessor = dependencies.accessors[ input ];\n                    var outputAccessor = dependencies.accessors[ output ];\n\n                    var node = dependencies.nodes[ name ];\n\n                    if ( node ) {\n\n                        node.updateMatrix();\n                        node.matrixAutoUpdate = true;\n\n                        var TypedKeyframeTrack;\n\n                        switch ( PATH_PROPERTIES[ target.path ] ) {\n\n                            case PATH_PROPERTIES.weights:\n\n                                TypedKeyframeTrack = THREE.NumberKeyframeTrack;\n                                break;\n\n                            case PATH_PROPERTIES.rotation:\n\n                                TypedKeyframeTrack = THREE.QuaternionKeyframeTrack;\n                                break;\n\n                            case PATH_PROPERTIES.position:\n                            case PATH_PROPERTIES.scale:\n                            default:\n\n                                TypedKeyframeTrack = THREE.VectorKeyframeTrack;\n                                break;\n\n                        }\n\n                        var targetName = node.name ? node.name : node.uuid;\n\n                        if ( sampler.interpolation === 'CUBICSPLINE' ) {\n\n                            var itemSize = outputAccessor.itemSize;\n                            var TypedArray = outputAccessor.array.constructor;\n                            var outputAccessorValues = new TypedArray( outputAccessor.count * itemSize / 3 );\n\n                            // Layout of keyframe output values for CUBICSPLINE animations:\n                            //\n                            //   [ inTangent1, splineVertex1, outTangent1, inTangent2, splineVertex2, ... ]\n                            //\n                            // THREE.KeyframeTrack infers tangents from the spline vertices when interpolating:\n                            // those values are extracted below. This still guarantees smooth curves, but does\n                            // throw away more precise information in the tangents. In the future, consider\n                            // re-sampling at a higher framerate using the tangents provided.\n                            //\n                            // See: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#appendix-c-spline-interpolation\n\n                            for ( var j = 0, jl = outputAccessor.count; j < jl; j += 3 ) {\n\n                                outputAccessorValues[ j * itemSize / 3 ] = outputAccessor.getX( j + 1 );\n                                if ( itemSize > 1 ) outputAccessorValues[ j * itemSize / 3 + 1 ] = outputAccessor.getY( j + 1 );\n                                if ( itemSize > 2 ) outputAccessorValues[ j * itemSize / 3 + 2 ] = outputAccessor.getZ( j + 1 );\n                                if ( itemSize > 3 ) outputAccessorValues[ j * itemSize / 3 + 3 ] = outputAccessor.getW( j + 1 );\n\n                            }\n\n                            outputAccessor = new THREE.BufferAttribute( outputAccessorValues, itemSize / 3, outputAccessor.normalized );\n\n                        }\n\n                        var interpolation = sampler.interpolation !== undefined ? INTERPOLATION[ sampler.interpolation ] : THREE.InterpolateLinear;\n\n                        var targetNames = [];\n\n                        if ( PATH_PROPERTIES[ target.path ] === PATH_PROPERTIES.weights ) {\n\n                            // node should be THREE.Group here but\n                            // PATH_PROPERTIES.weights(morphTargetInfluences) should be\n                            // the property of a mesh object under node.\n                            // So finding targets here.\n\n                            node.traverse( function ( object ) {\n\n                                if ( object.isMesh === true && object.material.morphTargets === true ) {\n\n                                    targetNames.push( object.name ? object.name : object.uuid );\n\n                                }\n\n                            } );\n\n                        } else {\n\n                            targetNames.push( targetName );\n\n                        }\n\n                        // KeyframeTrack.optimize() will modify given 'times' and 'values'\n                        // buffers before creating a truncated copy to keep. Because buffers may\n                        // be reused by other tracks, make copies here.\n                        for ( var j = 0, jl = targetNames.length; j < jl; j ++ ) {\n\n                            tracks.push( new TypedKeyframeTrack(\n                                targetNames[ j ] + '.' + PATH_PROPERTIES[ target.path ],\n                                THREE.AnimationUtils.arraySlice( inputAccessor.array, 0 ),\n                                THREE.AnimationUtils.arraySlice( outputAccessor.array, 0 ),\n                                interpolation\n                            ) );\n\n                        }\n\n                    }\n\n                }\n\n            }\n\n            var name = animationDef.name !== undefined ? animationDef.name : 'animation_' + animationIndex;\n\n            return new THREE.AnimationClip( name, undefined, tracks );\n\n        } );\n\n    };\n\n    /**\n     * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#nodes-and-hierarchy\n     * @param {number} nodeIndex\n     * @return {Promise<THREE.Object3D>}\n     */\n    GLTFParser.prototype.loadNode = function ( nodeIndex ) {\n\n        var json = this.json;\n        var extensions = this.extensions;\n\n        var meshReferences = this.json.meshReferences;\n        var meshUses = this.json.meshUses;\n\n        var nodeDef = this.json.nodes[ nodeIndex ];\n\n        return this.getMultiDependencies( [\n\n            'mesh',\n            'skin',\n            'camera'\n\n        ] ).then( function ( dependencies ) {\n\n            var node;\n\n            if ( nodeDef.isBone === true ) {\n\n                node = new THREE.Bone();\n\n            } else if ( nodeDef.mesh !== undefined ) {\n\n                var mesh = dependencies.meshes[ nodeDef.mesh ];\n\n                node = mesh.clone();\n\n                // for Specular-Glossiness\n                if ( mesh.isGroup === true ) {\n\n                    for ( var i = 0, il = mesh.children.length; i < il; i ++ ) {\n\n                        var child = mesh.children[ i ];\n\n                        if ( child.material && child.material.isGLTFSpecularGlossinessMaterial === true ) {\n\n                            node.children[ i ].onBeforeRender = child.onBeforeRender;\n\n                        }\n\n                    }\n\n                } else {\n\n                    if ( mesh.material && mesh.material.isGLTFSpecularGlossinessMaterial === true ) {\n\n                        node.onBeforeRender = mesh.onBeforeRender;\n\n                    }\n\n                }\n\n                if ( meshReferences[ nodeDef.mesh ] > 1 ) {\n\n                    node.name += '_instance_' + meshUses[ nodeDef.mesh ] ++;\n\n                }\n\n            } else if ( nodeDef.camera !== undefined ) {\n\n                node = dependencies.cameras[ nodeDef.camera ];\n\n            } else if ( nodeDef.extensions\n                && nodeDef.extensions[ EXTENSIONS.KHR_LIGHTS ]\n                && nodeDef.extensions[ EXTENSIONS.KHR_LIGHTS ].light !== undefined ) {\n\n                var lights = extensions[ EXTENSIONS.KHR_LIGHTS ].lights;\n                node = lights[ nodeDef.extensions[ EXTENSIONS.KHR_LIGHTS ].light ];\n\n            } else {\n\n                node = new THREE.Object3D();\n\n            }\n\n            if ( nodeDef.name !== undefined ) {\n\n                node.name = THREE.PropertyBinding.sanitizeNodeName( nodeDef.name );\n\n            }\n\n            if ( nodeDef.extras ) node.userData = nodeDef.extras;\n\n            if ( nodeDef.matrix !== undefined ) {\n\n                var matrix = new THREE.Matrix4();\n                matrix.fromArray( nodeDef.matrix );\n                node.applyMatrix( matrix );\n\n            } else {\n\n                if ( nodeDef.translation !== undefined ) {\n\n                    node.position.fromArray( nodeDef.translation );\n\n                }\n\n                if ( nodeDef.rotation !== undefined ) {\n\n                    node.quaternion.fromArray( nodeDef.rotation );\n\n                }\n\n                if ( nodeDef.scale !== undefined ) {\n\n                    node.scale.fromArray( nodeDef.scale );\n\n                }\n\n            }\n\n            return node;\n\n        } );\n\n    };\n\n    /**\n     * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#scenes\n     * @param {number} sceneIndex\n     * @return {Promise<THREE.Scene>}\n     */\n    GLTFParser.prototype.loadScene = function () {\n\n        // scene node hierachy builder\n\n        function buildNodeHierachy( nodeId, parentObject, json, allNodes, skins ) {\n\n            var node = allNodes[ nodeId ];\n            var nodeDef = json.nodes[ nodeId ];\n\n            // build skeleton here as well\n\n            if ( nodeDef.skin !== undefined ) {\n\n                var meshes = node.isGroup === true ? node.children : [ node ];\n\n                for ( var i = 0, il = meshes.length; i < il; i ++ ) {\n\n                    var mesh = meshes[ i ];\n                    var skinEntry = skins[ nodeDef.skin ];\n\n                    var bones = [];\n                    var boneInverses = [];\n\n                    for ( var j = 0, jl = skinEntry.joints.length; j < jl; j ++ ) {\n\n                        var jointId = skinEntry.joints[ j ];\n                        var jointNode = allNodes[ jointId ];\n\n                        if ( jointNode ) {\n\n                            bones.push( jointNode );\n\n                            var mat = new THREE.Matrix4();\n\n                            if ( skinEntry.inverseBindMatrices !== undefined ) {\n\n                                mat.fromArray( skinEntry.inverseBindMatrices.array, j * 16 );\n\n                            }\n\n                            boneInverses.push( mat );\n\n                        } else {\n\n                            console.warn( 'THREE.GLTFLoader: Joint \"%s\" could not be found.', jointId );\n\n                        }\n\n                    }\n\n                    mesh.bind( new THREE.Skeleton( bones, boneInverses ), mesh.matrixWorld );\n\n                }\n\n            }\n\n            // build node hierachy\n\n            parentObject.add( node );\n\n            if ( nodeDef.children ) {\n\n                var children = nodeDef.children;\n\n                for ( var i = 0, il = children.length; i < il; i ++ ) {\n\n                    var child = children[ i ];\n                    buildNodeHierachy( child, node, json, allNodes, skins );\n\n                }\n\n            }\n\n        }\n\n        return function loadScene( sceneIndex ) {\n\n            var json = this.json;\n            var extensions = this.extensions;\n            var sceneDef = this.json.scenes[ sceneIndex ];\n\n            return this.getMultiDependencies( [\n\n                'node',\n                'skin'\n\n            ] ).then( function ( dependencies ) {\n\n                var scene = new THREE.Scene();\n                if ( sceneDef.name !== undefined ) scene.name = sceneDef.name;\n\n                if ( sceneDef.extras ) scene.userData = sceneDef.extras;\n\n                var nodeIds = sceneDef.nodes || [];\n\n                for ( var i = 0, il = nodeIds.length; i < il; i ++ ) {\n\n                    buildNodeHierachy( nodeIds[ i ], scene, json, dependencies.nodes, dependencies.skins );\n\n                }\n\n                // Ambient lighting, if present, is always attached to the scene root.\n                if ( sceneDef.extensions\n                    && sceneDef.extensions[ EXTENSIONS.KHR_LIGHTS ]\n                    && sceneDef.extensions[ EXTENSIONS.KHR_LIGHTS ].light !== undefined ) {\n\n                    var lights = extensions[ EXTENSIONS.KHR_LIGHTS ].lights;\n                    scene.add( lights[ sceneDef.extensions[ EXTENSIONS.KHR_LIGHTS ].light ] );\n\n                }\n\n                return scene;\n\n            } );\n\n        };\n\n    }();\n\n    return GLTFLoader;\n\n} )();\n\nexport default GLTFLoader","import {fetchGraphObject} from \"../../syncgraph/utils\";\nimport * as THREE from \"three\";\nimport {NONE_ASSET, PROP_DEFS} from '../Common'\nimport GLTFLoader from '../GLTFLoader'\nimport {MeshLambertMaterial} from 'three'\nimport ObjectDef from './ObjectDef'\nimport {DoubleSide} from 'three'\n\nexport default class ModelDef extends ObjectDef {\n    make(graph, scene) {\n        if(!scene.id) throw new Error(\"can't create model w/ missing parent\")\n        return fetchGraphObject(graph,graph.createObject({\n            type:'model',\n            title:'a model',\n            visible:true,\n            tx:0, ty:0, tz:0,\n            rx:0, ry:0, rz:0,\n            sx:1, sy:1, sz:1,\n            color:'#ffffff',\n            children:graph.createArray(),\n            asset:NONE_ASSET.id,\n            parent:scene.id\n        }))\n    }\n    makeNode(obj, provider) {\n        const node = new THREE.Group()\n        node.name = obj.title\n        const clicker =  new THREE.Mesh(\n            new THREE.SphereBufferGeometry(1),\n            new MeshLambertMaterial({color:\"red\", transparent:true, opacity: 0.2})\n        )\n        clicker.material.visible = true\n        clicker.userData.clickable = true\n        node.userData.clicker = clicker\n        node.add(clicker)\n        // on(clicker,POINTER_CLICK,e =>SelectionManager.setSelection(node.userData.graphid))\n        node.position.set(obj.tx, obj.ty, obj.tz)\n        node.rotation.set(obj.rx,obj.ry,obj.rz)\n        node.scale.set(obj.sx,obj.sy,obj.sz)\n        node.visible = obj.visible\n        this.attachAsset(node, obj, provider)\n\n        node.enter = (evt, scriptManager) => {\n            node.userData.clicker.visible = false\n        }\n        node.exit = (evt, scriptManager) => {\n            const ob2 = provider.accessObject(obj.id)\n            if(ob2.asset === NONE_ASSET.id) {\n                node.userData.clicker.visible = true\n            }\n        }\n        return node\n    }\n\n    updateProperty(node, obj, op, provider) {\n        if (op.name === PROP_DEFS.asset.key) return this.attachAsset(node, obj, provider)\n        return super.updateProperty(node,obj,op,provider)\n    }\n\n    attachAsset(node, obj, provider) {\n        if(obj.asset === NONE_ASSET.id) {\n            // node.material = new MeshLambertMaterial({color: obj.color, side:DoubleSide})\n            console.log(\"REMOVE NODE CHILDREN\")\n            if(node.userData.model) {\n                node.remove(node.userData.model)\n                delete node.userData.model\n            }\n            node.userData.clicker.visible = true\n            return\n        }\n        const asset = provider.accessObject(obj.asset)\n        if(!asset.exists()) return\n        const loader = new GLTFLoader()\n        const url = provider.assetsManager.getAssetURL(asset)\n        provider.getLogger().log(\"ModelDef loading the model asset url\",url)\n        if(!url) {\n            provider.getLogger().error(\"ModelDef: empty url. cannot load GLTF\")\n            return\n        }\n        loader.load(url, (gltf)=> {\n            console.log(\"loaded\", gltf)\n            //swap the model\n            if(node.userData.model) node.remove(node.userData.model)\n            node.userData.model = gltf.scene.clone()\n            node.add(node.userData.model)\n\n            //calculate the size of the model\n            if(node.userData.model.geometry) {\n                node.userData.model.geometry.computeBoundingSphere()\n                const bs = node.userData.model.geometry.boundingSphere\n                const model = node.userData.model\n                model.position.x = -bs.center.x\n                model.position.y = -bs.center.y\n                model.position.z = -bs.center.z\n                node.userData.clicker.geometry = new THREE.SphereBufferGeometry(bs.radius)\n            }\n            //disable the clicker sphere\n            node.userData.clicker.visible = false\n        })\n    }\n\n}\n","import {fetchGraphObject} from '../../syncgraph/utils'\nimport {ASSET_TYPES, NONE_ASSET, OBJ_TYPES, PROP_DEFS} from '../Common'\nimport * as THREE from 'three'\nimport {MeshLambertMaterial} from 'three'\nimport {DoubleSide} from 'three'\nimport {TextureLoader} from 'three'\nimport {VideoTexture} from 'three'\n\nfunction customize(node,mat,obj) {\n    mat.onBeforeCompile = (shader) => {\n        //add uniform\n        shader.uniforms.imageOffsetAngle    = { value: obj.imageOffsetAngle }\n        shader.uniforms.imageCropStartAngle = { value: obj.imageCropStartAngle }\n        shader.uniforms.imageCropEndAngle   = { value: obj.imageCropEndAngle }\n        //prepend to the shader the defs\n        shader.vertexShader = `\n            uniform float imageOffsetAngle;\n            varying float vImageOffsetAngle;\n            uniform float imageCropStartAngle;            \n            varying float vImageCropStartAngle;            \n            uniform float imageCropEndAngle;            \n            varying float vImageCropEndAngle;            \n        ` + shader.vertexShader\n\n        //copy into fragment shader\n        shader.vertexShader = shader.vertexShader.replace('#include <begin_vertex>',`\n            #include <begin_vertex>\n            vImageOffsetAngle = imageOffsetAngle;\n            vImageCropStartAngle = imageCropStartAngle;\n            vImageCropEndAngle = imageCropEndAngle;\n        `)\n\n        //prepend to the fragment shader the defs\n        shader.fragmentShader = `\n                varying float vImageOffsetAngle;\n                varying float vImageCropStartAngle;\n                varying float vImageCropEndAngle;\n            `+shader.fragmentShader\n        //use in the shader\n        shader.fragmentShader = shader.fragmentShader.replace('#include <dithering_fragment>',`\n            if(vUv.x < vImageCropStartAngle) discard;\n            if(vUv.x > vImageCropEndAngle)  discard;\n            // gl_FragColor.r = vUv.x;\n            // vec3 jv = vec3(cos(gl_FragCoord.x/50.0)); \n            // vec3 empty = vec3(0.0,0.0,0.0);//vec3(jv,jv,jv)\n            // gl_FragColor.rgb = mix(empty,diffuseColor.rgb,jv);\n        `)\n        node.userData.matShader = shader\n    }\n}\n\nexport default class BG360Def {\n    make(graph, scene) {\n        if(!scene.id) throw new Error(\"can't create sphere w/ missing parent\")\n        return fetchGraphObject(graph,graph.createObject({\n            type:OBJ_TYPES.bg360,\n            title:'background',\n            visible:true,\n            asset:NONE_ASSET.id,\n            parent:scene.id,\n            imageOffsetAngle:0.0, //offset in UV coords, 0 to 1\n            imageCropStartAngle:0.0, //crop left edge of image\n            imageCropEndAngle:1.0, //crop right edge of image\n        }))\n    }\n    makeNode(obj, provider) {\n        const mat = new THREE.MeshLambertMaterial({color: 'white', side: THREE.BackSide})\n        const node = new THREE.Mesh(new THREE.SphereBufferGeometry(20.0, 50,50),mat)\n        customize(node,mat,obj)\n        node.name = obj.title\n        node.userData.clickable = true\n        node.visible = obj.visible\n        // on(node,POINTER_CLICK,e =>SelectionManager.setSelection(node.userData.graphid))\n        this.attachAsset(node, obj, provider)\n        return node\n    }\n    updateProperty(node, obj, op, provider) {\n        if (op.name === PROP_DEFS.asset.key) return this.attachAsset(node, obj, provider)\n        if(node.userData.matShader) {\n            if (op.name === 'imageOffsetAngle') node.userData.matShader.uniforms.imageOffsetAngle.value = op.value\n            if (op.name === 'imageCropStartAngle') node.userData.matShader.uniforms.imageCropStartAngle.value = op.value\n            if (op.name === 'imageCropEndAngle') node.userData.matShader.uniforms.imageCropEndAngle.value = op.value\n        } else {\n            console.warn(\"BG360: no shader reference?!\")\n        }\n    }\n\n    attachAsset(node, obj, provider) {\n        if(obj.asset === NONE_ASSET.id) {\n            node.material = new MeshLambertMaterial({color: 'white', side:DoubleSide})\n            return\n        }\n        const tex = provider.assetsManager.getTexture(obj.asset)\n        if(tex) node.material = new MeshLambertMaterial({color: obj.color, side: DoubleSide, map: tex})\n    }\n\n}\n","import ObjectDef from './ObjectDef'\nimport {fetchGraphObject} from '../../syncgraph/utils'\nimport {OBJ_TYPES, PROP_DEFS} from '../Common'\nimport * as THREE from 'three'\nimport WebLayer3D from 'three-web-layer'\n\nexport default class TextDef extends ObjectDef {\n    make(graph, scene) {\n        if(!scene.id) throw new Error(\"can't create sphere w/ missing parent\")\n        return fetchGraphObject(graph,graph.createObject({\n            type:OBJ_TYPES.text,\n            title:'some text',\n            visible:true,\n            text:'cool <b>formatted</b> <i>text</i>',\n            cssStyle:\n`color:black; \nbackground-color:white;\nwidth: 10em;\nfont-size: 200%;\n`,\n\n            tx:0, ty:0, tz:0,\n            rx:0, ry:0, rz:0,\n            sx:1, sy:1, sz:1,\n\n            children:graph.createArray(),\n            parent:scene.id\n        }))\n    }\n\n    makeNode(obj) {\n        const div = document.createElement('div')\n        div.innerHTML = obj.text\n        div.id = `div_${obj.id}`\n        div.classList.add('weblayer-div')\n        if(obj.cssStyle) div.setAttribute('style',obj.cssStyle)\n        const divLayer = new WebLayer3D(div,{\n            pixelRatio: window.devicePixelRatio,\n            onLayerCreate(layer) {\n                layer.mesh.material.side = THREE.DoubleSide\n                layer.mesh.userData.graphid = obj.id\n                layer.mesh.userData.clickable = true\n            }\n        })\n\n        divLayer.refresh(true)\n        divLayer.userData.clickable = true\n        const node = new THREE.Object3D()\n        node.previewUpdate = function() {\n            divLayer.update()\n        }\n        node.add(divLayer)\n        node.userData.divLayer = divLayer\n        node.userData.div = div\n        node.name = obj.title\n        node.userData.clickable = true\n        node.position.set(obj.tx, obj.ty, obj.tz)\n        node.rotation.set(obj.rx,obj.ry,obj.rz)\n        node.scale.set(obj.sx,obj.sy,obj.sz)\n        node.visible = obj.visible\n        this.regenerateText(node,obj)\n        return node\n    }\n\n    updateProperty(node, obj, op, provider) {\n        if(    op.name === PROP_DEFS.text.key) this.regenerateText(node,obj)\n        if(    op.name === PROP_DEFS.cssStyle.key) this.regenerateText(node,obj)\n        return super.updateProperty(node,obj,op,provider)\n    }\n\n\n    regenerateText(node, obj) {\n        node.userData.div.innerHTML = obj.text\n        if(obj.cssStyle) node.userData.div.setAttribute('style',obj.cssStyle)\n        node.userData.divLayer.refresh(true)\n    }\n}\n\n\n\n","import {fetchGraphObject} from '../../syncgraph/utils'\nimport {ASSET_TYPES, NONE_ASSET, OBJ_TYPES, PROP_DEFS} from '../Common'\nimport * as THREE from 'three'\nimport ObjectDef from './ObjectDef'\nimport {MeshLambertMaterial} from 'three'\nimport {DoubleSide} from 'three'\nimport {TextureLoader} from 'three'\nimport {VideoTexture} from 'three'\n\nexport default class Image2DDef extends ObjectDef {\n    make(graph, scene) {\n        if(!scene.id) throw new Error(\"can't create Image2D with missing parent\")\n        return fetchGraphObject(graph,graph.createObject({\n            type:OBJ_TYPES.img2d,\n            title:'image',\n            visible:true,\n            width:0.5,\n            ratio:1,\n            tx:0, ty:0, tz:0,\n            rx:0, ry:0, rz:0,\n            sx:1, sy:1, sz:1,\n            asset:NONE_ASSET.id,\n            parent:scene.id,\n        }))\n    }\n    makeNode(obj, provider) {\n        const node = new THREE.Mesh(\n            new THREE.PlaneBufferGeometry(obj.width, obj.width*obj.ratio),\n            new THREE.MeshLambertMaterial({color: 'white', side: THREE.DoubleSide})\n        )\n        node.name = obj.title\n        node.userData.clickable = true\n        // on(node,POINTER_CLICK,e =>SelectionManager.setSelection(node.userData.graphid))\n        node.position.set(obj.tx, obj.ty, obj.tz)\n        node.rotation.set(obj.rx,obj.ry,obj.rz)\n        node.scale.set(obj.sx,obj.sy,obj.sz)\n        node.visible = obj.visible\n        this.attachAsset(node, obj, provider)\n        return node\n    }\n    updateProperty(node, obj, op, provider) {\n        if (op.name === PROP_DEFS.asset.key) return this.attachAsset(node, obj, provider)\n        if( op.name === PROP_DEFS.width.key || op.name === 'ratio') {\n            node.geometry = new THREE.PlaneBufferGeometry(obj.width, obj.width*(1/obj.ratio))\n            return\n        }\n        return super.updateProperty(node,obj,op,provider)\n    }\n    attachAsset(node, obj, provider) {\n        if(obj.asset === NONE_ASSET.id) {\n            node.material = new MeshLambertMaterial({color: 'white', side:DoubleSide})\n            return\n        }\n        const tex = provider.assetsManager.getTexture(obj.asset)\n        if(tex) node.material = new MeshLambertMaterial({color: 'white', side: DoubleSide, map: tex})\n    }\n\n}\n","import {fetchGraphObject} from \"../../syncgraph/utils\"\nimport {Group} from 'three'\nimport ObjectDef from './ObjectDef'\nimport {OBJ_TYPES} from '../Common'\n\nlet COUNTER = 0\n\nexport default class GroupDef extends ObjectDef {\n    make(graph, scene) {\n        if(!scene.id) throw new Error(\"can't create cube w/ missing parent\")\n        return fetchGraphObject(graph,graph.createObject({\n            type:OBJ_TYPES.group,\n            title:'group '+COUNTER++,\n            visible:true,\n            tx:0, ty:0, tz:0,\n            rx:0, ry:0, rz:0,\n            sx:1, sy:1, sz:1,\n            color:'#00ff00',\n            children:graph.createArray(),\n            parent:scene.id\n        }))\n    }\n    makeNode(obj) {\n        const node = new Group()\n        node.name = obj.title\n        node.userData.clickable = true\n        node.position.set(obj.tx, obj.ty, obj.tz)\n        node.rotation.set(obj.rx,obj.ry,obj.rz)\n        node.scale.set(obj.sx,obj.sy,obj.sz)\n        node.visible = obj.visible\n        return node\n    }\n\n    updateProperty(node, obj, op, provider) {\n        return super.updateProperty(node,obj,op,provider)\n    }\n\n}\n","import {\n    BufferAttribute,\n    BufferGeometry,\n    CanvasTexture,\n    Color,\n    NormalBlending,\n    Object3D,\n    Points,\n    RepeatWrapping,\n    ShaderMaterial,\n    Vector3\n} from 'three'\n\n/*\n* modified from the version from the ThreeJS examples repo\n */\n\nconst GPUParticleShader = {\n\n    vertexShader:\n        `\n                uniform float uTime;\n                uniform float uScale;\n                uniform bool reverseTime;\n                uniform float fadeIn;\n                uniform float fadeOut;\n    \n                attribute vec3 positionStart;\n                attribute float startTime;\n                attribute vec3 velocity;\n                attribute vec3 acceleration;\n                attribute vec3 color;\n                attribute vec3 endColor;\n                attribute float size;\n                attribute float lifeTime;\n    \n                varying vec4 vColor;\n                varying vec4 vEndColor;\n                varying float lifeLeft;\n                varying float alpha;\n    \n                void main() {\n                    vColor = vec4( color, 1.0 );\n                    vEndColor = vec4( endColor, 1.0);\n                    vec3 newPosition;\n                    float timeElapsed = uTime - startTime;\n                    if(reverseTime) timeElapsed = lifeTime - timeElapsed;\n                    if(timeElapsed < fadeIn) {\n                        alpha = timeElapsed/fadeIn;\n                    }\n                    if(timeElapsed >= fadeIn && timeElapsed <= (lifeTime - fadeOut)) {\n                        alpha = 1.0;\n                    }\n                    if(timeElapsed > (lifeTime - fadeOut)) {\n                        alpha = 1.0 - (timeElapsed - (lifeTime-fadeOut))/fadeOut;\n                    }\n                    \n                    lifeLeft = 1.0 - ( timeElapsed / lifeTime );\n                    gl_PointSize = ( uScale * size );// * lifeLeft;\n                    newPosition = positionStart \n                        + (velocity * timeElapsed)\n                        + (acceleration * 0.5 * timeElapsed * timeElapsed)\n                        ;\n                    if (lifeLeft < 0.0) { \n                        lifeLeft = 0.0; \n                        gl_PointSize = 0.;\n                    }\n                    //while active use the new position\n                    if( timeElapsed > 0.0 ) {\n                        gl_Position = projectionMatrix * modelViewMatrix * vec4( newPosition, 1.0 );\n                    } else {\n                        //if dead use the initial position and set point size to 0\n                        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n                        lifeLeft = 0.0;\n                        gl_PointSize = 0.;\n                    }\n                }\n                `\n    ,\n\n    fragmentShader: `\n                varying vec4 vColor;\n                varying vec4 vEndColor;\n                varying float lifeLeft;\n                varying float alpha;\n                uniform sampler2D tSprite;\n                void main() {\n                    // color based on particle texture and the lifeLeft. \n                    // if lifeLeft is 0 then make invisible\n                    vec4 tex = texture2D( tSprite, gl_PointCoord );\n                    vec4 color = mix(vColor, vEndColor, 1.0-lifeLeft);\n                    gl_FragColor = vec4( color.rgb*tex.rgb, alpha * tex.a);\n                }\n    \n            `\n};\n\nconst UPDATEABLE_ATTRIBUTES = [\n    'positionStart', 'startTime',\n    'velocity', 'acceleration',\n    'color', 'endColor',\n    'size', 'lifeTime']\n\nexport default class GPUParticles extends Object3D {\n    constructor(options) {\n        super()\n        options = options || {};\n\n\n        this.blending = options.blending? options.blending : NormalBlending\n        this.PARTICLE_COUNT = options.maxParticles || 1000000;\n        this.PARTICLE_CURSOR = 0;\n        this.time = 0;\n        this.offset = 0;\n        this.count = 0;\n        this.DPR = window.devicePixelRatio;\n        this.particleUpdate = false;\n        this.onTick = options.onTick\n\n        this.reverseTime = options.reverseTime\n        this.fadeIn = options.fadeIn || 1\n        if(this.fadeIn === 0) this.fadeIn = 0.001\n        this.fadeOut = options.fadeOut || 1\n        if(this.fadeOut === 0) this.fadeOut = 0.001\n\n        // preload a 10_000 random numbers from -0.5 to 0.5\n        this.rand = [];\n        let i;\n        for (i = 1e5; i>0; i--) {\n            this.rand.push( Math.random() - 0.5 );\n        }\n        this.i = i\n\n        //setup the texture\n        this.sprite = options.particleSpriteTex || null;\n        if(!this.sprite) {\n            const can = document.createElement('canvas')\n            can.width = 16\n            can.height = 16\n            const ctx = can.getContext('2d')\n            ctx.fillStyle = 'black'\n            ctx.fillRect(0,0,can.width,can.height)\n            ctx.fillStyle = 'rgba(255,255,255,0.5)'\n            ctx.beginPath()\n            ctx.arc(8,8,8,0,Math.PI*2)\n            ctx.fill()\n            this.sprite = new CanvasTexture(can)\n        }\n        this.sprite.wrapS = this.sprite.wrapT = RepeatWrapping;\n\n        //setup the shader material\n        this.material = new ShaderMaterial( {\n            transparent: true,\n            depthWrite: false,\n            uniforms: {\n                'uTime': {\n                    value: 0.0\n                },\n                'uScale': {\n                    value: 1.0\n                },\n                'tSprite': {\n                    value: this.sprite\n                },\n                reverseTime: {\n                    value: this.reverseTime\n                },\n                fadeIn: {\n                    value: this.fadeIn\n                },\n                fadeOut: {\n                    value: this.fadeOut,\n                }\n            },\n            blending: this.blending,\n            vertexShader: GPUParticleShader.vertexShader,\n            fragmentShader: GPUParticleShader.fragmentShader\n        } );\n\n        // define defaults for all values\n        this.material.defaultAttributeValues.particlePositionsStartTime = [ 0, 0, 0, 0 ];\n        this.material.defaultAttributeValues.particleVelColSizeLife = [ 0, 0, 0, 0 ];\n\n\n        // geometry\n        this.geometry = new BufferGeometry();\n\n        //vec3 attributes\n        this.geometry.addAttribute('position',      new BufferAttribute(new Float32Array(this.PARTICLE_COUNT * 3), 3).setDynamic(true));\n        this.geometry.addAttribute('positionStart', new BufferAttribute(new Float32Array(this.PARTICLE_COUNT * 3), 3).setDynamic(true));\n        this.geometry.addAttribute('velocity',      new BufferAttribute(new Float32Array(this.PARTICLE_COUNT * 3), 3).setDynamic(true));\n        this.geometry.addAttribute('acceleration',  new BufferAttribute(new Float32Array(this.PARTICLE_COUNT * 3), 3).setDynamic(true));\n        this.geometry.addAttribute('color',         new BufferAttribute(new Float32Array(this.PARTICLE_COUNT * 3), 3).setDynamic(true));\n        this.geometry.addAttribute('endColor',      new BufferAttribute(new Float32Array(this.PARTICLE_COUNT * 3), 3).setDynamic(true));\n\n        //scalar attributes\n        this.geometry.addAttribute('startTime',     new BufferAttribute(new Float32Array(this.PARTICLE_COUNT), 1).setDynamic(true));\n        this.geometry.addAttribute('size',          new BufferAttribute(new Float32Array(this.PARTICLE_COUNT), 1).setDynamic(true));\n        this.geometry.addAttribute('lifeTime',      new BufferAttribute(new Float32Array(this.PARTICLE_COUNT), 1).setDynamic(true));\n\n\n        this.particleSystem = new Points(this.geometry, this.material);\n        this.particleSystem.frustumCulled = false;\n        this.add(this.particleSystem);\n    }\n\n    /*\n      This updates the geometry on the shader if at least one particle has been spawned.\n      It uses the offset and the count to determine which part of the data needs to actually\n      be sent to the GPU. This ensures no more data than necessary is sent.\n     */\n    geometryUpdate () {\n        if (this.particleUpdate === true) {\n            this.particleUpdate = false;\n            UPDATEABLE_ATTRIBUTES.forEach(name => {\n                const attr = this.geometry.getAttribute(name)\n                if (this.offset + this.count < this.PARTICLE_COUNT) {\n                    attr.updateRange.offset = this.offset * attr.itemSize\n                    attr.updateRange.count = this.count * attr.itemSize\n                } else {\n                    attr.updateRange.offset = 0\n                    attr.updateRange.count = -1\n                }\n                attr.needsUpdate = true\n            })\n            this.offset = 0;\n            this.count = 0;\n        }\n    }\n\n\n    //use one of the random numbers\n    random () {\n        return ++ this.i >= this.rand.length ? this.rand[ this.i = 1 ] : this.rand[ this.i ];\n    }\n\n    update ( ttime ) {\n        this.time = ttime/1000\n        this.material.uniforms.uTime.value = this.time;\n        if(this.onTick) this.onTick(this,this.time)\n        this.geometryUpdate();\n    }\n\n    dispose () {\n        this.material.dispose();\n        this.sprite.dispose();\n        this.geometry.dispose();\n    }\n\n    updateSprite(sprite) {\n        if(sprite) {\n            const old = this.sprite\n            this.sprite = sprite\n            this.sprite.wrapS = this.sprite.wrapT = RepeatWrapping;\n            this.material.uniforms.tSprite.value = sprite\n            if(old) old.dispose()\n        }\n    }\n\n    /* spawn a particle\n\n    This works by updating values inside of\n    the attribute arrays, then updates the count and the PARTICLE_CURSOR and\n    sets particleUpdate to true.\n\n    This if spawnParticle is called three times in a row before rendering,\n    then count will be 3 and the cursor will have moved by three.\n     */\n    spawnParticle ( options ) {\n        // console.log('spawnparticle')\n        let position = new Vector3()\n        let velocity = new Vector3()\n        let acceleration = new Vector3()\n        let color = new Color()\n        let endColor = new Color()\n\n        const positionStartAttribute = this.geometry.getAttribute('positionStart')\n        const startTimeAttribute = this.geometry.getAttribute('startTime')\n        const velocityAttribute = this.geometry.getAttribute('velocity')\n        const accelerationAttribute = this.geometry.getAttribute('acceleration')\n        const colorAttribute = this.geometry.getAttribute('color')\n        const endcolorAttribute = this.geometry.getAttribute('endColor')\n        const sizeAttribute = this.geometry.getAttribute('size')\n        const lifeTimeAttribute = this.geometry.getAttribute('lifeTime')\n\n        options = options || {};\n\n        // setup reasonable default values for all arguments\n\n        position = options.position !== undefined ? position.copy(options.position) : position.set(0, 0, 0);\n        velocity = options.velocity !== undefined ? velocity.copy(options.velocity) : velocity.set(0, 0, 0);\n        acceleration = options.acceleration !== undefined ? acceleration.copy(options.acceleration) : acceleration.set(0, 0, 0);\n        color = options.color !== undefined ? color.copy(options.color) : color.set(0xffffff);\n        endColor = options.endColor !== undefined ? endColor.copy(options.endColor) : endColor.copy(color)\n\n        const lifetime = options.lifetime !== undefined ? options.lifetime : 5\n        let size = options.size !== undefined ? options.size : 10\n        const sizeRandomness = options.sizeRandomness !== undefined ? options.sizeRandomness : 0\n\n        if (this.DPR !== undefined) size *= this.DPR;\n\n        const i = this.PARTICLE_CURSOR\n\n        // position\n        positionStartAttribute.array[i * 3 + 0] = position.x\n        positionStartAttribute.array[i * 3 + 1] = position.y\n        positionStartAttribute.array[i * 3 + 2] = position.z\n\n        velocityAttribute.array[i * 3 + 0] = velocity.x;\n        velocityAttribute.array[i * 3 + 1] = velocity.y;\n        velocityAttribute.array[i * 3 + 2] = velocity.z;\n\n        accelerationAttribute.array[i * 3 + 0] = acceleration.x;\n        accelerationAttribute.array[i * 3 + 1] = acceleration.y;\n        accelerationAttribute.array[i * 3 + 2] = acceleration.z;\n\n        colorAttribute.array[i * 3 + 0] = color.r;\n        colorAttribute.array[i * 3 + 1] = color.g;\n        colorAttribute.array[i * 3 + 2] = color.b;\n\n        endcolorAttribute.array[i * 3 + 0] = endColor.r;\n        endcolorAttribute.array[i * 3 + 1] = endColor.g;\n        endcolorAttribute.array[i * 3 + 2] = endColor.b;\n\n        //size, lifetime and starttime\n        sizeAttribute.array[i] = size + this.random() * sizeRandomness;\n        lifeTimeAttribute.array[i] = lifetime;\n        startTimeAttribute.array[i] = this.time + this.random() * 2e-2;\n\n        // offset\n        if (this.offset === 0) this.offset = this.PARTICLE_CURSOR;\n        // counter and cursor\n        this.count++;\n        this.PARTICLE_CURSOR++;\n        //wrap the cursor around\n        if (this.PARTICLE_CURSOR >= this.PARTICLE_COUNT) this.PARTICLE_CURSOR = 0;\n        this.particleUpdate = true;\n    };\n}\n","import {fetchGraphObject} from \"../../syncgraph/utils\"\nimport {AdditiveBlending, Color, DoubleSide, MeshLambertMaterial, TextureLoader, Vector3} from 'three'\nimport ObjectDef from './ObjectDef'\nimport {NONE_ASSET, OBJ_TYPES, PROP_DEFS} from '../Common'\nimport GPUParticles from './GPUParticles'\n\nexport const rand = (min,max) => Math.random()*(max-min) + min\n\nlet COUNTER = 0\n\nexport default class ParticlesDef extends ObjectDef {\n    make(graph, scene) {\n        if(!scene.id) throw new Error(\"can't create cube w/ missing parent\")\n        return fetchGraphObject(graph,graph.createObject({\n            type:OBJ_TYPES.particles,\n            title:'particles '+COUNTER++,\n            visible:true,\n            tx:0, ty:0, tz:0,\n            rx:0, ry:0, rz:0,\n            sx:1, sy:1, sz:1,\n            children:graph.createArray(),\n            pointSize:10.0,\n            lifetime:3.0,\n            startColor:'#ff0000',\n            endColor:'#0000ff',\n            parent:scene.id,\n            texture:NONE_ASSET.id,\n        }))\n    }\n    makeNode(obj, provider) {\n        const options = {\n            velocity: new Vector3(0,1,0),\n            position: new Vector3(0,0,0),\n            size:obj.pointSize,\n            lifetime:obj.lifetime,\n            color: new Color(1.0,0.0,1.0),\n            endColor: new Color(0,1,1),\n        }\n\n        const node = new GPUParticles({\n            maxParticles: 10000,\n            position: new Vector3(0,0,0),\n            positionRandomness: 0.0,\n            baseVelocity: new Vector3(0.0, 0.0, -1),\n            velocity: new Vector3(0.0, 0.0, 0.0),\n            velocityRandomness: 1.0,\n            acceleration: new Vector3(0,0.0,0),\n            baseColor: new Color(1.0,1.0,0.5),\n            color: new Color(1.0,0,0),\n            colorRandomness: 0.5,\n            lifetime: 3,\n            size: 10,\n            sizeRandomness: 1.0,\n            blending: AdditiveBlending,\n            onTick: (system, time) => {\n                options.velocity.set(rand(-1,1),1,rand(-1,1))\n                system.spawnParticle(options);\n            }\n        })\n        node.tick = function(evt) {\n            node.update(evt.time)\n        }\n        this.attachTexture(node,obj,provider)\n        node.userData.options = options\n        node.name = obj.title\n        node.userData.clickable = false\n        node.position.set(obj.tx, obj.ty, obj.tz)\n        node.rotation.set(obj.rx,obj.ry,obj.rz)\n        node.scale.set(obj.sx,obj.sy,obj.sz)\n        node.visible = obj.visible\n        return node\n    }\n\n    updateProperty(node, obj, op, provider) {\n        if(op.name === PROP_DEFS.pointSize.key) return node.userData.options.size = obj.pointSize\n        if(op.name === PROP_DEFS.lifetime.key) return node.userData.options.lifetime = obj.lifetime\n        if(op.name === PROP_DEFS.startColor.key) return node.userData.options.color.set(obj.startColor)\n        if(op.name === PROP_DEFS.endColor.key) return node.userData.options.endColor.set(obj.endColor)\n        if(op.name === PROP_DEFS.texture.key) return this.attachTexture(node,obj,provider)\n        return super.updateProperty(node,obj,op,provider)\n    }\n\n    attachTexture(node, obj, provider) {\n        if(obj.asset === NONE_ASSET.id) {\n            node.updateSprite(null)\n            return\n        }\n        const texture = provider.accessObject(obj.texture)\n        if(!texture.exists()) return\n        const url = provider.assetsManager.getAssetURL(texture)\n        provider.getLogger().log(\"ParticlesDef: loading the asset url\",url)\n        const tex = new TextureLoader().load(url)\n        node.updateSprite(tex)\n    }\n}\n","import {fetchGraphObject} from \"../../syncgraph/utils\"\nimport {Group, Mesh, MeshLambertMaterial, SphereBufferGeometry, PlaneBufferGeometry, TextureLoader, DoubleSide} from 'three'\nimport ObjectDef from './ObjectDef'\nimport {OBJ_TYPES, REC_TYPES, PROP_DEFS, toRad} from '../Common'\n\nlet COUNTER = 0\n\nexport default class ImageAnchorDef extends ObjectDef {\n    make(graph, scene) {\n        if(!scene.id) throw new Error(\"can't imageanchor w/ missing parent\")\n        return fetchGraphObject(graph,graph.createObject({\n            type:OBJ_TYPES.imageanchor,\n            title:'image anchor '+COUNTER++,\n            visible:true,\n            reactivate: false,\n            tx:0, ty:0, tz:0,\n            rx:0, ry:0, rz:0,\n            sx:1, sy:1, sz:1,\n            color:'#00ff00',\n            children:graph.createArray(),\n            targetImage:null,\n            imageRealworldWidth:1,\n            recType:REC_TYPES.SCENE_START,\n            parent:scene.id\n        }))\n    }\n    makeNode(obj, provider) {\n        const node = new Group()\n        node.name = obj.title\n        node.userData.clickable = true\n        node.position.set(obj.tx, obj.ty, obj.tz)\n        node.rotation.set(obj.rx,obj.ry,obj.rz)\n        node.scale.set(obj.sx,obj.sy,obj.sz)\n        node.visible = obj.visible\n\n        const clicker =  new Mesh(\n            new SphereBufferGeometry(1),\n            new MeshLambertMaterial({color:\"red\", transparent:true, opacity: 0.2})\n        )\n        clicker.material.visible = true\n        clicker.userData.clickable = true\n        node.userData.clicker = clicker\n        node.add(clicker)\n\n        const preview = new Mesh(\n            new PlaneBufferGeometry(1,1),\n            new MeshLambertMaterial({color:'white',transparent:true, opacity: 0.5, side: DoubleSide})\n        )\n        preview.rotation.x = toRad(90)\n        node.add(preview)\n        node.userData.preview = preview\n        this.updateImagePreview(node,obj,provider)\n\n        node.enter = (evt, scriptManager) => {\n            clicker.visible = false\n            node.visible = false\n            preview.visible = false\n            node.userData.info = {\n                image: scriptManager.sgp.getGraphObjectById(obj.targetImage),\n                imageRealworldWidth: obj.imageRealworldWidth,\n                reactivate: obj.reactivate,\n                recType: obj.recType,\n                object: obj,\n                node: node,\n                callback: (info) => {\n                    scriptManager.fireEventAtTarget(obj, 'recognized', info)\n                    node.visible = true\n                }\n            }\n            scriptManager.sgp.startImageRecognizer(node.userData.info)\n        }\n        node.exit = (evt, scriptManager) => {\n            clicker.visible = true\n            preview.visible = true\n            scriptManager.sgp.stopImageRecognizer(node.userData.info)\n        }\n        return node\n    }\n\n    updateProperty(node, obj, op, provider) {\n        if(op.name === PROP_DEFS.targetImage.key) {\n            return this.updateImagePreview(node,obj,provider)\n        }\n        if(op.name === PROP_DEFS.imageRealworldWidth.key) {\n            return this.updateImagePreview(node,obj,provider)\n        }\n        return super.updateProperty(node,obj,op,provider)\n    }\n\n    updateImagePreview(node,obj,provider) {\n        const targetImage = provider.accessObject(obj.targetImage)\n        if(targetImage.exists()) {\n            const url = provider.assetsManager.getAssetURL(targetImage)\n            provider.getLogger().log(\"ImageAnchor loading the asset url\",url)\n            const tex = new TextureLoader().load(url)\n            node.userData.preview.material = new MeshLambertMaterial({color:'white',transparent:true, opacity:0.5, side:DoubleSide, map:tex})\n            let height = (targetImage.height / targetImage.width)\n            let width = 1\n            node.userData.preview.geometry = new PlaneBufferGeometry(width,height)\n            console.log(obj)\n            let scale = obj.imageRealworldWidth\n            node.userData.preview.scale.set(scale,scale,scale)\n        }\n        if(provider.accessObject(obj.targetImage).exists()) {\n            node.userData.preview.visible = true\n            node.userData.clicker.visible = false\n        } else {\n            node.userData.preview.visible = false\n            node.userData.clicker.visible = true\n        }\n    }\n\n}\n","import {fetchGraphObject} from \"../../syncgraph/utils\"\nimport {Group, Mesh, MeshLambertMaterial, SphereBufferGeometry} from 'three'\nimport ObjectDef from './ObjectDef'\nimport {OBJ_TYPES, REC_TYPES} from '../Common'\nlet COUNTER = 0\n\nexport default class GeoAnchorDef extends ObjectDef {\n    make(graph, scene) {\n        if (!scene.id) throw new Error(\"can't create geo anchor w/ missing parent\")\n        return fetchGraphObject(graph, graph.createObject({\n            type: OBJ_TYPES.geoanchor,\n            title: 'geo anchor ' + COUNTER++,\n            visible: true,\n            tx: 0, ty: 0, tz: 0,\n            rx: 0, ry: 0, rz: 0,\n            sx: 1, sy: 1, sz: 1,\n            color: '#00ff00',\n            children: graph.createArray(),\n            targetGeoLocation: null,\n            recType: REC_TYPES.SCENE_START,\n            parent: scene.id\n        }))\n    }\n    makeNode(obj) {\n        const node = new Group()\n        node.name = obj.title\n        node.userData.clickable = true\n        node.position.set(obj.tx, obj.ty, obj.tz)\n        node.rotation.set(obj.rx,obj.ry,obj.rz)\n        node.scale.set(obj.sx,obj.sy,obj.sz)\n        node.visible = obj.visible\n\n        const clicker =  new Mesh(\n            new SphereBufferGeometry(1),\n            new MeshLambertMaterial({color:\"red\", transparent:true, opacity: 0.2})\n        )\n        clicker.material.visible = true\n        clicker.userData.clickable = true\n        node.userData.clicker = clicker\n        node.add(clicker)\n        node.enter = (evt, scriptManager) => {\n            clicker.visible = false\n            node.visible = false\n            node.userData.info = {\n                location:scriptManager.sgp.getGraphObjectById(obj.targetGeoLocation),\n                recType:obj.recType,\n                object:obj,\n                node:node,\n                callback:(info) => {\n                    scriptManager.fireEventAtTarget(obj, 'localized', info)\n                    node.visible = true\n                }\n            }\n            scriptManager.sgp.startGeoTracker(node.userData.info)\n        }\n        node.exit = (evt, scriptManager) => {\n            clicker.visible = true\n            scriptManager.sgp.stopGeoTracker(node.userData.info)\n        }\n        return node\n    }\n}","import {fetchGraphObject} from \"../../syncgraph/utils\"\nimport {Group, Mesh, MeshLambertMaterial, SphereBufferGeometry, PlaneBufferGeometry, TextureLoader, DoubleSide} from 'three'\nimport ObjectDef from './ObjectDef'\nimport {ASSET_TYPES, OBJ_TYPES, REC_TYPES, PROP_DEFS} from '../Common'\n\nlet COUNTER = 0\n\nexport class HudAnchorDef extends ObjectDef {\n    make(graph, scene) {\n        if(!scene.id) throw new Error(\"can't add hudanchor w/ missing parent\")\n        return fetchGraphObject(graph,graph.createObject({\n            type:OBJ_TYPES.hudanchor,\n            title:'hud anchor '+COUNTER++,\n            visible:true,\n            tx:0, ty:0, tz:0,\n            rx:0, ry:0, rz:0,\n            sx:1, sy:1, sz:1,\n            children:graph.createArray(),\n            parent:scene.id\n        }))\n    }\n    makeNode(obj, provider) {\n        const node = new Group()\n        node.name = obj.title\n        node.userData.clickable = true\n        node.position.set(obj.tx, obj.ty, obj.tz)\n        node.rotation.set(obj.rx,obj.ry,obj.rz)\n        node.scale.set(obj.sx,obj.sy,obj.sz)\n        node.visible = obj.visible\n\n        const clicker =  new Mesh(\n            new SphereBufferGeometry(1),\n            new MeshLambertMaterial({color:\"red\", transparent:true, opacity: 0.2})\n        )\n        clicker.material.visible = true\n        clicker.userData.clickable = true\n        node.userData.clicker = clicker\n        node.add(clicker)\n\n        node.start = (evt,scriptManager) => {\n            node.parent.remove(node)\n            node.position.z = 0\n            clicker.visible = false\n            scriptManager.sgp.getCamera().add(node)\n        }\n        node.stop = (evt,scriptManager) => {\n            scriptManager.sgp.getCamera().remove(node)\n            clicker.visible = true\n            const scene = scriptManager.sgp.getThreeObject(obj.parent)\n            scene.add(node)\n            node.position.set(obj.tx, obj.ty, obj.tz)\n            node.rotation.set(obj.rx,obj.ry,obj.rz)\n            node.scale.set(obj.sx,obj.sy,obj.sz)\n        }\n        return node\n    }\n\n    updateProperty(node, obj, op, provider) {\n        return super.updateProperty(node,obj,op,provider)\n    }\n}\n","import {TYPES} from '../common/PropSheet'\nimport CubeDef from './defs/CubeDef'\nimport SphereDef from './defs/SphereDef'\nimport PlaneDef from './defs/PlaneDef'\nimport ModelDef from './defs/ModelDef'\nimport BG360Def from './defs/BG360Def'\nimport TextDef from './defs/TextDef'\nimport Image2DDef from './defs/Image2DDef'\nimport GroupDef from './defs/GroupDef'\nimport ParticlesDef from './defs/ParticlesDef'\nimport ImageAnchorDef from './defs/ImageAnchorDef'\nimport GeoAnchorDef from './defs/GeoAnchorDef'\nimport {HudAnchorDef} from './defs/HudAnchorDef'\n\nexport const NONE_ASSET = {\n    id:-30,\n    title:'NONE'\n}\n\nconst stdhints = {\n    incrementValue:0.1,\n}\nexport const PROP_DEFS = {\n    title: {\n        key:'title',\n        name:'Title',\n        type:TYPES.STRING\n    },\n    description: {\n        key:'description',\n        name:'Description',\n        type:TYPES.STRING\n    },\n    width: {\n        key:'width',\n        name:'Width',\n        type:TYPES.NUMBER,\n        hints: stdhints\n    },\n    height: {\n        key:'height',\n        name:'Height',\n        type:TYPES.NUMBER,\n        hints: stdhints\n    },\n    depth: {\n        key:'depth',\n        name:'Depth',\n        type:TYPES.NUMBER,\n        hints: stdhints\n    },\n    radius: {\n        key:'radius',\n        name:'Radius',\n        type:TYPES.NUMBER,\n        hints: stdhints\n    },\n    tx: {\n        key:'tx',\n        name:'TX',\n        type:TYPES.NUMBER,\n        hints: stdhints\n    },\n    ty: {\n        key:'ty',\n        name:'TY',\n        type:TYPES.NUMBER,\n        hints: stdhints\n    },\n    tz: {\n        key:'tz',\n        name:'TZ',\n        type:TYPES.NUMBER,\n        hints: stdhints\n    },\n    rx: {\n        key:'rx',\n        name:'RX',\n        type:TYPES.NUMBER,\n        hints: stdhints\n    },\n    ry: {\n        key:'ry',\n        name:'RY',\n        type:TYPES.NUMBER,\n        hints: stdhints\n    },\n    rz: {\n        key:'rz',\n        name:'RZ',\n        type:TYPES.NUMBER,\n        hints: stdhints\n    },\n    sx: {\n        key:'sx',\n        name:'SX',\n        type:TYPES.NUMBER,\n        hints: stdhints\n    },\n    sy: {\n        key:'sy',\n        name:'SY',\n        type:TYPES.NUMBER,\n        hints: stdhints\n    },\n    sz: {\n        key:'sz',\n        name:'SZ',\n        type:TYPES.NUMBER,\n        hints: stdhints\n    },\n    color: {\n        key:'color',\n        name:'Color',\n        type:TYPES.COLOR,\n        custom:true,\n    },\n    defaultFloor: {\n        key:'defaultFloor',\n        name:'Default Floor',\n        type:TYPES.BOOLEAN\n    },\n    src: {\n        key:'src',\n        name:'src',\n        type:TYPES.STRING,\n        locked:true,\n    },\n    asset: {\n        key:'asset',\n        name:'asset',\n        type:TYPES.ENUM,\n    },\n    subtype: {\n        key:'subtype',\n        name:'kind',\n        type:TYPES.STRING,\n        locked:true,\n    },\n    format: {\n        key:'format',\n        name:'format',\n        type:TYPES.STRING,\n        locked:true,\n    },\n    imageOffsetAngle: {\n        key:'imageOffsetAngle',\n        name:'Image Offset Angle',\n        type:TYPES.NUMBER,\n        hints: {\n            incrementValue:0.05,\n        }\n    },\n    imageCropStartAngle: {\n        key:'imageCropStartAngle',\n        name:'Image Crop Start Angle',\n        type:TYPES.NUMBER,\n        hints: {\n            incrementValue:0.05,\n        }\n    },\n    imageCropEndAngle: {\n        key:'imageCropEndAngle',\n        name:'Image Crop End Angle',\n        type:TYPES.NUMBER,\n        hints: {\n            incrementValue:0.05,\n        }\n    },\n    imageRealworldWidth: {\n        key:'imageRealworldWidth',\n        name:'Image width in meters',\n        type: TYPES.NUMBER,\n        hints: {\n            incrementValue:0.01\n        }\n    },\n    recType: {\n        key:'recType',\n        name:'Recognition Type',\n        type: TYPES.ENUM,\n    },\n\n    targetImage: {\n        key:'targetImage',\n        name:'Image to Recognize',\n        type: TYPES.ENUM,\n    },\n\n    targetGeoLocation: {\n        key:'targetGeoLocation',\n        name:'Target Location',\n        type: TYPES.ENUM,\n    },\n\n    text: {\n        key:'text',\n        name:'Text',\n        type:TYPES.STRING,\n        hints: {\n            multiline:true\n        }\n    },\n    fontSize: {\n        key:'fontSize',\n        name:'Font Size',\n        type:TYPES.NUMBER,\n    },\n    padding: {\n        key:'padding',\n        name:'Padding',\n        type:TYPES.NUMBER,\n    },\n    borderWidth: {\n        key:'borderWidth',\n        name:'Border width',\n        type:TYPES.NUMBER,\n    },\n    borderRadius: {\n        key:'borderRadius',\n        name:'Corner Size',\n        type:TYPES.NUMBER,\n    },\n    horizontalAlign: {\n        key:'horizontalAlign',\n        name:'H Align',\n        type:TYPES.ENUM,\n        locked:false,\n    },\n    textColor: {\n        key:'textColor',\n        name:'Text Color',\n        type:TYPES.COLOR,\n        custom:true,\n    },\n    backgroundColor: {\n        key:'backgroundColor',\n        name:'BG Color',\n        type:TYPES.COLOR,\n        custom:true,\n    },\n    borderColor: {\n        key:'borderColor',\n        name:'Border Color',\n        type:TYPES.COLOR,\n        custom:true,\n    },\n    startColor: {\n        key:'startColor',\n        name:'Start',\n        type:TYPES.COLOR,\n        custom:true,\n    },\n    endColor: {\n        key:'endColor',\n        name:'End',\n        type:TYPES.COLOR,\n        custom:true,\n    },\n    drawBackground: {\n        key:'drawBackground',\n        name:'BG?',\n        type:TYPES.BOOLEAN,\n    },\n    scriptBody: {\n        key:'scriptBody',\n        name:'code',\n        type:TYPES.STRING,\n        hints: {\n            multiline:true\n        }\n    },\n    defaultScene: {\n        key:'defaultScene',\n        name:'Start Scene',\n        type:TYPES.ENUM,\n    },\n    visible: {\n        key:'visible',\n        name:'Visible',\n        type:TYPES.BOOLEAN\n    },\n\n    reactivate: {\n        key: 'reactivate',\n        name: \"Reactivate Image Search\",\n        type: TYPES.BOOLEAN\n    },\n\n    pointSize: {\n        key:'pointSize',\n        name:'Point Size',\n        type:TYPES.NUMBER,\n    },\n    lifetime: {\n        key:'lifetime',\n        name:'Lifetime',\n        type:TYPES.NUMBER,\n        hints: stdhints,\n    },\n    texture: {\n        key:'texture',\n        name:'texture',\n        type:TYPES.ENUM,\n    },\n    cssStyle: {\n        key:'cssStyle',\n        name:'Style',\n        type:TYPES.STRING,\n        hints: {\n            multiline:true\n        }\n    },\n    latitude: {\n        key:'latitude',\n        name:\"Latitude\",\n        type:TYPES.NUMBER, //value in degrees\n    },\n    longitude: {\n        key:'longitude',\n        name:\"Longitude\",\n        type:TYPES.NUMBER, //value in degrees\n    },\n    altitude: {\n        key:'altitude',\n        name:\"altitude\",\n        type:TYPES.NUMBER, //value in meters\n    },\n    useAltitude: {\n        key:'useAltitude',\n        name:\"use altitude?\",\n        type:TYPES.BOOLEAN,\n    },\n    autoRecenter: {\n        key:'autoRecenter',\n        name:\"Recenter on Load\",\n        type:TYPES.BOOLEAN\n    }\n}\n\nexport const SIMPLE_COLORS = [\"#ffffff\",\"#ff0000\",\"#ffff00\",\"#00ff00\",\"#00ffff\",\"#0000ff\",\"#ff00ff\",\"#000000\"]\n\nexport const OBJ_TYPES = {\n    cube:'cube',\n    sphere:'sphere',\n    plane:'plane',\n    model:'model',\n    bg360:'bg360',\n    text:'text',\n    img2d:'img2d',\n    group:'group',\n    particles:'particles',\n    imageanchor:'imageanchor',\n    geoanchor:'geoanchor',\n    hudanchor:'hudanchor',\n}\n\nexport const TOTAL_OBJ_TYPES = {\n    SCENE:'scene',\n    ASSET:'asset',\n    BEHAVIOR:'behavior',\n    BEHAVIOR_SCRIPT:'behavior_script',\n    ASSETS_LIST: 'assets',\n    BEHAVIORS_LIST: 'behaviors',\n    ROOT: 'root'\n}\nexport const HORIZONTAL_ALIGNMENT = {\n    LEFT:'LEFT',\n    CENTER:'CENTER',\n    RIGHT:'RIGHT',\n}\n\n\nexport function is3DObjectType(type) {\n    if(type === OBJ_TYPES.cube) return true\n    if(type === OBJ_TYPES.sphere) return true\n    if(type === OBJ_TYPES.plane) return true\n    if(type === OBJ_TYPES.model) return true\n    if(type === OBJ_TYPES.text) return true\n    if(type === OBJ_TYPES.bg360) return true\n    if(type === OBJ_TYPES.img2d) return true\n    if(type === OBJ_TYPES.group) return true\n    if(type === OBJ_TYPES.particles) return true\n    if(type === OBJ_TYPES.imageanchor) return true\n    if(type === OBJ_TYPES.geoanchor) return true\n    if(type === OBJ_TYPES.hudanchor) return true\n    return false\n}\n\nexport function canHaveShape(type) {\n    if(type === OBJ_TYPES.group) return true\n    if(type === OBJ_TYPES.imageanchor) return true\n    if(type === OBJ_TYPES.geoanchor) return true\n    if(type === OBJ_TYPES.hudanchor) return true\n    if(type === TOTAL_OBJ_TYPES.SCENE) return true\n    return false\n}\n\nexport function canHaveBehavior(type) {\n    if(is3DObjectType(type)) return true\n    if(type === TOTAL_OBJ_TYPES.SCENE) return true\n    return false\n}\n\nexport function canHaveScene(type) {\n    if(type === TOTAL_OBJ_TYPES.ROOT) return true\n    return false\n}\n\nexport function canBeDeleted(type) {\n    if(type === TOTAL_OBJ_TYPES.ROOT) return false\n    if(type === TOTAL_OBJ_TYPES.ASSETS_LIST) return false\n    if(type === TOTAL_OBJ_TYPES.BEHAVIORS_LIST) return false\n    return true\n}\n\nexport function get3DObjectDef(type) {\n    if(type === OBJ_TYPES.cube) return new CubeDef()\n    if(type === OBJ_TYPES.sphere) return new SphereDef()\n    if(type === OBJ_TYPES.plane) return new PlaneDef()\n    if(type === OBJ_TYPES.model) return new ModelDef()\n    if(type === OBJ_TYPES.bg360) return new BG360Def()\n    if(type === OBJ_TYPES.text) return new TextDef()\n    if(type === OBJ_TYPES.img2d) return new Image2DDef()\n    if(type === OBJ_TYPES.group) return new GroupDef()\n    if(type === OBJ_TYPES.particles) return new ParticlesDef()\n    if(type === OBJ_TYPES.imageanchor) return new ImageAnchorDef()\n    if(type === OBJ_TYPES.geoanchor) return new GeoAnchorDef()\n    if(type === OBJ_TYPES.hudanchor) return new HudAnchorDef()\n    throw new Error(`unknown 3d object type ${type}`)\n}\n\nexport const toRad = (degrees) => degrees*Math.PI/180\n\nexport const MIME_TYPES = { PNG:'image/png', JPEG:'image/jpeg', MP3: 'audio/mpeg', AAC: 'audio/aac', JAVASCRIPT: 'text/javascript', GLB: 'model/gltf-binary', MP4:'video/mp4' }\nexport const ASSET_TYPES = {\n    BEHAVIOR:'behavior',\n    IMAGE:'image',\n    GLTF: 'gltf',\n    AUDIO:'audio',\n    VIDEO:'video',\n    GEOLOCATION: 'geolocation'\n}\nexport function isImageType(type) {\n    if (!type) return false\n    if (type.toLowerCase() === MIME_TYPES.PNG) return true\n    if (type.toLowerCase() === MIME_TYPES.JPEG) return true\n    return false;\n}\nexport function isAudioType(type) {\n    if(!type) return false\n    if(type.toLowerCase() === MIME_TYPES.MP3) return true\n    if(type.toLowerCase() === MIME_TYPES.AAC) return true\n    return false\n}\n\nexport function isVideoType(type) {\n    if(!type) return false\n    if(type.toLowerCase() === MIME_TYPES.MP4) return true\n    return false\n}\nexport function isGLTFType(type) {\n    if(!type) return false\n    if(type.toLowerCase() === MIME_TYPES.GLB) return true\n    return false\n}\n\n\nexport function isGLTFFile(file) {\n    if (!file) return false\n    console.log(\"looking at the file\", file, 'type', file.type, 'type')\n    if (!file.type || file.type === '' || file.type.length === 0) {\n        console.log(\"no mimetype. check extension\")\n        if (file.name.toLowerCase().indexOf(\".gltf\") > 0) return true\n        if (file.name.toLowerCase().indexOf(\".glb\") > 0) return true\n    }\n    if (file.type.toLowerCase() === 'image/gltf') return true\n    return false;\n}\n\nexport const ITEM_ICONS = {\n    plane: 'plane',\n    cube: 'square',\n    sphere: 'circle',\n    model: 'cube',\n    asset: 'file',\n    assets: 'archive',\n    behavior:'superpowers',\n    behavior_script:'superpowers',\n    scene: 'globe',\n    bg360:'image',\n    img2d:'image',\n    image:'image',\n    text:'font',\n    audio:'music',\n    video:'video-camera',\n    group:'object-group',\n    particles:'certificate',\n    gltf:'cube',\n    imageanchor:'anchor',\n    geoanchor:'globe',\n    geolocation:'globe',\n    hudanchor: 'eye',\n\n    cut:'cut',\n    copy:'copy',\n    paste:'paste',\n    delete:'close'\n}\n\n\nexport function parseBehaviorScript(contents) {\n    return Function(`\"use strict\";\n    const toRadians = (deg) => Math.PI/180*deg; \n    return(${contents})`)();\n}\n\nexport const REC_TYPES = {\n    SCENE_START:'SCENE_START'\n}","import * as THREE from 'three'\nimport React, {Component} from \"react\"\nimport {VRManager} from 'webxr-boilerplate'\nimport GLTFLoader from './GLTFLoader'\n\nexport default class GLTFAssetView extends Component {\n    componentDidMount() {\n        this.initThreeJS()\n    }\n    render() {\n        return <div>GLTF viewer\n            <div ref={c => this.sceneContainer = c}></div>\n        </div>\n    }\n    initThreeJS() {\n        const asset = this.props.asset\n        this.scene = new THREE.Scene();\n        this.scene.background = new THREE.Color( 0x000000 );\n        this.camera = new THREE.PerspectiveCamera( 70, window.innerWidth / window.innerHeight, 0.1, 50 );\n        this.renderer = new THREE.WebGLRenderer( { antialias: true } );\n        this.renderer.setPixelRatio( window.devicePixelRatio );\n        this.renderer.setSize( window.innerWidth, window.innerHeight );\n        this.renderer.gammaOutput = true\n        this.renderer.vr.enabled = true;\n        this.sceneContainer.appendChild( this.renderer.domElement );\n        this.vrmanager = new VRManager(this.renderer)\n        window.addEventListener( 'resize', ()=>{\n            this.camera.aspect = window.innerWidth / window.innerHeight;\n            this.camera.updateProjectionMatrix();\n            this.renderer.setSize( window.innerWidth, window.innerHeight );\n        }, false );\n        this.renderer.setAnimationLoop(this.renderThree)\n        const light = new THREE.DirectionalLight( 0xffffff, 1.0 );\n        light.position.set( 1, 1, 1 ).normalize();\n        this.scene.add( light );\n        this.scene.add(new THREE.AmbientLight(0xffffff,0.2))\n        console.log(\"rendering the asset\",asset)\n\n        const loader = new GLTFLoader()\n        const url = this.props.provider.assetsManager.getAssetURL(asset)\n        this.props.provider.getLogger().log(\"GLTFAssetView loading the url\",url)\n        if(!url) {\n            this.props.provider.getLogger().error(\"GLTFAssetView url is empty!\")\n            return\n        }\n        loader.load(url, (gltf)=> {\n            console.log(\"loaded\", gltf)\n            //swap the model\n            this.scene.add(gltf.scene.clone())\n        })\n\n    }\n    renderThree = (time) => {\n        this.renderer.render( this.scene, this.camera );\n    }\n\n}\n","import React, {Component} from \"react\"\nimport {map, tileLayer, marker, Icon, divIcon, latLng} from \"leaflet/dist/leaflet-src.esm\"\nimport \"leaflet/dist/leaflet.css\"\nimport {TREE_ITEM_PROVIDER} from '../TreeItemProvider'\nimport {HBox} from 'appy-comps'\n\nexport default class GeoAssetView extends Component {\n\n\n    constructor(props, context) {\n        super(props, context)\n        this.updateLocation = (e) => {\n            const obj = this.props.provider.accessObject(this.props.asset.id)\n            const ll = latLng({\n                lat: obj.latitude,\n                lon: obj.longitude\n            })\n            this.marker.setLatLng(ll)\n            this.mymap.panTo(ll)\n        }\n    }\n\n    loadCurrentLocation = () => {\n        navigator.geolocation.getCurrentPosition((success)=>{\n            console.log(\"success\",success)\n            const coords = success.coords\n            this.props.provider.quick_setPropertyValue(this.props.asset.id,'latitude',coords.latitude)\n            this.props.provider.quick_setPropertyValue(this.props.asset.id,'longitude',coords.longitude)\n        },(error)=>{\n            console.log(\"error\",error)\n        })\n    }\n\n    onMapClick = (e) => {\n        this.props.provider.quick_setPropertyValue(this.props.asset.id,'latitude',e.latlng.lat)\n        this.props.provider.quick_setPropertyValue(this.props.asset.id,'longitude',e.latlng.lng)\n    }\n\n    render() {\n        const style = {\n            width: '400px',\n            height: '400px',\n            border: '1px solid black',\n        }\n        return <div>\n            <HBox>\n                <button onClick={this.loadCurrentLocation}>set to current location</button>\n            </HBox>\n            <div id=\"mapid\" ref={d => this.div = d} style={style}></div>\n        </div>\n    }\n\n    componentWillReceiveProps(nextProps, nextContext) {\n        if(nextProps.asset.id !== this.props.asset.id) {\n            this.updateLocation()\n        }\n    }\n\n    componentDidMount() {\n        this.mymap = map('mapid').setView([this.props.asset.longitude, this.props.asset.latitude], 18);\n        tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {\n            maxZoom: 18,\n            attribution: 'Map data &copy; <a href=\"https://www.openstreetmap.org/\">OpenStreetMap</a> contributors, ' +\n                '<a href=\"https://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA</a>, ' +\n                'Imagery  <a href=\"https://www.mapbox.com/\">Mapbox</a>',\n            id: 'mapbox.streets'\n        }).addTo(this.mymap);\n        this.mymap.on('click',this.onMapClick)\n\n        const customIcon = divIcon({className:'map-icon'})\n        this.marker = marker([this.props.asset.longitude, this.props.asset.latitude],{\n            title:'this is the geo location',\n            icon: customIcon\n        }).addTo(this.mymap)\n\n        this.props.provider.on(TREE_ITEM_PROVIDER.PROPERTY_CHANGED, this.updateLocation)\n        this.updateLocation()\n    }\n    componentWillUnmount() {\n        this.props.provider.off(TREE_ITEM_PROVIDER.PROPERTY_CHANGED, this.updateLocation)\n    }\n}\n\n\n\n","import React, {Component} from \"react\"\nimport {fetchGraphObject} from '../syncgraph/utils'\nimport {ASSET_TYPES} from '../vr/Common'\nimport GLTFAssetView from '../vr/GLTFAssetView'\nimport GeoAssetView from '../vr/GeoAssetView'\n\nexport default class AssetView extends Component {\n    render() {\n        const prov = this.props.provider\n        const asset = fetchGraphObject(prov.getDataGraph(),this.props.asset)\n        return <div>\n            <h3>{asset.subtype} : <b>{asset.title}</b></h3>\n            {this.renderAsset(asset)}\n        </div>\n    }\n\n    renderAsset(asset) {\n        const url = this.props.provider.assetsManager.getAssetURL(asset)\n        if(asset.subtype === ASSET_TYPES.IMAGE) return <img src={url} alt={asset.title}/>\n        if(asset.subtype === ASSET_TYPES.AUDIO) return <audio src={url} controls/>\n        // added playsinline so video shows in editor on ipad \n        if(asset.subtype === ASSET_TYPES.VIDEO) return <video src={url} controls playsInline crossOrigin=\"anonymous\"/>\n        if(asset.subtype === ASSET_TYPES.BEHAVIOR) return <div>{url}</div>\n        if(asset.subtype === ASSET_TYPES.GLTF) return <GLTFAssetView asset={asset} provider={this.props.provider}/>\n        if(asset.subtype === ASSET_TYPES.GEOLOCATION) return <GeoAssetView asset={asset} provider={this.props.provider}/>\n        return <div>unknown type</div>\n    }\n}\n","import * as ToasterManager from './ToasterManager'\nimport {getAssetsURL} from '../TreeItemProvider'\nimport {ASSET_TYPES, MIME_TYPES, TOTAL_OBJ_TYPES} from './Common'\nimport {fetchGraphObject} from '../syncgraph/utils'\nimport {AuthModule} from './AuthModule'\n\nexport function addImageAssetFromExpandedURL(assetId, url,format,title, prov) {\n    if(!AuthModule.supportsAssetUpload()) assetId = title\n\n    const asset = prov.accessObject(prov.getDataGraph().createObject({\n        type:TOTAL_OBJ_TYPES.ASSET,\n        subtype:ASSET_TYPES.IMAGE,\n        assetId:assetId,\n        format:format,\n        src:url,\n        width:100,\n        height:100,\n        title:title,\n        parent:0\n    }))\n    prov.accessObject(prov.getAssetsObject()).insertChildLast(asset)\n    prov.requestImageCache(prov.assetsManager.getAssetURL(asset)).then(img => {\n        asset.set('width',img.width)\n        asset.set('height',img.height)\n    })\n}\n\nexport function addGeoAnchorAsset(info,title,prov) {\n    const asset = prov.accessObject(prov.getDataGraph().createObject({\n        type:TOTAL_OBJ_TYPES.ASSET,\n        subtype:ASSET_TYPES.GEOLOCATION,\n        title:title,\n        latitude:info.latitude,\n        longitude:info.longitude,\n        altitude:info.altitude,\n        useAltitude:info.useAltitude,\n        parent:0\n    }))\n    prov.accessObject(prov.getAssetsObject()).insertChildLast(asset)\n}\n\nexport function addImageAssetFromFile (file, prov) {\n    ToasterManager.add('uploading ' + file.name)\n    prov.uploadFile(file).then((ans)=>{\n        ToasterManager.add('uploaded')\n        if(ans.success === false) return console.log(\"there was an error uploading! :(\")\n        return addImageAssetFromExpandedURL(null,getAssetsURL()+ans.asset.id, ans.asset.mimeType, file.name, prov)\n    })\n}\nexport function addImageAssetFromURL  (url, prov) {\n    //TODO: make this format detection code more robust\n    const name = url.substring(url.lastIndexOf('/') + 1)\n    const type = name.substring(name.lastIndexOf(\".\") + 1)\n    let fileType = \"image/unknown\"\n    if (type.toLowerCase() === 'png') fileType = MIME_TYPES.PNG\n    if (type.toLowerCase() === 'jpg') fileType = MIME_TYPES.JPEG\n    if (type.toLowerCase() === 'jpeg') fileType = MIME_TYPES.JPEG\n    return addImageAssetFromExpandedURL(null,url, fileType, name, prov)\n}\nexport function addGLBAssetFromFile (file, prov) {\n    ToasterManager.add('uploading '+ file.name)\n    prov.uploadFile(file).then((ans)=>{\n        ToasterManager.add('uploaded')\n        if(ans.success === false) return console.log(\"there was an error uploading! :(\")\n        const url = getAssetsURL()+ans.asset.id\n        const graph = prov.getDataGraph()\n        const asset = fetchGraphObject(graph,graph.createObject({\n            type:TOTAL_OBJ_TYPES.ASSET,\n            subtype:ASSET_TYPES.GLTF,\n            format:MIME_TYPES.GLB,\n            src:url,\n            title:file.name,\n            parent:0\n        }))\n        prov.accessObject(prov.getAssetsObject()).insertChildLast(asset)\n    })\n}\n\nexport function addAudioAssetFromFile (file, prov) {\n    ToasterManager.add('uploading')\n    prov.uploadFile(file).then((ans)=>{\n        ToasterManager.add('uploaded')\n        console.log(\"uploaded file with answer\",ans)\n        if(ans.success === false) return console.log(\"there was an error uploading! :(\")\n        const url = getAssetsURL()+ans.asset.id\n        const graph = prov.getDataGraph()\n        const asset = fetchGraphObject(graph,graph.createObject({\n            type:TOTAL_OBJ_TYPES.ASSET,\n            subtype:ASSET_TYPES.AUDIO,\n            format:ans.asset.mimeType,\n            src:url,\n            title:file.name,\n            parent:0\n        }))\n        prov.accessObject(prov.getAssetsObject()).insertChildLast(asset)\n    })\n}\nexport function addAudioAssetFromURL (assetId, url, fileType, name, prov) {\n    //TODO: make this format detection code more robust\n    if(!name) {\n        name = url.substring(url.lastIndexOf('/') + 1)\n    }\n    if(!fileType) {\n        const type = name.substring(name.lastIndexOf(\".\") + 1)\n        fileType = \"audio/unknown\"\n        if(type.toLowerCase() === 'mp3') fileType = MIME_TYPES.MP3\n        if(type.toLowerCase() === 'aac') fileType = MIME_TYPES.AAC\n    }\n    if(!AuthModule.supportsAssetUpload()) assetId = name\n\n    const graph = prov.getDataGraph()\n    const asset = fetchGraphObject(graph,graph.createObject({\n        type: TOTAL_OBJ_TYPES.ASSET,\n        subtype:ASSET_TYPES.AUDIO,\n        assetId:assetId,\n        format:fileType,\n        src:url,\n        title:name,\n        parent:0\n    }))\n    prov.accessObject(prov.getAssetsObject()).insertChildLast(asset)\n}\n\nexport function addVideoAssetFromURL (assetId, url, fileType, title, prov) {\n    if(!title) title = url.substring(url.lastIndexOf('/') + 1)\n    if(!AuthModule.supportsAssetUpload()) assetId = title\n    const asset = prov.accessObject(prov.getDataGraph().createObject({\n        type: TOTAL_OBJ_TYPES.ASSET,\n        subtype:ASSET_TYPES.VIDEO,\n        assetId:assetId,\n        format:fileType,\n        src:url,\n        title:title,\n        parent:0\n    }))\n    prov.accessObject(prov.getAssetsObject()).insertChildLast(asset)\n}\n\n\nexport function addGLBAssetFromURL(assetId, url, fileType, title, prov) {\n    if(!title) title = url.substring(url.lastIndexOf('/') + 1)\n    if(!AuthModule.supportsAssetUpload()) assetId = title\n    const asset = prov.accessObject(prov.getDataGraph().createObject({\n        type: TOTAL_OBJ_TYPES.ASSET,\n        subtype:ASSET_TYPES.GLTF,\n        assetId:assetId,\n        format:fileType,\n        src:url,\n        title:title,\n        parent:0\n    }))\n    prov.accessObject(prov.getAssetsObject()).insertChildLast(asset)\n}","import React, {Component} from 'react'\nimport {DialogManager, HBox, VBox} from 'appy-comps'\nimport {listToArray} from '../../syncgraph/utils'\nimport {ToggleButton, Toolbar} from '../../common/GridEditorApp'\nimport {addImageAssetFromFile, addImageAssetFromURL} from '../AssetActions'\nimport {Dialog} from '../../common/Dialog'\n\nexport class AddImageAssetDialog extends Component {\n    constructor(props) {\n        super(props)\n        this.state = {\n            view:'local',\n            url:\"\",\n        }\n        this.fileInput = React.createRef();\n    }\n\n    cancel = () => {\n        DialogManager.hide()\n    }\n    okay = () => {\n        DialogManager.hide()\n        if(this.state.view === 'remote') {\n            console.log(\"adding the url\",this.state.url)\n            addImageAssetFromURL(this.state.url, this.props.provider)\n        } else {\n            console.log(\"the file input is\",this.fileInput)\n            listToArray(this.fileInput.current.files).forEach(file => {\n                addImageAssetFromFile(file, this.props.provider)\n            })\n        }\n    }\n    switchLocal = () => this.setState({view:'local'})\n    switchRemote = () => this.setState({view:'remote'})\n\n    render() {\n        return <Dialog visible={true} onScrimClick={this.cancel}>\n            <VBox grow>\n                <h3>add image to assets</h3>\n                <VBox grow>\n                    <Toolbar>\n                        <ToggleButton onClick={this.switchLocal} selected={this.state.view==='local'}>local</ToggleButton>\n                        <ToggleButton onClick={this.switchRemote} selected={this.state.view==='remote'}>remote</ToggleButton>\n                    </Toolbar>\n                    {this.renderSelectedPanel()}\n                </VBox>\n                <HBox>\n                    <button onClick={this.cancel}>cancel</button>\n                    <button onClick={this.okay}>okay</button>\n                </HBox>\n            </VBox>\n        </Dialog>\n    }\n\n    selectedFile = (e) => {\n        this.setState({fileInput:e.target.value})\n    }\n\n    typedURL = (e) => {\n        this.setState({url:e.target.value})\n    }\n\n    renderSelectedPanel() {\n        if(this.state.view === 'local') {\n            return <HBox>\n                <label>File\n                    <input key=\"f1\" type=\"file\" onChange={this.selectedFile} ref={this.fileInput}/>\n                </label>\n            </HBox>\n        } else {\n            return <HBox>\n                <label>URL\n                    <input key=\"f2\" value={this.state.url} type=\"input\" onChange={this.typedURL}/>\n                </label>\n            </HBox>\n        }\n    }\n}\n","import React, {Component} from 'react'\nimport {DEFAULT_DPI, UNITS} from './Dimension'\nimport {fetchGraphObject, propToArray} from '../syncgraph/utils'\nimport SelectionManager from '../SelectionManager'\n\nexport class PageCanvasView extends Component {\n    constructor(props) {\n        super(props)\n        this.state = {\n            scale: 1.0,\n        }\n    }\n\n    componentDidMount() {\n        this.canvas.focus()\n        this.redraw()\n    }\n\n    componentDidUpdate(prevProps) {\n        this.redraw()\n    }\n\n    redraw = () => {\n        if (!this.canvas) return\n        const c = this.canvas.getContext('2d')\n        const size = this.props.provider.getPageSize(this.props.page).as(UNITS.PIXEL, 1, DEFAULT_DPI)\n        this.canvas.width = size.width\n        this.canvas.height = size.height\n        c.fillStyle = 'white'\n        c.fillRect(0, 0, this.canvas.width, this.canvas.height)\n        c.save()\n        c.scale(this.state.scale, this.state.scale)\n        const graph = this.props.provider.getRawGraph()\n        const page = this.props.page\n        if (page) this.drawPage(c, graph, page)\n        c.restore()\n    }\n\n    drawPage(c, g, page) {\n        propToArray(g, page.children).forEach(id => this.drawLayer(c, g, fetchGraphObject(g, id)))\n    }\n\n    drawLayer(c, g, layer) {\n        propToArray(g, layer.children).forEach(id => this.drawShape(c, g, fetchGraphObject(g, id)))\n    }\n\n    drawShape(c, g, shape) {\n        const def = this.props.provider.getShapeDef(shape.type)\n        if (def) def.draw(c, g, shape, SelectionManager.getSelection() === shape.id, this.props.provider)\n    }\n\n    render() {\n        return <canvas\n            tabIndex={-1}\n            width={100} height={100} ref={(e) => this.canvas = e}\n            style={{\n                width: '100vw',\n            }}\n            onClick={this.props.onNext}\n            onKeyDown={this.handleKeypress}\n        ></canvas>\n    }\n\n    handleKeypress = (e) => {\n        if (e.key === 'ArrowRight') this.props.onNext()\n        if (e.key === 'ArrowLeft') this.props.onPrev()\n    }\n}","import React, {Component} from 'react'\nimport {TREE_ITEM_PROVIDER} from '../TreeItemProvider'\nimport {PageCanvasView} from './PageCanvasView'\n\n\nexport default class PresentationApp extends Component {\n    constructor(props) {\n        super(props)\n\n        this.state = {\n            pageIndex:-1\n        }\n    }\n\n    componentDidMount() {\n        this.props.provider.on(TREE_ITEM_PROVIDER.DOCUMENT_SWAPPED, this.docSwapped)\n    }\n\n    docSwapped = () => this.setState({pageIndex:0})\n\n    getPages() {\n        const provider = this.props.provider\n        const root = provider.accessObject(provider.getSceneRoot())\n        return root.array('children').map(ch => provider.accessObject(ch) ).filter(ch => ch.type === 'page')\n    }\n\n    render() {\n        const provider = this.props.provider\n        const pages = this.getPages()\n        if(this.state.pageIndex < 0) return <div>no pages loaded</div>\n        const page = pages[this.state.pageIndex]\n        return <PageCanvasView page={page} provider={provider} onNext={this.onNext} onPrev={this.onPrev}/>\n    }\n\n    onNext = () => {\n        const pages = this.getPages()\n        if(this.state.pageIndex === pages.length-1) this.state.pageIndex = -1\n        this.setState({pageIndex:this.state.pageIndex+1})\n    }\n\n    onPrev = () => {\n        const pages = this.getPages()\n        if(this.state.pageIndex === 0) this.state.pageIndex = pages.length\n        this.setState({pageIndex:this.state.pageIndex-1})\n    }\n}\n\n","export default class GraphAccessor {\n    constructor(graph) {\n        this.graph = graph\n    }\n    object(id) {\n        if(id && id.id && id.exists && id.exists()) {\n            console.log(\"someone created a graphaccessor on an existing object\")\n            return id\n        }\n        if(this.graph.hasObject(id)) {\n            const obj = {}\n            this.graph.getPropertiesForObject(id).forEach(key => {\n                obj[key] = this.graph.getPropertyValue(id, key)\n            })\n            obj.id = id\n            obj.exists = function() { return true }\n            obj.set = (key, value) => {\n                this.graph.setProperty(id,key,value)\n                return obj\n            }\n            obj.props = () => {\n                const o = {}\n                this.graph.getPropertiesForObject(id).forEach(key => {\n                    o[key] = this.graph.getPropertyValue(id, key)\n                })\n                return o\n            }\n            obj.array = (key) => {\n                // console.log(\"looking at key\",key)\n                // console.log(\"self is\",obj)\n                const CH = obj[key]\n                // console.log(\"children id is\",CH)\n                const len = this.graph.getArrayLength(CH)\n                const ch = []\n                for (let i = 0; i < len; i++) {\n                    ch.push(this.graph.getElementAt(CH, i))\n                }\n                return ch\n            }\n            obj.getChildren = () => {\n                if(obj.children) return obj.array('children').map(id => this.object(id))\n                return []\n            }\n            obj.insertChildLast = (child) => {\n                this.graph.setProperty(child.id,'parent',obj.id)\n                const CH = this.graph.getPropertyValue(obj.id,'children')\n                const len = this.graph.getArrayLength(CH)\n                const prev = this.graph.getElementAt(CH,len-1)\n                this.graph.insertAfter(CH,prev,child.id)\n            }\n            obj.insertFirstChild = (child) => {\n                this.graph.setProperty(child.id,'parent',obj.id)\n                const ch = this.graph.getPropertyValue(obj.id,'children')\n                this.graph.insertAfter(ch,null,child.id)\n            }\n            obj.child = (index) => this.object(obj.array('children')[index])\n            obj.removeFromParent = () => {\n                const parent = this.object(obj.parent)\n                const n = parent.array('children').findIndex(ch => ch === obj.id)\n                // const n = indexOf(graph, parent.children, obj.id)\n                if (n >= 0) {\n                    this.graph.removeElement(parent.children, n)\n                } else {\n                    console.error(\"could not find index for child\", obj, 'in children', parent.children)\n                }\n            }\n            obj.clone = () => {\n                const shape = obj;\n                const id = shape.id\n                const id2 = this.graph.createObject()\n                const props = this.graph.getPropertiesForObject(id)\n                props.forEach(key => {\n                    this.graph.createProperty(id2,key,this.graph.getPropertyValue(id,key))\n                })\n                return this.object(id2)\n            }\n            obj.find = (match,list) => {\n                if(!list) list = []\n                if(match(obj)) list.push(obj)\n                if(obj.children) obj.getChildren().forEach(ch => {\n                    ch.find(match,list)\n                })\n                return list\n            }\n            return obj\n        } else {\n            return {\n                exists: function() { return false }\n            }\n        }\n    }\n}\n","import React, {Component} from 'react'\nimport GridEditorApp, {MenuPopup, Panel, Spacer, Toolbar} from '../common/GridEditorApp'\nimport PropSheet from '../common/PropSheet'\nimport TreeTable from '../common/TreeTable'\nimport SelectionManager, {SELECTION_MANAGER} from '../SelectionManager'\nimport {MetadocCanvas} from \"./MetadocCanvas\";\nimport SyncGraphProvider from '../syncgraph/SyncGraphProvider'\nimport {\n    cloneShape,\n    createGraphObjectFromObject,\n    fetchGraphObject,\n    insertAsFirstChild, insertAsLastChild, listToArray,\n    propToArray,\n    removeFromParent\n} from \"../syncgraph/utils\";\nimport {DialogManager, HBox, PopupManager} from \"appy-comps\";\nimport InputManager from \"../common/InputManager\";\nimport {getAssetsURL, TREE_ITEM_PROVIDER} from '../TreeItemProvider'\nimport {\n    HORIZONTAL_ALIGNMENT,\n    ICONS,\n    isShapeType,\n    PROP_DEFS,\n    SHAPE_DEFS,\n    STANDARD_FONTS,\n    VERTICAL_ALIGNMENT\n} from \"./Common\";\nimport AssetView from './AssetView'\nimport {AddImageAssetDialog} from '../vr/dialogs/AddImageAssetDialog'\nimport {DEFAULT_DPI, parseDimension, UNITS} from \"./Dimension\"\nimport {EnumEditor} from \"../common/EnumEditor\";\nimport PresentationApp from './PresentationApp'\nimport GraphAccessor from '../syncgraph/GraphAccessor'\n\n\nconst EnumTitleRenderer = (props) => {\n    let value = \"---\"\n    if(props.value && props.provider) {\n        const graph = props.provider.getDataGraph()\n        value = graph.getPropertyValue(props.value,'title')\n    }\n    return <b>{value}</b>\n}\n\nconst STANDARD_PAGE_SIZES = [\n    {\n        name:\"1024 x 768 pixels\",\n        value:'1024x768px',\n    },\n    {\n        name:\"VGA (640x480)\",\n        value:\"640x480px\"\n    },\n    {\n        name:\"A4 paper\",\n        value:\"210x297mm\"\n    },\n    {\n        name:\"16:9\",\n        value:\"300x169mm\"\n    },\n    {\n        name:\"4:3\",\n        value:\"225x169mm\"\n    },\n]\nconst PageSizeRenderer = (props) => {\n    let value = \"---\"\n    if(props.value && props.provider) {\n        const size = STANDARD_PAGE_SIZES.find(s => s.value === props.value)\n        if(size) {\n            value = size.name\n        } else {\n            value = props.value\n        }\n    }\n    return <b>{value}</b>\n}\n\nexport default class MetadocEditor extends  SyncGraphProvider {\n    constructor(options) {\n        super(options)\n        this.imagecache = {}\n    }\n    getDocType() { return \"metadoc\" }\n    getApp = () => {\n        if(this.mode === 'view') return <PresentationApp provider={this}/>\n        return <MetadocApp provider={this}/>\n    }\n    getTitle = () => \"MetaDoc\"\n\n    makeEmptyRoot(doc) {\n        //create root and children\n        const root = fetchGraphObject(doc,doc.createObject({ type:'root', title:'root', pageSize:'640 x 480 px', children: doc.createArray(), parent:0}))\n        //create page and children\n        const page = fetchGraphObject(doc,doc.createObject({ type:'page', title:'page 1', children: doc.createArray(),parent:0}))\n        //create layer and children\n        const layer = fetchGraphObject(doc,doc.createObject({type:'layer',title:'layer 1', children: doc.createArray(),parent:0}))\n        //create rect\n        const rect1 = SHAPE_DEFS.rect.make(doc,layer)\n        // create assets\n        const assets = fetchGraphObject(doc,doc.createObject({type:'assets',title:'Assets', children: doc.createArray(), parent:0}))\n        //connect it all together\n        insertAsFirstChild(doc,layer,rect1)\n        insertAsFirstChild(doc,page,layer)\n        insertAsFirstChild(doc,root,page)\n        insertAsLastChild(doc,root,assets)\n    }\n\n    getRendererForItem = (item) => {\n        if(!this.getDataGraph().getObjectById(item)) return <div>???</div>\n        const type = this.getDataGraph().getPropertyValue(item,'type')\n        const title = this.getDataGraph().getPropertyValue(item,'title')\n        if(ICONS[type]) return <div><i className={`fa fa-${ICONS[type]}`}/> {title}</div>\n        return <div>{title}</div>\n    }\n\n    setPropertyValue(item, def, value) {\n        super.setPropertyValue(item,def,value)\n        if(def.key === PROP_DEFS.asset.key) {\n            const asset = fetchGraphObject(this.getDataGraph(),value)\n            super.setPropertyValue(item,{key:'width'},asset.width)\n            super.setPropertyValue(item,{key:'height'},asset.height)\n        }\n    }\n\n\n    getProperties(item) {\n        function copyPropDef(def,value) {\n            const out = {};\n            Object.keys(def).forEach((key) => out[key] = def[key])\n            out.value = value\n            return out;\n        }\n        let defs = []\n        if(!item) return defs\n\n        const props = this.syncdoc.getPropertiesForObject(item)\n        if(props) {\n            props.forEach(key => {\n                if(key === 'type') return\n                if(key === 'children') return\n                if(key === 'parent') return\n                const value = this.syncdoc.getPropertyValue(item,key)\n                if(PROP_DEFS[key]) return defs.push(copyPropDef(PROP_DEFS[key],value))\n                console.log(\"unknown property\",key)\n            })\n        }\n\n        return defs\n    }\n\n    createCustomEditor(item,def,provider, value, onChange) {\n        if(def.key === PROP_DEFS.fillColor.key) return <HBox>\n            {\n                [\"#ffffff\",\"#ff0000\",\"#ffff00\",\"#00ff00\",\"#00ffff\",\"#0000ff\",\"#ff00ff\",\"#000000\"]\n                    .map(c => <button\n                        key={c}\n                        onClick={()=>onChange(c)}\n                        style={{color:c, padding:'1px', margin:0, borderWidth:0,}}\n                        className={\"fa fa-square\"}/> )\n            }\n        </HBox>\n        if(def.key === PROP_DEFS.pageSize.key) {\n            const obj = fetchGraphObject(this.getDataGraph(),item)\n            return <EnumEditor def={def} provider={this} obj={item} value={obj.pageSize} onChange={onChange}/>\n        }\n        return <i>no custom editor for {def.key}</i>\n    }\n\n    getValuesForEnum(key,obj) {\n        if(key === PROP_DEFS.asset.key) {\n            const children = this.getDataGraph().getPropertyValue(this.getAssetsObject(),'children')\n            return propToArray(this.getDataGraph(),children)\n        }\n        if(key === PROP_DEFS.fontFamily.key) {\n            return Object.keys(STANDARD_FONTS).map(key => STANDARD_FONTS[key])\n        }\n        if(key === PROP_DEFS.verticalAlign.key) {\n            return Object.keys(VERTICAL_ALIGNMENT).map(key => VERTICAL_ALIGNMENT[key])\n        }\n        if(key === PROP_DEFS.horizontalAlign.key) {\n            return Object.keys(HORIZONTAL_ALIGNMENT).map(key => HORIZONTAL_ALIGNMENT[key])\n        }\n        if(key === PROP_DEFS.pageSize.key) {\n            return STANDARD_PAGE_SIZES.map(s => s.value)\n        }\n    }\n    getRendererForEnum(key,obj) {\n        if(key === PROP_DEFS.asset.key) return EnumTitleRenderer\n        if(key === PROP_DEFS.pageSize.key) return PageSizeRenderer\n    }\n\n\n    getPageSize(page) {\n        const root = this.getSceneRoot()\n        const rootobj = fetchGraphObject(this.getDataGraph(),root)\n        console.log(\"parsing\",rootobj)\n        return parseDimension(rootobj.pageSize)\n    }\n\n\n\n    getShapeDef(type) {\n        return SHAPE_DEFS[type]\n    }\n    getSelectedRoot() {\n        return fetchGraphObject(this.getDataGraph(),this.getSceneRoot())\n    }\n    getSelectedPage() {\n        let sel = SelectionManager.getSelection()\n        if(!sel) return null\n        while(true) {\n            const type = this.getDataGraph().getPropertyValue(sel, 'type')\n            if(type === 'root') return null\n            if(type === 'page') return fetchGraphObject(this.getDataGraph(),sel)\n            sel = this.getDataGraph().getPropertyValue(sel,'parent')\n            if(!sel) break\n        }\n    }\n\n    getSelectedLayer() {\n        let sel = SelectionManager.getSelection()\n        if(!sel) return null\n        while(true) {\n            const type = this.getDataGraph().getPropertyValue(sel, 'type')\n            if(type === 'root') return null\n            if(type === 'layer') return fetchGraphObject(this.getDataGraph(),sel)\n            sel = this.getDataGraph().getPropertyValue(sel,'parent')\n            if(!sel) break\n        }\n        console.log(fetchGraphObject(this.getDataGraph(),sel))\n    }\n\n    getSelectedShape() {\n        let sel = SelectionManager.getSelection()\n        if(!sel) return null\n        const type = this.getDataGraph().getPropertyValue(sel, 'type')\n        if(SHAPE_DEFS[type]) return fetchGraphObject(this.getDataGraph(),sel)\n        return null\n    }\n\n    calculateContextMenu(item) {\n        const obj = fetchGraphObject(this.getDataGraph(),item)\n        if(obj.type === 'assets') {\n            return [{\n                title:'Add Image',\n                icon:'image',\n                fun:this.showAddImageAssetDialog\n            }]\n        }\n        if(obj.type === 'asset') {\n            return [{\n                title:'delete',\n                icon:'close',\n                fun: this.deleteSelectedAsset\n            }]\n        }\n        const cmds =  [\n            {\n                title:'delete',\n                icon:'close',\n                fun: this.deleteSelection\n            },\n            {\n                title:'rect',\n                icon:ICONS.rect,\n                fun: this.addRect\n            },\n            {\n                title:'circle',\n                icon:ICONS.circle,\n                fun: this.addCircle\n            },\n            {\n                title:'text',\n                icon:ICONS.text,\n                fun: this.addText\n            },\n            {\n                title:'image',\n                icon: ICONS.image,\n                fun: this.addImage\n            },\n            {\n                title:'cut',\n                icon: ICONS.cut,\n                fun:this.cutSelection\n            },\n            {\n                title:'copy',\n                icon: ICONS.copy,\n                fun:this.copySelection\n            },\n            {\n                title:'paste',\n                icon: ICONS.paste,\n                fun:this.pasteSelection\n            },\n        ]\n        return cmds\n    }\n\n    addShape = (def) => {\n        const graph = this.getDataGraph()\n        const layer = this.getSelectedLayer()\n        if(!layer) return console.error(\"no layer!\")\n        const shape = def.make(graph,layer)\n        insertAsFirstChild(graph,layer,shape)\n    }\n    addRect   = () => this.addShape(this.getShapeDef('rect'))\n    addCircle = () => this.addShape(this.getShapeDef('circle'))\n    addText   = () => this.addShape(this.getShapeDef('text'))\n    addImage   = () => this.addShape(this.getShapeDef('image'))\n\n    addImageAssetFromFile = (file) => {\n        this.uploadFile(file).then((ans)=>{\n            console.log(\"uploaded file with answer\",ans)\n            const url = getAssetsURL()+ans.id\n            const graph = this.getDataGraph()\n            const asset = fetchGraphObject(graph,graph.createObject({\n                type:'asset',\n                subtype:'image',\n                format:file.type,\n                src:url,\n                width:100,\n                height:100,\n                title:file.name,\n                parent:0\n            }))\n            const assets = fetchGraphObject(graph,this.getAssetsObject())\n            insertAsLastChild(graph,assets,asset)\n            this.requestImageCache(url).then(img => {\n                graph.setProperty(asset.id,'width',img.width)\n                graph.setProperty(asset.id,'height',img.height)\n            })\n        })\n    }\n\n    addImageAssetFromURL = (url) => {\n        //TODO: make this format detection code more robust\n        const name = url.substring(url.lastIndexOf('/')+1)\n        const type = name.substring(name.lastIndexOf(\".\")+1)\n        let fileType = \"image/unknown\"\n        if(type.toLowerCase() === 'png') fileType = 'image/png'\n        if(type.toLowerCase() === 'jpg') fileType = 'image/jpeg'\n        if(type.toLowerCase() === 'jpeg') fileType = 'image/jpeg'\n\n        const graph = this.getDataGraph()\n        const asset = fetchGraphObject(graph,graph.createObject({\n            type:'asset',\n            subtype:'image',\n            format:fileType,\n            src:url,\n            width:100,\n            height:100,\n            title:name,\n            parent:0\n        }))\n        const assets = fetchGraphObject(graph,this.getAssetsObject())\n        insertAsLastChild(graph,assets,asset)\n        this.requestImageCache(url).then(img => {\n            graph.setProperty(asset.id,'width',img.width)\n            graph.setProperty(asset.id,'height',img.height)\n        })\n    }\n    deleteSelection = () => {\n        const graph = this.getDataGraph()\n        // const layer = this.getSelectedLayer()\n        const shape = this.getSelectedShape()\n        if(!shape) return\n        removeFromParent(graph,shape)\n        SelectionManager.clearSelection()\n    }\n    deleteSelectedAsset = () => {\n        const graph = this.getDataGraph()\n        const sel = SelectionManager.getSelection()\n        const obj = fetchGraphObject(graph,sel)\n        removeFromParent(graph,obj)\n        SelectionManager.clearSelection()\n    }\n    cutSelection = () => {\n        const graph = this.getDataGraph()\n        let sel = SelectionManager.getSelection()\n        if(!sel) return\n        const obj = fetchGraphObject(graph,sel)\n        SelectionManager.setClipboard(obj.id)\n        removeFromParent(graph,obj)\n        SelectionManager.clearSelection()\n    }\n    copySelection = () => {\n        const graph = this.getDataGraph()\n        let sel = SelectionManager.getSelection()\n        if(!sel) return\n        const obj = fetchGraphObject(graph,sel)\n        SelectionManager.setClipboard(obj.id)\n    }\n    pasteSelection = (e) => {\n        if(e.target && e.target.getAttribute('type') === 'input') return console.log(\"pasting into an input field. don't intercept\")\n        const graph = this.getDataGraph()\n        const shapeid = SelectionManager.getClipboard()\n        const obj1 = fetchGraphObject(graph,shapeid)\n\n        let parent = null\n        if(isShapeType(obj1.type)) parent = this.getSelectedLayer()\n        if(obj1.type === 'layer') parent = this.getSelectedPage()\n        if(obj1.type === 'page') parent = fetchGraphObject(graph,this.getSceneRoot())\n        if (!parent) return console.error(\"no parent to ad too! bad obj type?\",obj1.type)\n\n        const obj2 = cloneShape(graph,obj1)\n        graph.setProperty(obj2.id, 'parent', parent.id)\n        insertAsFirstChild(graph, parent, obj2)\n        return\n    }\n\n    exportSVG = () => {\n        const page = this.getSelectedPage()\n\n        const svg = this.renderSVGWrapper(this.renderSVGChildren(page))\n        const link = document.createElement('a');\n        link.href = 'data:image/svg+xml,'+encodeURIComponent(svg)\n        link.download = 'test.svg'\n        document.body.appendChild(link)\n        link.click()\n    }\n    renderSVGWrapper(str) {\n        return `<svg id=\"svg-canvas\" viewBox=\"0 0 1000 1000\" \n                xmlns=\"http://www.w3.org/2000/svg\" \n                xmlnsXlink=\"http://www.w3.org/1999/xlink\">\n                ${str}</svg>`\n    }\n    renderSVGChildren(obj) {\n        if(obj.type === 'page') return propToArray(this.getDataGraph(),obj.children)\n            .map((layer) => `<g>${this.renderSVGChildren(fetchGraphObject(this.getDataGraph(),layer))}</g>`).join(\"\")\n        if(obj.type === 'layer') return propToArray(this.getDataGraph(),obj.children)\n            .map(shape => this.renderSVGChildren(fetchGraphObject(this.getDataGraph(),shape))).join(\"\")\n        if(SHAPE_DEFS[obj.type]) return SHAPE_DEFS[obj.type].toSVGString(obj,this)\n        return \"\";\n    }\n\n    exportPNG = () => {\n        const page = this.getSelectedPage()\n        const canvas = document.createElement('canvas')\n        const c = canvas.getContext('2d')\n        const g = this.getRawGraph()\n        const size = this.getPageSize(page).as(UNITS.PIXEL, 1, DEFAULT_DPI)\n        canvas.width = size.width\n        canvas.height = size.height\n        c.fillStyle = 'white'\n        c.fillRect(0, 0, canvas.width, canvas.height)\n        if(page) {\n            this.accessObject(page.id).getChildren().forEach(layer => {\n                layer.getChildren().forEach(shape => {\n                    const def = this.getShapeDef(shape.type)\n                    if (def) def.draw(c, g, shape, false, this)\n                })\n            })\n        }\n\n        const link = document.createElement('a');\n        link.href = canvas.toDataURL('image/png')\n        link.download = 'test.png'\n        document.body.appendChild(link)\n        link.click()\n    }\n\n\n    canAddChild(parent,child) {\n        const p = fetchGraphObject(this.getDataGraph(),parent)\n        const c = fetchGraphObject(this.getDataGraph(),child)\n        if(p.type === 'layer' && isShapeType(c.type)) return true\n        if(p.type === 'page' && c.type === 'layer') return true\n        if(p.type === 'root' && c.type === 'page') return true\n        return false\n    }\n    canBeSibling(src,tgt) {\n        const s = fetchGraphObject(this.getDataGraph(),src)\n        const t = fetchGraphObject(this.getDataGraph(),tgt)\n        if(s.type === 'layer' && t.type === 'layer') return true\n        if(s.type === 'page' && t.type === 'page') return true\n        if(isShapeType(s.type) && isShapeType(t.type)) return true\n        return false\n    }\n    canAddExternalChild(parent,child) {\n        const pobj = fetchGraphObject(this.getDataGraph(),parent)\n        // console.log('parent is',pobj)\n        if(pobj.type === 'assets') return true\n        return false\n    }\n    acceptDrop(e,tgt) {\n        const obj = fetchGraphObject(this.getDataGraph(),tgt)\n        if(obj.type === 'assets') {\n            listToArray(e.dataTransfer.files).forEach(file => this.addImageAssetFromFile(file))\n        }\n    }\n\n\n    newView = () => window.open( `./?mode=metadoc&doctype=${this.getDocType()}&doc=${this.getDocId()}`)\n    openPresentationView = () => window.open( `./?mode=view&doctype=${this.getDocType()}&doc=${this.getDocId()}`)\n\n\n    isImageCached(src) {\n        if(this.imagecache[src]) return this.imagecache[src].complete\n        return false\n    }\n    requestImageCache(src) {\n        const img = new Image()\n        this.imagecache[src] = img\n        return new Promise((res,rej) => {\n            img.src = src\n            img.onload = () => {\n                this.fire(TREE_ITEM_PROVIDER.STRUCTURE_CHANGED,{ provider: this })\n                res(img)\n            }\n        })\n    }\n    getCachedImage(src) {\n        return this.imagecache[src]\n    }\n\n    getAssetsObject = () => this.getDataGraph().getObjectByProperty('type','assets')\n\n    showAddImageAssetDialog = () => DialogManager.show(<AddImageAssetDialog provider={this}/>)\n\n    accessObject = (id) => {\n        return new GraphAccessor(this.getDataGraph()).object(id)\n    }\n\n}\n\n\n\nclass MetadocApp extends Component {\n    constructor(props) {\n        super(props)\n        this.state = {\n            connected:false,\n            zoom: 0,\n            mode:'canvas'\n        }\n\n        this.im = new InputManager()\n        this.im.addKeyBinding({ id:'save',  key:InputManager.KEYS.S, modifiers:[InputManager.MODIFIERS.COMMAND]})\n        this.im.addKeyBinding({ id:'undo', key:InputManager.KEYS.Z,  modifiers:[InputManager.MODIFIERS.COMMAND]})\n        this.im.addKeyBinding({ id:'redo', key:InputManager.KEYS.Z,  modifiers:[InputManager.MODIFIERS.COMMAND, InputManager.MODIFIERS.SHIFT]})\n        this.im.addListener('save',this.props.provider.save)\n        this.im.addListener('undo',this.props.provider.performUndo)\n        this.im.addListener('redo',this.props.provider.performRedo)\n\n        this.im.addKeyBinding({id:'cut', key:InputManager.KEYS.X, modifiers:[InputManager.MODIFIERS.COMMAND]})\n        this.im.addKeyBinding({id:'copy', key:InputManager.KEYS.C, modifiers:[InputManager.MODIFIERS.COMMAND]})\n        this.im.addKeyBinding({id:'paste', key:InputManager.KEYS.V, modifiers:[InputManager.MODIFIERS.COMMAND]})\n\n        this.im.addListener('cut',this.props.provider.cutSelection)\n        this.im.addListener('copy',this.props.provider.copySelection)\n        this.im.addListener('paste',this.props.provider.pasteSelection)\n    }\n\n    componentDidMount() {\n        this.im.attachKeyEvents(document)\n        this.props.provider.on('CONNECTED',()=> this.setState({connected: this.props.provider.isConnected()}))\n        SelectionManager.on(SELECTION_MANAGER.CHANGED,()=>{\n            const sel = SelectionManager.getSelection()\n            if(sel) {\n                const item = fetchGraphObject(this.props.provider.getDataGraph(),sel)\n                if(item.type === PROP_DEFS.asset.key) {\n                    this.setState({mode:'asset'})\n                    return\n                }\n            }\n            this.setState({mode:'canvas'})\n        })\n    }\n\n    canvasSelected = (rect) => SelectionManager.setSelection(rect)\n\n\n    showAddPopup = (e) => {\n        const acts = [\n            {\n                title: 'page',\n                icon: ICONS.page,\n                fun: () => this.addPage()\n            },\n            {\n                title: 'layer',\n                icon: ICONS.layer,\n                fun: () => this.addLayer()\n            },\n            {\n                title: 'rect',\n                icon: ICONS.rect,\n                fun: () => this.props.provider.addRect()\n            },\n            {\n                title: 'circle',\n                icon: ICONS.circle,\n                fun: () => this.props.provider.addCircle()\n            },\n            {\n                title: 'text',\n                icon: ICONS.text,\n                fun: () => this.props.provider.addText()\n            },\n            {\n                title:'image',\n                icon: ICONS.image,\n                fun: () => this.props.provider.addImage()\n            },\n        ]\n        PopupManager.show(<MenuPopup actions={acts}/>,e.target)\n    }\n    addPage = () => {\n        const graph = this.props.provider.getDataGraph()\n        const root = this.props.provider.getSelectedRoot()\n        const page = fetchGraphObject(graph,createGraphObjectFromObject(graph,{\n            type:'page',\n            title:'new page',\n            parent:root.id,\n            children: graph.createArray()\n        }))\n        insertAsFirstChild(graph,root,page)\n    }\n    addLayer = () => {\n        const graph = this.props.provider.getDataGraph()\n        const page = this.props.provider.getSelectedPage()\n        const layer = fetchGraphObject(graph,createGraphObjectFromObject(graph,{\n            type:'layer',\n            title:'new layer',\n            parent:page.id,\n            children:graph.createArray()\n        }))\n        insertAsFirstChild(graph,page,layer)\n    }\n\n    zoomIn  = () => this.setState({zoom:this.state.zoom+1})\n    zoomOut = () => this.setState({zoom:this.state.zoom-1})\n\n    render() {\n        const prov = this.props.provider\n        return <GridEditorApp>\n            <Toolbar left top><label>{prov.getTitle()}</label></Toolbar>\n            <Panel scroll left middle>\n                <TreeTable root={prov.getSceneRoot()} provider={prov}/>\n            </Panel>\n\n            <Toolbar left bottom>\n                <button className=\"fa fa-plus\" onClick={this.showAddPopup}/>\n                <button className=\"fa fa-close\" onClick={prov.deleteSelection}/>\n                <button className=\"fa fa-file-image-o\" onClick={prov.showAddImageAssetDialog}/>\n            </Toolbar>\n\n            <Toolbar center top>\n                <button className=\"fa fa-save\" onClick={prov.save}/>\n                <button className=\"fa fa-download\" onClick={prov.exportSVG}> SVG</button>\n                <button className=\"fa fa-download\" onClick={prov.exportPNG}> PNG</button>\n                <button className=\"fa fa-undo\" onClick={prov.performUndo}/>\n                <button className=\"fa fa-repeat\" onClick={prov.performRedo}/>\n                <button className=\"fa fa-search-plus\" onClick={this.zoomIn}/>\n                <button className=\"fa fa-search-minus\" onClick={this.zoomOut}/>\n                <Spacer/>\n                <button className=\"fa fa-cut\" onClick={prov.cutSelection}/>\n                <button className=\"fa fa-copy\" onClick={prov.copySelection}/>\n                <button className=\"fa fa-paste\" onClick={prov.pasteSelection}/>\n                <Spacer/>\n                <button className=\"fa fa-play\" onClick={prov.openPresentationView}/>\n                <button className=\"fa fa-plus\" onClick={prov.newView}> view</button>\n                <button className=\"fa fa-superpowers\" onClick={prov.toggleConnected}>{this.state.connected?\"disconnect\":\"connect\"}</button>\n            </Toolbar>\n\n            <Panel center middle scroll>\n                {this.renderCenterPane(this.state.mode)}\n            </Panel>\n\n            <Panel scroll right><PropSheet provider={prov}/></Panel>\n\n            <Toolbar right top/>\n            <Toolbar right bottom/>\n\n        </GridEditorApp>\n    }\n\n    renderCenterPane(mode) {\n        if (mode === 'canvas') {\n            return <MetadocCanvas prov={this.props.provider} onSelect={this.canvasSelected} scale={Math.pow(2, this.state.zoom)}/>\n        } else {\n            const sel = SelectionManager.getSelection()\n            return <AssetView provider={this.props.provider} asset={sel}/>\n        }\n    }\n}\n\n\n","/* eslint-disable */\nconst THREE = require('three');//requireimport * as THREE from 'three'\n\n/**\n * @author arodic / https://github.com/arodic\n */\n\nconst TransformControls = function ( camera, domElement ) {\n\n    THREE.Object3D.call( this );\n\n    domElement = ( domElement !== undefined ) ? domElement : document;\n\n    this.visible = false;\n\n    var _gizmo = new TransformControlsGizmo();\n    this.add( _gizmo );\n\n    var _plane = new TransformControlsPlane();\n    this.add( _plane );\n\n    var scope = this;\n\n    // Define properties with getters/setter\n    // Setting the defined property will automatically trigger change event\n    // Defined properties are passed down to gizmo and plane\n\n    defineProperty( \"camera\", camera );\n    defineProperty( \"object\", undefined );\n    defineProperty( \"enabled\", true );\n    defineProperty( \"axis\", null );\n    defineProperty( \"mode\", \"translate\" );\n    defineProperty( \"translationSnap\", null );\n    defineProperty( \"rotationSnap\", null );\n    defineProperty( \"space\", \"world\" );\n    defineProperty( \"size\", 1 );\n    defineProperty( \"dragging\", false );\n    defineProperty( \"showX\", true );\n    defineProperty( \"showY\", true );\n    defineProperty( \"showZ\", true );\n\n    var changeEvent = { type: \"change\" };\n    var mouseDownEvent = { type: \"mouseDown\" };\n    var mouseUpEvent = { type: \"mouseUp\", mode: scope.mode };\n    var objectChangeEvent = { type: \"objectChange\" };\n\n    // Reusable utility variables\n\n    var ray = new THREE.Raycaster();\n\n    var _tempVector = new THREE.Vector3();\n    var _tempVector2 = new THREE.Vector3();\n    var _tempQuaternion = new THREE.Quaternion();\n    var _unit = {\n        X: new THREE.Vector3( 1, 0, 0 ),\n        Y: new THREE.Vector3( 0, 1, 0 ),\n        Z: new THREE.Vector3( 0, 0, 1 )\n    };\n    var _identityQuaternion = new THREE.Quaternion();\n    var _alignVector = new THREE.Vector3();\n\n    var pointStart = new THREE.Vector3();\n    var pointEnd = new THREE.Vector3();\n    var rotationAxis = new THREE.Vector3();\n    var rotationAngle = 0;\n\n    var cameraPosition = new THREE.Vector3();\n    var cameraQuaternion = new THREE.Quaternion();\n    var cameraScale = new THREE.Vector3();\n\n    var parentPosition = new THREE.Vector3();\n    var parentQuaternion = new THREE.Quaternion();\n    var parentScale = new THREE.Vector3();\n\n    var worldPositionStart = new THREE.Vector3();\n    var worldQuaternionStart = new THREE.Quaternion();\n    var worldScaleStart = new THREE.Vector3();\n\n    var worldPosition = new THREE.Vector3();\n    var worldQuaternion = new THREE.Quaternion();\n    var worldScale = new THREE.Vector3();\n\n    var eye = new THREE.Vector3();\n\n    var _positionStart = new THREE.Vector3();\n    var _quaternionStart = new THREE.Quaternion();\n    var _scaleStart = new THREE.Vector3();\n\n    // TODO: remove properties unused in plane and gizmo\n\n    defineProperty( \"parentQuaternion\", parentQuaternion );\n    defineProperty( \"worldPosition\", worldPosition );\n    defineProperty( \"worldPositionStart\", worldPositionStart );\n    defineProperty( \"worldQuaternion\", worldQuaternion );\n    defineProperty( \"worldQuaternionStart\", worldQuaternionStart );\n    defineProperty( \"cameraPosition\", cameraPosition );\n    defineProperty( \"cameraQuaternion\", cameraQuaternion );\n    defineProperty( \"pointStart\", pointStart );\n    defineProperty( \"pointEnd\", pointEnd );\n    defineProperty( \"rotationAxis\", rotationAxis );\n    defineProperty( \"rotationAngle\", rotationAngle );\n    defineProperty( \"eye\", eye );\n\n\n\n        domElement.addEventListener( \"mousedown\", onPointerDown, false );\n        domElement.addEventListener( \"touchstart\", onPointerDown, false );\n        domElement.addEventListener( \"mousemove\", onPointerHover, false );\n        domElement.addEventListener( \"touchmove\", onPointerHover, false );\n        domElement.addEventListener( \"touchmove\", onPointerMove, false );\n        document.addEventListener( \"mouseup\", onPointerUp, false );\n        domElement.addEventListener( \"touchend\", onPointerUp, false );\n        domElement.addEventListener( \"touchcancel\", onPointerUp, false );\n        domElement.addEventListener( \"touchleave\", onPointerUp, false );\n        domElement.addEventListener( \"contextmenu\", onContext, false );\n\n\n\n    this.dispose = function () {\n\n        domElement.removeEventListener( \"mousedown\", onPointerDown );\n        domElement.removeEventListener( \"touchstart\", onPointerDown );\n        domElement.removeEventListener( \"mousemove\", onPointerHover );\n        domElement.removeEventListener( \"touchmove\", onPointerHover );\n        domElement.removeEventListener( \"touchmove\", onPointerMove );\n        document.removeEventListener( \"mouseup\", onPointerUp );\n        domElement.removeEventListener( \"touchend\", onPointerUp );\n        domElement.removeEventListener( \"touchcancel\", onPointerUp );\n        domElement.removeEventListener( \"touchleave\", onPointerUp );\n        domElement.removeEventListener( \"contextmenu\", onContext );\n\n    };\n\n    // Set current object\n    this.attach = function ( object ) {\n\n        this.object = object;\n        this.visible = true;\n\n    };\n\n    // Detatch from object\n    this.detach = function () {\n\n        this.object = undefined;\n        this.visible = false;\n        this.axis = null;\n\n    };\n\n    // Defined getter, setter and store for a property\n    function defineProperty( propName, defaultValue ) {\n\n        var propValue = defaultValue;\n\n        Object.defineProperty( scope, propName, {\n\n            get: function() {\n\n                return propValue !== undefined ? propValue : defaultValue;\n\n            },\n\n            set: function( value ) {\n\n                if ( propValue !== value ) {\n\n                    propValue = value;\n                    _plane[ propName ] = value;\n                    _gizmo[ propName ] = value;\n\n                    scope.dispatchEvent( { type: propName + \"-changed\", value: value } );\n                    scope.dispatchEvent( changeEvent );\n\n                }\n\n            }\n\n        });\n\n        scope[ propName ] = defaultValue;\n        _plane[ propName ] = defaultValue;\n        _gizmo[ propName ] = defaultValue;\n\n    }\n\n    // updateMatrixWorld  updates key transformation variables\n    this.updateMatrixWorld = function () {\n\n        if ( this.object !== undefined ) {\n\n            this.object.updateMatrixWorld();\n            this.object.parent.matrixWorld.decompose( parentPosition, parentQuaternion, parentScale );\n            this.object.matrixWorld.decompose( worldPosition, worldQuaternion, worldScale );\n\n        }\n\n        this.camera.updateMatrixWorld();\n        this.camera.matrixWorld.decompose( cameraPosition, cameraQuaternion, cameraScale );\n\n        if ( this.camera instanceof THREE.PerspectiveCamera ) {\n\n            eye.copy( cameraPosition ).sub( worldPosition ).normalize();\n\n        } else if ( this.camera instanceof THREE.OrthographicCamera ) {\n\n            eye.copy( cameraPosition ).normalize();\n\n        }\n\n        THREE.Object3D.prototype.updateMatrixWorld.call( this );\n\n    };\n\n    this.pointerHover = function( pointer ) {\n\n        if ( this.object === undefined || this.dragging === true || ( pointer.button !== undefined && pointer.button !== 0 ) ) return;\n\n        ray.setFromCamera( pointer, this.camera );\n\n        var intersect = ray.intersectObjects( _gizmo.picker[ this.mode ].children, true )[ 0 ] || false;\n\n        if ( intersect ) {\n\n            this.axis = intersect.object.name;\n\n        } else {\n\n            this.axis = null;\n\n        }\n\n    };\n\n    this.pointerDown = function( pointer ) {\n\n        if ( this.object === undefined || this.dragging === true || ( pointer.button !== undefined && pointer.button !== 0 ) ) return;\n\n        if ( ( pointer.button === 0 || pointer.button === undefined ) && this.axis !== null ) {\n\n            ray.setFromCamera( pointer, this.camera );\n\n            var planeIntersect = ray.intersectObjects( [ _plane ], true )[ 0 ] || false;\n\n            if ( planeIntersect ) {\n\n                var space = this.space;\n\n                if ( this.mode === 'scale') {\n\n                    space = 'local';\n\n                } else if ( this.axis === 'E' ||  this.axis === 'XYZE' ||  this.axis === 'XYZ' ) {\n\n                    space = 'world';\n\n                }\n\n                if ( space === 'local' && this.mode === 'rotate' ) {\n\n                    var snap = this.rotationSnap;\n\n                    if ( this.axis === 'X' && snap ) this.object.rotation.x = Math.round( this.object.rotation.x / snap ) * snap;\n                    if ( this.axis === 'Y' && snap ) this.object.rotation.y = Math.round( this.object.rotation.y / snap ) * snap;\n                    if ( this.axis === 'Z' && snap ) this.object.rotation.z = Math.round( this.object.rotation.z / snap ) * snap;\n\n                }\n\n                this.object.updateMatrixWorld();\n                this.object.parent.updateMatrixWorld();\n\n                _positionStart.copy( this.object.position );\n                _quaternionStart.copy( this.object.quaternion );\n                _scaleStart.copy( this.object.scale );\n\n                this.object.matrixWorld.decompose( worldPositionStart, worldQuaternionStart, worldScaleStart );\n\n                pointStart.copy( planeIntersect.point ).sub( worldPositionStart );\n\n                if ( space === 'local' ) pointStart.applyQuaternion( worldQuaternionStart.clone().inverse() );\n\n            }\n\n            this.dragging = true;\n            mouseDownEvent.mode = this.mode;\n            this.dispatchEvent( mouseDownEvent );\n\n        }\n\n    };\n\n    this.pointerMove = function( pointer ) {\n\n        var axis = this.axis;\n        var mode = this.mode;\n        var object = this.object;\n        var space = this.space;\n\n        if ( mode === 'scale') {\n\n            space = 'local';\n\n        } else if ( axis === 'E' ||  axis === 'XYZE' ||  axis === 'XYZ' ) {\n\n            space = 'world';\n\n        }\n\n        if ( object === undefined || axis === null || this.dragging === false || ( pointer.button !== undefined && pointer.button !== 0 ) ) return;\n\n        ray.setFromCamera( pointer, this.camera );\n\n        var planeIntersect = ray.intersectObjects( [ _plane ], true )[ 0 ] || false;\n\n        if ( planeIntersect === false ) return;\n\n        pointEnd.copy( planeIntersect.point ).sub( worldPositionStart );\n\n        if ( space === 'local' ) pointEnd.applyQuaternion( worldQuaternionStart.clone().inverse() );\n\n        if ( mode === 'translate' ) {\n\n            if ( axis.search( 'X' ) === -1 ) {\n                pointEnd.x = pointStart.x;\n            }\n            if ( axis.search( 'Y' ) === -1 ) {\n                pointEnd.y = pointStart.y;\n            }\n            if ( axis.search( 'Z' ) === -1 ) {\n                pointEnd.z = pointStart.z;\n            }\n\n            // Apply translate\n\n            if ( space === 'local' ) {\n                object.position.copy( pointEnd ).sub( pointStart ).applyQuaternion( _quaternionStart );\n            } else {\n                object.position.copy( pointEnd ).sub( pointStart );\n            }\n\n            object.position.add( _positionStart );\n\n            // Apply translation snap\n\n            if ( this.translationSnap ) {\n\n                if ( space === 'local' ) {\n\n                    object.position.applyQuaternion(_tempQuaternion.copy( _quaternionStart ).inverse() );\n\n                    if ( axis.search( 'X' ) !== -1 ) {\n                        object.position.x = Math.round( object.position.x / this.translationSnap ) * this.translationSnap;\n                    }\n\n                    if ( axis.search( 'Y' ) !== -1 ) {\n                        object.position.y = Math.round( object.position.y / this.translationSnap ) * this.translationSnap;\n                    }\n\n                    if ( axis.search( 'Z' ) !== -1 ) {\n                        object.position.z = Math.round( object.position.z / this.translationSnap ) * this.translationSnap;\n                    }\n\n                    object.position.applyQuaternion( _quaternionStart );\n\n                }\n\n                if ( space === 'world' ) {\n\n                    if ( object.parent ) {\n                        object.position.add( _tempVector.setFromMatrixPosition( object.parent.matrixWorld ) );\n                    }\n\n                    if ( axis.search( 'X' ) !== -1 ) {\n                        object.position.x = Math.round( object.position.x / this.translationSnap ) * this.translationSnap;\n                    }\n\n                    if ( axis.search( 'Y' ) !== -1 ) {\n                        object.position.y = Math.round( object.position.y / this.translationSnap ) * this.translationSnap;\n                    }\n\n                    if ( axis.search( 'Z' ) !== -1 ) {\n                        object.position.z = Math.round( object.position.z / this.translationSnap ) * this.translationSnap;\n                    }\n\n                    if ( object.parent ) {\n                        object.position.sub( _tempVector.setFromMatrixPosition( object.parent.matrixWorld ) );\n                    }\n\n                }\n\n            }\n\n        } else if ( mode === 'scale' ) {\n\n            if ( axis.search( 'XYZ' ) !== -1 ) {\n\n                var d = pointEnd.length() / pointStart.length();\n\n                if ( pointEnd.dot( pointStart ) < 0 ) d *= -1;\n\n                _tempVector.set( d, d, d );\n\n            } else {\n\n                _tempVector.copy( pointEnd ).divide( pointStart );\n\n                if ( axis.search( 'X' ) === -1 ) {\n                    _tempVector.x = 1;\n                }\n                if ( axis.search( 'Y' ) === -1 ) {\n                    _tempVector.y = 1;\n                }\n                if ( axis.search( 'Z' ) === -1 ) {\n                    _tempVector.z = 1;\n                }\n\n            }\n\n            // Apply scale\n\n            object.scale.copy( _scaleStart ).multiply( _tempVector );\n\n        } else if ( mode === 'rotate' ) {\n\n            var ROTATION_SPEED = 20 / worldPosition.distanceTo( _tempVector.setFromMatrixPosition( this.camera.matrixWorld ) );\n\n            var quaternion = this.space === \"local\" ? worldQuaternion : _identityQuaternion;\n\n            var unit = _unit[ axis ];\n\n            if ( axis === 'E' ) {\n\n                _tempVector.copy( pointEnd ).cross( pointStart );\n                rotationAxis.copy( eye );\n                rotationAngle = pointEnd.angleTo( pointStart ) * ( _tempVector.dot( eye ) < 0 ? 1 : -1 );\n\n            } else if ( axis === 'XYZE' ) {\n\n                _tempVector.copy( pointEnd ).sub( pointStart ).cross( eye ).normalize();\n                rotationAxis.copy( _tempVector );\n                rotationAngle = pointEnd.sub( pointStart ).dot( _tempVector.cross( eye ) ) * ROTATION_SPEED;\n\n            } else if ( axis === 'X' || axis === 'Y' || axis === 'Z' ) {\n\n                _alignVector.copy( unit ).applyQuaternion( quaternion );\n\n                rotationAxis.copy( unit );\n\n                _tempVector = unit.clone();\n                _tempVector2 = pointEnd.clone().sub( pointStart );\n                if ( space === 'local' ) {\n                    _tempVector.applyQuaternion( quaternion );\n                    _tempVector2.applyQuaternion( worldQuaternionStart );\n                }\n                rotationAngle = _tempVector2.dot( _tempVector.cross( eye ).normalize() ) * ROTATION_SPEED;\n\n            }\n\n            // Apply rotation snap\n\n            if ( this.rotationSnap ) rotationAngle = Math.round( rotationAngle / this.rotationSnap ) * this.rotationSnap;\n\n            this.rotationAngle = rotationAngle;\n\n            // Apply rotate\n\n            if ( space === 'local' ) {\n\n                object.quaternion.copy( _quaternionStart );\n                object.quaternion.multiply( _tempQuaternion.setFromAxisAngle( rotationAxis, rotationAngle ) );\n\n            } else {\n\n                object.quaternion.copy( _tempQuaternion.setFromAxisAngle( rotationAxis, rotationAngle ) );\n                object.quaternion.multiply( _quaternionStart );\n\n            }\n\n        }\n\n        this.dispatchEvent( changeEvent );\n        this.dispatchEvent( objectChangeEvent );\n\n    };\n\n    this.pointerUp = function( pointer ) {\n\n        if ( pointer.button !== undefined && pointer.button !== 0 ) return;\n\n        if ( this.dragging && ( this.axis !== null ) ) {\n\n            mouseUpEvent.mode = this.mode;\n            this.dispatchEvent( mouseUpEvent );\n\n        }\n\n        this.dragging = false;\n\n        if ( pointer.button === undefined ) this.axis = null;\n\n    };\n\n    // normalize mouse / touch pointer and remap {x,y} to view space.\n\n    function getPointer( event ) {\n\n        var pointer = event.changedTouches ? event.changedTouches[ 0 ] : event;\n\n        var rect = domElement.getBoundingClientRect();\n\n        return {\n            x: ( pointer.clientX - rect.left ) / rect.width * 2 - 1,\n            y: - ( pointer.clientY - rect.top ) / rect.height * 2 + 1,\n            button: event.button\n        };\n\n    }\n\n    // mouse / touch event handlers\n\n    function onContext( event ) {\n\n        event.preventDefault();\n\n    }\n\n    function onPointerHover( event ) {\n\n        if ( !scope.enabled ) return;\n\n        scope.pointerHover( getPointer( event ) );\n\n    }\n\n    function onPointerDown( event ) {\n\n        if ( !scope.enabled ) return;\n\n        event.preventDefault();\n\n        document.addEventListener( \"mousemove\", onPointerMove, false );\n\n        scope.pointerHover( getPointer( event ) );\n        scope.pointerDown( getPointer( event ) );\n\n    }\n\n    function onPointerMove( event ) {\n\n        if ( !scope.enabled ) return;\n\n        event.preventDefault();\n\n        scope.pointerMove( getPointer( event ) );\n\n    }\n\n    function onPointerUp( event ) {\n\n        if ( !scope.enabled ) return;\n\n        event.preventDefault(); // Prevent MouseEvent on mobile\n\n        document.removeEventListener( \"mousemove\", onPointerMove, false );\n\n        scope.pointerUp( getPointer( event ) );\n\n    }\n\n    // TODO: depricate\n\n    this.getMode = function () {\n\n        return scope.mode;\n\n    };\n\n    this.setMode = function ( mode ) {\n\n        scope.mode = mode;\n\n    };\n\n    this.setTranslationSnap = function ( translationSnap ) {\n\n        scope.translationSnap = translationSnap;\n\n    };\n\n    this.setRotationSnap = function ( rotationSnap ) {\n\n        scope.rotationSnap = rotationSnap;\n\n    };\n\n    this.setSize = function ( size ) {\n\n        scope.size = size;\n\n    };\n\n    this.setSpace = function ( space ) {\n\n        scope.space = space;\n\n    };\n\n    this.update = function () {\n\n        console.warn( 'TransformControls: update function has been depricated.' );\n\n    };\n\n};\n\nTransformControls.prototype = Object.assign( Object.create( THREE.Object3D.prototype ), {\n\n    constructor: TransformControls,\n\n    isTransformControls: true\n\n} );\n\n\nconst TransformControlsGizmo = function () {\n\n\n    THREE.Object3D.call( this );\n\n    this.type = 'TransformControlsGizmo';\n\n    // shared materials\n\n    var gizmoMaterial = new THREE.MeshBasicMaterial({\n        depthTest: false,\n        depthWrite: false,\n        transparent: true,\n        side: THREE.DoubleSide,\n        fog: false\n    });\n\n    var gizmoLineMaterial = new THREE.LineBasicMaterial({\n        depthTest: false,\n        depthWrite: false,\n        transparent: true,\n        linewidth: 1,\n        fog: false\n    });\n\n    // Make unique material for each axis/color\n\n    var matInvisible = gizmoMaterial.clone();\n    matInvisible.opacity = 0.15;\n\n    var matHelper = gizmoMaterial.clone();\n    matHelper.opacity = 0.33;\n\n    var matRed = gizmoMaterial.clone();\n    matRed.color.set( 0xff0000 );\n\n    var matGreen = gizmoMaterial.clone();\n    matGreen.color.set( 0x00ff00 );\n\n    var matBlue = gizmoMaterial.clone();\n    matBlue.color.set( 0x0000ff );\n\n    var matWhiteTransperent = gizmoMaterial.clone();\n    matWhiteTransperent.opacity = 0.25;\n\n    var matYellowTransparent = matWhiteTransperent.clone();\n    matYellowTransparent.color.set( 0xffff00 );\n\n    var matCyanTransparent = matWhiteTransperent.clone();\n    matCyanTransparent.color.set( 0x00ffff );\n\n    var matMagentaTransparent = matWhiteTransperent.clone();\n    matMagentaTransparent.color.set( 0xff00ff );\n\n    var matYellow = gizmoMaterial.clone();\n    matYellow.color.set( 0xffff00 );\n\n    var matLineRed = gizmoLineMaterial.clone();\n    matLineRed.color.set( 0xff0000 );\n\n    var matLineGreen = gizmoLineMaterial.clone();\n    matLineGreen.color.set( 0x00ff00 );\n\n    var matLineBlue = gizmoLineMaterial.clone();\n    matLineBlue.color.set( 0x0000ff );\n\n    var matLineCyan = gizmoLineMaterial.clone();\n    matLineCyan.color.set( 0x00ffff );\n\n    var matLineMagenta = gizmoLineMaterial.clone();\n    matLineMagenta.color.set( 0xff00ff );\n\n    var matLineYellow = gizmoLineMaterial.clone();\n    matLineYellow.color.set( 0xffff00 );\n\n    var matLineGray = gizmoLineMaterial.clone();\n    matLineGray.color.set( 0x787878);\n\n    var matLineYellowTransparent = matLineYellow.clone();\n    matLineYellowTransparent.opacity = 0.25;\n\n    // reusable geometry\n\n    var arrowGeometry = new THREE.CylinderBufferGeometry( 0, 0.05, 0.2, 12, 1, false);\n\n    var scaleHandleGeometry = new THREE.BoxBufferGeometry( 0.125, 0.125, 0.125);\n\n    var lineGeometry = new THREE.BufferGeometry( );\n    lineGeometry.addAttribute('position', new THREE.Float32BufferAttribute( [ 0, 0, 0,\t1, 0, 0 ], 3 ) );\n\n    var CircleGeometry = function( radius, arc ) {\n\n        var geometry = new THREE.BufferGeometry( );\n        var vertices = [];\n\n        for ( var i = 0; i <= 64 * arc; ++i ) {\n\n            vertices.push( 0, Math.cos( i / 32 * Math.PI ) * radius, Math.sin( i / 32 * Math.PI ) * radius );\n\n        }\n\n        geometry.addAttribute('position', new THREE.Float32BufferAttribute( vertices, 3 ) );\n\n        return geometry;\n\n    };\n\n    // Special geometry for transform helper. If scaled with position vector it spans from [0,0,0] to position\n\n    var TranslateHelperGeometry = function( radius, arc ) {\n\n        var geometry = new THREE.BufferGeometry()\n\n        geometry.addAttribute('position', new THREE.Float32BufferAttribute( [ 0, 0, 0, 1, 1, 1 ], 3 ) );\n\n        return geometry;\n\n    };\n\n    // Gizmo definitions - custom hierarchy definitions for setupGizmo() function\n\n    var gizmoTranslate = {\n        X: [\n            [ new THREE.Mesh( arrowGeometry, matRed ), [ 1, 0, 0 ], [ 0, 0, -Math.PI / 2 ], null, 'fwd' ],\n            [ new THREE.Mesh( arrowGeometry, matRed ), [ 1, 0, 0 ], [ 0, 0, Math.PI / 2 ], null, 'bwd' ],\n            [ new THREE.Line( lineGeometry, matLineRed ) ]\n        ],\n        Y: [\n            [ new THREE.Mesh( arrowGeometry, matGreen ), [ 0, 1, 0 ], null, null, 'fwd' ],\n            [ new THREE.Mesh( arrowGeometry, matGreen ), [ 0, 1, 0 ], [ Math.PI, 0, 0 ], null, 'bwd' ],\n            [ new THREE.Line( lineGeometry, matLineGreen ), null, [ 0, 0, Math.PI / 2 ] ]\n        ],\n        Z: [\n            [ new THREE.Mesh( arrowGeometry, matBlue ), [ 0, 0, 1 ], [ Math.PI / 2, 0, 0 ], null, 'fwd' ],\n            [ new THREE.Mesh( arrowGeometry, matBlue ), [ 0, 0, 1 ], [ -Math.PI / 2, 0, 0 ], null, 'bwd' ],\n            [ new THREE.Line( lineGeometry, matLineBlue ), null, [ 0, -Math.PI / 2, 0 ] ]\n        ],\n        XYZ: [\n            [ new THREE.Mesh( new THREE.OctahedronBufferGeometry( 0.1, 0 ), matWhiteTransperent ), [ 0, 0, 0 ], [ 0, 0, 0 ] ]\n        ],\n        XY: [\n            [ new THREE.Mesh( new THREE.PlaneBufferGeometry( 0.295, 0.295 ), matYellowTransparent ), [ 0.15, 0.15, 0 ] ],\n            [ new THREE.Line( lineGeometry, matLineYellow ), [ 0.18, 0.3, 0 ], null, [ 0.125, 1, 1 ] ],\n            [ new THREE.Line( lineGeometry, matLineYellow ), [ 0.3, 0.18, 0 ], [ 0, 0, Math.PI / 2 ], [ 0.125, 1, 1 ] ]\n        ],\n        YZ: [\n            [ new THREE.Mesh( new THREE.PlaneBufferGeometry( 0.295, 0.295 ), matCyanTransparent ), [ 0, 0.15, 0.15 ], [ 0, Math.PI / 2, 0 ] ],\n            [ new THREE.Line( lineGeometry, matLineCyan ), [ 0, 0.18, 0.3 ], [ 0, 0, Math.PI / 2 ], [ 0.125, 1, 1 ] ],\n            [ new THREE.Line( lineGeometry, matLineCyan ), [ 0, 0.3, 0.18 ], [ 0, -Math.PI / 2, 0 ], [ 0.125, 1, 1 ] ]\n        ],\n        XZ: [\n            [ new THREE.Mesh( new THREE.PlaneBufferGeometry( 0.295, 0.295 ), matMagentaTransparent ), [ 0.15, 0, 0.15 ], [ -Math.PI / 2, 0, 0 ] ],\n            [ new THREE.Line( lineGeometry, matLineMagenta ), [ 0.18, 0, 0.3 ], null, [ 0.125, 1, 1 ] ],\n            [ new THREE.Line( lineGeometry, matLineMagenta ), [ 0.3, 0, 0.18 ], [ 0, -Math.PI / 2, 0 ], [ 0.125, 1, 1 ] ]\n        ]\n    };\n\n    var pickerTranslate = {\n        X: [\n            [ new THREE.Mesh( new THREE.CylinderBufferGeometry( 0.2, 0, 1, 4, 1, false ), matInvisible ), [ 0.6, 0, 0 ], [ 0, 0, -Math.PI / 2 ] ]\n        ],\n        Y: [\n            [ new THREE.Mesh( new THREE.CylinderBufferGeometry( 0.2, 0, 1, 4, 1, false ), matInvisible ), [ 0, 0.6, 0 ] ]\n        ],\n        Z: [\n            [ new THREE.Mesh( new THREE.CylinderBufferGeometry( 0.2, 0, 1, 4, 1, false ), matInvisible ), [ 0, 0, 0.6 ], [ Math.PI / 2, 0, 0 ] ]\n        ],\n        XYZ: [\n            [ new THREE.Mesh( new THREE.OctahedronBufferGeometry( 0.2, 0 ), matInvisible ) ]\n        ],\n        XY: [\n            [ new THREE.Mesh( new THREE.PlaneBufferGeometry( 0.4, 0.4 ), matInvisible ), [ 0.2, 0.2, 0 ] ]\n        ],\n        YZ: [\n            [ new THREE.Mesh( new THREE.PlaneBufferGeometry( 0.4, 0.4 ), matInvisible ), [ 0, 0.2, 0.2 ], [ 0, Math.PI / 2, 0 ] ]\n        ],\n        XZ: [\n            [ new THREE.Mesh( new THREE.PlaneBufferGeometry( 0.4, 0.4 ), matInvisible ), [ 0.2, 0, 0.2 ], [ -Math.PI / 2, 0, 0 ] ]\n        ]\n    };\n\n    var helperTranslate = {\n        START: [\n            [ new THREE.Mesh( new THREE.OctahedronBufferGeometry( 0.01, 2 ), matHelper ), null, null, null, 'helper' ]\n        ],\n        END: [\n            [ new THREE.Mesh( new THREE.OctahedronBufferGeometry( 0.01, 2 ), matHelper ), null, null, null, 'helper' ]\n        ],\n        DELTA: [\n            [ new THREE.Line( TranslateHelperGeometry(), matHelper ), null, null, null, 'helper' ]\n        ],\n        X: [\n            [ new THREE.Line( lineGeometry, matHelper.clone() ), [ -1e3, 0, 0 ], null, [ 1e6, 1, 1 ], 'helper' ]\n        ],\n        Y: [\n            [ new THREE.Line( lineGeometry, matHelper.clone() ), [ 0, -1e3, 0 ], [ 0, 0, Math.PI / 2 ], [ 1e6, 1, 1 ], 'helper' ]\n        ],\n        Z: [\n            [ new THREE.Line( lineGeometry, matHelper.clone() ), [ 0, 0, -1e3 ], [ 0, -Math.PI / 2, 0 ], [ 1e6, 1, 1 ], 'helper' ]\n        ]\n    };\n\n    var gizmoRotate = {\n        X: [\n            [ new THREE.Line( CircleGeometry( 1, 0.5 ), matLineRed ) ],\n            [ new THREE.Mesh( new THREE.OctahedronBufferGeometry( 0.04, 0 ), matRed ), [ 0, 0, 0.99 ], null, [ 1, 3, 1 ] ],\n        ],\n        Y: [\n            [ new THREE.Line( CircleGeometry( 1, 0.5 ), matLineGreen ), null, [ 0, 0, -Math.PI / 2 ] ],\n            [ new THREE.Mesh( new THREE.OctahedronBufferGeometry( 0.04, 0 ), matGreen ), [ 0, 0, 0.99 ], null, [ 3, 1, 1 ] ],\n        ],\n        Z: [\n            [ new THREE.Line( CircleGeometry( 1, 0.5 ), matLineBlue ), null, [ 0, Math.PI / 2, 0 ] ],\n            [ new THREE.Mesh( new THREE.OctahedronBufferGeometry( 0.04, 0 ), matBlue ), [ 0.99, 0, 0 ], null, [ 1, 3, 1 ] ],\n        ],\n        E: [\n            [ new THREE.Line( CircleGeometry( 1.25, 1 ), matLineYellowTransparent ), null, [ 0, Math.PI / 2, 0 ] ],\n            [ new THREE.Mesh( new THREE.CylinderBufferGeometry( 0.03, 0, 0.15, 4, 1, false ), matLineYellowTransparent ), [ 1.17, 0, 0 ], [ 0, 0, -Math.PI / 2 ], [ 1, 1, 0.001 ]],\n            [ new THREE.Mesh( new THREE.CylinderBufferGeometry( 0.03, 0, 0.15, 4, 1, false ), matLineYellowTransparent ), [ -1.17, 0, 0 ], [ 0, 0, Math.PI / 2 ], [ 1, 1, 0.001 ]],\n            [ new THREE.Mesh( new THREE.CylinderBufferGeometry( 0.03, 0, 0.15, 4, 1, false ), matLineYellowTransparent ), [ 0, -1.17, 0 ], [ Math.PI, 0, 0 ], [ 1, 1, 0.001 ]],\n            [ new THREE.Mesh( new THREE.CylinderBufferGeometry( 0.03, 0, 0.15, 4, 1, false ), matLineYellowTransparent ), [ 0, 1.17, 0 ], [ 0, 0, 0 ], [ 1, 1, 0.001 ]],\n        ],\n        XYZE: [\n            [ new THREE.Line( CircleGeometry( 1, 1 ), matLineGray ), null, [ 0, Math.PI / 2, 0 ] ]\n        ]\n    };\n\n    var helperRotate = {\n        AXIS: [\n            [ new THREE.Line( lineGeometry, matHelper.clone() ), [ -1e3, 0, 0 ], null, [ 1e6, 1, 1 ], 'helper' ]\n        ]\n    };\n\n    var pickerRotate = {\n        X: [\n            [ new THREE.Mesh( new THREE.TorusBufferGeometry( 1, 0.1, 4, 24 ), matInvisible ), [ 0, 0, 0 ], [ 0, -Math.PI / 2, -Math.PI / 2 ] ],\n        ],\n        Y: [\n            [ new THREE.Mesh( new THREE.TorusBufferGeometry( 1, 0.1, 4, 24 ), matInvisible ), [ 0, 0, 0 ], [ Math.PI / 2, 0, 0 ] ],\n        ],\n        Z: [\n            [ new THREE.Mesh( new THREE.TorusBufferGeometry( 1, 0.1, 4, 24 ), matInvisible ), [ 0, 0, 0 ], [ 0, 0, -Math.PI / 2 ] ],\n        ],\n        E: [\n            [ new THREE.Mesh( new THREE.TorusBufferGeometry( 1.25, 0.1, 2, 24 ), matInvisible ) ]\n        ],\n        XYZE: [\n            [ new THREE.Mesh( new THREE.SphereBufferGeometry( 0.7, 10, 8 ), matInvisible ) ]\n        ]\n    };\n\n    var gizmoScale = {\n        X: [\n            [ new THREE.Mesh( scaleHandleGeometry, matRed ), [ 0.8, 0, 0 ], [ 0, 0, -Math.PI / 2 ] ],\n            [ new THREE.Line( lineGeometry, matLineRed ), null, null, [ 0.8, 1, 1 ] ]\n        ],\n        Y: [\n            [ new THREE.Mesh( scaleHandleGeometry, matGreen ), [ 0, 0.8, 0 ] ],\n            [ new THREE.Line( lineGeometry, matLineGreen ), null, [ 0, 0, Math.PI / 2 ], [ 0.8, 1, 1 ] ]\n        ],\n        Z: [\n            [ new THREE.Mesh( scaleHandleGeometry, matBlue ), [ 0, 0, 0.8 ], [ Math.PI / 2, 0, 0 ] ],\n            [ new THREE.Line( lineGeometry, matLineBlue ), null, [ 0, -Math.PI / 2, 0 ], [ 0.8, 1, 1 ] ]\n        ],\n        XY: [\n            [ new THREE.Mesh( scaleHandleGeometry, matYellowTransparent ), [ 0.85, 0.85, 0 ], null, [ 2, 2, 0.2 ] ],\n            [ new THREE.Line( lineGeometry, matLineYellow ), [ 0.855, 0.98, 0 ], null, [ 0.125, 1, 1 ] ],\n            [ new THREE.Line( lineGeometry, matLineYellow ), [ 0.98, 0.855, 0 ], [ 0, 0, Math.PI / 2 ], [ 0.125, 1, 1 ] ]\n        ],\n        YZ: [\n            [ new THREE.Mesh( scaleHandleGeometry, matCyanTransparent ), [ 0, 0.85, 0.85 ], null, [ 0.2, 2, 2 ] ],\n            [ new THREE.Line( lineGeometry, matLineCyan ), [ 0, 0.855, 0.98 ], [ 0, 0, Math.PI / 2 ], [ 0.125, 1, 1 ] ],\n            [ new THREE.Line( lineGeometry, matLineCyan ), [ 0, 0.98, 0.855 ], [ 0, -Math.PI / 2, 0 ], [ 0.125, 1, 1 ] ]\n        ],\n        XZ: [\n            [ new THREE.Mesh( scaleHandleGeometry, matMagentaTransparent ), [ 0.85, 0, 0.85 ], null, [ 2, 0.2, 2 ] ],\n            [ new THREE.Line( lineGeometry, matLineMagenta ), [ 0.855, 0, 0.98 ], null, [ 0.125, 1, 1 ] ],\n            [ new THREE.Line( lineGeometry, matLineMagenta ), [ 0.98, 0, 0.855 ], [ 0, -Math.PI / 2, 0 ], [ 0.125, 1, 1 ] ]\n        ],\n        XYZX: [\n            [ new THREE.Mesh( new THREE.BoxBufferGeometry( 0.125, 0.125, 0.125 ), matWhiteTransperent ), [ 1.1, 0, 0 ] ],\n        ],\n        XYZY: [\n            [ new THREE.Mesh( new THREE.BoxBufferGeometry( 0.125, 0.125, 0.125 ), matWhiteTransperent ), [ 0, 1.1, 0 ] ],\n        ],\n        XYZZ: [\n            [ new THREE.Mesh( new THREE.BoxBufferGeometry( 0.125, 0.125, 0.125 ), matWhiteTransperent ), [ 0, 0, 1.1 ] ],\n        ]\n    };\n\n    var pickerScale = {\n        X: [\n            [ new THREE.Mesh( new THREE.CylinderBufferGeometry( 0.2, 0, 0.8, 4, 1, false ), matInvisible ), [ 0.5, 0, 0 ], [ 0, 0, -Math.PI / 2 ] ]\n        ],\n        Y: [\n            [ new THREE.Mesh( new THREE.CylinderBufferGeometry( 0.2, 0, 0.8, 4, 1, false ), matInvisible ), [ 0, 0.5, 0 ] ]\n        ],\n        Z: [\n            [ new THREE.Mesh( new THREE.CylinderBufferGeometry( 0.2, 0, 0.8, 4, 1, false ), matInvisible ), [ 0, 0, 0.5 ], [ Math.PI / 2, 0, 0 ] ]\n        ],\n        XY: [\n            [ new THREE.Mesh( scaleHandleGeometry, matInvisible ), [ 0.85, 0.85, 0 ], null, [ 3, 3, 0.2 ] ],\n        ],\n        YZ: [\n            [ new THREE.Mesh( scaleHandleGeometry, matInvisible ), [ 0, 0.85, 0.85 ], null, [ 0.2, 3, 3 ] ],\n        ],\n        XZ: [\n            [ new THREE.Mesh( scaleHandleGeometry, matInvisible ), [ 0.85, 0, 0.85 ], null, [ 3, 0.2, 3 ] ],\n        ],\n        XYZX: [\n            [ new THREE.Mesh( new THREE.BoxBufferGeometry( 0.2, 0.2, 0.2 ), matInvisible ), [ 1.1, 0, 0 ] ],\n        ],\n        XYZY: [\n            [ new THREE.Mesh( new THREE.BoxBufferGeometry( 0.2, 0.2, 0.2 ), matInvisible ), [ 0, 1.1, 0 ] ],\n        ],\n        XYZZ: [\n            [ new THREE.Mesh( new THREE.BoxBufferGeometry( 0.2, 0.2, 0.2 ), matInvisible ), [ 0, 0, 1.1 ] ],\n        ]\n    };\n\n    var helperScale = {\n        X: [\n            [ new THREE.Line( lineGeometry, matHelper.clone() ), [ -1e3, 0, 0 ], null, [ 1e6, 1, 1 ], 'helper' ]\n        ],\n        Y: [\n            [ new THREE.Line( lineGeometry, matHelper.clone() ), [ 0, -1e3, 0 ], [ 0, 0, Math.PI / 2 ], [ 1e6, 1, 1 ], 'helper' ]\n        ],\n        Z: [\n            [ new THREE.Line( lineGeometry, matHelper.clone() ), [ 0, 0, -1e3 ], [ 0, -Math.PI / 2, 0 ], [ 1e6, 1, 1 ], 'helper' ]\n        ]\n    };\n\n    // Creates an Object3D with gizmos described in custom hierarchy definition.\n\n    var setupGizmo = function( gizmoMap ) {\n\n        var gizmo = new THREE.Object3D();\n\n        for ( var name in gizmoMap ) {\n\n            for ( var i = gizmoMap[ name ].length; i --; ) {\n\n                var object = gizmoMap[ name ][ i ][ 0 ].clone();\n                var position = gizmoMap[ name ][ i ][ 1 ];\n                var rotation = gizmoMap[ name ][ i ][ 2 ];\n                var scale = gizmoMap[ name ][ i ][ 3 ];\n                var tag = gizmoMap[ name ][ i ][ 4 ];\n\n                // name and tag properties are essential for picking and updating logic.\n                object.name = name;\n                object.tag = tag;\n\n                if (position) {\n                    object.position.set(position[ 0 ], position[ 1 ], position[ 2 ]);\n                }\n                if (rotation) {\n                    object.rotation.set(rotation[ 0 ], rotation[ 1 ], rotation[ 2 ]);\n                }\n                if (scale) {\n                    object.scale.set(scale[ 0 ], scale[ 1 ], scale[ 2 ]);\n                }\n\n                object.updateMatrix();\n\n                var tempGeometry = object.geometry.clone();\n                tempGeometry.applyMatrix(object.matrix);\n                object.geometry = tempGeometry;\n\n                object.position.set( 0, 0, 0 );\n                object.rotation.set( 0, 0, 0 );\n                object.scale.set(1, 1, 1);\n\n                gizmo.add(object);\n\n            }\n\n        }\n\n        return gizmo;\n\n    };\n\n    // Reusable utility variables\n\n    var tempVector = new THREE.Vector3( 0, 0, 0 );\n    var tempEuler = new THREE.Euler();\n    var alignVector = new THREE.Vector3( 0, 1, 0 );\n    var zeroVector = new THREE.Vector3( 0, 0, 0 );\n    var lookAtMatrix = new THREE.Matrix4();\n    var tempQuaternion = new THREE.Quaternion();\n    var tempQuaternion2 = new THREE.Quaternion();\n    var identityQuaternion = new THREE.Quaternion();\n\n    var unitX = new THREE.Vector3( 1, 0, 0 );\n    var unitY = new THREE.Vector3( 0, 1, 0 );\n    var unitZ = new THREE.Vector3( 0, 0, 1 );\n\n    // Gizmo creation\n\n    this.gizmo = {};\n    this.picker = {};\n    this.helper = {};\n\n    this.add( this.gizmo[ \"translate\" ] = setupGizmo( gizmoTranslate ) );\n    this.add( this.gizmo[ \"rotate\" ] = setupGizmo( gizmoRotate ) );\n    this.add( this.gizmo[ \"scale\" ] = setupGizmo( gizmoScale ) );\n    this.add( this.picker[ \"translate\" ] = setupGizmo( pickerTranslate ) );\n    this.add( this.picker[ \"rotate\" ] = setupGizmo( pickerRotate ) );\n    this.add( this.picker[ \"scale\" ] = setupGizmo( pickerScale ) );\n    this.add( this.helper[ \"translate\" ] = setupGizmo( helperTranslate ) );\n    this.add( this.helper[ \"rotate\" ] = setupGizmo( helperRotate ) );\n    this.add( this.helper[ \"scale\" ] = setupGizmo( helperScale ) );\n\n    // Pickers should be hidden always\n\n    this.picker[ \"translate\" ].visible = false;\n    this.picker[ \"rotate\" ].visible = false;\n    this.picker[ \"scale\" ].visible = false;\n\n    // updateMatrixWorld will update transformations and appearance of individual handles\n\n    this.updateMatrixWorld = function () {\n\n        var space = this.space;\n\n        if ( this.mode === 'scale' ) space = 'local'; // scale always oriented to local rotation\n\n        var quaternion = space === \"local\" ? this.worldQuaternion : identityQuaternion;\n\n        // Show only gizmos for current transform mode\n\n        this.gizmo[ \"translate\" ].visible = this.mode === \"translate\";\n        this.gizmo[ \"rotate\" ].visible = this.mode === \"rotate\";\n        this.gizmo[ \"scale\" ].visible = this.mode === \"scale\";\n\n        this.helper[ \"translate\" ].visible = this.mode === \"translate\";\n        this.helper[ \"rotate\" ].visible = this.mode === \"rotate\";\n        this.helper[ \"scale\" ].visible = this.mode === \"scale\";\n\n\n        var handles = [];\n        handles = handles.concat( this.picker[ this.mode ].children );\n        handles = handles.concat( this.gizmo[ this.mode ].children );\n        handles = handles.concat( this.helper[ this.mode ].children );\n\n        for ( var i = 0; i < handles.length; i++ ) {\n\n            var handle = handles[i];\n\n            // hide aligned to camera\n\n            handle.visible = true;\n            handle.rotation.set( 0, 0, 0 );\n            handle.position.copy( this.worldPosition );\n\n            var eyeDistance = this.worldPosition.distanceTo( this.cameraPosition);\n            handle.scale.set( 1, 1, 1 ).multiplyScalar( eyeDistance * this.size / 7 );\n\n            // TODO: simplify helpers and consider decoupling from gizmo\n\n            if ( handle.tag === 'helper' ) {\n\n                handle.visible = false;\n\n                if ( handle.name === 'AXIS' ) {\n\n                    handle.position.copy( this.worldPositionStart );\n                    handle.visible = !!this.axis;\n\n                    if ( this.axis === 'X' ) {\n\n                        tempQuaternion.setFromEuler( tempEuler.set( 0, 0, 0 ) );\n                        handle.quaternion.copy( quaternion ).multiply( tempQuaternion );\n\n                        if ( Math.abs( alignVector.copy( unitX ).applyQuaternion( quaternion ).dot( this.eye ) ) > 0.9 ) {\n                            handle.visible = false;\n                        }\n\n                    }\n\n                    if ( this.axis === 'Y' ) {\n\n                        tempQuaternion.setFromEuler( tempEuler.set( 0, 0, Math.PI / 2 ) );\n                        handle.quaternion.copy( quaternion ).multiply( tempQuaternion );\n\n                        if ( Math.abs( alignVector.copy( unitY ).applyQuaternion( quaternion ).dot( this.eye ) ) > 0.9 ) {\n                            handle.visible = false;\n                        }\n\n                    }\n\n                    if ( this.axis === 'Z' ) {\n\n                        tempQuaternion.setFromEuler( tempEuler.set( 0, Math.PI / 2, 0 ) );\n                        handle.quaternion.copy( quaternion ).multiply( tempQuaternion );\n\n                        if ( Math.abs( alignVector.copy( unitZ ).applyQuaternion( quaternion ).dot( this.eye ) ) > 0.9 ) {\n                            handle.visible = false;\n                        }\n\n                    }\n\n                    if ( this.axis === 'XYZE' ) {\n\n                        tempQuaternion.setFromEuler( tempEuler.set( 0, Math.PI / 2, 0 ) );\n                        alignVector.copy( this.rotationAxis );\n                        handle.quaternion.setFromRotationMatrix( lookAtMatrix.lookAt( zeroVector, alignVector, unitY ) );\n                        handle.quaternion.multiply( tempQuaternion );\n                        handle.visible = this.dragging;\n\n                    }\n\n                    if ( this.axis === 'E' ) {\n\n                        handle.visible = false;\n\n                    }\n\n\n                } else if ( handle.name === 'START' ) {\n\n                    handle.position.copy( this.worldPositionStart );\n                    handle.visible = this.dragging;\n\n                } else if ( handle.name === 'END' ) {\n\n                    handle.position.copy( this.worldPosition );\n                    handle.visible = this.dragging;\n\n                } else if ( handle.name === 'DELTA' ) {\n\n                    handle.position.copy( this.worldPositionStart );\n                    handle.quaternion.copy( this.worldQuaternionStart );\n                    tempVector.set( 1e-10, 1e-10, 1e-10 ).add( this.worldPositionStart ).sub( this.worldPosition ).multiplyScalar( -1 );\n                    tempVector.applyQuaternion( this.worldQuaternionStart.clone().inverse() );\n                    handle.scale.copy( tempVector );\n                    handle.visible = this.dragging;\n\n                } else {\n\n                    handle.quaternion.copy( quaternion );\n\n                    if ( this.dragging ) {\n\n                        handle.position.copy( this.worldPositionStart );\n\n                    } else {\n\n                        handle.position.copy( this.worldPosition );\n\n                    }\n\n                    if ( this.axis ) {\n\n                        handle.visible = this.axis.search( handle.name ) !== -1;\n\n                    }\n\n                }\n\n                // If updating helper, skip rest of the loop\n                continue;\n\n            }\n\n            // Align handles to current local or world rotation\n\n            handle.quaternion.copy( quaternion );\n\n            if ( this.mode === 'translate' || this.mode === 'scale' ) {\n\n                // Hide translate and scale axis facing the camera\n\n                var AXIS_HIDE_TRESHOLD = 0.99;\n                var PLANE_HIDE_TRESHOLD = 0.2;\n                var AXIS_FLIP_TRESHOLD = -0.4;\n\n\n                if ( handle.name === 'X' || handle.name === 'XYZX' ) {\n                    if ( Math.abs( alignVector.copy( unitX ).applyQuaternion( quaternion ).dot( this.eye ) ) > AXIS_HIDE_TRESHOLD ) {\n                        handle.scale.set( 1e-10, 1e-10, 1e-10 );\n                        handle.visible = false;\n                    }\n                }\n                if ( handle.name === 'Y' || handle.name === 'XYZY' ) {\n                    if ( Math.abs( alignVector.copy( unitY ).applyQuaternion( quaternion ).dot( this.eye ) ) > AXIS_HIDE_TRESHOLD ) {\n                        handle.scale.set( 1e-10, 1e-10, 1e-10 );\n                        handle.visible = false;\n                    }\n                }\n                if ( handle.name === 'Z' || handle.name === 'XYZZ' ) {\n                    if ( Math.abs( alignVector.copy( unitZ ).applyQuaternion( quaternion ).dot( this.eye ) ) > AXIS_HIDE_TRESHOLD ) {\n                        handle.scale.set( 1e-10, 1e-10, 1e-10 );\n                        handle.visible = false;\n                    }\n                }\n                if ( handle.name === 'XY' ) {\n                    if ( Math.abs( alignVector.copy( unitZ ).applyQuaternion( quaternion ).dot( this.eye ) ) < PLANE_HIDE_TRESHOLD ) {\n                        handle.scale.set( 1e-10, 1e-10, 1e-10 );\n                        handle.visible = false;\n                    }\n                }\n                if ( handle.name === 'YZ' ) {\n                    if ( Math.abs( alignVector.copy( unitX ).applyQuaternion( quaternion ).dot( this.eye ) ) < PLANE_HIDE_TRESHOLD ) {\n                        handle.scale.set( 1e-10, 1e-10, 1e-10 );\n                        handle.visible = false;\n                    }\n                }\n                if ( handle.name === 'XZ' ) {\n                    if ( Math.abs( alignVector.copy( unitY ).applyQuaternion( quaternion ).dot( this.eye ) ) < PLANE_HIDE_TRESHOLD ) {\n                        handle.scale.set( 1e-10, 1e-10, 1e-10 );\n                        handle.visible = false;\n                    }\n                }\n\n                // Flip translate and scale axis ocluded behind another axis\n\n                if ( handle.name.search( 'X' ) !== -1 ) {\n                    if ( alignVector.copy( unitX ).applyQuaternion( quaternion ).dot( this.eye ) < AXIS_FLIP_TRESHOLD ) {\n                        if ( handle.tag === 'fwd' ) {\n                            handle.visible = false;\n                        } else {\n                            handle.scale.x *= -1;\n                        }\n                    } else if ( handle.tag === 'bwd' ) {\n                        handle.visible = false;\n                    }\n                }\n\n                if ( handle.name.search( 'Y' ) !== -1 ) {\n                    if ( alignVector.copy( unitY ).applyQuaternion( quaternion ).dot( this.eye ) < AXIS_FLIP_TRESHOLD ) {\n                        if ( handle.tag === 'fwd' ) {\n                            handle.visible = false;\n                        } else {\n                            handle.scale.y *= -1;\n                        }\n                    } else if ( handle.tag === 'bwd' ) {\n                        handle.visible = false;\n                    }\n                }\n\n                if ( handle.name.search( 'Z' ) !== -1 ) {\n                    if ( alignVector.copy( unitZ ).applyQuaternion( quaternion ).dot( this.eye ) < AXIS_FLIP_TRESHOLD ) {\n                        if ( handle.tag === 'fwd' ) {\n                            handle.visible = false;\n                        } else {\n                            handle.scale.z *= -1;\n                        }\n                    } else if ( handle.tag === 'bwd' ) {\n                        handle.visible = false;\n                    }\n                }\n\n            } else if ( this.mode === 'rotate' ) {\n\n                // Align handles to current local or world rotation\n\n                tempQuaternion2.copy( quaternion );\n                alignVector.copy( this.eye ).applyQuaternion( tempQuaternion.copy( quaternion ).inverse() );\n\n                if ( handle.name.search( \"E\" ) !== - 1 ) {\n\n                    handle.quaternion.setFromRotationMatrix( lookAtMatrix.lookAt( this.eye, zeroVector, unitY ) );\n\n                }\n\n                if ( handle.name === 'X' ) {\n\n                    tempQuaternion.setFromAxisAngle( unitX, Math.atan2( -alignVector.y, alignVector.z ) );\n                    tempQuaternion.multiplyQuaternions( tempQuaternion2, tempQuaternion );\n                    handle.quaternion.copy( tempQuaternion );\n\n                }\n\n                if ( handle.name === 'Y' ) {\n\n                    tempQuaternion.setFromAxisAngle( unitY, Math.atan2( alignVector.x, alignVector.z ) );\n                    tempQuaternion.multiplyQuaternions( tempQuaternion2, tempQuaternion );\n                    handle.quaternion.copy( tempQuaternion );\n\n                }\n\n                if ( handle.name === 'Z' ) {\n\n                    tempQuaternion.setFromAxisAngle( unitZ, Math.atan2( alignVector.y, alignVector.x ) );\n                    tempQuaternion.multiplyQuaternions( tempQuaternion2, tempQuaternion );\n                    handle.quaternion.copy( tempQuaternion );\n\n                }\n\n            }\n\n            // Hide disabled axes\n            handle.visible = handle.visible && ( handle.name.indexOf( \"X\" ) === -1 || this.showX );\n            handle.visible = handle.visible && ( handle.name.indexOf( \"Y\" ) === -1 || this.showY );\n            handle.visible = handle.visible && ( handle.name.indexOf( \"Z\" ) === -1 || this.showZ );\n            handle.visible = handle.visible && ( handle.name.indexOf( \"E\" ) === -1 || ( this.showX && this.showY && this.showZ ) );\n\n            // highlight selected axis\n\n            handle.material._opacity = handle.material._opacity || handle.material.opacity;\n            handle.material._color = handle.material._color || handle.material.color.clone();\n\n            handle.material.color.copy( handle.material._color );\n            handle.material.opacity = handle.material._opacity;\n\n            if ( !this.enabled ) {\n\n                handle.material.opacity *= 0.5;\n                handle.material.color.lerp( new THREE.Color( 1, 1, 1 ), 0.5 );\n\n            } else if ( this.axis ) {\n\n                if ( handle.name === this.axis ) {\n\n                    handle.material.opacity = 1.0;\n                    handle.material.color.lerp( new THREE.Color( 1, 1, 1 ), 0.5 );\n\n                } else if ( this.axis.split('').some( function( a ) { return handle.name === a; } ) ) {\n\n                    handle.material.opacity = 1.0;\n                    handle.material.color.lerp( new THREE.Color( 1, 1, 1 ), 0.5 );\n\n                } else {\n\n                    handle.material.opacity *= 0.25;\n                    handle.material.color.lerp( new THREE.Color( 1, 1, 1 ), 0.5 );\n\n                }\n\n            }\n\n        }\n\n        THREE.Object3D.prototype.updateMatrixWorld.call( this );\n\n    };\n\n};\n\nTransformControlsGizmo.prototype = Object.assign( Object.create( THREE.Object3D.prototype ), {\n\n    constructor: TransformControlsGizmo,\n\n    isTransformControlsGizmo: true\n\n} );\n\n\nconst TransformControlsPlane = function () {\n\n\n    THREE.Mesh.call( this,\n        new THREE.PlaneBufferGeometry( 100000, 100000, 2, 2 ),\n        new THREE.MeshBasicMaterial( { visible: false, wireframe: true, side: THREE.DoubleSide, transparent: true, opacity: 0.1 } )\n    );\n\n    this.type = 'TransformControlsPlane';\n\n    var unitX = new THREE.Vector3( 1, 0, 0 );\n    var unitY = new THREE.Vector3( 0, 1, 0 );\n    var unitZ = new THREE.Vector3( 0, 0, 1 );\n\n    var tempVector = new THREE.Vector3();\n    var dirVector = new THREE.Vector3();\n    var alignVector = new THREE.Vector3();\n    var tempMatrix = new THREE.Matrix4();\n    var identityQuaternion = new THREE.Quaternion();\n\n    this.updateMatrixWorld = function() {\n\n        var space = this.space;\n\n        this.position.copy( this.worldPosition );\n\n        if ( this.mode === 'scale' ) space = 'local'; // scale always oriented to local rotation\n\n        unitX.set( 1, 0, 0 ).applyQuaternion( space === \"local\" ? this.worldQuaternion : identityQuaternion );\n        unitY.set( 0, 1, 0 ).applyQuaternion( space === \"local\" ? this.worldQuaternion : identityQuaternion );\n        unitZ.set( 0, 0, 1 ).applyQuaternion( space === \"local\" ? this.worldQuaternion : identityQuaternion );\n\n        // Align the plane for current transform mode, axis and space.\n\n        alignVector.copy( unitY );\n\n        switch ( this.mode ) {\n            case 'translate':\n            case 'scale':\n                switch ( this.axis ) {\n                    case 'X':\n                        alignVector.copy( this.eye ).cross( unitX );\n                        dirVector.copy( unitX ).cross( alignVector );\n                        break;\n                    case 'Y':\n                        alignVector.copy( this.eye ).cross( unitY );\n                        dirVector.copy( unitY ).cross( alignVector );\n                        break;\n                    case 'Z':\n                        alignVector.copy( this.eye ).cross( unitZ );\n                        dirVector.copy( unitZ ).cross( alignVector );\n                        break;\n                    case 'XY':\n                        dirVector.copy( unitZ );\n                        break;\n                    case 'YZ':\n                        dirVector.copy( unitX );\n                        break;\n                    case 'XZ':\n                        alignVector.copy( unitZ );\n                        dirVector.copy( unitY );\n                        break;\n                    case 'XYZ':\n                    case 'E':\n                        dirVector.set( 0, 0, 0 );\n                        break;\n                    default:\n                        break;\n                }\n                break;\n            case 'rotate':\n            default:\n                // special case for rotate\n                dirVector.set( 0, 0, 0 );\n        }\n\n        if ( dirVector.length() === 0 ) {\n\n            // If in rotate mode, make the plane parallel to camera\n            this.quaternion.copy( this.cameraQuaternion );\n\n        } else {\n\n            tempMatrix.lookAt( tempVector.set( 0, 0, 0 ), dirVector, alignVector );\n\n            this.quaternion.setFromRotationMatrix( tempMatrix );\n\n        }\n\n        THREE.Object3D.prototype.updateMatrixWorld.call( this );\n\n    };\n\n};\n\nTransformControlsPlane.prototype = Object.assign( Object.create( THREE.Mesh.prototype ), {\n\n    constructor: TransformControlsPlane,\n\n    isTransformControlsPlane: true\n\n} );\n\nexport default TransformControls\n","import {createGraphObjectFromObject, fetchGraphObject} from \"../../syncgraph/utils\";\nimport {\n    Group,\n    Mesh,\n    MeshLambertMaterial,\n    PlaneBufferGeometry\n} from 'three'\nimport {OBJ_TYPES, PROP_DEFS} from '../Common'\n\nlet COUNTER = 0\n\nfunction isAnchorType(type) {\n    if(type === OBJ_TYPES.geoanchor) return true\n    if(type === OBJ_TYPES.imageanchor) return true\n    if(type === OBJ_TYPES.hudanchor) return true\n    return false\n}\n\nexport default class SceneDef {\n    make(graph, root) {\n        if(!root.id) throw new Error(\"can't create scene w/ missing parent\")\n        return fetchGraphObject(graph,createGraphObjectFromObject(graph,{\n            type:'scene',\n            title:'Scene '+COUNTER++,\n            autoRecenter:true,\n            defaultFloor: false,\n            parent:root.id,\n            children:graph.createArray()\n        }))\n    }\n    makeNode(obj,provider) {\n        const scene = new Group()\n        scene.name = obj.title\n        this.setDefaultFloor(scene,obj.defaultFloor)\n        scene.start = () => {\n            scene.userData.sceneAnchor = new Group()\n            scene.userData.sceneAnchor.name = \"SceneAnchor\"\n            scene.add(scene.userData.sceneAnchor)\n            scene.children.forEach(chNode => {\n                const chObj = provider.accessObject(chNode.userData.graphid)\n                if(!chObj.exists()) return\n                if(isAnchorType(chObj.type)) return\n                if(chObj.type === OBJ_TYPES.geoanchor) return\n                if(chObj.type === OBJ_TYPES.imageanchor) return\n                scene.userData.sceneAnchor.add(chNode)\n            })\n        }\n        scene.stop = () => {\n            const toMove = scene.userData.sceneAnchor.children.slice()\n            toMove.forEach(chNode => scene.add(chNode))\n            scene.remove(scene.userData.sceneAnchor)\n        }\n        return scene\n    }\n\n    updateProperty(node, obj, op, provider) {\n        console.log(\"update property\",node.name,op.name,op.value)\n        if(op.name === PROP_DEFS.defaultFloor.key) {\n            console.log('setting the floor too',op.value)\n            this.setDefaultFloor(node,op.value)\n        }\n    }\n\n    setDefaultFloor(scene,val) {\n        if (val === true) {\n            const floor = new Mesh(\n                new PlaneBufferGeometry(100, 100, 10, 10),\n                new MeshLambertMaterial({color: 'blue'})\n            )\n            floor.name = 'defaultFloor'\n            floor.rotation.x = -90 * Math.PI / 180\n            scene.parts = {}\n            scene.parts.floor = floor\n            scene.add(floor)\n        } else {\n            if (scene.parts && scene.parts.floor) {\n                scene.remove(scene.parts.floor)\n                delete scene.parts.floor\n            }\n        }\n    }\n\n    getFloorPart(node) {\n        if(!node) return null\n        if(!node.parts) return null\n        return node.parts.floor\n    }\n\n}\n","import React, {Component} from 'react'\nimport * as ToasterManager from './ToasterManager'\n\nexport class ToasterNotification extends Component {\n    constructor(props) {\n        super(props)\n        this.state = {\n            notification:'saved',\n            visible:false\n        }\n    }\n\n    add = (payload) => {\n        this.setState({notification:payload, visible:true})\n        setTimeout(this.hide,2000)\n    }\n\n    hide = () => this.setState({visible:false})\n\n    componentWillMount() {\n        ToasterManager.onAdd(this.add)\n    }\n    componentWillUnmount() {\n        ToasterManager.offAdd(this.add)\n    }\n\n    render() {\n        return <div style={{\n            position:'absolute',\n            bottom:'10px',\n            left:'10px',\n            backgroundColor:'rgba(0,0,0,0.6)',\n            borderRadius:'1em',\n            color:'white',\n            fontSize:'24pt',\n            padding:'1em',\n            display:this.state.visible?'block':'none'\n        }}>{this.state.notification}</div>\n    }\n}\n","import {canHaveBehavior, TOTAL_OBJ_TYPES} from './Common'\nimport * as THREE from \"three\"\nimport WebLayer3D from 'three-web-layer'\nimport GPUParticles from './defs/GPUParticles'\nimport GLTFLoader from './GLTFLoader'\n\nexport class SceneGraphProvider {\n    //return the current scene. provider is in charge of tracking which scene is considered 'current'\n    //including the default scene when the project loads\n    getCurrentScene() { throw new Error(\"getCurrentScene not implemented\")}\n    getSceneObjects(scene) { throw new Error(\"getSceneObjects not implemented\")}\n    getBehaviorsForObject(obj) { throw new Error(\"getBehaviorsForObject(obj) not implemented\")}\n    //return threejs object for the id of the graph object\n    getThreeObject(id) { throw new Error(\"getThreeObject(id) not implemented\")}\n    getParsedBehaviorAsset(beh) { throw new Error(\"getParsedBehaviorAsset(behavior) not implemented\")}\n    getAllBehaviors() { throw new Error(\"getAllBehaviors() not implemented\")}\n    getAllScenes() { throw new Error(\"getAllScenes not implemented\")}\n\n    //navigate to the specified scene\n    navigateScene(id) { throw new Error(\"navigateScene(id) not implemented\")}\n\n    playMediaAsset(id) { throw new Error(\"playMediaAsset(id) not implemented\")}\n    stopMediaAsset(id) { throw new Error(\"stopMediaAsset(id) not implemented\")}\n    getGraphObjectByName(name) { throw new Error(\"getGraphObjectByName(name) not implemented\")}\n    getGraphObjectById(id) { throw new Error(\"getGraphObjectById(id) not implemented\")}\n    getCamera() { throw new Error(\"getCamera() not implemented\")}\n    getTweenManager() { throw new Error(\"getTweenManager() not implemented\")}\n    startImageRecognizer(info) { throw new Error(\"startImageRecognizer not implemented\")}\n    startGeoTracker(info) { throw new Error(\"startGeoTracker not implemented\")}\n    stopImageRecognizer(info) { throw new Error(\"stopImageRecognizer not implemented\")}\n    stopGeoTracker(info) { throw new Error(\"stopGeoTracker not implemented\")}\n}\n\nclass SystemFacade {\n\n    constructor(manager, sgp, behavior) {\n        this.manager = manager\n        this.sgp = sgp\n        this.logger = this.manager.logger\n        this.tween = sgp.getTweenManager()\n        this.camera = sgp.getCamera()\n        this.globalStorage = this.manager.storage\n        this.behavior = behavior\n    }\n\n    get globals () {\n        return {\n            THREE:THREE,\n            GLTFLoader: GLTFLoader,\n            GPUParticles: GPUParticles,\n            WebLayer3D: WebLayer3D\n        }\n    }\n\n    get properties () {\n        return this.behavior.props()\n    }\n    getThreeObjectByTitle(title) {\n        const obj = this.sgp.getGraphObjectByName(title)\n        if(!obj) throw new Error(`object '${title}' not found`)\n        return this.sgp.getThreeObject(obj)\n    }\n    getObjectByTitle(title) {\n        return this.sgp.getGraphObjectByName(title)\n    }\n    getAssetByTitle(title) {\n        const obj = this.sgp.getGraphObjectByName(title)\n        if(!obj) throw new Error(`asset '${title}' not found`)\n        let trusted = this._event && this._event.data && this._event.data.event && this._event.data.event.isTrusted\n        return new AssetFacade(this.manager,obj, trusted)\n    }\n    getObjectById(id) {\n        return this.sgp.getGraphObjectById(id)\n    }\n    getThreeObjectById(id) {\n        return this.sgp.getThreeObject(id)\n    }\n    playSound(id) {\n        this.playMedia(id)\n    }\n\n    playMedia(id) {\n        const asset = this.sgp.getGraphObjectById(id)\n        let trusted = this._event && this._event.data && this._event.data.event && this._event.data.event.isTrusted\n        this.manager.sgp.playMediaAsset(asset, trusted)\n    }\n\n    stopMedia(id) {\n        const asset = this.sgp.getGraphObjectById(id)\n        this.manager.sgp.stopMediaAsset(asset)\n    }\n\n    getCurrentScene() {\n        return this.sgp.getCurrentScene()\n    }\n    navigateScene(id) {\n        this.manager.fireSceneLifecycleEvent('exit',this.getCurrentScene())\n        this.sgp.navigateScene(id)\n        this.manager.fireSceneLifecycleEvent('enter',this.getCurrentScene())\n    }\n    fireEvent(type,payload,target=null) {\n        // this.manager.fireEventFromTarget(target,type,payload)\n        if (target == null) {\n            target = this.sgp.getGraphObjectById(this.behavior.parent)\n        }\n        this.manager.fireEventAtTarget(target,type,payload)\n    }\n    sendMessage(name,payload,target=null) {\n        if (target == null) {\n            target = this.sgp.getGraphObjectById(this.behavior.parent)\n        }\n        this.manager.fireMessageAtTarget(target,name,payload)\n    }\n    captureEvent() {\n        this.manager.captureEvent()\n    }\n}\n\nexport default class ScriptManager {\n    constructor(sceneGraphProvider, logger) {\n        this.sgp = sceneGraphProvider\n        this.logger = logger\n        this.running = false\n        this.storage = {}\n        this.logger = logger\n        this.logger.log(\"ScriptManager created\")\n        this.system_cache = {}\n\n        this.bubbling = true;\n\n        if (!window.THREE) window.THREE = THREE\n        if (!window.GLTFLoader) window.GLTFLoader = GLTFLoader\n        if (!window.GPUParticles) window.GPUParticles = GPUParticles\n        if (!window.WebLayer3D) window.WebLayer3D = WebLayer3D\n    }\n\n    makeSystemFacade(behavior) {\n        return new SystemFacade(this,this.sgp, behavior)\n    }\n\n    fireLifecycleEvent(type) {\n        this.logger.log(`doing ${type} event`)\n        const evt = {\n            type:type\n        }\n        this.sgp.getAllScenes().forEach(scene => {\n            scene.find(child => {\n                if(child.type === TOTAL_OBJ_TYPES.BEHAVIOR) {\n                    evt.target = this.sgp.getThreeObject(child.parent)\n                    evt.graphTarget = this.sgp.getGraphObjectById(child.parent)\n                    const asset = this.sgp.getParsedBehaviorAsset(child)\n                    const system = this.getSystemFacadeFromCache(child)\n                    if (asset[type]) asset[type].call(system,evt)\n                } else {\n                    evt.target = this.sgp.getThreeObject(child)\n                    evt.graphTarget = child\n                    if(evt.target && evt.target[type]) evt.target[type](evt, this)\n                }\n            })\n        })\n    }\n\n    fireSceneLifecycleEvent(type, scene, time) {\n        if(type!=='tick') this.logger.log(`doing ${type} event`)\n\n        const evt = {\n            type: type,\n            time: time ? time - this.startTime : -1,\n            deltaTime: time ? time - this.lastTime : 0,\n            session: this.session\n        }\n        if (time) {\n            this.lastTime = time\n        }\n        scene.find(child => {\n            if(type!=='tick') this.logger.log(`calling ${type} on ${child.type} ${child.id}`)\n            if(child.type === TOTAL_OBJ_TYPES.BEHAVIOR) {\n                evt.target = this.sgp.getThreeObject(child.parent)\n                evt.graphTarget = this.sgp.getGraphObjectById(child.parent)\n                //evt.props = child.props()\n                const asset = this.sgp.getParsedBehaviorAsset(child)\n                const system = this.getSystemFacadeFromCache(child)\n                if (asset[type]) asset[type].call(system,evt)\n                // if(asset[type]) asset[type](evt)\n            } else {\n                evt.target = this.sgp.getThreeObject(child)\n                evt.graphTarget = child\n                if(evt.target && evt.target[type]) {\n                    evt.target[type](evt, this)\n                }\n            }\n        })\n    }\n\n    tick(time, session) {\n        if(!this.running) return\n        if(this.startTime ===0) {\n            this.startTime = time\n            this.lastTime = time\n        }\n        try {\n            this.session = session\n            this.fireSceneLifecycleEvent('tick',this.sgp.getCurrentScene(),time)\n        } catch (err) {\n            this.logger.error(\"error in script\",err.message)\n            this.logger.log(err)\n            this.stopRunning()\n        }\n    }\n\n\n    startRunning() {\n        this.running = true\n        this.startTime = 0\n        this.lastTime = 0\n        this.storage = {}\n        this.logger.log(\"ScriptManager starting\")\n        try {\n            this.fireLifecycleEvent('start')\n        } catch(err) {\n            this.logger.error(\"error in script\",err.message)\n            this.logger.error(err)\n            this.stopRunning()\n        }\n    }\n\n    startFirstScene() {\n        try {\n            this.fireSceneLifecycleEvent('enter',this.sgp.getCurrentScene())\n        } catch(err) {\n            this.logger.error(\"error in script\",err.message)\n            this.logger.error(err)\n            this.stopRunning()\n        }\n    }\n    \n\n    stopRunning() {\n        try {\n            this.fireSceneLifecycleEvent('exit',this.sgp.getCurrentScene())\n            this.fireLifecycleEvent('stop')\n            this.running = false\n            this.storage = {}\n            this.destroyListeners()\n        } catch(err) {\n            this.running = false\n            this.logger.error(\"error stopping scripts\",err.message)\n            this.logger.error(err)\n        }\n        this.logger.log(\"script manager stopping\")\n    }\n    isRunning() {\n        return this.running\n    }\n\n    fireMessageAtTarget(target, name, payload) {\n        if(!this.running) return\n        try { \n            const evt = {\n                type: 'message',\n                name: name,\n                data: payload,\n                time: this.lastTime,\n                target: this.sgp.getThreeObject(target),\n                graphTarget: target,\n            }\n            const behaviors = this.sgp.getBehaviorsForObject(target)\n            behaviors.forEach(b => {\n                const system = this.getSystemFacadeFromCache(b)\n                const asset = this.sgp.getParsedBehaviorAsset(b)\n                system._event = evt   // want to be able to look for this later\n                if (asset.message) asset.message.call(system,evt)\n                system._event = null\n            })\n        } catch (error) {\n            this.logger.error(\"error in '\" + name + \"' message\",error.message)\n            this.logger.error(error)\n            this.stopRunning()\n        }\n    }\n\n    performClickAction(target, e) {\n        this.fireEventAtTarget(target, \"click\", {event: e})\n        // if(!this.running) return\n        // try {\n        //     this.logger.log(\"script manager, got a click event\",target)\n        //     if (!target || !target.exists || !target.exists()) return\n        //     const evt = {\n        //         type: 'click',\n        //         target: this.sgp.getThreeObject(target),\n        //         graphTarget: target\n        //     }\n        //     this.sgp.getBehaviorsForObject(target).forEach(b => {\n        //         const asset = this.sgp.getParsedBehaviorAsset(b)\n        //         const system = this.getSystemFacadeFromCache(b)\n        //         if (asset.click) asset.click.call(system,evt)\n        //     })\n        // } catch (error) {\n        //     this.logger.error(\"error in performClickAction\",error.message)\n        //     this.logger.error(error)\n        //     this.stopRunning()\n        // }\n    }\n\n    captureEvent() {\n        this.bubbling = false\n    }\n\n    fireEventAtTarget(target, type, payload) {\n        if(!this.running) return\n        try { \n            this.bubbling = true\n\n            const evt = {\n                type: type,\n                data: payload,\n                time: this.lastTime,\n                target: this.sgp.getThreeObject(target),\n                graphTarget: target,\n            }\n\n            let scene = this.sgp.getCurrentScene()\n            while (this.bubbling && target.id !== scene.id) {\n                const behaviors = this.sgp.getBehaviorsForObject(target)\n                //this.logger.log(\"firing \" + type + \" at target \" + target.id + \", \" + behaviors.length + \" behaviors\")\n\n                behaviors.forEach(b => {\n                    const system = this.getSystemFacadeFromCache(b)\n                    const asset = this.sgp.getParsedBehaviorAsset(b)\n                    system._event = evt\n                    if (asset[type]) {\n                        // this.logger.log(\"found message on behavior\")\n                        asset[type].call(system,evt)\n                    } else {\n                        // this.logger.log(\"didn't find message on behavior\")\n                    }\n                    system._event = null\n                })\n                target = this.sgp.getGraphObjectById(target.parent)\n            }\n        } catch (error) {\n            this.logger.error(\"error in '\" + type + \"' event\",error.message)\n            this.logger.error(error)\n            this.stopRunning()\n        }\n    }\n\n    destroyListeners() {\n        this.listeners = {}\n    }\n\n    on(target,type,cb) {\n        if(!this.listeners) this.listeners = {}\n        if(!this.listeners[target.id]) this.listeners[target.id] = {}\n        if(!this.listeners[target.id][type]) this.listeners[target.id][type] = []\n        this.listeners[target.id][type].push(cb)\n    }\n\n    // fireEventFromTarget(target, type, payload) {\n    //     if(!this.listeners) return\n    //     if(!this.listeners[target.id]) return\n    //     if(!this.listeners[target.id][type]) return\n    //     this.listeners[target.id][type].forEach(cb => cb(payload))\n    // }\n\n    getSystemFacadeFromCache(behavior) {\n        if(!this.system_cache[behavior.id]) {\n            this.system_cache[behavior.id] = this.makeSystemFacade(behavior)\n        }\n        return this.system_cache[behavior.id]\n    }\n}\n\n\nclass AssetFacade {\n    constructor(manager,obj, trusted) {\n        this.manager = manager\n        this.obj = obj\n        this.trusted = trusted\n    }\n    play() {\n        this.manager.sgp.playMediaAsset(this.obj, this.trusted)\n    }\n    stop() {\n        this.manager.sgp.stopMediaAsset(this.obj)\n    }\n}\nclass ThreeObjectFacade {\n    constructor(manager,obj) {\n        this.manager = manager\n        this._TYPE = 'ThreeObjectFacade'\n        this.obj = obj\n    }\n    get position() {\n        return this.manager.sgp.getThreeObject(this.obj).position\n    }\n    set position(val) {\n        this.manager.sgp.getThreeObject(this.obj).position.copy(val)\n    }\n\n    get rotation() {\n        return this.manager.sgp.getThreeObject(this.obj).rotation\n    }\n    get visible() {\n        return this.manager.sgp.getThreeObject(this.obj).visible\n    }\n    set visible(val) {\n        return this.manager.sgp.getThreeObject(this.obj).visible = val\n    }\n    lookAt(vec) {\n        return this.manager.sgp.getThreeObject(this.obj).lookAt(vec)\n    }\n}\n","import * as THREE from 'three'\n\nclass Tween {\n    constructor() {\n        this.running = false\n    }\n    update(time) {\n        throw new Error(\"update not implemented\")\n    }\n    start() {\n        this.running = true\n    }\n    isAlive() {\n        return this.running\n    }\n    kill() {\n        this.running = false\n    }\n}\n\nclass WaitTween extends Tween {\n    constructor(dur) {\n        super()\n        this.type = 'wait'\n        this.duration = dur\n    }\n    update(time) {\n        time = time/1000\n        if(!this.startTime) this.startTime = time\n        const diff = time - this.startTime\n        let t = diff/this.duration\n        if(t >= 1) {\n            this.running = false\n        }\n    }\n}\n\nclass ActionTween extends Tween {\n    constructor(fn) {\n        super()\n        this.type = 'action'\n        this.fn = fn\n    }\n    start() {\n        const res = this.fn()\n        this.running = false\n        return res\n    }\n}\n\nclass ForeverTween extends Tween {\n    constructor(fn) {\n        super()\n        this.type = 'forever'\n        this.fn = fn\n    }\n    start() {\n        this.running = true\n        this.startTime = Date.now()/1000\n    }\n    update(time) {\n        const diff = time/1000 - this.startTime\n        this.fn(diff)\n    }\n}\n\nexport const PROP_TYPES = {\n    SINGLE:'single',\n    COMPOUND:'compound',\n}\nexport const LERP_TYPES = {\n    LINEAR:'linear',\n    ELASTIC:'elastic'\n}\n\nfunction easeOutElastic(t) {\n    var p = 0.3;\n    return Math.pow(2,-10*t) * Math.sin((t-p/4)*(2*Math.PI)/p) + 1;\n}\nfunction easeLinear(from,to,t) {\n    return (to - from) * t + from\n}\nclass PropTween extends Tween {\n    constructor(opts) {\n        super()\n        this.type = 'prop'\n        this.target = opts.target\n        this.duration = opts.duration\n        if(typeof this.duration === 'undefined') throw new Error(\"duration is missing\")\n        this.property = opts.property\n        if(typeof this.property === 'undefined') throw new Error(\"property is missing\")\n        this.propertyType = opts.propertyType || PROP_TYPES.SINGLE\n        this.from = opts.from\n        this.to = opts.to\n        this.lerp_type = opts.lerpType || LERP_TYPES.LINEAR\n\n        this.loop = opts.loop\n        if(typeof this.loop === 'undefined') this.loop = 1\n        this.loopCount = 0\n        this.reversed = false\n        this.autoReverse = opts.autoReverse\n        if(typeof this.autoReverse === 'undefined') this.autoReverse = false\n    }\n    update(time) {\n        time = time/1000\n        if(!this.startTime) this.startTime = time\n        const diff = time - this.startTime\n\n        let t = diff/this.duration\n        if(t > 1.0) {\n            t = 1.0\n        }\n        this.setPropertyValue(this.from,this.to,t)\n        if(t === 1.0) {\n            this.loopCount++\n            if(this.autoReverse) {\n                this.reversed = !this.reversed\n            }\n            if(this.loop !== -1) {\n                if(this.loopCount >= this.loop) {\n                    this.running = false\n                    return\n                }\n            }\n            this.startTime = time\n        }\n    }\n\n    setPropertyValue(from,to,t,target,name) {\n        if(this.propertyType === PROP_TYPES.SINGLE) {\n            this.target[this.property] = this.lerp(this.from, this.to, this.reversed ? (1 - t) : t)\n        }\n        if(this.propertyType === PROP_TYPES.COMPOUND) {\n            Object.keys(this.from).forEach(name => {\n                this.target[this.property][name] = this.lerp(this.from[name], this.to[name], this.reversed ? (1 - t) : t)\n            })\n        }\n    }\n\n    lerp(from,to,t) {\n        if(this.lerp_type === LERP_TYPES.LINEAR)  return easeLinear(from,to,t)\n        if(this.lerp_type === LERP_TYPES.ELASTIC) return easeLinear(from,to,easeOutElastic(t))\n        console.log(\"invalid LERP_TYPE\")\n        return from\n    }\n}\n\nclass ClipTween extends Tween {\n    constructor(opts) {\n        super()\n        this.type = 'clip'\n        this.target = opts.target\n        this.name = opts.name\n        this.loop = opts.loop\n        this.autoReverse = opts.autoReverse\n        if(typeof this.autoReverse === 'undefined') this.autoReverse = false\n        if(typeof this.loop === 'undefined') this.loop = 1\n        if(typeof this.name === 'undefined') throw new Error(\"name is missing\")\n        this.speed = opts.speed\n        if(typeof this.speed === 'undefined') this.speed = 1\n    }\n    start() {\n        this.running = true\n        this.mixer = new THREE.AnimationMixer(this.target.scene)\n        this.action = this.mixer.clipAction(THREE.AnimationClip.findByName(this.target.animations,this.name))\n        if(this.loop === 1) {\n            this.action.setLoop(THREE.LoopOnce, 1)\n        }\n        if(this.loop === -1) {\n            this.action.setLoop(this.autoReverse?THREE.LoopPingPong:THREE.LoopRepeat, Infinity)\n        }\n        if(this.loop > 1) {\n            this.action.setLoop(THREE.LoopRepeat, this.loop)\n        }\n        this.action.play()\n        this.action.setEffectiveTimeScale(this.speed)\n        this.startTime = Date.now()/1000\n        this.prevTime = this.startTime\n    }\n    update(time) {\n        const diff = time/1000 - this.prevTime\n        this.mixer.update(diff)\n        this.prevTime = time/1000\n    }\n    kill() {\n        this.action.stop()\n        this.running = false\n    }\n}\n\nclass ParallelTween extends Tween {\n    constructor() {\n        super()\n        this.subs = []\n    }\n    and(obj) {\n        if(obj instanceof Tween) {\n            this.subs.push(obj)\n        } else {\n            this.subs.push(new ActionTween(obj))\n        }\n        return this\n    }\n    start() {\n        // console.log(\"starting parallel\")\n        this.running = true\n        this.subs.forEach(s=>s.start())\n        // console.log('started')\n        // console.log(this.subs)\n        return this\n    }\n    update(time) {\n        this.subs.forEach(s => {\n            if(s.isAlive()) s.update(time)\n        })\n    }\n    isAlive() {\n        const first = this.subs.find(s => s.isAlive() === true)\n        // console.log(\"first alive is\",first)\n        return first !== undefined\n    }\n}\n\nclass SequentialTween extends Tween {\n    constructor() {\n        super()\n        this.subs = []\n        this.n = -1\n    }\n    then(obj) {\n        if(obj instanceof Tween) {\n            this.subs.push(obj)\n        } else {\n            this.subs.push(new ActionTween(obj))\n        }\n        return this\n    }\n    wait(dur) {\n        this.subs.push(new WaitTween(dur))\n        return this\n    }\n    start() {\n        this.running = true\n        this._startNext()\n        return this\n    }\n    _startNext() {\n        this.n = this.n + 1\n\n        //if at the end of everything\n        if(this.n > this.subs.length-1) {\n            this.running = false\n            this.n = -1\n            return null\n        }\n\n\n        const cur = this.subs[this.n]\n        const res = cur.start()\n        if(!cur.isAlive()) {\n            if(res) {\n                console.log(\"the next swapped itself\", res)\n                //swap in the result\n                this.subs[this.n] = res\n                //backup\n                this.n = this.n -1\n                //recurse\n                return this._startNext()\n            } else {\n                // console.log(\"the next didn't swap. just move on\")\n                return this._startNext()\n            }\n        }\n        return cur\n    }\n    update(time) {\n        // console.log('updating')\n        const cur = this.subs[this.n]\n        cur.update(time)\n        // console.log(\"updated cur\",cur, cur.isAlive())\n        if(!cur.isAlive()) this._startNext()\n\n    }\n    isAlive() {\n        const first = this.subs.find(s => s.isAlive() === true)\n        // console.log(\"first alive is\",first)\n        // console.log(this.subs)\n        return first !== undefined\n    }\n}\n\nexport class TweenManager {\n    constructor() {\n        this.subs = []\n    }\n    parallel() {\n        const t = new ParallelTween()\n        this.subs.push(t)\n        return t\n    }\n    sequence() {\n        const t =  new SequentialTween()\n        this.subs.push(t)\n        return t\n    }\n    action(fn) {\n        const t = new ActionTween(fn)\n        this.subs.push(t)\n        return t\n    }\n    prop(opts) {\n        const t = new PropTween(opts)\n        this.subs.push(t)\n        return t\n    }\n    isAlive() {\n        return this.subs.find((s => s.isAlive() === true))\n    }\n    update(time) {\n        const now = Date.now()\n        this.subs.forEach(s => {\n            if(s.isAlive()) s.update(now)\n        })\n    }\n    forever(fn) {\n        const t = new ForeverTween(fn)\n        this.subs.push(t)\n        return t\n    }\n    clip(opts) {\n        const t = new ClipTween(opts)\n        this.subs.push(t)\n        return t\n    }\n    wait(dur) {\n        const t = new WaitTween(dur)\n        this.subs.push(t)\n        return t\n    }\n}\n\n/*\n\nconst obj = { x: -1, y: -1, z: 0, w: 0}\n\nconst para = t2.parallel()\n    .and(t2.prop({ target:obj, property:'x', from:10, to:0, duration: 1}))\n    .and(()=>console.log(\"inside the parallel action\"))\n    .start()\n\nconst seq = t2.sequence()\n    .then(()=>console.log(\"first is an action\"))\n    .then(t2.prop({ target:obj, property:'y', from:10, to:0, duration: 1}))\n    .then(()=> console.log(\"inside the sequential action\"))\n    .then(t2.prop({target:obj, property:'y', from:0, to:10, duration:1 }))\n    .then(()=>{\n        console.log(\"done with part 1. calculating part 2\")\n        return t2.prop({target:obj, property:'x', from: 0, to:-8, duration:1})\n    })\n    .then(() => {\n        console.log(\"now we're going to insert a new parallel tween\")\n        return t2.parallel()\n            .and(t2.prop({target:obj, property:'z', from:-1,to:1, duration:1}))\n            .and(t2.prop({target:obj, property:'w', from:-1,to:1, duration:1}))\n    })\n    .start()\n\nfunction update() {\n    console.log(\"tick\")\n    t2.update()\n    console.log(obj)\n    if(t2.isAlive()) {\n        setTimeout(update,250)\n    } else {\n        console.log(\"done with everything. check it out!\")\n        console.log(obj.z === 1)\n    }\n}\nupdate()\n*/\n","import {toFlatString} from '../utils'\nimport * as ToasterManager from './ToasterManager'\nimport * as mat4 from 'gl-matrix/src/gl-matrix/mat4'\nimport * as vec3 from 'gl-matrix/src/gl-matrix/vec3'\n\nlet Cesium = window.Cesium\nlet XRGeospatialAnchor = window.XRGeospatialAnchor\n\nexport class XRSupport {\n    constructor() {\n        this.imageDetectorMap = {}\n        this.geoAnchorMap = {}\n        this._workingMatrix = mat4.create()\n        this._identity = mat4.create()\n        this._vec = vec3.create()\n        this.lastFrameTime = 0\n        \n    }\n    static supportsARKit() {\n        if (navigator.xr && navigator.xr._mozillaXRViewer) {\n            console.log(\"*** Found mozilla xr viewer\")\n            return true\n        }\n        console.log(\"*** Did not find WebXR\")\n        return false\n    }\n\n    getContext(canvas = 0) {\n        this.device = 0\n        this.session = 0\n        this.xrCanvas = 0\n        this.xrContext = 0\n        this.canvas = canvas\n        this.context = 0\n        this.xrCanvas = document.createElement('canvas')\n        this.xrContext = this.xrCanvas.getContext('xrpresent')\n        this._anchoredNodes = new Map() // { XRAnchorOffset, Three.js Object3D }\n\n        let that = this\n        let prom = new Promise((resolve, reject) => {\n            // document.body.insertBefore(this.xrCanvas, document.body.firstChild) <- not needed?\n            navigator.xr.requestDevice().then((xrDevice) => {\n                that.device = xrDevice\n                that.device.requestSession({\n                    outputContext: that.xrContext,\n                    alignEUS: true,\n                    geolocation: true,\n                    worldSensing: true\n                }).then((xrSession) => {\n                    that.session = xrSession\n\n                    // we want to always use the estimated elevation\n                    XRGeospatialAnchor.useEstimatedElevation(true)\n\n                    // enable smooth tracking of image targets\n                    that.session.nonStandard_setNumberOfTrackedImages(4)\n\n                    if (!that.canvas) that.canvas = document.createElement('canvas')\n                    if (!that.context) that.context = that.canvas.getContext('webgl', {compatibleXRDevice: that.device})\n                    that.session.baseLayer = new window.XRWebGLLayer(that.session, that.context)\n                    resolve(that.context)\n                }).catch(err => {\n                    console.error('Session setup error', err)\n                    reject()\n                })\n            }).catch(err => {\n                console.error('Error', err)\n                reject()\n            })\n        })\n        return prom\n    }\n\n    setAnimationLoop(userAnimationCallback) {\n\n        if (!userAnimationCallback) {\n            console.error(\"Supply a callback\")\n            return\n        }\n\n        // head-model is the coordinate system that tracks the position of the display\n        this.session.requestFrameOfReference('head-model').then(frameOfReference => {\n            this.headFrameOfReference = frameOfReference\n        }).catch(err => {\n            console.error('Error finding head frame of reference', err)\n        })\n\n        // get eye level which is somehow different from head level?\n        this.session.requestFrameOfReference('eye-level').then(frameOfReference => {\n            this.eyeLevelFrameOfReference = frameOfReference\n        }).catch(err => {\n            console.error('Error finding eye frame of reference', err)\n        })\n\n        // setup callback\n        this.userAnimationCallback = userAnimationCallback\n        this.__handleAnimationFrame = this._handleAnimationFrame.bind(this)\n        this.session.requestAnimationFrame(this.__handleAnimationFrame)\n    }\n\n    _handleAnimationFrame(time = 0, frame = 0) {\n        this.lastFrameTime = time\n        if (!this.session || this.session.ended) return\n\n        this.session.requestAnimationFrame(this.__handleAnimationFrame)\n\n        if (!this.headFrameOfReference || !this.eyeLevelFrameOfReference) return\n\n        let pose = frame.getDevicePose(this.eyeLevelFrameOfReference)\n        if (!pose) {\n            console.log('No pose')\n            return\n        }\n\n        for (let view of frame.views) {\n            this.userAnimationCallback(\n                this.session.baseLayer.getViewport(view),\n                view.projectionMatrix,\n                pose.getViewMatrix(view),\n                time,frame,\n            )\n            break\n        }\n    }\n\n    getTime() { return this.lastFrameTime }\n\n    addAnchoredNode(anchor, node, logger) {\n        if (!anchor || !anchor.uid) {\n            console.error(\"not a valid anchor\", anchor)\n            logger.error(`not a valid anchor ${toFlatString(anchor)}`)\n            return\n        }\n        this._anchoredNodes.set(anchor.uid, {\n            anchor: anchor,\n            node: node\n        })\n        node.anchor = anchor\n        node.matrixAutoUpdate = false\n        node.matrix.fromArray(anchor.modelMatrix)\n        node.updateMatrixWorld(true)\n        //this._scene.add(node) -> presumably this is already done\n\n        anchor._handleAnchorUpdateCallback = this._handleAnchorUpdate.bind(this, logger)\n        anchor._handleAnchorDeleteCallback = this._handleAnchorDelete.bind(this, logger)\n\n        anchor.addEventListener(\"update\", anchor._handleAnchorUpdateCallback)\n        anchor.addEventListener(\"removed\", anchor._handleAnchorDeleteCallback)\n        logger.log(\"done adding anchored node\")\n        return node\n    }\n\n    async createSceneAnchor(sceneNode, logger) {\n        logger.log(\"Creating Scene Anchor\")\n\n        if (!this.session) {\n            logger.log(\"no session\")\n            return\n        }\n        let eyeLevel = await this.session.requestFrameOfReference('eye-level')\n        let headLevel = await this.session.requestFrameOfReference('head-model')\n\n        // get the pose of the camera in the world\n        headLevel.getTransformTo(eyeLevel, this._workingMatrix)\n\n        // get just the position\n        mat4.getTranslation(this._vec, this._workingMatrix) \n\n        // set the matrix to just the position, which means the orientation is EUS\n        mat4.fromTranslation(this._workingMatrix, this._vec)\n\n        // create that anchor\n        let newAnchor = await this.session.addAnchor(this._workingMatrix, eyeLevel)\n\n        this.addAnchoredNode(newAnchor, sceneNode, logger)\n        return newAnchor\n    }\n\n    updateAnchoredSceneNode(sceneAnchor, sceneNode, logger) {\n        logger.log(\"Replacing the scene node on the existing scene anchor\")\n        this._removeAnchorFromNode(sceneAnchor)\n        this.addAnchoredNode(sceneAnchor, sceneNode, logger)\n    }\n\n    removeSceneAnchor(sceneAnchor, logger) {\n        logger.log(\"Removing Scene Anchor\")\n        this.session.removeAnchor(sceneAnchor)\n        this._removeAnchorFromNode(sceneAnchor)\n    }\n\n    _fetchImage(info,logger) {\n        return new Promise((res,rej) => {\n            const img = new Image()\n            img.crossOrigin = \"Anonymous\"\n            img.src = info.image.src\n            logger.log(\"Loading image\",img.src)\n            img.onload = () => {\n                res(img)\n            }\n        })\n    }\n\n    createDetectionImage(info, logger) {\n        logger.log(\"creating/find an image recognizer\")\n        return new Promise((res,rej) => {            \n            if (!info.image || !info.node) {\n                logger.log(\"createDetectionImage: missing image or threejs node\")\n                rej(\"createDetectionImage: missing image or threejs node\")\n                return\n            }\n\n            if (!this.session) {\n                logger.log(\"no session\")\n                rej(\"no session\")\n                return\n            }\n\n            let imageRealworldWidth = info.imageRealworldWidth || 1\n\n            if (this.imageDetectorMap[info.image.src]) {\n                let det = this.imageDetectorMap[info.image.src]\n                if (imageRealworldWidth != det.realWorldWidth) {\n                    logger.log(\"can't create the same image with different real world width\")\n                    rej(\"can't create the same image with different real world width\")\n                    return\n                }\n                logger.log(\"createDetectionImage: already created, returning it\")\n                res(det.name)\n                return\n            }\n\n            this._fetchImage(info,logger).then(image => {\n                logger.log(\"got the image\",toFlatString(image))\n    \n                //info contains\n                // * callback: to call when the image is found\n                // * image: info about the image to recognize. src is at image.src\n                // * imageRealworldWidth: width of the image in meters\n                // * object: the anchor object\n                // * node: the ThreeJS group which represents the anchor. It should be updated as the scene changes\n                // * recType: current set to SCENE_START, meaning we should recognize as soon as the scene starts up\n    \n        \n                // random name from https://gist.github.com/6174/6062387\n                let name = [...Array(10)].map(i => (~~(Math.random() * 36)).toString(36)).join('')\n        \n                // Get ImageData\n                let canvas = document.createElement('canvas')\n                let context = canvas.getContext('2d')\n                canvas.width = image.width\n                canvas.height = image.height\n        \n                context.drawImage(image, 0, 0)\n                let idata\n                try {\n                    idata = context.getImageData(0, 0, image.width, image.height)\n                } catch (e) {\n                    logger.log(`error drawing image ${toFlatString(e)}`)\n                    logger.log(`name ${e.name}`)\n                    logger.log(`name ${e.message}`)\n                    logger.log(\"local url is \" + document.documentURI)\n                    logger.log(\"image url from \" + image.src)\n                    ToasterManager.add(\"error drawing image\", e.toString())\n                    rej( new Error(\"foo\"))\n                }\n                logger.log(`calling createDetectionImage with image width and height ${image.width} ${image.height}`)\n        \n                // Attach image observer handler\n                this.session.nonStandard_createDetectionImage(name, idata.data, image.width, image.height, imageRealworldWidth).then(() => {\n                    this.imageDetectorMap[info.image.src] = {\n                        name: name,\n                        realWorldWidth: imageRealworldWidth,\n                        anchor: null\n                    }\n                    res(name)\n                }).catch(error => {\n                    logger.error(`error creating detection image: ${error}`)\n                    rej(error)\n                })\n            }).catch(error => {\n                logger.error(`error creating detection image: ${error}`)\n                rej(error)\n            })\n        })\n    }\n\n    startImageRecognizer(info, name, logger) {\n        logger.log(\"starting Image Recognizer\")\n\n        if (!info.image || !info.node) {\n            logger.log(\"missing image or threejs node\")\n            return\n        }\n\n        if (!this.session) {\n            logger.log(\"no session\")\n            return\n        }\n\n        //info contains\n        // * callback: to call when the image is found\n        // * image: info about the image to recognize. src is at image.src\n        // * imageRealworldWidth: width of the image in meters\n        // * object: the anchor object\n        // * node: the ThreeJS group which represents the anchor. It should be updated as the scene changes\n        // * recType: current set to SCENE_START, meaning we should recognize as soon as the scene starts up\n\n        let callback = info.callback\n\n        let node = info.node\n        let recType = 0 // unused. currently set to SCENE_START -> meaning we should recognize as soon as the scene starts up\n\n        if (!this.imageDetectorMap[info.image.src]) {\n            logger.error(\"not detection object for image\", info.image.src)\n            return\n        }\n\n        let det = this.imageDetectorMap[info.image.src]\n\n        // there is already an anchor tracking this image, either from this\n        // scene or another\n        if (det.anchor) {\n            if (info.reactivate) {\n                logger.log(\"Found existing anchor: reactivate\")\n                // we want to reactivate.  So destroy the anchor, remove it from\n                // the node it was tracking, and continue below to reactivate\n                this.session.removeAnchor(det.anchor)\n                logger.log(\"remove from previous node\")\n                this._removeAnchorFromNode(det.anchor)\n                det.anchor = null\n            } else {\n                logger.log(\"Found existing anchor: use it\")\n                // we want to reuse, likely from some previous scene.\n                // So, remove the relationship to whatever node is in the \n                // anchor map, and reset it to this node.   \n                logger.log(\"remove from previous node\")\n                this._removeAnchorFromNode(det.anchor)\n                logger.log(\"add our node\")\n                this.addAnchoredNode(det.anchor, node, logger)\n                if (callback) {\n                    callback(info)\n                }\n                return\n            }\n        } \n\n        node.anchorName = null\n        logger.log(\"activate detection image\")\n        this.session.nonStandard_activateDetectionImage(det.name).then(anchor => {\n            logger.log(\"found detection image\")\n            // this gets invoked after the image is seen for the first time\n            node.anchorName = name\n            node.anchorStyle = \"image\"\n            this.addAnchoredNode(anchor, node, logger)\n            if (callback) {\n                callback(info)\n            }\n        }).catch(error => {\n            logger.error(`error activating detection image: ${error}`)\n        })\n    }\n\n    stopImageRecognizer(info, logger) {\n        console.log(\"Stopping image recognizer\")\n        if(!this._anchoredNodes) return\n\n        if (!this.imageDetectorMap[info.image.src]) {\n            logger.error(\"no detection object for image\", info.image.src)\n            return\n        }\n\n        let det = this.imageDetectorMap[info.image.src]\n\n        if (det.anchor) {\n            console.log(\"already found the image, removing it\")\n            this._removeAnchorFromNode(det.anchor)\n            det.anchor = null\n        }\n\n        console.log(\"deactivating the image\")\n        this.session.nonStandard_deactivateDetectionImage(det.name).then(() => {\n        }).catch(error => {\n            logger.error(`error deactivating detection image: ${error}`)\n        })\n    }\n\n\n    createGeoAnchor(info, logger) {        \n        logger.log(\"creating or reusing a geospatial anchor\")\n        return new Promise((res,rej) => {            \n            if (!info.node) {\n                logger.log(\"Missing threejs node\")\n                rej(\"Missing threejs node\")\n                return\n            }\n\n            if (!this.session) {\n                logger.log(\"no session\")\n                rej(\"no session\")\n                return\n            }\n\n            if (this.geoAnchorMap[info.location.id]) {\n                let det = this.geoAnchorMap[info.location.id]\n                logger.log(\"found geoanchor: already created, returning it\")\n                res()\n                return\n            }\n\n            /*\n            info contains\n            location:  a geo location asset, has properties for latitude, longitude, altitude, useAltitude\n            recType: the recognition type. for now always SCENE_START\n            object: the anchor object. It reresents the anchor in the 3D scene. has tx,ty,tz, rotation, etc.\n            node: the actual ThreeJS object that mirrors the propertites of the `object` above\n            callback: a function to be called once the geo anchor is recognized. By default this callback will fire a 'recognized' event and make the anchor visible in the scene\n            */\n\n            let location = info.location\n            let object = info.object // object that represents anchor variables that users can edit in general-editor\n            let node = info.node\n            let recType = 0 // unused. currently set to SCENE_START -> meaning we should recognize as soon as the scene starts up\n\n            // As a slight hack, look for any non zero value in latitude or longitude as a hint to not use your current location\n\n            // these values are 0 by default, we need to change at least one of them by a bit!\n            if (location.latitude != 0 || location.longitude != 0) {\n                // use supplied altitude?\n\n                let lla = new Cesium.Cartographic(location.longitude * Math.PI / 180, location.latitude * Math.PI / 180, location.altitude)\n\n                if (location.useAltitude) {\n                    logger.log(\"XRGeoAnchor: Placing an object at specified lla and specified altitude\")\n                    logger.log(toFlatString(lla))\n                    XRGeospatialAnchor.createGeoAnchor(lla).then(anchor => {\n                        this.geoAnchorMap[info.location.id] = {\n                            anchor: anchor\n                        }\n                        res()\n                        return;\n                    }).catch(error => {\n                        logger.error(`error creating geospatial anchor: ${error}`)\n                        rej(error)\n                    })\n                } else {\n                    XRGeospatialAnchor.getDefaultElevation(lla).then(altitude => {\n                        lla.height = altitude\n                        logger.log(\"XRGeoAnchor: Placing an object at specified lla and estimated altitude\")\n                        logger.log(toFlatString(lla))\n                        XRGeospatialAnchor.createGeoAnchor(lla).then(anchor => {\n                            this.geoAnchorMap[info.location.id] = {\n                                anchor: anchor\n                            }\n                            res()\n                            return;\n                        }).catch(error => {\n                            logger.error(`error creating geospatial anchor: ${error}`)\n                            rej(error)\n                        })\n                    }).catch(error => {\n                        logger.error(`error getting default elevation: ${error}`)\n                        rej(error)\n                    })\n                }\n            }\n\n            // else find current position and altitude\n            else {\n                XRGeospatialAnchor.getDeviceCartographic().then(cartographic => {\n                    // probably don't need to explicitly do this, but to be safe ...\n                    XRGeospatialAnchor.getDefaultElevation().then(altitude => {\n                        let lla = new Cesium.Cartographic(cartographic.longitude, cartographic.latitude, altitude)\n                        logger.log(\"XRGeoAnchor: Placing an object at your lla\")\n                        logger.log(toFlatString(lla))\n                        XRGeospatialAnchor.createGeoAnchor(lla).then(anchor => {\n                            this.geoAnchorMap[info.location.id] = {\n                                anchor: anchor\n                            }\n                            res()\n                            return;\n                        }).catch(error => {\n                            logger.error(`error creating geospatial anchor: ${error}`)\n                            rej(error)\n                        })\n                    }).catch(error => {\n                        logger.error(`error getting default elevation: ${error}`)\n                        rej(error)\n                    })\n                }).catch(error => {\n                    logger.error(`error getting device cartographic location: ${error}`)\n                    rej(error)\n                })\n            }\n        })\n    }\n\n\n    addGeoAnchoredNode(info, logger) {\n        logger.log(\"adding a geotracked node\")\n\n        if (!info.node) {\n            logger.log(\"Missing threejs node\")\n            return\n        }\n\n        if (!this.session) {\n            logger.log(\"no session\")\n            return\n        }\n\n        if (!this.geoAnchorMap[info.location.id]) {\n            logger.error(\"not geolocation anchor for object\", info.location.id)\n            return\n        }\n\n        let det = this.geoAnchorMap[info.location.id]\n\n        /*\n        info contains\n         location:  a geo location asset, has properties for latitude, longitude, altitude, useAltitude\n         recType: the recognition type. for now always SCENE_START\n         object: the anchor object. It reresents the anchor in the 3D scene. has tx,ty,tz, rotation, etc.\n         node: the actual ThreeJS object that mirrors the propertites of the `object` above\n         callback: a function to be called once the geo anchor is recognized. By default this callback will fire a 'recognized' event and make the anchor visible in the scene\n         */\n\n        let callback = info.callback\n        let node = info.node\n        let recType = 0 // unused. currently set to SCENE_START -> meaning we should recognize as soon as the scene starts up\n\n\n        this._removeAnchorFromNode(det.anchor)\n        logger.log(\"add our node\")\n        this.addAnchoredNode(det.anchor, node, logger)\n        if (callback) {\n            callback(info)\n        }\n    }\n\n    /// BLAIR:  Need a way to destroy geo Anchors!\n    stopGeoTracker(info, logger) {\n        // info.node may be destroyed before we get here\n        if (info && info.node) {\n            this._removeAnchorForNode(info.node)\n        }\n    }\n\n    _handleAnchorDelete(logger, details) {\n        logger.log(\"delete anchor\")\n        let anchor = details.source\n        this._removeAnchorFromNode(anchor)\n    }\n\n    _removeAnchorForNode(node) {\n        this._anchoredNodes.forEach( (value) => {\n            if(value.node == node) {\n                this._removeAnchorFromNode(node.anchor)\n                return\n            }\n        })\n    }\n\n    _removeAnchorFromNode(anchor) {\n        const anchoredNode = this._anchoredNodes.get(anchor.uid)\n        if (anchoredNode) {\n            const node = anchoredNode.node\n            node.anchor = null\n\n            anchor.removeEventListener(\"update\", anchor._handleAnchorUpdateCallback)\n            anchor.removeEventListener(\"removed\", anchor._handleAnchorDeleteCallback)\n            anchor._handleAnchorUpdateCallback = null\n            anchor._handleAnchorDeleteCallback = null\n\n            // NOTIFY SOMEBODY? TODO\n            this._anchoredNodes.delete(anchor.uid)\n        }\n    }\n\n    _handleAnchorUpdate(logger, details) {\n        // logger.log(\"anchor update\")\n        const anchor = details.source\n        const anchoredNode = this._anchoredNodes.get(anchor.uid)\n        if (anchoredNode) {\n            const node = anchoredNode.node\n            node.matrixAutoUpdate = false\n            node.matrix.fromArray(anchor.modelMatrix)\n            node.updateMatrixWorld(true)\n        }\n    }\n\n}","const THREE = require('three');//requireimport * as THREE from 'three'\n\n/**\n * @author qiao / https://github.com/qiao\n * @author mrdoob / http://mrdoob.com\n * @author alteredq / http://alteredqualia.com/\n * @author WestLangley / http://github.com/WestLangley\n * @author erich666 / http://erichaines.com\n */\n\n// This set of controls performs orbiting, dollying (zooming), and panning.\n// Unlike TrackballControls, it maintains the \"up\" direction object.up (+Y by default).\n//\n//    Orbit - left mouse / touch: one finger move\n//    Zoom - middle mouse, or mousewheel / touch: two finger spread or squish\n//    Pan - right mouse, or arrow keys / touch: three finger swipe\n\nconst OrbitControls = function ( object, domElement ) {\n\n    this.object = object;\n\n    this.domElement = ( domElement !== undefined ) ? domElement : document;\n\n    // Set to false to disable this control\n    this.enabled = true;\n\n    // \"target\" sets the location of focus, where the object orbits around\n    this.target = new THREE.Vector3();\n\n    // How far you can dolly in and out ( PerspectiveCamera only )\n    this.minDistance = 0;\n    this.maxDistance = Infinity;\n\n    // How far you can zoom in and out ( OrthographicCamera only )\n    this.minZoom = 0;\n    this.maxZoom = Infinity;\n\n    // How far you can orbit vertically, upper and lower limits.\n    // Range is 0 to Math.PI radians.\n    this.minPolarAngle = 0; // radians\n    this.maxPolarAngle = Math.PI; // radians\n\n    // How far you can orbit horizontally, upper and lower limits.\n    // If set, must be a sub-interval of the interval [ - Math.PI, Math.PI ].\n    this.minAzimuthAngle = - Infinity; // radians\n    this.maxAzimuthAngle = Infinity; // radians\n\n    // Set to true to enable damping (inertia)\n    // If damping is enabled, you must call controls.update() in your animation loop\n    this.enableDamping = false;\n    this.dampingFactor = 0.25;\n\n    // This option actually enables dollying in and out; left as \"zoom\" for backwards compatibility.\n    // Set to false to disable zooming\n    this.enableZoom = true;\n    this.zoomSpeed = 1.0;\n\n    // Set to false to disable rotating\n    this.enableRotate = true;\n    this.rotateSpeed = 1.0;\n\n    // Set to false to disable panning\n    this.enablePan = true;\n    this.keyPanSpeed = 7.0;\t// pixels moved per arrow key push\n\n    // Set to true to automatically rotate around the target\n    // If auto-rotate is enabled, you must call controls.update() in your animation loop\n    this.autoRotate = false;\n    this.autoRotateSpeed = 2.0; // 30 seconds per round when fps is 60\n\n    // Set to false to disable use of the keys\n    this.enableKeys = true;\n\n    // The four arrow keys\n    this.keys = { LEFT: 37, UP: 38, RIGHT: 39, BOTTOM: 40 };\n\n    // Mouse buttons\n    this.mouseButtons = { ORBIT: THREE.MOUSE.LEFT, ZOOM: THREE.MOUSE.MIDDLE, PAN: THREE.MOUSE.RIGHT };\n\n    // for reset\n    this.target0 = this.target.clone();\n    this.position0 = this.object.position.clone();\n    this.zoom0 = this.object.zoom;\n\n    //\n    // public methods\n    //\n\n    this.getPolarAngle = function () {\n\n        return spherical.phi;\n\n    };\n\n    this.getAzimuthalAngle = function () {\n\n        return spherical.theta;\n\n    };\n\n    this.saveState = function () {\n\n        scope.target0.copy( scope.target );\n        scope.position0.copy( scope.object.position );\n        scope.zoom0 = scope.object.zoom;\n\n    };\n\n    this.reset = function () {\n\n        scope.target.copy( scope.target0 );\n        scope.object.position.copy( scope.position0 );\n        scope.object.zoom = scope.zoom0;\n\n        scope.object.updateProjectionMatrix();\n        scope.dispatchEvent( changeEvent );\n\n        scope.update();\n\n        state = STATE.NONE;\n\n    };\n\n    // this method is exposed, but perhaps it would be better if we can make it private...\n    this.update = function () {\n\n        var offset = new THREE.Vector3();\n\n        // so camera.up is the orbit axis\n        var quat = new THREE.Quaternion().setFromUnitVectors( object.up, new THREE.Vector3( 0, 1, 0 ) );\n        var quatInverse = quat.clone().inverse();\n\n        var lastPosition = new THREE.Vector3();\n        var lastQuaternion = new THREE.Quaternion();\n\n        return function update() {\n\n            var position = scope.object.position;\n\n            offset.copy( position ).sub( scope.target );\n\n            // rotate offset to \"y-axis-is-up\" space\n            offset.applyQuaternion( quat );\n\n            // angle from z-axis around y-axis\n            spherical.setFromVector3( offset );\n\n            if ( scope.autoRotate && state === STATE.NONE ) {\n\n                rotateLeft( getAutoRotationAngle() );\n\n            }\n\n            spherical.theta += sphericalDelta.theta;\n            spherical.phi += sphericalDelta.phi;\n\n            // restrict theta to be between desired limits\n            spherical.theta = Math.max( scope.minAzimuthAngle, Math.min( scope.maxAzimuthAngle, spherical.theta ) );\n\n            // restrict phi to be between desired limits\n            spherical.phi = Math.max( scope.minPolarAngle, Math.min( scope.maxPolarAngle, spherical.phi ) );\n\n            spherical.makeSafe();\n\n\n            spherical.radius *= scale;\n\n            // restrict radius to be between desired limits\n            spherical.radius = Math.max( scope.minDistance, Math.min( scope.maxDistance, spherical.radius ) );\n\n            // move target to panned location\n            scope.target.add( panOffset );\n\n            offset.setFromSpherical( spherical );\n\n            // rotate offset back to \"camera-up-vector-is-up\" space\n            offset.applyQuaternion( quatInverse );\n\n            position.copy( scope.target ).add( offset );\n\n            scope.object.lookAt( scope.target );\n\n            if ( scope.enableDamping === true ) {\n\n                sphericalDelta.theta *= ( 1 - scope.dampingFactor );\n                sphericalDelta.phi *= ( 1 - scope.dampingFactor );\n\n            } else {\n\n                sphericalDelta.set( 0, 0, 0 );\n\n            }\n\n            scale = 1;\n            panOffset.set( 0, 0, 0 );\n\n            // update condition is:\n            // min(camera displacement, camera rotation in radians)^2 > EPS\n            // using small-angle approximation cos(x/2) = 1 - x^2 / 8\n\n            if ( zoomChanged ||\n                lastPosition.distanceToSquared( scope.object.position ) > EPS ||\n                8 * ( 1 - lastQuaternion.dot( scope.object.quaternion ) ) > EPS ) {\n\n                scope.dispatchEvent( changeEvent );\n                lastPosition.copy( scope.object.position );\n                lastQuaternion.copy( scope.object.quaternion );\n                zoomChanged = false;\n\n                return true;\n\n            }\n\n            return false;\n\n        };\n\n    }();\n\n    this.dispose = function () {\n\n        scope.domElement.removeEventListener( 'contextmenu', onContextMenu, false );\n        scope.domElement.removeEventListener( 'mousedown', onMouseDown, false );\n        scope.domElement.removeEventListener( 'wheel', onMouseWheel, false );\n\n        scope.domElement.removeEventListener( 'touchstart', onTouchStart, false );\n        scope.domElement.removeEventListener( 'touchend', onTouchEnd, false );\n        scope.domElement.removeEventListener( 'touchmove', onTouchMove, false );\n\n        document.removeEventListener( 'mousemove', onMouseMove, false );\n        document.removeEventListener( 'mouseup', onMouseUp, false );\n\n        window.removeEventListener( 'keydown', onKeyDown, false );\n\n        //scope.dispatchEvent( { type: 'dispose' } ); // should this be added here?\n\n    };\n\n    //\n    // internals\n    //\n\n    var scope = this;\n\n    var changeEvent = { type: 'change' };\n    var startEvent = { type: 'start' };\n    var endEvent = { type: 'end' };\n\n    var STATE = { NONE: - 1, ROTATE: 0, DOLLY: 1, PAN: 2, TOUCH_ROTATE: 3, TOUCH_DOLLY: 4, TOUCH_PAN: 5 };\n\n    var state = STATE.NONE;\n\n    var EPS = 0.000001;\n\n    // current position in spherical coordinates\n    var spherical = new THREE.Spherical();\n    var sphericalDelta = new THREE.Spherical();\n\n    var scale = 1;\n    var panOffset = new THREE.Vector3();\n    var zoomChanged = false;\n\n    var rotateStart = new THREE.Vector2();\n    var rotateEnd = new THREE.Vector2();\n    var rotateDelta = new THREE.Vector2();\n\n    var panStart = new THREE.Vector2();\n    var panEnd = new THREE.Vector2();\n    var panDelta = new THREE.Vector2();\n\n    var dollyStart = new THREE.Vector2();\n    var dollyEnd = new THREE.Vector2();\n    var dollyDelta = new THREE.Vector2();\n\n    function getAutoRotationAngle() {\n\n        return 2 * Math.PI / 60 / 60 * scope.autoRotateSpeed;\n\n    }\n\n    function getZoomScale() {\n\n        return Math.pow( 0.95, scope.zoomSpeed );\n\n    }\n\n    function rotateLeft( angle ) {\n\n        sphericalDelta.theta -= angle;\n\n    }\n\n    function rotateUp( angle ) {\n\n        sphericalDelta.phi -= angle;\n\n    }\n\n    var panLeft = function () {\n\n        var v = new THREE.Vector3();\n\n        return function panLeft( distance, objectMatrix ) {\n\n            v.setFromMatrixColumn( objectMatrix, 0 ); // get X column of objectMatrix\n            v.multiplyScalar( - distance );\n\n            panOffset.add( v );\n\n        };\n\n    }();\n\n    var panUp = function () {\n\n        var v = new THREE.Vector3();\n\n        return function panUp( distance, objectMatrix ) {\n\n            v.setFromMatrixColumn( objectMatrix, 1 ); // get Y column of objectMatrix\n            v.multiplyScalar( distance );\n\n            panOffset.add( v );\n\n        };\n\n    }();\n\n    // deltaX and deltaY are in pixels; right and down are positive\n    var pan = function () {\n\n        var offset = new THREE.Vector3();\n\n        return function pan( deltaX, deltaY ) {\n\n            var element = scope.domElement === document ? scope.domElement.body : scope.domElement;\n\n            if ( scope.object.isPerspectiveCamera ) {\n\n                // perspective\n                var position = scope.object.position;\n                offset.copy( position ).sub( scope.target );\n                var targetDistance = offset.length();\n\n                // half of the fov is center to top of screen\n                targetDistance *= Math.tan( ( scope.object.fov / 2 ) * Math.PI / 180.0 );\n\n                // we actually don't use screenWidth, since perspective camera is fixed to screen height\n                panLeft( 2 * deltaX * targetDistance / element.clientHeight, scope.object.matrix );\n                panUp( 2 * deltaY * targetDistance / element.clientHeight, scope.object.matrix );\n\n            } else if ( scope.object.isOrthographicCamera ) {\n\n                // orthographic\n                panLeft( deltaX * ( scope.object.right - scope.object.left ) / scope.object.zoom / element.clientWidth, scope.object.matrix );\n                panUp( deltaY * ( scope.object.top - scope.object.bottom ) / scope.object.zoom / element.clientHeight, scope.object.matrix );\n\n            } else {\n\n                // camera neither orthographic nor perspective\n                console.warn( 'WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.' );\n                scope.enablePan = false;\n\n            }\n\n        };\n\n    }();\n\n    function dollyIn( dollyScale ) {\n\n        if ( scope.object.isPerspectiveCamera ) {\n\n            scale /= dollyScale;\n\n        } else if ( scope.object.isOrthographicCamera ) {\n\n            scope.object.zoom = Math.max( scope.minZoom, Math.min( scope.maxZoom, scope.object.zoom * dollyScale ) );\n            scope.object.updateProjectionMatrix();\n            zoomChanged = true;\n\n        } else {\n\n            console.warn( 'WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.' );\n            scope.enableZoom = false;\n\n        }\n\n    }\n\n    function dollyOut( dollyScale ) {\n\n        if ( scope.object.isPerspectiveCamera ) {\n\n            scale *= dollyScale;\n\n        } else if ( scope.object.isOrthographicCamera ) {\n\n            scope.object.zoom = Math.max( scope.minZoom, Math.min( scope.maxZoom, scope.object.zoom / dollyScale ) );\n            scope.object.updateProjectionMatrix();\n            zoomChanged = true;\n\n        } else {\n\n            console.warn( 'WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.' );\n            scope.enableZoom = false;\n\n        }\n\n    }\n\n    //\n    // event callbacks - update the object state\n    //\n\n    function handleMouseDownRotate( event ) {\n\n        //console.log( 'handleMouseDownRotate' );\n\n        rotateStart.set( event.clientX, event.clientY );\n\n    }\n\n    function handleMouseDownDolly( event ) {\n\n        //console.log( 'handleMouseDownDolly' );\n\n        dollyStart.set( event.clientX, event.clientY );\n\n    }\n\n    function handleMouseDownPan( event ) {\n\n        //console.log( 'handleMouseDownPan' );\n\n        panStart.set( event.clientX, event.clientY );\n\n    }\n\n    function handleMouseMoveRotate( event ) {\n\n        //console.log( 'handleMouseMoveRotate' );\n\n        rotateEnd.set( event.clientX, event.clientY );\n        rotateDelta.subVectors( rotateEnd, rotateStart );\n\n        var element = scope.domElement === document ? scope.domElement.body : scope.domElement;\n\n        // rotating across whole screen goes 360 degrees around\n        rotateLeft( 2 * Math.PI * rotateDelta.x / element.clientWidth * scope.rotateSpeed );\n\n        // rotating up and down along whole screen attempts to go 360, but limited to 180\n        rotateUp( 2 * Math.PI * rotateDelta.y / element.clientHeight * scope.rotateSpeed );\n\n        rotateStart.copy( rotateEnd );\n\n        scope.update();\n\n    }\n\n    function handleMouseMoveDolly( event ) {\n\n        //console.log( 'handleMouseMoveDolly' );\n\n        dollyEnd.set( event.clientX, event.clientY );\n\n        dollyDelta.subVectors( dollyEnd, dollyStart );\n\n        if ( dollyDelta.y > 0 ) {\n\n            dollyIn( getZoomScale() );\n\n        } else if ( dollyDelta.y < 0 ) {\n\n            dollyOut( getZoomScale() );\n\n        }\n\n        dollyStart.copy( dollyEnd );\n\n        scope.update();\n\n    }\n\n    function handleMouseMovePan( event ) {\n\n        //console.log( 'handleMouseMovePan' );\n\n        panEnd.set( event.clientX, event.clientY );\n\n        panDelta.subVectors( panEnd, panStart );\n\n        pan( panDelta.x, panDelta.y );\n\n        panStart.copy( panEnd );\n\n        scope.update();\n\n    }\n\n    function handleMouseUp( event ) {\n\n        // console.log( 'handleMouseUp' );\n\n    }\n\n    function handleMouseWheel( event ) {\n\n        // console.log( 'handleMouseWheel' );\n\n        if ( event.deltaY < 0 ) {\n\n            dollyOut( getZoomScale() );\n\n        } else if ( event.deltaY > 0 ) {\n\n            dollyIn( getZoomScale() );\n\n        }\n\n        scope.update();\n\n    }\n\n    function handleKeyDown( event ) {\n\n        //console.log( 'handleKeyDown' );\n\n        switch ( event.keyCode ) {\n\n            case scope.keys.UP:\n                pan( 0, scope.keyPanSpeed );\n                scope.update();\n                break;\n\n            case scope.keys.BOTTOM:\n                pan( 0, - scope.keyPanSpeed );\n                scope.update();\n                break;\n\n            case scope.keys.LEFT:\n                pan( scope.keyPanSpeed, 0 );\n                scope.update();\n                break;\n\n            case scope.keys.RIGHT:\n                pan( - scope.keyPanSpeed, 0 );\n                scope.update();\n                break;\n\n        }\n\n    }\n\n    function handleTouchStartRotate( event ) {\n\n        //console.log( 'handleTouchStartRotate' );\n\n        rotateStart.set( event.touches[ 0 ].pageX, event.touches[ 0 ].pageY );\n\n    }\n\n    function handleTouchStartDolly( event ) {\n\n        //console.log( 'handleTouchStartDolly' );\n\n        var dx = event.touches[ 0 ].pageX - event.touches[ 1 ].pageX;\n        var dy = event.touches[ 0 ].pageY - event.touches[ 1 ].pageY;\n\n        var distance = Math.sqrt( dx * dx + dy * dy );\n\n        dollyStart.set( 0, distance );\n\n    }\n\n    function handleTouchStartPan( event ) {\n\n        //console.log( 'handleTouchStartPan' );\n\n        panStart.set( event.touches[ 0 ].pageX, event.touches[ 0 ].pageY );\n\n    }\n\n    function handleTouchMoveRotate( event ) {\n\n        //console.log( 'handleTouchMoveRotate' );\n\n        rotateEnd.set( event.touches[ 0 ].pageX, event.touches[ 0 ].pageY );\n        rotateDelta.subVectors( rotateEnd, rotateStart );\n\n        var element = scope.domElement === document ? scope.domElement.body : scope.domElement;\n\n        // rotating across whole screen goes 360 degrees around\n        rotateLeft( 2 * Math.PI * rotateDelta.x / element.clientWidth * scope.rotateSpeed );\n\n        // rotating up and down along whole screen attempts to go 360, but limited to 180\n        rotateUp( 2 * Math.PI * rotateDelta.y / element.clientHeight * scope.rotateSpeed );\n\n        rotateStart.copy( rotateEnd );\n\n        scope.update();\n\n    }\n\n    function handleTouchMoveDolly( event ) {\n\n        //console.log( 'handleTouchMoveDolly' );\n\n        var dx = event.touches[ 0 ].pageX - event.touches[ 1 ].pageX;\n        var dy = event.touches[ 0 ].pageY - event.touches[ 1 ].pageY;\n\n        var distance = Math.sqrt( dx * dx + dy * dy );\n\n        dollyEnd.set( 0, distance );\n\n        dollyDelta.subVectors( dollyEnd, dollyStart );\n\n        if ( dollyDelta.y > 0 ) {\n\n            dollyOut( getZoomScale() );\n\n        } else if ( dollyDelta.y < 0 ) {\n\n            dollyIn( getZoomScale() );\n\n        }\n\n        dollyStart.copy( dollyEnd );\n\n        scope.update();\n\n    }\n\n    function handleTouchMovePan( event ) {\n\n        //console.log( 'handleTouchMovePan' );\n\n        panEnd.set( event.touches[ 0 ].pageX, event.touches[ 0 ].pageY );\n\n        panDelta.subVectors( panEnd, panStart );\n\n        pan( panDelta.x, panDelta.y );\n\n        panStart.copy( panEnd );\n\n        scope.update();\n\n    }\n\n    function handleTouchEnd( event ) {\n\n        //console.log( 'handleTouchEnd' );\n\n    }\n\n    //\n    // event handlers - FSM: listen for events and reset state\n    //\n\n    function onMouseDown( event ) {\n\n        if ( scope.enabled === false ) return;\n\n        event.preventDefault();\n\n        switch ( event.button ) {\n\n            case scope.mouseButtons.ORBIT:\n\n                if ( scope.enableRotate === false ) return;\n\n                handleMouseDownRotate( event );\n\n                state = STATE.ROTATE;\n\n                break;\n\n            case scope.mouseButtons.ZOOM:\n\n                if ( scope.enableZoom === false ) return;\n\n                handleMouseDownDolly( event );\n\n                state = STATE.DOLLY;\n\n                break;\n\n            case scope.mouseButtons.PAN:\n\n                if ( scope.enablePan === false ) return;\n\n                handleMouseDownPan( event );\n\n                state = STATE.PAN;\n\n                break;\n\n        }\n\n        if ( state !== STATE.NONE ) {\n\n            document.addEventListener( 'mousemove', onMouseMove, false );\n            document.addEventListener( 'mouseup', onMouseUp, false );\n\n            scope.dispatchEvent( startEvent );\n\n        }\n\n    }\n\n    function onMouseMove( event ) {\n\n        if ( scope.enabled === false ) return;\n\n        event.preventDefault();\n\n        switch ( state ) {\n\n            case STATE.ROTATE:\n\n                if ( scope.enableRotate === false ) return;\n\n                handleMouseMoveRotate( event );\n\n                break;\n\n            case STATE.DOLLY:\n\n                if ( scope.enableZoom === false ) return;\n\n                handleMouseMoveDolly( event );\n\n                break;\n\n            case STATE.PAN:\n\n                if ( scope.enablePan === false ) return;\n\n                handleMouseMovePan( event );\n\n                break;\n\n        }\n\n    }\n\n    function onMouseUp( event ) {\n\n        if ( scope.enabled === false ) return;\n\n        handleMouseUp( event );\n\n        document.removeEventListener( 'mousemove', onMouseMove, false );\n        document.removeEventListener( 'mouseup', onMouseUp, false );\n\n        scope.dispatchEvent( endEvent );\n\n        state = STATE.NONE;\n\n    }\n\n    function onMouseWheel( event ) {\n\n        if ( scope.enabled === false || scope.enableZoom === false || ( state !== STATE.NONE && state !== STATE.ROTATE ) ) return;\n\n        event.preventDefault();\n        event.stopPropagation();\n\n        handleMouseWheel( event );\n\n        scope.dispatchEvent( startEvent ); // not sure why these are here...\n        scope.dispatchEvent( endEvent );\n\n    }\n\n    function onKeyDown( event ) {\n\n        if ( scope.enabled === false || scope.enableKeys === false || scope.enablePan === false ) return;\n\n        handleKeyDown( event );\n\n    }\n\n    function onTouchStart( event ) {\n\n        if ( scope.enabled === false ) return;\n\n        switch ( event.touches.length ) {\n\n            case 1:\t// one-fingered touch: rotate\n\n                if ( scope.enableRotate === false ) return;\n\n                handleTouchStartRotate( event );\n\n                state = STATE.TOUCH_ROTATE;\n\n                break;\n\n            case 2:\t// two-fingered touch: dolly\n\n                if ( scope.enableZoom === false ) return;\n\n                handleTouchStartDolly( event );\n\n                state = STATE.TOUCH_DOLLY;\n\n                break;\n\n            case 3: // three-fingered touch: pan\n\n                if ( scope.enablePan === false ) return;\n\n                handleTouchStartPan( event );\n\n                state = STATE.TOUCH_PAN;\n\n                break;\n\n            default:\n\n                state = STATE.NONE;\n\n        }\n\n        if ( state !== STATE.NONE ) {\n\n            scope.dispatchEvent( startEvent );\n\n        }\n\n    }\n\n    function onTouchMove( event ) {\n\n        if ( scope.enabled === false ) return;\n\n        event.preventDefault();\n        event.stopPropagation();\n\n        switch ( event.touches.length ) {\n\n            case 1: // one-fingered touch: rotate\n\n                if ( scope.enableRotate === false ) return;\n                if ( state !== STATE.TOUCH_ROTATE ) return; // is this needed?...\n\n                handleTouchMoveRotate( event );\n\n                break;\n\n            case 2: // two-fingered touch: dolly\n\n                if ( scope.enableZoom === false ) return;\n                if ( state !== STATE.TOUCH_DOLLY ) return; // is this needed?...\n\n                handleTouchMoveDolly( event );\n\n                break;\n\n            case 3: // three-fingered touch: pan\n\n                if ( scope.enablePan === false ) return;\n                if ( state !== STATE.TOUCH_PAN ) return; // is this needed?...\n\n                handleTouchMovePan( event );\n\n                break;\n\n            default:\n\n                state = STATE.NONE;\n\n        }\n\n    }\n\n    function onTouchEnd( event ) {\n\n        if ( scope.enabled === false ) return;\n\n        handleTouchEnd( event );\n\n        scope.dispatchEvent( endEvent );\n\n        state = STATE.NONE;\n\n    }\n\n    function onContextMenu( event ) {\n\n        if ( scope.enabled === false ) return;\n\n        event.preventDefault();\n\n    }\n\n    //\n\n    scope.domElement.addEventListener( 'contextmenu', onContextMenu, false );\n\n    scope.domElement.addEventListener( 'mousedown', onMouseDown, false );\n    scope.domElement.addEventListener( 'wheel', onMouseWheel, false );\n\n    scope.domElement.addEventListener( 'touchstart', onTouchStart, false );\n    scope.domElement.addEventListener( 'touchend', onTouchEnd, false );\n    scope.domElement.addEventListener( 'touchmove', onTouchMove, false );\n\n    // window.addEventListener( 'keydown', onKeyDown, false );\n\n    // force an update at start\n\n    this.update();\n\n};\n\nOrbitControls.prototype = Object.create( THREE.EventDispatcher.prototype );\nOrbitControls.prototype.constructor = THREE.OrbitControls;\n\nObject.defineProperties( OrbitControls.prototype, {\n\n    center: {\n\n        get: function () {\n\n            console.warn( 'THREE.OrbitControls: .center has been renamed to .target' );\n            return this.target;\n\n        }\n\n    },\n\n    // backward compatibility\n\n    noZoom: {\n\n        get: function () {\n\n            console.warn( 'THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead.' );\n            return ! this.enableZoom;\n\n        },\n\n        set: function ( value ) {\n\n            console.warn( 'THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead.' );\n            this.enableZoom = ! value;\n\n        }\n\n    },\n\n    noRotate: {\n\n        get: function () {\n\n            console.warn( 'THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead.' );\n            return ! this.enableRotate;\n\n        },\n\n        set: function ( value ) {\n\n            console.warn( 'THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead.' );\n            this.enableRotate = ! value;\n\n        }\n\n    },\n\n    noPan: {\n\n        get: function () {\n\n            console.warn( 'THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead.' );\n            return ! this.enablePan;\n\n        },\n\n        set: function ( value ) {\n\n            console.warn( 'THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead.' );\n            this.enablePan = ! value;\n\n        }\n\n    },\n\n    noKeys: {\n\n        get: function () {\n\n            console.warn( 'THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead.' );\n            return ! this.enableKeys;\n\n        },\n\n        set: function ( value ) {\n\n            console.warn( 'THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead.' );\n            this.enableKeys = ! value;\n\n        }\n\n    },\n\n    staticMoving: {\n\n        get: function () {\n\n            console.warn( 'THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead.' );\n            return ! this.enableDamping;\n\n        },\n\n        set: function ( value ) {\n\n            console.warn( 'THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead.' );\n            this.enableDamping = ! value;\n\n        }\n\n    },\n\n    dynamicDampingFactor: {\n\n        get: function () {\n\n            console.warn( 'THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead.' );\n            return this.dampingFactor;\n\n        },\n\n        set: function ( value ) {\n\n            console.warn( 'THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead.' );\n            this.dampingFactor = value;\n\n        }\n\n    }\n\n} );\n\n\nexport default OrbitControls","import React, {Component} from 'react'\nimport * as THREE from 'three'\nimport {TREE_ITEM_PROVIDER} from '../TreeItemProvider'\nimport SelectionManager, {SELECTION_MANAGER} from '../SelectionManager'\nimport TransformControls from './TransformControls.js'\nimport SceneDef from \"./defs/SceneDef\"\nimport {ASSET_TYPES, get3DObjectDef, is3DObjectType, OBJ_TYPES, TOTAL_OBJ_TYPES} from './Common'\nimport {ToasterNotification} from './ToasterNotification'\nimport ScriptManager, {SceneGraphProvider} from './ScriptManager'\nimport {TweenManager} from '../common/tween'\nimport {toFlatString} from '../utils'\nimport {XRSupport} from './XRSupport'\nimport OrbitControls from './OrbitControls'\n\nconst {SET_PROPERTY, INSERT_ELEMENT, DELETE_ELEMENT} = require(\"syncing_protocol\");\n\n\n// ================  SGP implementation =====================\nclass Adapter extends SceneGraphProvider {\n    constructor(canvas) {\n        super()\n        this.canvas = canvas\n    }\n\n    getCurrentScene() {\n        return this.canvas.props.provider.getSelectedSceneObject()\n    }\n    getSceneObjects(scene) {\n        return scene.getChildren().filter(ch => is3DObjectType(ch.type))\n    }\n    getBehaviorsForObject(scene) {\n        return scene.getChildren().filter(ch => ch.type === TOTAL_OBJ_TYPES.BEHAVIOR)\n    }\n    getThreeObject(obj) {\n        if(obj.id) return this.canvas.findNode(obj.id)\n        return this.canvas.findNode(obj)\n    }\n    getParsedBehaviorAsset(beh) {\n        const prov = this.canvas.props.provider\n        const asset = prov.accessObject(beh.behavior)\n        return prov.getCachedBehaviorAsset(asset.id)\n    }\n\n    getAllBehaviors() {\n        return this.canvas.props.provider.accessObject(this.canvas.props.provider.getSceneRoot())\n            .find((obj)=> obj.type === TOTAL_OBJ_TYPES.BEHAVIOR)\n    }\n    getAllScenes() {\n        return this.canvas.props.provider.accessObject(this.canvas.props.provider.getSceneRoot())\n            .find((obj)=>obj.type === TOTAL_OBJ_TYPES.SCENE)\n    }\n\n    navigateScene(id) {\n        SelectionManager.setSelection(id)\n    }\n\n\n    playMediaAsset(asset, trusted=false) {\n        if(asset.subtype === ASSET_TYPES.AUDIO) {\n            const sound = new THREE.Audio(this.canvas.audioListener)\n            const audioLoader = new THREE.AudioLoader()\n            audioLoader.load(asset.src, function (buffer) {\n                sound.setBuffer(buffer);\n                sound.setLoop(false);\n                sound.setVolume(0.5);\n                sound.play();\n            });\n            this.canvas.playing_audio[asset.id] = sound\n        }\n        if(asset.subtype === ASSET_TYPES.VIDEO) {\n            this.canvas.props.provider.assetsManager.playMediaAsset(asset, trusted)\n        }\n    }\n\n    stopMediaAsset(asset) {\n        if(asset.subtype === ASSET_TYPES.AUDIO) {\n            if(this.canvas.playing_audio[asset.id]) {\n                this.canvas.playing_audio[asset.id].stop()\n                delete this.canvas.playing_audio[asset.id]\n                this.canvas.playing_audio[asset.id] = null\n            }\n        }\n    }\n    getGraphObjectByName(title) {\n        const list = this.canvas.props.provider.accessObject(this.canvas.props.provider.getSceneRoot()).find((o)=>o.title === title)\n        if(!list || list.length<1) return null\n        return list[0]\n    }\n\n    getGraphObjectById(id) {\n        return this.canvas.props.provider.accessObject(id)\n    }\n\n\n    getCamera() {\n        return this.canvas.camera\n    }\n    \n    getTweenManager() {\n        return this.canvas.tweenManager\n    }\n    startImageRecognizer(info) {\n        return this.canvas.startImageRecognizer(info)\n    }\n    stopImageRecognizer(info) {\n        return this.canvas.stopImageRecognizer(info)\n    }\n    startGeoTracker(info) {\n        return this.canvas.startGeoTracker(info)\n    }\n    stopGeoTracker(info) {\n        return this.canvas.stopGeoTracker(info)\n    }\n}\n\n\nconst MOVE_SPEED = 0.1\nexport class VRCanvas extends Component {\n    moveCameraForward = () => {\n        this.camera.position.z += -MOVE_SPEED\n    }\n    moveCameraBackward = () => {\n        this.camera.position.z += MOVE_SPEED\n    }\n    handleKeyPress = (e) => {\n        if(e.key === 'ArrowUp') {\n            this.camera.position.z -= MOVE_SPEED\n        }\n        if(e.key === 'ArrowDown') {\n            this.camera.position.z += MOVE_SPEED\n        }\n        if(e.key === 'a') {\n            this.camera.position.x -= MOVE_SPEED\n        }\n        if(e.key === 'd') {\n            this.camera.position.x += MOVE_SPEED\n        }\n        if(e.key === 'ArrowLeft') {\n            this.camera.rotation.y += 0.1\n        }\n        if(e.key === 'ArrowRight') {\n            this.camera.rotation.y -= 0.1\n        }\n    }\n    recenterOnSelection = () => {\n        const sel = SelectionManager.getSelection()\n        if(!sel) return\n        const obj = this.props.provider.accessObject(sel)\n        if(is3DObjectType(obj.type)) {\n            const node = this.findNode(sel)\n            if(!node) return\n            this.orbitControls.target0.copy(node.position)\n            const cam = node.position.clone().sub(new THREE.Vector3(0,0,-2))\n            this.orbitControls.position0.copy(cam)\n            this.orbitControls.reset()\n        }\n        if(obj.type === TOTAL_OBJ_TYPES.SCENE) {\n            this.orbitControls.saveState()\n            this.orbitControls.target0.set(0,0,0)\n            this.orbitControls.position0.set(1,6,6)\n            this.orbitControls.reset()\n        }\n    }\n\n    constructor(props) {\n        super(props)\n        this.obj_node_map = {}\n        this.previewUpdateNodes = []\n        this.scenes = []\n        this.state = {\n            scene: -1,\n            running:props.running\n        }\n        this.current_scene_wrapper = null\n        this.playing_audio = {}\n        this.scriptManager = new ScriptManager(new Adapter(this),this.props.provider.getLogger())\n    }\n\n    pauseQueue = (e) => {\n        this.props.provider.pauseQueue()\n    }\n    unpauseQueue = (e) => {\n        this.props.provider.unpauseQueue()\n    }\n    transformChanged = (e) => {\n        const sel = SelectionManager.getSelection()\n        if(sel) {\n            const obj = this.props.provider.accessObject(sel)\n            if(!is3DObjectType(obj.type)) return\n            if(obj.type === OBJ_TYPES.bg360) return\n            const node = this.findNode(sel)\n            if(!node) return\n            const prov = this.props.provider\n            prov.quick_setPropertyValue(sel,'tx',node.position.x)\n            prov.quick_setPropertyValue(sel,'ty',node.position.y)\n            prov.quick_setPropertyValue(sel,'tz',node.position.z)\n        }\n    }\n    transformDraggingChanged = (e) => {\n        this.orbitControls.enabled = ! e.value\n    }\n\n    docSwapped = (e) => {\n        //nuke all the old stuff\n        this.scenes.forEach(sc => this.scene.remove(sc))\n        this.scenes = []\n        this.obj_node_map = {}\n        this.setState({scene: -1})\n        //make new stuff\n        const graph = this.props.provider.getDocGraph()\n        this.rebuildNode(graph,\"\")\n\n        const sceneObj = this.props.provider.getSelectedSceneObject()\n        const sceneNode = this.findNode(sceneObj.id)\n        this.setCurrentSceneWrapper(sceneNode, false)\n    }\n    rebuildNode(obj, inset) {\n        // console.log(inset,\"rebuilding\",obj.type)\n        if(obj.type === TOTAL_OBJ_TYPES.SCENE) {\n            const node = new SceneDef().makeNode(obj,this.props.provider)\n            this.insertNodeMapping(obj.id,node)\n            this.addSceneWrapper(node)\n        }\n        if(is3DObjectType(obj.type)) {\n            const node = get3DObjectDef(obj.type).makeNode(obj,this.props.provider)\n            this.insertNodeMapping(obj.id,node)\n            const parent = this.findNode(obj.parent)\n            parent.add(node)\n        }\n        if(obj.children) {\n            obj.children.forEach(ch => {\n                this.rebuildNode(ch,inset+\"   \")\n            })\n        }\n    }\n    selectionChanged = () => {\n        this.transformControls.detach()\n        const sel = SelectionManager.getSelection()\n        if(!sel) return\n        const obj = this.props.provider.accessObject(sel)\n\n        if(obj.type === TOTAL_OBJ_TYPES.SCENE) return this.setCurrentSceneWrapper(this.findNode(sel),true)\n\n        if(is3DObjectType(obj.type)) {\n            const sc = this.props.provider.findSceneObjectParent(obj)\n            this.setCurrentSceneWrapper(this.findNode(sc.id),true)\n            const node = this.findNode(sel)\n            if (!node) return\n            this.transformControls.attach(node)\n            return\n        }\n        console.log(\"selected something not an object or scene\")\n    }\n\n    checkAspectRatio() {\n        if(!this.canvas) return\n        const w = this.wrapper.clientWidth\n        const h = this.wrapper.clientHeight\n        const aspect = w/h\n        if(Math.abs(this.camera.aspect - aspect) > 0.001 ) {\n            this.camera.aspect = aspect\n            this.camera.updateProjectionMatrix()\n            this.renderer.setSize(w-4,h-4)\n        }\n    }\n\n    componentDidMount() {\n        const canvas = this.canvas\n        const logger = this.props.provider.getLogger()\n        logger.log(\"mounting VRCanvas\")\n        if(XRSupport.supportsARKit()) {\n            this.xr = new XRSupport()\n            this.xr.getContext(canvas).then((context) => {\n                this.setupRenderer(canvas,context)\n                this.xr.setAnimationLoop( this.animationLoopWithCamera.bind(this) )\n            }).catch(err => {\n                console.error('Error', err)\n            })\n        } else {\n            this.setupRenderer(canvas,0)\n            this.renderer.setAnimationLoop( this.animationLoop.bind(this) )\n        }\n    }\n\n    componentWillUnmount() {\n        this.saveOrbitControlsState()\n        this.transformControls.removeEventListener('change',this.transformChanged)\n        this.transformControls.removeEventListener('mouseDown',this.pauseQueue)\n        this.transformControls.removeEventListener('mouseUp',this.unpauseQueue)\n        this.props.provider.off(TREE_ITEM_PROVIDER.DOCUMENT_SWAPPED,this.docSwapped)\n        SelectionManager.off(SELECTION_MANAGER.CHANGED,this.selectionChanged)\n    }\n\n    setupRenderer(canvas,context) {\n        this.scene = new THREE.Scene();\n        this.camera = new THREE.PerspectiveCamera(50, canvas.width / canvas.height, 0.1, 1000);\n        this.renderer = new THREE.WebGLRenderer({antialias: false, canvas: canvas, context:context});\n        this.renderer.setPixelRatio( window.devicePixelRatio );\n        this.renderer.gammaOutput = true\n        this.audioListener = new THREE.AudioListener()\n        this.camera.add(this.audioListener)\n        //only set a background if there is no XR active\n        if(!this.xr) this.scene.background = new THREE.Color(0x000000);\n        // this.camera.matrixAutoUpdate = false\n        this.scene.add(this.camera)\n        this.camera.position.set(1,6,6)\n\n        this.transformControls = new TransformControls(this.camera, this.renderer.domElement)\n        this.transformControls.addEventListener('change',this.transformChanged)\n        this.transformControls.addEventListener('dragging-changed', this.transformDraggingChanged)\n        this.transformControls.addEventListener('mouseDown',this.pauseQueue)\n        this.transformControls.addEventListener('mouseUp',this.unpauseQueue)\n        this.scene.add(this.transformControls)\n\n        this.orbitControls = new OrbitControls(this.camera,this.renderer.domElement)\n        this.orbitControls.update()\n        // this.orbitControls.autoRotate = true\n        this.raycaster = new THREE.Raycaster();\n\n        const light = new THREE.DirectionalLight(0xffffff, 1.0);\n        light.position.set(1, 1, 1).normalize();\n        this.scene.add(light);\n\n        this.scene.add(new THREE.AmbientLight(0xffffff,0.4))\n        \n        this.tweenManager = new TweenManager()\n\n        this.props.provider.onRawChange(op => this.updateScene(op))\n        this.props.provider.on(TREE_ITEM_PROVIDER.DOCUMENT_SWAPPED, this.docSwapped)\n        SelectionManager.on(SELECTION_MANAGER.CHANGED, this.selectionChanged)\n\n        this.docSwapped()\n    }\n\n    animationLoop(time, frame) {\n        this.checkAspectRatio()\n        let session = null\n        if(this.xr) session = this.xr.session\n        if(this.state.running) this.scriptManager.tick(time, session)\n        if(this.tweenManager) this.tweenManager.update(time)\n        if(this.orbitControls) this.orbitControls.update()\n        this.previewUpdateNodes.forEach(n => n.previewUpdate())\n        this.renderer.render(this.scene, this.camera)\n    }\n\n    animationLoopWithCamera(bounds,projectionMatrix,viewMatrix, time,frame) {\n        if(!this.scene || !this.camera) return\n        this.camera.matrix.fromArray(viewMatrix)\n        this.camera.matrixWorldNeedsUpdate = true\n        this.camera.updateMatrixWorld()\n        this.camera.projectionMatrix.fromArray(projectionMatrix)\n        this.animationLoop(time,frame)\n    }\n\n    insertNodeMapping(id, node) {\n        if (typeof id !== 'string') throw new Error(\"cannot map an object to an object. invalid call in insertNodeMapping\")\n        this.obj_node_map[id] = node\n        node.userData.graphid = id\n        if(node.previewUpdate) this.previewUpdateNodes.push(node)\n    }\n    removeNodeMapping(id,node) {\n        delete this.obj_node_map[id]\n        delete node.userData.graphid\n        this.previewUpdateNodes = this.previewUpdateNodes.filter(n => n !== node)\n    }\n\n\n    findNode(id) {\n        if (!this.obj_node_map[id]) console.warn(\"could not find node for id\", id)\n        return this.obj_node_map[id]\n    }\n\n    updateScene(op) {\n        const prov = this.props.provider\n        if (op.type === INSERT_ELEMENT) {\n            const objid = op.value\n            const obj = prov.accessObject(op.value)\n            if(obj.type === TOTAL_OBJ_TYPES.SCENE) return this.populateNode(objid)\n            if (is3DObjectType(obj.type)) return this.populateNode(objid)\n            if(obj.type === TOTAL_OBJ_TYPES.ASSET) return\n            if(obj.type === TOTAL_OBJ_TYPES.ASSETS_LIST) return\n            if(obj.type === TOTAL_OBJ_TYPES.BEHAVIOR_SCRIPT) return\n            if(obj.type === TOTAL_OBJ_TYPES.BEHAVIOR) return\n            if(obj.type === TOTAL_OBJ_TYPES.BEHAVIORS_LIST) return\n            console.warn(\"unknown object type\", obj)\n            return\n        }\n        if (op.type === SET_PROPERTY) {\n            //skip setting parents. done through insert_element\n            if(op.name === 'parent') return\n            const node = this.findNode(op.object)\n            if (node) {\n                const obj = prov.accessObject(op.object)\n                if(obj.type === 'scene') {\n                    new SceneDef().updateProperty(node,obj,op,this.props.provider)\n                    return\n                }\n                if(is3DObjectType(obj.type)) return get3DObjectDef(obj.type).updateProperty(node,obj,op, this.props.provider)\n            } else {\n                console.log(\"could not find the node for object id:\", op)\n            }\n            return\n        }\n        if (op.type === DELETE_ELEMENT) {\n            this.transformControls.detach()\n            const node = this.findNode(op.value)\n            if(node) {\n                this.removeNodeMapping(op.value,node)\n                const obj = prov.accessObject(op.value)\n                if(is3DObjectType(obj.type)) node.parent.remove(node)\n            }\n            return\n        }\n        // console.log('skipping', op.type)\n    }\n    shouldComponentUpdate(nextProps, nextState, nextContext) {\n        if('running' in nextProps) {\n            if(nextProps.running !== this.props.running) {\n                this.setState({running:nextProps.running})\n                if(nextProps.running === false) {\n                    this.scriptManager.stopRunning()\n                    this.stopAllMedia()\n                    this.resetSceneGraph()\n                    this.stopRecognizers()\n                } else {\n                    //start the script manager\n                    this.startRecognizers()\n                    this.scriptManager.startRunning()\n                    this.scriptManager.startFirstScene();\n                }\n                return false\n            }\n        }\n        return false\n    }\n\n    render() {\n        return <div style={{\n            borderWidth:0,\n            boxSizing:'border-box',\n            height:'100%',\n            display:'flex',\n            flexDirection:'column'\n        }}>\n            <button onClick={this.recenterOnSelection}>recenter on selection</button>\n            <div style={{\n                boxSizing:'border-box',\n                borderWidth:0,\n                margin:0,\n                padding:0,\n                flex:1.0,\n                overflow:'auto',\n            }}\n                 ref={c => this.wrapper = c}\n            >\n                <canvas ref={c => this.canvas = c}\n                        style={{\n                            boxSizing:'border-box',\n                            margin:0,\n                            padding:0,\n                            width:'100px',\n                            height:'100px',\n                            borderWidth:0,\n                        }}\n                        onClick={this.clickedCanvas}\n                        className=\"editable-canvas\"\n                        onKeyDown={this.handleKeyPress}\n                        tabIndex={0}\n                />\n                <ToasterNotification/>\n            </div>\n        </div>\n    }\n\n    populateNode(nodeid) {\n        const obj = this.props.provider.accessObject(nodeid)\n        if (is3DObjectType(obj.type)) {\n            const obj3d = get3DObjectDef(obj.type).makeNode(obj,this.props.provider)\n            this.insertNodeMapping(nodeid, obj3d)\n            const parent = this.findNode(obj.parent)\n            parent.add(obj3d)\n            return obj3d\n        }\n        if (obj.type === TOTAL_OBJ_TYPES.SCENE) {\n            const scene = new SceneDef().makeNode(obj,this.props.provider)\n            this.insertNodeMapping(nodeid, scene)\n            this.addSceneWrapper(scene)\n            this.setCurrentSceneWrapper(scene,true)\n            return scene\n        }\n\n        console.warn(\"cannot populate node for type\", obj.type)\n    }\n\n    addSceneWrapper(scene) {\n        this.scenes.push(scene)\n        this.scene.add(scene)\n    }\n\n    saveOrbitControlsState() {\n        const scene = this.scenes.find(sc => sc.visible)\n        this.orbitControls.saveState()\n        const id = scene.userData.graphid\n        this.props.provider.orbit_state[id] = {\n            target: this.orbitControls.target0.clone(),\n            position:this.orbitControls.position0.clone(),\n        }\n    }\n    restoreOrbitControlsState(scene) {\n        const id = scene.userData.graphid\n        if(this.props.provider.orbit_state[id]) {\n            const state = this.props.provider.orbit_state[id]\n            this.orbitControls.target0.copy(state.target)\n            this.orbitControls.position0.copy(state.position)\n            this.orbitControls.reset()\n        }\n    }\n    setCurrentSceneWrapper(scene, saveState) {\n        const cur = this.getCurrentSceneWrapper()\n        const changed = (scene !== cur)\n        if(changed && saveState) this.saveOrbitControlsState()\n        this.current_scene_wrapper = scene\n        this.scenes.forEach(sc => {\n            if(sc === scene) {\n                sc.visible = true\n            } else {\n                sc.visible = false\n            }\n        })\n        if(changed) this.restoreOrbitControlsState(scene)\n    }\n\n    dumpScenes() {\n        this.scenes.forEach(sc => {\n            console.log(\"scene\")\n            this.dump(sc,'')\n        })\n    }\n    dump(sc,inset) {\n        console.log(inset+\"\",sc.type,sc.id,  'vis', sc.visible)\n        if(sc.type === 'Mesh') console.log(inset+'  ',sc.geometry.type)\n        // console.log(sc)\n        if(sc.children) {\n            sc.children.forEach((ch) => this.dump(ch, inset + '  '))\n        }\n    }\n\n    getCurrentSceneWrapper() {\n        return this.current_scene_wrapper\n    }\n\n    clickedCanvas = (e) => {\n        this.canvas.focus()\n        const rect = this.canvas.getBoundingClientRect();\n        const pointer = {\n            x: ( e.clientX - rect.left ) / rect.width * 2 - 1,\n            y: - ( e.clientY - rect.top ) / rect.height * 2 + 1,\n        }\n\n        function findKnownParent(node) {\n            if(!node) return null\n            if(node.userData.graphid) return node\n            return findKnownParent(node.parent)\n        }\n\n        this.raycaster.setFromCamera(pointer, this.camera);\n        const intersect = this.raycaster.intersectObjects(this.getCurrentSceneWrapper().children, true)\n        if(intersect && intersect.length >= 1) {\n            let obj = findKnownParent(intersect[0].object)\n            if(this.state.running) {\n                this.scriptManager.performClickAction(this.props.provider.accessObject(obj.userData.graphid), e)\n            } else {\n                SelectionManager.setSelection(obj.userData.graphid)\n            }\n        } else {\n            SelectionManager.clearSelection()\n        }\n    }\n\n\n    resetSceneGraph() {\n        Object.keys(this.obj_node_map).forEach(id => {\n            const graphObj = this.props.provider.accessObject(id)\n            const threeObj = this.obj_node_map[id]\n            if(graphObj.type === 'scene') {\n                // new SceneDef().updateProperty(node,obj,op,this.props.provider)\n                return\n            }\n            if(is3DObjectType(graphObj.type)) {\n                const def = get3DObjectDef(graphObj.type)\n                if(def.reset) {\n                    def.reset(threeObj,graphObj,this.props.provider.getDataGraph())\n                }\n            }\n        })\n    }\n\n    stopAllMedia() {\n        Object.keys(this.playing_audio).forEach(key => {\n            const media = this.playing_audio[key]\n            console.log(\"stopping\",media)\n            media.stop()\n        })\n        this.props.provider.assetsManager.stopAllMedia()\n    }\n\n    startRecognizers() {\n        //called when script running is started\n    }\n\n    stopRecognizers() {\n        //called when script running is started\n    }\n\n    startImageRecognizer(info) {\n        this.props.getLogger().log(\"NOTHING DONE TO start image recognizer\")\n    }\n\n    stopImageRecognizer(info) {\n        this.props.getLogger().log(\"NOTHING DONE TO stop image recognizer\")\n    }\n\n    startGeoTracker(info) {\n        this.props.provider.getLogger().log(\"NOTHING DONE TO start geo recognizer\")\n    }\n\n    stopGeoTracker(info) {\n        this.props.provider.getLogger().log(\"NOTHING DONE TO stop geo recognizer\")\n    }\n\n\n}\n","import * as THREE from 'three'\nimport {POINTER_ENTER, POINTER_EXIT, POINTER_MOVE, POINTER_PRESS, POINTER_RELEASE} from 'webxr-boilerplate'\n\n\n\nconst on = (elem,type,cb) => elem.addEventListener(type,cb)\nconst off = (elem,type,cb) => elem.removeEventListener(type,cb)\nconst toRad = (degrees) => degrees*Math.PI/180\n\nexport default class TranslationArrow extends THREE.Group {\n    constructor(axis, control) {\n        super()\n        this.axis = axis\n        this.control = control\n        this.makePlane()\n        this.makeArrow()\n        this.makeInputGrabber()\n    }\n\n    makePlane() {\n        this.plane = new THREE.Mesh(\n            new THREE.PlaneBufferGeometry(100, 100, 100, 100),\n            new THREE.MeshBasicMaterial({visible: true, wireframe: true, side: THREE.DoubleSide})\n        )\n        if (this.axis === 'Z') this.plane.rotation.y = toRad(90)\n        this.plane.userData.draggable = true\n        this.plane.visible = false\n        this.add(this.plane)\n    }\n\n    makeArrow() {\n        this.arrow = new THREE.Mesh(\n            new THREE.CylinderBufferGeometry(0.02, 0.02, 4),\n            new THREE.MeshLambertMaterial({color: 'yellow'})\n        )\n        if (this.axis === 'X') this.arrow.rotation.z = toRad(90)\n        if (this.axis === 'Y') this.arrow.rotation.z = toRad(180)\n        if (this.axis === 'Z') this.arrow.rotation.x = toRad(90)\n        this.add(this.arrow)\n    }\n\n    makeInputGrabber() {\n        this.input = new THREE.Mesh(\n            new THREE.CylinderBufferGeometry(0.1, 0.1, 4),\n            new THREE.MeshLambertMaterial({color: 'green', visible: false})\n        )\n        if (this.axis === 'X') this.input.rotation.z = toRad(90)\n        if (this.axis === 'Y') this.input.rotation.z = toRad(180)\n        if (this.axis === 'Z') this.input.rotation.x = toRad(90)\n        this.input.userData.clickable = true\n        this.add(this.input)\n    }\n\n    attach() {\n        on(this.input, POINTER_ENTER, this.startHover)\n        on(this.input, POINTER_EXIT, this.endHover)\n        on(this.input, POINTER_PRESS, this.beginDrag)\n    }\n\n    detach() {\n        off(this.input, POINTER_ENTER, this.startHover)\n        off(this.input, POINTER_EXIT, this.endHover)\n        off(this.input, POINTER_PRESS, this.beginDrag)\n    }\n\n    startHover = () => this.arrow.material.color.set(0xffffff)\n    endHover = () => this.arrow.material.color.set(0xffff00)\n\n    beginDrag = (e) => {\n        this.startPoint = this.parent.position.clone()\n        this.startPoint.copy(e.intersection.point)\n        this.parent.target.parent.worldToLocal(this.startPoint)\n        this.oldFilter = this.parent.pointer.intersectionFilter\n        this.parent.pointer.intersectionFilter = (obj) => obj.userData.draggable\n        this.startPosition = this.parent.target.position.clone()\n        this.plane.visible = true\n        on(this.plane, POINTER_MOVE, this.updateDrag)\n        on(this.plane, POINTER_RELEASE, this.endDrag)\n    }\n    updateDrag = (e) => {\n        this.endPoint = e.intersection.point.clone()\n        this.parent.target.parent.worldToLocal(this.endPoint)\n        //neutralize y and z\n        if (this.axis === 'X') {\n            this.endPoint.y = this.startPoint.y\n            this.endPoint.z = this.startPoint.z\n        }\n        if (this.axis === 'Y') {\n            this.endPoint.x = this.startPoint.x\n            this.endPoint.z = this.startPoint.z\n        }\n        if (this.axis === 'Z') {\n            this.endPoint.x = this.startPoint.x\n            this.endPoint.y = this.startPoint.y\n        }\n        const diff = this.endPoint.clone().sub(this.startPoint)\n        const finalPoint = this.startPosition.clone().add(diff)\n        this.parent.target.position.copy(finalPoint)\n        this.parent.position.copy(finalPoint)\n    }\n    endDrag = (e) => {\n        off(this.plane, POINTER_MOVE, this.updateDrag)\n        off(this.plane, POINTER_RELEASE, this.endDrag)\n        this.parent.pointer.intersectionFilter = this.oldFilter\n        this.plane.visible = false\n        this.parent.dispatchEvent({\n            type: 'change',\n            start: this.startPosition.clone(),\n            end: this.parent.position.clone()\n        })\n    }\n}\n","import * as THREE from 'three'\nimport TranslationArrow from './TranslationArrow'\n\nexport class TranslateControl extends THREE.Group {\n    constructor() {\n        super()\n        this.handles = []\n        this.handles.push(new TranslationArrow('X', this))\n        this.handles.push(new TranslationArrow('Y', this))\n        this.handles.push(new TranslationArrow('Z', this))\n        this.handles.forEach(h => this.add(h))\n        this.visible = false\n    }\n\n    attach(target, pointer) {\n        this.target = target\n        this.pointer = pointer\n        this.position.copy(target.position)\n        this.visible = true\n        this.handles.forEach(h => h.attach())\n    }\n\n    detach() {\n        this.target = null\n        this.pointer = null\n        this.visible = false\n        this.handles.forEach(h => h.attach())\n    }\n}\n","import * as THREE from 'three'\n\nimport {POINTER_RELEASE, POINTER_CLICK, POINTER_ENTER, POINTER_EXIT, POINTER_PRESS, POINTER_MOVE} from 'webxr-boilerplate'\n\n// const $ = (sel) => document.querySelector(sel)\nconst on = (elem, type, cb) => elem.addEventListener(type,cb)\n// const toRad = (deg) => deg * Math.PI/180\n\nexport default class Panel2D extends THREE.Object3D {\n    constructor(scene,camera) {\n        super()\n\n        if(!scene) throw new Error(\"cannot pass empty scene to Panel2D()\")\n        if(!camera) throw new Error(\"cannot pass empty camera to Panel2D()\")\n        this.type = 'panel2d'\n        this.listeners = {}\n        this.scene = scene\n        this.camera = camera\n        this.canvas = document.createElement('canvas')\n        this.canvas.width = 256\n        this.canvas.height = 512\n        this.canvasTexture = new THREE.CanvasTexture(this.canvas)\n        this.redrawHandler = (e) => this.redraw()\n\n        const c = this.canvas.getContext('2d')\n        c.fillStyle = 'red'\n        c.fillRect(0,0,this.canvas.width,this.canvas.height)\n\n        this.mesh = new THREE.Mesh(\n            new THREE.PlaneGeometry(1,2),\n            new THREE.MeshBasicMaterial({color:'white',map:this.canvasTexture})\n        )\n        this.mesh.userData.clickable = true\n        this.comps = []\n\n        this.add(this.mesh)\n\n        let inside = null\n        on(this.mesh,POINTER_MOVE,(e)=>{\n            const uv = e.intersection.uv\n            const fpt = new THREE.Vector2(uv.x*256, 512-uv.y*512)\n            if(inside && !inside.contains(fpt)) {\n                inside.fire(POINTER_EXIT)\n                inside = null\n            }\n            const comp = this.findAt(fpt)\n            // for(let i=0; i<this.comps.length; i++) {\n            //     const comp = this.comps[i]\n            //     if(comp.contains(fpt)) {\n            if(inside !== comp){\n                if(inside) inside.fire(POINTER_EXIT)\n                inside = null\n            }\n            if(comp) comp.fire(POINTER_ENTER)\n            inside = comp\n            // }\n            // }\n        })\n        on(this.mesh,POINTER_CLICK,(e)=>{\n            const uv = e.intersection.uv\n            const fpt = new THREE.Vector2(uv.x*256, 512-uv.y*512)\n            const comp = this.findAt(fpt)\n            if(comp) comp.fire(POINTER_CLICK)\n            // for(let i=0; i<this.comps.length; i++) {\n            //     const comp = this.comps[i]\n            //     if(comp.contains(fpt)) {\n            //         comp.fire(POINTER_CLICK)\n            //     }\n            // }\n        })\n\n        this.header = new THREE.Mesh(\n            new THREE.BoxGeometry(1.0,0.1,0.1),\n            new THREE.MeshBasicMaterial({color:'goldenrod'})\n        )\n        this.header.userData.clickable = true\n        this.header.position.set(0,1.1,0)\n        this.add(this.header)\n\n        on(this.header,POINTER_ENTER, e => this.header.material.color.set('yellow'))\n        on(this.header,POINTER_EXIT,  e => this.header.material.color.set('goldenrod'))\n        on(this.header,POINTER_PRESS, e => this.startDrag())\n    }\n\n    fire(type,payload) {\n        if(!this.listeners[type]) this.listeners[type] = []\n        this.listeners[type].forEach(cb => cb(payload))\n    }\n\n    findAt(pt) {\n        for(let i=0; i<this.comps.length; i++) {\n            const comp = this.comps[i]\n            const res = comp.findAt({x:pt.x-comp.x,y:pt.y-comp.y})\n            if(res) return res\n        }\n        return null\n    }\n\n    add(comp) {\n        if(comp instanceof THREE.Object3D) {\n            super.add(comp)\n        } else {\n            this.comps.push(comp)\n            on(comp, 'changed', this.redrawHandler)\n        }\n    }\n\n    redraw() {\n        const ctx = this.canvas.getContext('2d')\n        ctx.fillStyle = 'white'\n        ctx.fillRect(0,0,this.canvas.width,this.canvas.height)\n        this.comps.forEach(comp => comp.draw(ctx))\n        this.canvasTexture.needsUpdate = true\n    }\n\n    startDrag() {\n        this.header.userData.clickable = false\n        this.mesh.userData.clickable = false\n\n        this.dragSphere = new THREE.Mesh(\n            new THREE.SphereGeometry(4,32,32),\n            new THREE.MeshLambertMaterial({\n                color:'green',\n                wireframe:true,\n                side: THREE.BackSide\n            })\n        )\n        this.dragSphere.userData.clickable = true\n        this.scene.add(this.dragSphere)\n\n        on(this.dragSphere,POINTER_MOVE,(e)=> this.moveDrag(e))\n        on(this.dragSphere,POINTER_RELEASE,(e)=> this.endDrag(e))\n\n    }\n    endDrag() {\n        this.scene.remove(this.dragSphere)\n        this.dragSphere.userData.clickable = false\n        this.header.userData.clickable = true\n        this.mesh.userData.clickable = true\n    }\n\n\n    moveDrag(e) {\n        this.position.copy(e.point)\n        this.position.add(new THREE.Vector3(0,-1,0))\n        this.lookAt(this.camera.position)\n    }\n}\n","export default class Component2D {\n    constructor() {\n        this.listeners = {}\n    }\n    set(key,value) {\n        this[key] = value\n        this.fire('changed',{type:'changed',target:this})\n        return this\n    }\n    get(key) {\n        return this[key]\n    }\n    addEventListener(type,cb) {\n        if(!this.listeners[type]) this.listeners[type] = []\n        this.listeners[type].push(cb)\n        return this\n    }\n    on(type,cb) {\n        this.addEventListener(type,cb)\n        return this\n    }\n    setAll(props) {\n        Object.keys(props).forEach(key => this.set(key, props[key]))\n        return this\n    }\n    fire(type,payload) {\n        if(!this.listeners[type]) this.listeners[type] = []\n        this.listeners[type].forEach(cb => cb(payload))\n    }\n\n}","import {POINTER_ENTER, POINTER_EXIT} from 'webxr-boilerplate'\nimport Component2D from \"./component2d\";\n\n\nexport default class Button2D extends Component2D {\n    constructor() {\n        super()\n        this.type = 'button'\n        this.text = 'foo'\n        this.x = 0\n        this.y = 0\n        this.fsize = 20\n        this.w = this.text.length * this.fsize\n        this.h = 20\n        this.normalBg = 'white'\n        this.hoverBg = 'red'\n        this.bg = this.normalBg\n        this.on(POINTER_ENTER, () => {\n            this.bg = this.hoverBg\n            this.fire('changed', {type: 'changed', target: this})\n        })\n        this.on(POINTER_EXIT, () => {\n            this.bg = this.normalBg\n            this.fire('changed', {type: 'changed', target: this})\n        })\n    }\n\n    draw(ctx) {\n        ctx.font = `${this.fsize}px sans-serif`\n        const metrics = ctx.measureText(this.text)\n        this.w = 5 + metrics.width + 5\n        this.h = 0 + this.fsize + 4\n        ctx.fillStyle = this.bg\n        ctx.fillRect(this.x, this.y, this.w, this.h)\n        ctx.fillStyle = 'black'\n        ctx.fillText(this.text, this.x + 3, this.y + this.fsize - 2)\n        ctx.strokeStyle = 'black'\n        ctx.strokeRect(this.x, this.y, this.w, this.h)\n    }\n\n    contains(pt) {\n        if (pt.x < this.x) return false\n        if (pt.x > this.x + this.w) return false\n        if (pt.y < this.y) return false\n        if (pt.y > this.y + this.h) return false\n        return true\n    }\n\n    findAt(pt) {\n        if (pt.x < 0) return null\n        if (pt.x > 0 + this.w) return null\n        if (pt.y < 0) return null\n        if (pt.y > 0 + this.h) return null\n        return this\n    }\n\n    set(key, value) {\n        super.set(key, value)\n        if (key === 'normalBg') this.bg = this.normalBg\n    }\n}\n","import Component2D from \"./component2d\";\n\nexport default class Group2D extends Component2D {\n    constructor() {\n        super()\n        this.type = 'group'\n        this.x = 0\n        this.y = 0\n        this.w = 100\n        this.h = 100\n        this.bg = 'gray'\n        this.visible = true\n        this.comps = []\n        this.padding = 5\n        this.border = 1\n\n        this.layout = (comp) => {\n            console.log(\"not laying out anything\")\n        }\n    }\n    draw(ctx) {\n        if(!this.visible) return\n        this.layout(this)\n        ctx.fillStyle = this.bg\n        ctx.fillRect(this.x,this.y,this.w,this.h)\n        if(this.border > 0) {\n            ctx.strokeStyle = 'black'\n            ctx.strokeRect(this.x, this.y, this.w, this.h)\n        }\n        ctx.save()\n        ctx.translate(this.x+this.padding,this.y+this.padding)\n        this.comps.forEach(comp => comp.draw(ctx))\n        ctx.restore()\n    }\n\n    contains(pt) {\n        if(pt.x < this.x) return false\n        if(pt.x > this.x + this.w) return false\n        if(pt.y < this.y) return false\n        if(pt.y > this.y + this.h) return false\n        return true\n    }\n    findAt(pt) {\n        if(!this.visible) return null\n        for(let i=0; i<this.comps.length; i++) {\n            const comp = this.comps[i]\n            const res = comp.findAt({x:pt.x-comp.x-5,y:pt.y-comp.y-5})\n            if(res) return res\n        }\n        return null\n    }\n\n    childSet(key,value) {\n        this.childProps[key] = value\n        this.comps.forEach(ch=>ch.set(key,value))\n        return this\n    }\n\n    add(comp) {\n        this.comps.push(comp)\n        this.fire('changed',{type:'changed',target:this})\n        return this\n    }\n}\n","import * as THREE from 'three'\n\nconst toRad = (deg) => Math.PI/180*deg\nconst YAXIS = new THREE.Vector3(0,1,0)\n\n\nexport default class ThreeDOFController {\n\n\n    constructor(stagePos, stageRot) {\n        this.stagePos = stagePos\n        this.stageRot = stageRot\n        this.states = { touchpad: false}\n        this.listeners = {}\n        this.keystates = {\n            ArrowLeft:{current:false, previous:false},\n            ArrowRight:{current:false, previous:false},\n            ArrowUp:{current:false, previous:false},\n            ArrowDown:{current:false, previous:false}\n        }\n        this.dir = new THREE.Vector3(0,0,1)\n\n\n        document.addEventListener('keydown',(e)=>{\n            if(this.keystates[e.key]) {\n                this.keystates[e.key].current = true\n            }\n        })\n        document.addEventListener('keyup',(e)=>{\n            if(this.keystates[e.key]) {\n                this.keystates[e.key].current = false\n            }\n        })\n\n    }\n\n    addEventListener(type, cb) {\n        if (!this.listeners[type]) this.listeners[type] = []\n        this.listeners[type].push(cb)\n    }\n\n    _fire(type,payload) {\n        if (!this.listeners[type]) this.listeners[type] = []\n        this.listeners[type].forEach(cb => cb(payload))\n    }\n\n\n\n\n    updateKeys() {\n        if(this.keystates.ArrowLeft.current === false && this.keystates.ArrowLeft.previous === true) {\n            this.rotateLeft()\n        }\n        if(this.keystates.ArrowRight.current === false && this.keystates.ArrowRight.previous === true) {\n            this.rotateRight()\n        }\n        if(this.keystates.ArrowUp.current === false && this.keystates.ArrowUp.previous === true) {\n            this.moveForward()\n        }\n        if(this.keystates.ArrowDown.current === false && this.keystates.ArrowDown.previous === true) {\n            this.moveBackward()\n        }\n\n        Object.keys(this.keystates).forEach(key => {\n            this.keystates[key].previous = this.keystates[key].current\n        })\n    }\n\n    rotateLeft() {\n        this.dir.applyAxisAngle(YAXIS,toRad(30))\n        this.stageRot.rotation.y -= toRad(30)\n    }\n\n    rotateRight() {\n        this.dir.applyAxisAngle(YAXIS,-toRad(30))\n        this.stageRot.rotation.y += toRad(30)\n    }\n\n    moveForward() {\n        this.stagePos.position.add(this.dir)\n        this._fire('move',this.stagePos.position)\n    }\n\n    moveBackward() {\n        this.stagePos.position.sub(this.dir)\n        this._fire('move',this.stagePos.position)\n    }\n\n    update() {\n        this.scanGamepads()\n        this.updateKeys()\n    }\n\n    scanGamepads() {\n        // console.log(\"gamepads\",navigator.getGamepads())\n        const gamepads = navigator.getGamepads()\n        for(let i=0; i<gamepads.length; i++) {\n            const gamepad = gamepads[i]\n            if ( gamepad && ( gamepad.id === 'Daydream Controller' ||\n                gamepad.id === 'Gear VR Controller' || gamepad.id === 'Oculus Go Controller' ||\n                gamepad.id === 'OpenVR Gamepad' || gamepad.id.startsWith( 'Oculus Touch' ) ||\n                gamepad.id.startsWith( 'Spatial Controller' ) ) ) {\n                //we should have at least two buttons\n                if(gamepad.buttons.length < 2) return\n\n                const touchpad = gamepad.buttons[0]\n                if(touchpad.pressed && gamepad.axes && gamepad.axes.length === 2) {\n                    const left = gamepad.axes[0] < -0.5\n                    const right = gamepad.axes[0] > 0.5\n                    const down = gamepad.axes[1] < -0.5\n                    const up = (gamepad.axes[1] > 0.5)\n\n\n                    if (down && this.states.touchpad === false && touchpad.pressed === true) {\n                        this.moveForward()\n                    }\n                    if (up && this.states.touchpad === false && touchpad.pressed === true) {\n                        this.moveBackward()\n                    }\n                    if (left && this.states.touchpad === false && touchpad.pressed === true) {\n                        this.rotateLeft()\n                    }\n                    if (right && this.states.touchpad === false && touchpad.pressed === true) {\n                        this.rotateRight()\n                    }\n                }\n\n                const trigger = gamepad.buttons[1]\n                if(trigger.pressed) console.log(\"trigger\")\n                if(this.states.touchpad === false && touchpad.pressed === true) {\n                    console.log(\"pressed\")\n                }\n                if(this.states.touchpad === true && touchpad.pressed === false) {\n                    console.log(\"released\")\n                }\n                this.states.touchpad = touchpad.pressed\n            }\n\n        }\n    }\n\n}\n","import SceneDef from './defs/SceneDef'\nimport SelectionManager from '../SelectionManager'\nimport {toQueryString} from '../utils'\nimport {ITEM_ICONS, OBJ_TYPES} from './Common'\nimport {PopupManager} from 'appy-comps'\nimport {MenuPopup} from '../common/GridEditorApp'\nimport React from 'react'\nimport {AuthModule} from './AuthModule'\n\nexport function addScene(provider) {\n    const root = provider.accessObject(provider.getSceneRoot())\n    const scene = new SceneDef().make(provider.getDataGraph(),root)\n    root.insertFirstChild(scene)\n    SelectionManager.setSelection(scene.id)\n}\n\n\nexport function deleteObject(provider) {\n    if(SelectionManager.isEmpty()) return\n    provider.accessObject(SelectionManager.getSelection()).removeFromParent()\n    SelectionManager.clearSelection()\n}\n\nexport function newDoc(provider) {\n    const opts = Object.assign({},provider.options,\n        {mode:'edit', switcher:false, doc:provider.genID('doc')})\n    document.location =  `./?${toQueryString(opts)}`\n}\n\n\nexport function showAddPopup (e, provider) {\n    let item = provider.getSelectedSceneObject()\n    const acts = Object.keys(OBJ_TYPES).map(type => {\n        return {\n            title: type,\n            icon: ITEM_ICONS[type],\n            fun: () => provider.add3DObject(type,item)\n        }\n    })\n    PopupManager.show(<MenuPopup actions={acts}/>, e.target)\n}\n\nexport function showAddAssetPopup(e, provider) {\n    const acts = generateAddAssetPopup(provider)\n    PopupManager.show(<MenuPopup actions={acts}/>, e.target)\n}\n\nexport function generateAddAssetPopup(provider) {\n    let acts = []\n    // console.log(\"Auth mod\",AuthModule.supportsAssetUpload())\n    if(AuthModule.supportsAssetUpload()) {\n        acts = acts.concat([\n            {\n                title: 'image',\n                enabled: AuthModule.isLoggedIn(),\n                icon: ITEM_ICONS.image,\n                fun: () => provider.showAddImageAssetDialog()\n            },\n            {\n                title: 'server image',\n                enabled: AuthModule.isLoggedIn(),\n                icon: ITEM_ICONS.image,\n                fun: () => provider.showAddServerImageDialog()\n            },\n            {divider: true},\n            {\n                title: 'GLTF model',\n                enabled: AuthModule.isLoggedIn(),\n                icon: ITEM_ICONS.model,\n                fun: () => provider.showAddGLTFAssetDialog()\n            },\n            {\n                title: 'GLB model',\n                enabled: AuthModule.isLoggedIn(),\n                icon: ITEM_ICONS.model,\n                fun: () => provider.showAddGLBAssetDialog()\n            },\n            {divider: true},\n            {\n                title: 'audio file',\n                enabled: AuthModule.isLoggedIn(),\n                icon: ITEM_ICONS.audio,\n                fun: () => provider.showAddAudioAssetDialog()\n            },\n            {\n                title: 'existing asset on server',\n                enabled: AuthModule.isLoggedIn(),\n                icon: ITEM_ICONS.assets,\n                fun: () => provider.showOpenAssetDialog()\n            }])\n    } else {\n        acts.push({\n            title: 'add asset from glitch',\n            icon: ITEM_ICONS.assets,\n            fun: () => provider.showOpenAssetDialog()\n        })\n    }\n\n    acts.push({\n        title:'geo location',\n        icon: ITEM_ICONS.geoanchor,\n        fun: () => provider.showAddGeoLocationAssetDialog()\n    })\n\n    return acts\n}\n\nexport function showAddBehaviorPopup (e, provider) {\n    const acts = [\n        {\n            title:'Add Behavior from Server',\n            enabled: AuthModule.isLoggedIn(),\n            icon: ITEM_ICONS.behavior_script,\n            fun: () => provider.showOpenBehaviorDialog()\n        },\n    ]\n    if(AuthModule.supportsScriptEdit()) {\n        acts.push({\n            title: 'custom behavior',\n            enabled: AuthModule.isLoggedIn(),\n            icon: ITEM_ICONS.behavior_script,\n            fun: () => provider.addCustomBehaviorAsset()\n        })\n    }\n    PopupManager.show(<MenuPopup actions={acts}/>, e.target)\n}\n","import React, {Component} from 'react'\nimport {\n    AmbientLight,\n    Audio,\n    AudioLoader,\n    AudioListener,\n    Color,\n    CylinderBufferGeometry,\n    DirectionalLight,\n    Group,\n    Mesh,\n    MeshLambertMaterial,\n    PerspectiveCamera,\n    Scene,\n    WebGLRenderer\n} from 'three'\n\nimport './VREditor.css'\n\nimport {Pointer, POINTER_CLICK, VR_DETECTED, VRManager, VRStats} from \"webxr-boilerplate\"\n\nimport {TREE_ITEM_PROVIDER} from '../TreeItemProvider'\nimport SelectionManager, {SELECTION_MANAGER} from '../SelectionManager'\nimport {TranslateControl} from './TranslateControl'\nimport panel2d from \"./panel2d/panel2d\"\nimport button2d from \"./panel2d/button2d\"\nimport group2d from \"./panel2d/group2d\"\nimport SceneDef from \"./defs/SceneDef\"\nimport {on, parseOptions, toFlatString} from \"../utils\"\nimport {TweenManager} from \"../common/tween\"\nimport {ASSET_TYPES, get3DObjectDef, is3DObjectType, OBJ_TYPES, SIMPLE_COLORS, toRad, TOTAL_OBJ_TYPES} from './Common'\n//use the oculus go controller\nimport ThreeDOFController from \"./3dof.js\"\nimport ScriptManager, {SceneGraphProvider} from './ScriptManager'\nimport {deleteObject} from './Actions'\nimport {DialogContainer} from 'appy-comps'\nimport {PubnubLogger} from '../syncgraph/PubnubSyncWrapper'\n\nconst {SET_PROPERTY, CREATE_OBJECT, INSERT_ELEMENT, DELETE_ELEMENT} = require(\"syncing_protocol\");\n\nclass Adapter extends SceneGraphProvider {\n    constructor(editor, provider) {\n        super()\n        this.editor = editor\n        this.provider = provider\n    }\n    getCurrentScene ()  {\n        return this.provider.accessObject(this.editor.currentScene)\n    }\n    getSceneObjects (scene)  {\n        return scene.getChildren().filter(ch => is3DObjectType(ch.type))\n    }\n    getBehaviorsForObject (obj)  {\n        return obj.getChildren().filter(ch => ch.type === TOTAL_OBJ_TYPES.BEHAVIOR)\n    }\n    getThreeObject(id) {\n        return this.editor.findNode(id)\n    }\n    getParsedBehaviorAsset (beh) {\n        const asset = this.provider.accessObject(beh.behavior)\n        return this.provider.getCachedBehaviorAsset(asset.id)\n    }\n    getAllBehaviors ()  {\n        return this.provider.accessObject(this.provider.getSceneRoot())\n            .find((obj)=> obj.type === TOTAL_OBJ_TYPES.BEHAVIOR)\n    }\n\n    getAllScenes() {\n        return this.provider.accessObject(this.provider.getSceneRoot())\n            .find((obj)=>obj.type === TOTAL_OBJ_TYPES.SCENE)\n    }\n\n    navigateScene(id) {\n        return this.editor.swapScene(id)\n    }\n    playMediaAsset(asset, trusted) {\n        if(asset.subtype === ASSET_TYPES.AUDIO) {\n            const sound = new Audio(this.editor.audioListener)\n            const audioLoader = new AudioLoader()\n            audioLoader.load(asset.src, function (buffer) {\n                sound.setBuffer(buffer);\n                sound.setLoop(false);\n                sound.setVolume(0.5);\n                sound.play();\n            });\n            this.editor.playing_audio[asset.id] = sound\n        }\n    }\n\n    stopMediaAsset(asset) {\n        if(asset.subtype === ASSET_TYPES.AUDIO) {\n            if(this.editor.playing_audio[asset.id]) {\n                this.editor.playing_audio[asset.id].stop()\n                delete this.editor.playing_audio[asset.id]\n                this.canvas.playing_audio[asset.id] = null\n            }\n        }\n    }\n\n    getGraphObjectByName(title) {\n        const list = this.provider.accessObject(this.provider.getSceneRoot()).find((o)=>o.title === title)\n        if(!list || list.length<1) return null\n        return list[0]\n    }\n    getGraphObjectById(id) {\n        return this.provider.accessObject(id)\n    }\n\n    getCamera() {\n        return this.editor.camera\n    }\n    \n\n    getTweenManager() {\n        return this.editor.tweenManager\n    }\n\n    startImageRecognizer(info) {\n        this.provider.getLogger().log(\"NOTHING DONE TO start image recognizer\")\n    }\n\n    stopImageRecognizer(info) {\n        this.provider.getLogger().log(\"NOTHING DONE TO stop image recognizer\")\n    }\n\n    startGeoTracker(info) {\n        this.provider.getLogger().log(\"NOTHING DONE TO start geo recognizer\")\n    }\n\n    stopGeoTracker(info) {\n        this.provider.getLogger().log(\"NOTHING DONE TO stop geo recognizer\")\n    }\n\n}\n\nexport default class ImmersiveVREditor extends Component {\n    constructor(props) {\n        super(props)\n        this.obj_node_map = {}\n        this.previewUpdateNodes = []\n        this.playing_audio = []\n        const opts = parseOptions({})\n        if(!opts.doc) throw new Error(\"doc not specified\")\n        this.logger = new PubnubLogger(opts.doc)\n        this.scriptManager = new ScriptManager(new Adapter(this, this.props.provider), this.logger)\n    }\n\n    shouldComponentUpdate(nextProps, nextState, nextContext) {\n        return false\n    }\n\n\n    render() {\n        return <div>\n            <div id=\"overlay\">\n                <div id=\"inner\">\n                    <h1>Application Name</h1>\n                    <div id=\"loading-indicator\">\n                        <label>loading</label>\n                        <progress max=\"100\" value=\"0\" id=\"progress\"></progress>\n                    </div>\n                    <button id=\"enter-button\" disabled>VR not supported, play anyway</button>\n                </div>\n            </div>\n            <div ref={c => this.wrapper = c}></div>\n            <DialogContainer/>\n        </div>\n    }\n\n\n    componentDidMount() {\n        this.sceneWrappers = {}\n        this.initScene()\n        this.renderer.setAnimationLoop(this.render3.bind(this))\n    }\n\n    render3(time) {\n        //update the pointer and stats, if configured\n        if(this.tweenManager) this.tweenManager.update(time)\n        this.previewUpdateNodes.forEach(n => n.previewUpdate())\n        if(this.pointer) this.pointer.tick(time)\n        if(this.stats) this.stats.update(time)\n        if(this.controller) this.controller.update(time)\n        if(this.scriptManager.isRunning()) this.scriptManager.tick(time)\n        this.renderer.render( this.scene, this.camera );\n    }\n\n    initScene() {\n\n        const $ = (sel) => document.querySelector(sel)\n        const on = (elem, type, cb) => elem.addEventListener(type,cb)\n\n        const container = this.wrapper\n        this.tweenManager = new TweenManager()\n        this.scene = new Scene();\n        this.stageRot = new Group()\n        this.scene.add(this.stageRot)\n        this.stagePos = new Group()\n        this.stageRot.add(this.stagePos)\n        this.camera = new PerspectiveCamera( 70, window.innerWidth / window.innerHeight, 0.1, 50 );\n        this.renderer = new WebGLRenderer( { antialias: true } );\n        const renderer = this.renderer\n        renderer.setPixelRatio( window.devicePixelRatio );\n        renderer.setSize( window.innerWidth, window.innerHeight );\n        renderer.gammaOutput = true\n        renderer.vr.enabled = true;\n        container.appendChild( renderer.domElement );\n        this.vrmanager = new VRManager(renderer)\n\n        this.audioListener = new AudioListener()\n        this.camera.add(this.audioListener)\n\n        this.initContent()\n\n        window.addEventListener( 'resize', ()=>{\n            this.camera.aspect = window.innerWidth / window.innerHeight;\n            this.camera.updateProjectionMatrix();\n            this.renderer.setSize( window.innerWidth, window.innerHeight );\n        }, false );\n\n\n        on($(\"#enter-button\"),'click',()=>{\n            $(\"#overlay\").style.display = 'none'\n            //we can start playing sound now\n        })\n\n        this.vrmanager.addEventListener(VR_DETECTED,()=>{\n            console.log(\"VR detected\")\n            $(\"#enter-button\").removeAttribute('disabled',false)\n            $(\"#enter-button\").innerText = \"enter vr\"\n            on($(\"#enter-button\"),'click',()=> this.vrmanager.enterVR())\n        })\n\n        const WAIT_FOR_LOAD = false\n\n        if(!WAIT_FOR_LOAD) {\n            $(\"#loading-indicator\").style.display = 'none'\n            $(\"#enter-button\").style.display = 'block'\n            $(\"#enter-button\").removeAttribute('disabled')\n        }\n\n        this.props.provider.onRawChange(this.updateSceneOp.bind(this))\n        this.props.provider.on(TREE_ITEM_PROVIDER.DOCUMENT_SWAPPED, this.documentSwapped.bind(this))\n        SelectionManager.on(SELECTION_MANAGER.CHANGED, this.selectionChanged.bind(this))\n        //clear selection when click on the bg\n        on(this.pointer,POINTER_CLICK,()=> SelectionManager.clearSelection())\n\n        this.controller = new ThreeDOFController(this.stagePos, this.stageRot)\n        // on(this.controller,'move', this.standardProximityHandler)\n\n        this.loadScene()\n    }\n\n    selectionChanged() {\n        const sel = SelectionManager.getSelection()\n        if (sel === null && this.controls) return this.controls.detach(this.selectedNode)\n        const node = this.findNode(sel)\n        if(this.selectedNode !== node && this.controls) this.controls.detach(this.selectedNode)\n        this.selectedNode = node\n        if (this.selectedNode && this.controls) this.controls.attach(this.selectedNode, this.pointer)\n    }\n\n    standardViewClickHandler = (e)  => {\n        if(this.scriptManager.isRunning()) {\n            this.scriptManager.performClickAction(this.props.provider.accessObject(e.target.userData.graphid), e)\n        } else {\n            SelectionManager.setSelection(e.target.userData.graphid)\n        }\n    }\n\n\n    initContent() {\n        if(!this.xr) this.scene.background = new Color(0x000000);\n        const light = new DirectionalLight( 0xffffff, 1.0 );\n        light.position.set( 1, 1, 1 ).normalize();\n        this.scene.add( light );\n        this.scene.add(new AmbientLight(0xffffff,0.2))\n\n        // enable stats visible inside VR\n        this.stats = new VRStats({renderer:this.renderer})\n        if(this.props.editable) {\n            this.camera.add(this.stats)\n        }\n        this.scene.add(this.camera)\n        this.camera.matrixAutoUpdate = false\n\n        //class which handles mouse and VR controller \n        this.pointer = new Pointer(this, {\n            intersectionFilter: ((o) => o.userData.clickable),\n            cameraFollowMouse:false,\n            mouseSimulatesController:false,\n            enableLaser: true,\n            laserLength: 20,\n        })\n\n\n        const STICK_HEIGHT = 1.0\n        const stick = new Mesh(\n            new CylinderBufferGeometry(0.1,0.1,STICK_HEIGHT),\n            new MeshLambertMaterial({color:'aqua'})\n        )\n        stick.position.z = -STICK_HEIGHT/2;\n        stick.rotation.x = toRad(-90)\n        this.pointer.controller1.add(stick)\n\n\n        if(this.props.editable) {\n            this.controls = new TranslateControl()\n            this.controls.name = 'Controls'\n            on(this.controls, 'change', (e) => {\n                const sel = SelectionManager.getSelection()\n                if (sel) {\n                    const node = this.findNode(sel)\n                    const prov = this.props.provider\n                    prov.quick_setPropertyValue(sel, 'tx', node.position.x)\n                    prov.quick_setPropertyValue(sel, 'ty', node.position.y)\n                    prov.quick_setPropertyValue(sel, 'tz', node.position.z)\n                }\n            })\n        }\n\n        if(this.props.editable) {\n            this.tools = new panel2d(this.scene, this.camera)\n            this.tools.position.set(-1, 0, -3)\n            this.scene.add(this.tools)\n\n\n            this.tools.add(new button2d()\n                .setAll({x: 5, y: 5, text: 'add box'})\n                .on(POINTER_CLICK, () => {\n                    const scene = this.props.provider.accessObject(this.currentScene)\n                    this.props.provider.add3DObject(OBJ_TYPES.cube,scene)\n                }))\n            this.tools.add(new button2d()\n                .setAll({x: 5, y: 5 + 30, text: 'add sphere'})\n                .on(POINTER_CLICK, () => {\n                    const scene = this.props.provider.accessObject(this.currentScene)\n                    this.props.provider.add3DObject(OBJ_TYPES.sphere,scene)\n                }))\n            this.tools.add(new button2d()\n                .setAll({x: 5, y: 5 + 30 + 30, text: 'delete'})\n                .on(POINTER_CLICK, ()=>{\n                    deleteObject(this.props.provider)\n                }))\n            this.tools.add(new button2d()\n                .setAll({x: 5, y: 5 + 30 + 30 + 30, text: 'save'})\n                .on(POINTER_CLICK, this.props.provider.save))\n            const runButton = new button2d()\n                .setAll({x:5, y: 5+30*4, text:'run'})\n                .on(POINTER_CLICK,() => {\n                    if(this.scriptManager.isRunning()) {\n                        runButton.set('text','run')\n                        this.scriptManager.stopRunning()\n                    } else {\n                        runButton.set('text','stop')\n                        this.scriptManager.startRunning()\n                        this.scriptManager.startFirstScene()\n                    }\n                })\n            this.tools.add(runButton)\n\n            const rowLayout = (panel) => {\n                let x = 0\n                panel.comps.forEach((c) => {\n                    c.x = x\n                    c.y = 0\n                    x += c.w + panel.padding\n                })\n            }\n\n            const color_group = new group2d().setAll({x: 5, y: 5 + 30 * 5, w: 235, h: 35, layout: rowLayout})\n            SIMPLE_COLORS.forEach(c => {\n                color_group.add(new button2d()\n                    .setAll({text: ' ', normalBg: c})\n                    .on(POINTER_CLICK, () => this.props.provider.setColor(c))\n                )\n            })\n\n            this.tools.add(color_group)\n\n            this.tools.redraw()\n        }\n\n    }\n\n\n    updateSceneOp(op) {\n        //only do scenes with create_object\n        if (op.type === CREATE_OBJECT) {\n            if(op.defaults) {\n                //console.log(\"creating object with defaults\",op.defaults)\n                if(op.defaults.type === 'scene') {\n                    let node =  this.findNode(op.id)\n                    if(node) {\n                        // console.log(\"scene already exists. skipping\", node.name)\n                    } else {\n                        // console.log(\"Making a real scene\", op)\n                        const obj = this.props.provider.accessObject(op.id)\n                        node = new SceneDef().makeNode(obj, this.props.provider)\n                        this.insertNodeMapping(op.id,node)\n                        this.sceneWrappers[op.id] = node\n                        this.stagePos.add(node)\n                        // this.scene.add(node)\n                        this.swapScene(op.id)\n                    }\n                }\n            }\n        }\n        // other objects are done with insert_element\n        if (op.type === INSERT_ELEMENT) {\n            const obj = this.props.provider.accessObject(op.value)\n            if (obj.type === 'scene') return // console.log(\"skipping insert scene\")\n            if(is3DObjectType(obj.type)) {\n                const nodeObj = get3DObjectDef(obj.type).makeNode(obj, this.props.provider)\n                on(nodeObj, POINTER_CLICK, this.standardViewClickHandler)\n                this.insertNodeMapping(obj.id, nodeObj)\n                this.findNode(obj.parent).add(nodeObj)\n                return\n            }\n            if(obj.type === TOTAL_OBJ_TYPES.ASSETS_LIST) return\n            if(obj.type === TOTAL_OBJ_TYPES.ASSET) return\n            if(obj.type === TOTAL_OBJ_TYPES.BEHAVIORS_LIST) return\n            if(obj.type === TOTAL_OBJ_TYPES.BEHAVIOR) return\n            if(obj.type === TOTAL_OBJ_TYPES.BEHAVIOR_SCRIPT) return\n            console.warn(\"unknown object type\", obj)\n            return\n        }\n        if (op.type === SET_PROPERTY) {\n            const obj = this.props.provider.accessObject(op.object)\n            if(obj.type === 'asset') return\n            if(obj.type === 'assets') return\n            const node = this.findNode(op.object)\n            if (node) {\n                if(op.name === 'parent') return\n                if(obj.type === 'scene') return new SceneDef().updateProperty(node,obj,op,this.props.provider)\n                if(is3DObjectType(obj.type)) return get3DObjectDef(obj.type).updateProperty(node,obj,op, this.props.provider)\n            } else {\n                console.log(\"could not find the node for object id:\", op)\n                console.log(\"objects are\",this.obj_node_map)\n            }\n            return\n        }\n        if(op.type === DELETE_ELEMENT) {\n            const obj = this.props.provider.accessObject(op.value)\n            if(is3DObjectType(obj.type)) {\n                const node = this.findNode(obj.id)\n                this.findNode(obj.parent).remove(node)\n            }\n            return\n        }\n        // console.log('skipping', op.type)\n    }\n    documentSwapped() {\n        console.log(\"totally new document!\")\n        //nuke all the old stuff\n        Object.keys(this.sceneWrappers).forEach(key => {\n            const scene = this.sceneWrappers[key]\n            if(this.controls) scene.remove(this.controls)\n            this.stagePos.remove(scene)\n        })\n        this.sceneWrappers = {}\n        this.obj_node_map = {}\n        // this.setState({scene: -1})\n        //make new stuff\n        const graph = this.props.provider.getDocGraph()\n        console.log(\"we are rebuilding using this graph\",graph)\n        this.rebuildNode(graph,\"\")\n    }\n\n    rebuildNode(obj, inset) {\n        console.log(inset,\"rebuilding\",obj.type)\n        if(obj.type === TOTAL_OBJ_TYPES.SCENE) {\n            const node = new SceneDef().makeNode(obj, this.props.provider)\n            this.insertNodeMapping(obj.id,node)\n            this.sceneWrappers[obj.id] = node\n            this.stagePos.add(node)\n            this.swapScene(obj.id)\n        }\n        if(is3DObjectType(obj.type)) {\n            const node = get3DObjectDef(obj.type).makeNode(obj, this.props.provider)\n            on(node, POINTER_CLICK, this.standardViewClickHandler)\n            this.insertNodeMapping(obj.id, node)\n            this.findNode(obj.parent).add(node)\n        }\n        if(obj.children) {\n            obj.children.forEach(ch => {\n                this.rebuildNode(ch,inset+\"   \")\n            })\n        }\n    }\n\n    swapScene(id) {\n        this.currentScene = id\n        console.log(\"swapping to the scene\",id)\n        //make all scenes invisible except the right one\n        Object.keys(this.sceneWrappers).forEach(key => {\n            const scene = this.sceneWrappers[key]\n            scene.visible = (key === id)\n            if(this.controls) scene.remove(this.controls)\n        })\n        if(this.controls) this.sceneWrappers[id].add(this.controls)\n        this.sceneWrappers[id].position.x = 0\n        this.sceneWrappers[id].position.z = 0\n    }\n\n\n    loadScene() {\n    }\n\n    insertNodeMapping(id, node) {\n        if (typeof id !== 'string') throw new Error(\"cannot map an object to an object. invalid call in insertNodeMapping\")\n        this.obj_node_map[id] = node\n        if(node.previewUpdate) this.previewUpdateNodes.push(node)\n        node.userData.graphid = id\n    }\n\n    findNode(id) {\n        if (!this.obj_node_map[id]) console.warn(\"could not find node for id\", id)\n        return this.obj_node_map[id]\n    }\n\n\n}\n\n\n","import React, {Component} from 'react'\nimport {DialogManager, HBox, VBox} from 'appy-comps'\nimport {listToArray} from '../../syncgraph/utils'\nimport {Dialog} from '../../common/Dialog'\n\nexport class AddGLTFAssetDialog extends Component {\n    cancel = () => {\n        DialogManager.hide()\n    }\n    okay = () => {\n        DialogManager.hide()\n        listToArray(this.fileinput.files).forEach(file => {\n            console.log(\"got the file\", file)\n        })\n    }\n\n    render() {\n        return <Dialog visible={true} onScrimClick={this.cancel}>\n            <VBox>\n                <h3>add GLTF file assets</h3>\n                <p>\n                    chose <b>the directory</b> containing the GLTF file\n                </p>\n                <input type=\"file\" ref={(obj) => this.fileinput = obj} onChange={this.selectedFile} multiple={true}\n                       webkitdirectory=\"true\"/>\n                <HBox>\n                    <button onClick={this.cancel}>cancel</button>\n                    <button onClick={this.okay}>okay</button>\n                </HBox>\n            </VBox>\n        </Dialog>\n    }\n\n    selectedFile = (e) => {\n        console.log(\"selected a file\", e.target)\n    }\n}\n","import React, {Component} from 'react'\nimport {DialogManager, HBox, VBox} from 'appy-comps'\nimport {listToArray} from '../../syncgraph/utils'\nimport {addGLBAssetFromFile} from '../AssetActions'\nimport {Dialog} from '../../common/Dialog'\n\nexport class AddGLBAssetDialog extends Component {\n    cancel = () => {\n        DialogManager.hide()\n    }\n    okay = () => {\n        DialogManager.hide()\n        listToArray(this.fileinput.files).forEach(file => {\n            addGLBAssetFromFile(file, this.props.provider)\n        })\n    }\n\n    render() {\n        return <Dialog visible={true} onScrimClick={this.cancel}>\n            <VBox>\n                <h3>add GLB to assets</h3>\n                <p>\n                    choose a GLB file\n                </p>\n                <input type=\"file\" ref={(obj) => this.fileinput = obj} onChange={this.selectedFile} multiple={true}/>\n                <HBox>\n                    <button onClick={this.cancel}>cancel</button>\n                    <button onClick={this.okay}>okay</button>\n                </HBox>\n            </VBox>\n        </Dialog>\n    }\n\n    selectedFile = (e) => {\n        console.log(\"selected a file\", e.target)\n    }\n}\n","import React, {Component} from 'react'\nimport {DialogManager, HBox, VBox} from 'appy-comps'\nimport {listToArray} from '../../syncgraph/utils'\nimport {ToggleButton, Toolbar} from '../../common/GridEditorApp'\nimport {addAudioAssetFromFile, addAudioAssetFromURL} from '../AssetActions'\nimport {Dialog} from '../../common/Dialog'\n\nexport class AddAudioAssetDialog extends Component {\n    constructor(props) {\n        super(props)\n        this.state = {\n            view:'local',\n            url:\"\",\n        }\n        this.fileInput = React.createRef();\n    }\n\n    cancel = () => {\n        DialogManager.hide()\n    }\n    okay = () => {\n        DialogManager.hide()\n        if(this.state.view === 'remote') {\n            console.log(\"adding the url\",this.state.url)\n            addAudioAssetFromURL(null,this.state.url, this.props.provider)\n        } else {\n            console.log(\"the file input is\",this.fileInput)\n            listToArray(this.fileInput.current.files).forEach(file => {\n                addAudioAssetFromFile(file, this.props.provider)\n            })\n        }\n    }\n    switchLocal = () => this.setState({view:'local'})\n    switchRemote = () => this.setState({view:'remote'})\n\n    render() {\n        return <Dialog visible={true} onScrimClick={this.cancel}>\n            <VBox grow>\n                <h3>add audio to assets</h3>\n                <VBox grow>\n                    <Toolbar>\n                        <ToggleButton onClick={this.switchLocal} selected={this.state.view==='local'}>local</ToggleButton>\n                        <ToggleButton onClick={this.switchRemote} selected={this.state.view==='remote'}>remote</ToggleButton>\n                    </Toolbar>\n                    {this.renderSelectedPanel()}\n                </VBox>\n                <HBox>\n                    <button onClick={this.cancel}>cancel</button>\n                    <button onClick={this.okay}>okay</button>\n                </HBox>\n            </VBox>\n        </Dialog>\n    }\n\n    selectedFile = (e) => {\n        console.log(\"selected a file\", e.target)\n        this.setState({fileInput:e.target.value})\n    }\n\n    typedURL = (e) => {\n        this.setState({url:e.target.value})\n    }\n\n    renderSelectedPanel() {\n        if(this.state.view === 'local') {\n            return <HBox>\n                <label>File\n                    <input key=\"f1\" type=\"file\" onChange={this.selectedFile} ref={this.fileInput}/>\n                </label>\n            </HBox>\n        } else {\n            return <HBox>\n                <label>URL\n                    <input key=\"f2\" value={this.state.url} type=\"input\" onChange={this.typedURL}/>\n                </label>\n            </HBox>\n        }\n    }\n}\n","import React, {Component} from 'react'\nimport {DialogManager, HBox, VBox} from 'appy-comps'\nimport {Dialog} from '../../common/Dialog'\n\nexport class UnsavedDocumentDialog extends Component {\n    cancel = () => {\n        DialogManager.hide()\n    }\n    okay = () => {\n        DialogManager.hide()\n        this.props.onAnyway()\n    }\n    render() {\n        return <Dialog visible={true} onScrimClick={this.cancel} width=\"600px\" height=\"auto\">\n            <VBox grow>\n                <h3>Warning. Your document has unsaved changes.</h3>\n                <p>Press cancel to go back</p>\n                <p>Press continue to continue anyway and lose the unsaved changes</p>\n                <HBox>\n                    <button onClick={this.cancel}>cancel</button>\n                    <button onClick={this.okay}>continue!</button>\n                </HBox>\n            </VBox>\n        </Dialog>\n    }\n}\n\n","import React, {Component} from 'react'\nimport {DialogManager, HBox, VBox} from 'appy-comps'\nimport {toQueryString} from '../../utils'\nimport {AuthModule} from '../AuthModule'\nimport {Dialog} from '../../common/Dialog'\n\n\nexport class OpenFileDialog extends Component {\n    constructor(props) {\n        super(props)\n        this.state = {\n            docList:[]\n        }\n    }\n    refreshList = () => {\n        this.props.provider.loadDocList().then((docs) => this.setState({docList:docs}))\n    }\n    componentDidMount() {\n        this.refreshList()\n    }\n    generateDocUrl(doc) {\n        const opts = Object.assign({},this.props.provider.options,{\n            mode:'edit',\n            switcher:false,\n            doc:doc.id\n        })\n        const url = `./?${toQueryString(opts)}`\n        return url\n    }\n    deleteDoc(info) {\n        return this.props.provider.removeDoc(info).then((res)=>{\n            console.log('removed?',res)\n            this.refreshList()\n        })\n    }\n\n    dismiss = () => {\n        DialogManager.hide()\n    }\n    render() {\n        return <Dialog visible={true} onScrimClick={this.dismiss}>\n            <h3>Open document</h3>\n            <VBox scroll style={{flex:1}}>\n                <ul>{this.state.docList.map((doc, i) => {\n\n                    return <li key={i}>\n                        <b>{doc.title}</b>\n                        <a className={\"button\"} href={this.generateDocUrl(doc)}>open</a>\n                        {this.renderDeleteButton(doc)}\n                    </li>\n                })}\n                </ul>\n            </VBox>\n            <HBox className={\"footer\"}>\n                <button onClick={this.dismiss}>dismiss</button>\n            </HBox>\n        </Dialog>\n    }\n\n    renderDeleteButton(doc) {\n        if(!AuthModule.supportsDocDelete()) return \"\"\n        return <button onClick={()=>this.deleteDoc(doc)}>delete</button>\n\n    }\n\n}\n","import React, {Component} from 'react'\nimport {DialogManager, HBox, VBox} from 'appy-comps'\nimport {isAudioType, isGLTFType, isImageType, isVideoType} from '../Common'\nimport {AuthModule} from '../AuthModule'\nimport {\n    addAudioAssetFromURL,\n    addGLBAssetFromURL,\n    addImageAssetFromExpandedURL,\n    addVideoAssetFromURL\n} from '../AssetActions'\nimport {Dialog} from '../../common/Dialog'\n\nexport class OpenAssetDialog extends Component {\n    constructor(props) {\n        super(props)\n        this.state = {\n            assetList:[]\n        }\n    }\n    refreshList = () => {\n        this.props.provider.loadAssetList()\n            .then((assets) => {\n                if(this.props.filter) assets = assets.filter(this.props.filter)\n                this.setState({assetList:assets})\n            })\n    }\n    componentDidMount() {\n        this.refreshList()\n    }\n    addAsset(info) {\n        DialogManager.hide()\n        if(isImageType(info.mimeType)) {\n            return addImageAssetFromExpandedURL(info.id, info.url,info.mimeType, info.title, this.props.provider)\n        }\n        if(isAudioType(info.mimeType)) {\n            return addAudioAssetFromURL(info.id, info.url, info.mimeType, info.title, this.props.provider)\n        }\n        if(isVideoType(info.mimeType)) {\n            return addVideoAssetFromURL(info.id, info.url, info.mimeType, info.title, this.props.provider)\n        }\n        if(isGLTFType(info.mimeType)) {\n            return addGLBAssetFromURL(info.id, info.url, info.mimeType, info.title, this.props.provider)\n        }\n        console.log(\"can't add this type\",info.mimeType)\n    }\n    deleteAsset(info) {\n        return this.props.provider.removeAssetSource(info).then((res)=>{\n            console.log('removed?',res)\n            this.refreshList()\n        })\n    }\n\n    okay = () => {\n        DialogManager.hide()\n    }\n    render() {\n        return <Dialog visible={true} onScrimClick={this.okay}>\n            <h3>Add Asset</h3>\n            <VBox scroll grow>\n                <ul>{this.state.assetList.map((doc, i) => {\n                    return <li key={i}>\n                        <b>{doc.title} </b>\n                        <i> {doc.mimeType}</i>\n                        <button onClick={()=>this.addAsset(doc)}>add</button>\n                        {this.renderDeleteButton(doc)}\n                    </li>\n                })}\n                </ul>\n            </VBox>\n            <HBox className={\"footer\"}>\n                <button onClick={this.okay}>close</button>\n            </HBox>\n        </Dialog>\n    }\n\n    renderDeleteButton(doc) {\n        if(!AuthModule.supportsAssetUpload()) return \"\"\n        return <button onClick={()=>this.deleteAsset(doc)}>delete</button>\n\n    }\n}\n","import React, {Component} from \"react\"\nimport {TREE_ITEM_PROVIDER} from '../TreeItemProvider'\nimport selMan, {SELECTION_MANAGER} from '../SelectionManager'\nimport {TOTAL_OBJ_TYPES} from './Common'\nimport AceEditor from 'react-ace'\nimport 'brace/mode/javascript'\nimport 'brace/theme/github'\n\nexport default class ScriptEditor extends Component {\n    constructor(props) {\n        super(props)\n        this.refresh = () => {\n            const id = selMan.getSelection()\n            const obj = this.props.provider.accessObject(id)\n            console.log('id',id,obj.exists(), obj.type)\n            if(obj.exists() && obj.type === TOTAL_OBJ_TYPES.BEHAVIOR_SCRIPT) {\n                this.props.provider.fetchBehaviorAssetContents(id).then(text => {\n                    this.setState({id:id, text:text})\n                })\n            } else {\n            }\n        }\n        this.state = {\n            id:null,\n            text:'empty',\n        }\n    }\n    componentDidMount() {\n        this.refresh()\n        this.props.provider.on(TREE_ITEM_PROVIDER.PROPERTY_CHANGED,this.refresh)\n        selMan.on(SELECTION_MANAGER.CHANGED,this.swap)\n    }\n\n    componentWillUnmount() {\n        this.props.provider.off(TREE_ITEM_PROVIDER.PROPERTY_CHANGED,this.refresh)\n        selMan.off(SELECTION_MANAGER.CHANGED,this.swap)\n    }\n    swap = () => {\n        const obj = this.props.provider.accessObject(selMan.getSelection())\n        if(obj.exists()  && obj.type === TOTAL_OBJ_TYPES.BEHAVIOR_SCRIPT) {\n            this.refresh()\n        }\n    }\n    changeText = (value) => this.setState({text:value})\n    save = (e) => {\n        this.props.provider.updateBehaviorAssetContents(this.state.id,this.state.text)\n    }\n    render() {\n        if(this.state.id === null) return <div>loading</div>\n        return <AceEditor mode=\"javascript\"\n                          theme=\"github\"\n                          name=\"script-editor\"\n                          value={this.state.text}\n                          onChange={this.changeText}\n                          onBlur={this.save}\n                          showGutter={true}\n                          width={'100%'}\n                          height={'100%'}\n        />\n    }\n\n}","import React, {Component} from 'react'\nimport {DialogManager, HBox, VBox} from 'appy-comps'\nimport {Spacer} from '../../common/GridEditorApp'\nimport {AuthModule} from '../AuthModule'\nimport {Dialog} from '../../common/Dialog'\n\nexport class OpenScriptDialog extends Component {\n    constructor(props) {\n        super(props)\n        this.state = {\n            scripts:[]\n        }\n    }\n    refreshList = () => {\n        this.props.provider.loadScriptList()\n            .then((scripts) => this.setState({scripts:scripts}))\n    }\n    componentDidMount() {\n        this.refreshList()\n    }\n    addScript(info) {\n        DialogManager.hide()\n        console.log(\"URL is\",info.url)\n        info.url = info.name\n        console.log(\"Now URL is\",info.url)\n        const beh = this.props.provider.addBehaviorAssetFromURL(info)\n        if(this.props.onAdd) this.props.onAdd(beh)\n    }\n    deleteScript(info) {\n        return this.props.provider.removeBehaviorAssetSource(info.name)\n            .then(()=> this.refreshList())\n    }\n\n    okay = () => DialogManager.hide()\n\n    render() {\n        return <Dialog visible={true} onScrimClick={this.okay}>\n            <h3>Choose Behavior Script</h3>\n            <VBox scroll>\n                <ul className=\"behaviors-list\">{this.state.scripts.map((doc, i) => {\n                    return <HBox key={doc.name}>\n                        <VBox>\n                            <div>\n                                <i>{doc.name}</i> -  <b>{doc.title}</b>\n                            </div>\n\n                            <p>{doc.description}</p>\n                        </VBox>\n                        <Spacer/>\n                        <button onClick={()=>this.addScript(doc)}>add</button>\n                        {this.renderDeleteButton(doc)}\n                    </HBox>\n                })}\n                </ul>\n            </VBox>\n            <HBox className={\"footer\"}>\n                <button onClick={this.okay}>close</button>\n            </HBox>\n        </Dialog>\n    }\n\n    renderDeleteButton(doc) {\n        if(!AuthModule.supportsScriptEdit()) return \"\"\n        return <button onClick={()=>this.deleteScript(doc)}>delete</button>\n    }\n\n}\n","export const CUSTOM_BEHAVIOR_SCRIPT = `\n/*\n #title untitled behavior\n #description does something\n*/\n({\n  // defines a target property. must be a scene\n    properties: {\n        scene: { \n            type:'enum', \n            title: 'target scene', \n            value:null, \n            hints: {\n                type:'node',\n                nodeType:'scene'\n            }\n        },\n    },\n    start: function(evt) {\n        //called when the program starts\n    },\n    click: function(evt) {\n        //called when object is clicked on\n        //this.navigateScene(this.properties.scene)\n    }\n})\n`\n\n\n\nexport const CUSTOM_SCENE_SCRIPT = `\n/*\n #title scene script\n #description does something\n*/\n({\n    // defines a target property. must be a scene\n    properties: {\n        scene: { \n            type:'enum', \n            title: 'target scene', \n            value:null, \n            hints: {\n                type:'node',\n                nodeType:'scene'\n            }\n        },\n    },\n    start: function(evt) {\n        //called when the program starts\n    },\n    enter: function(evt) {\n        //called when entering a scene\n    },\n    tick: function(evt) {\n        //called on every frame\n    },\n    exit: function(evt) {\n        //called when exiting a scene\n    },\n    stop: function(evt) {\n        //called when the program stops\n    },\n})\n`","import React, {Component} from 'react'\nimport QRCode from 'qrcode'\n\nexport default class QRCanvas extends Component {\n    componentDidMount() {\n        if (this.canvas) this.redraw()\n    }\n\n    componentWillReceiveProps(newProps) {\n        if (this.canvas) this.redraw()\n    }\n\n    redraw() {\n        QRCode.toCanvas(this.canvas, this.props.url, {width: this.props.width, height: this.props.height})\n    }\n\n    render() {\n        let style = {}\n        if (this.props.style) Object.assign(style, this.props.style)\n        return <canvas width={this.props.width} height={this.props.height} ref={(canvas) => this.canvas = canvas} style={style}/>\n    }\n}","import React, {Component} from 'react'\nimport {DialogManager, HBox, VBox} from 'appy-comps'\nimport QRCanvas from '../../common/QRCanvas'\nimport {Dialog} from '../../common/Dialog'\n\nexport class QRDialog extends Component {\n\n    okay = () => {\n        DialogManager.hide()\n    }\n\n    render() {\n        let url = null\n        if(this.props.url) url = this.props.url\n        let wurl = url.replace(\"https\",\"wxrv\")\n        wurl = wurl.replace(\"http\",\"wxrv\")\n        return <Dialog visible={true} onScrimClick={this.okay}>\n            <VBox grow>\n                <h3>{this.props.text?this.props.text:'Scan'}</h3>\n                <VBox grow>\n                    <label><a href={url}>{url}</a></label>\n                    <QRCanvas url={wurl} width={160} height={160}/>\n                </VBox>\n                <HBox>\n                    <button onClick={this.okay}>dismiss</button>\n                </HBox>\n            </VBox>\n        </Dialog>\n    }\n\n}\n","import React, {Component} from 'react'\nimport {DialogManager, HBox, VBox} from 'appy-comps'\nimport {AuthModule} from '../AuthModule'\nimport {Dialog} from '../../common/Dialog'\nimport {Spacer} from '../../common/GridEditorApp'\n\nexport class PasswordDialog extends Component {\n    constructor(props) {\n        super(props)\n        this.state = {\n            field:\"\"\n        }\n    }\n    cancel = () => {\n        DialogManager.hide()\n    }\n    okay = () => {\n        DialogManager.hide()\n        AuthModule.doPasswordLogin(this.state.field)\n    }\n    keyDown = (e) => {\n        if(e.key === 'Enter') this.okay()\n    }\n    render() {\n        return <Dialog visible={true} onScrimClick={this.cancel} width=\"600px\" height=\"auto\">\n            <VBox grow>\n                <h3>login with the password from your env file</h3>\n                <label>password</label>\n                <input type={\"password\"} value={this.state.field}\n                       onKeyDown={this.keyDown}\n                       onChange={(e)=>{\n                    this.setState({field:e.target.value})\n                }}/>\n                <HBox>\n                    <Spacer/>\n                    <button onClick={this.cancel}>cancel</button>\n                    <button onClick={this.okay}>okay</button>\n                </HBox>\n            </VBox>\n        </Dialog>\n    }\n}\n\n","import React, {Component} from 'react'\nimport {DialogManager, HBox, VBox} from 'appy-comps'\nimport {AuthModule} from '../AuthModule'\nimport {getLoginURL} from '../../TreeItemProvider'\nimport {Dialog} from '../../common/Dialog'\n\nexport class GithubAuthDialog extends Component {\n    constructor(props) {\n        super(props)\n        this.state = {\n            data:null\n        }\n    }\n    componentDidMount() {\n        console.log(\"opening dialog\")\n        AuthModule.getJSON(getLoginURL()).then(data => {\n            console.log(\"got the data\",data)\n            this.setState({data:data})\n        })\n    }\n\n    cancel = () => {\n        DialogManager.hide()\n    }\n    okay = () => {\n        DialogManager.hide()\n        console.log(\"opening window with the data\",this.state.data)\n        AuthModule.login(this.state.data)\n    }\n    render() {\n        return <Dialog visible={true} onScrimClick={this.cancel}>\n            <VBox grow>\n                <h3>Github Auth</h3>\n                <p>To log into MrEd you need a github account. Press the button\n                below to log into github and approve MrEd's access. The app will only use\n                Github for authentication. It does not have access to any of your projects or code.\n                </p>\n                <button onClick={this.okay}>Open Github</button>\n                <HBox>\n                    <button onClick={this.cancel}>cancel</button>\n                </HBox>\n            </VBox>\n        </Dialog>\n    }\n}\n\n","import React, {Component} from 'react'\n\nexport class ErrorCatcher extends Component {\n\n\n    constructor(props, context) {\n        super(props, context)\n        this.state = {error:false }\n    }\n\n    componentDidCatch(error, errorInfo) {\n        this.setState({error:true})\n        const logger = this.props.logger\n        if(!logger) {\n            console.log(\"NO LOGGER!\")\n            return\n        }\n        logger.error(\"an error occurred at the react level\")\n        logger.error(error)\n        logger.error(errorInfo)\n    }\n\n    render() {\n        if(this.state.error === true) {\n            return <div><h1>An error happened. Please look at the console</h1></div>\n        }\n\n        return this.props.children\n    }\n\n}","import {ASSET_TYPES} from './Common'\nimport {DoubleSide, MeshLambertMaterial, TextureLoader, VideoTexture} from 'three'\nimport {AuthModule} from './AuthModule'\nimport {getAssetsURL} from '../TreeItemProvider'\n\nexport class AssetsManager {\n    constructor(provider) {\n        this.provider = provider\n        this.assets_url_map = {}\n        this.videocache = {}\n    }\n\n    cacheAssetsList() {\n        return AuthModule.getJSON(`${getAssetsURL()}list`).then(assets => {\n            if(!assets || !assets.forEach) return\n            if(AuthModule.supportsAssetUpload()) {\n                //doc server version\n                assets.forEach(asset => {\n                    this.assets_url_map[asset.id] = getAssetsURL()+asset.id\n                })\n            } else {\n                //glitch server version\n                assets.forEach(asset => {\n                    this.assets_url_map[asset.title] = asset.url\n                })\n                console.log(\"cached the assets\",this.assets_url_map)\n            }\n        })\n    }\n\n    getAssetURL(asset) {\n        console.log(\"getting asset url\",asset)\n        if(asset.assetId) {\n            console.log(\"converting asset id\",asset.assetId)\n            return this.assets_url_map[asset.assetId]\n        } else {\n            return asset.src\n        }\n    }\n\n\n    playMediaAsset(asset, trusted=false) {\n        const lg = this.provider.getLogger()\n        lg.log(\"playing the asset\",asset)\n        const url = this.getAssetURL(asset)\n        lg.log(\"playing the url\",url)\n        const cache = this.videocache\n        if(cache[url]) cache[url].play()\n    }\n\n    stopAllMedia() {\n        const cache = this.videocache\n        Object.keys(cache).forEach(key => {\n            const item = cache[key]\n            if(item.pause) {\n                item.pause()\n            }\n        })\n    }\n\n\n    getTexture(id) {\n        const asset = this.provider.accessObject(id)\n        if(!asset.exists()) return null\n        const url = this.getAssetURL(asset)\n        if(!url) {\n            this.provider.getLogger().error(\"==== null url from asset\",asset)\n            return\n        }\n        this.provider.getLogger().log(\"loading asset url\",url)\n        if(asset.subtype === ASSET_TYPES.IMAGE) {\n            const tex = new TextureLoader().load(url)\n            return tex\n        }\n        if(asset.subtype === ASSET_TYPES.VIDEO) {\n            let video\n            if(!this.videocache[url]) {\n                video = document.createElement('video')\n                video.crossOrigin = 'anonymous'\n\n                // video will only play inline on mobile devices if it's muted\n                // we will loop video\n                video.muted = true;\n                video.loop = true;\n                video.setAttribute( 'playsinline', '' );\n\n                video.src = url\n                this.videocache[url] = video\n            } else {\n                video = this.videocache[url]\n            }\n            const tex = new VideoTexture(video)\n            return tex\n        }\n        return null\n    }\n}","import SyncGraphProvider from '../syncgraph/SyncGraphProvider'\nimport React, {Component} from 'react'\nimport GridEditorApp, {MenuPopup, Panel, Spacer, Toolbar} from '../common/GridEditorApp'\nimport TreeTable from '../common/TreeTable'\nimport PropSheet, {TYPES} from '../common/PropSheet'\nimport SelectionManager, {SELECTION_MANAGER} from '../SelectionManager'\nimport {VRCanvas} from './VRCanvas'\nimport {getAssetsURL, getDocsURL, getScriptsURL, TREE_ITEM_PROVIDER} from '../TreeItemProvider'\nimport ImmersiveVREditor from './ImmersiveVREditor'\nimport {fetchGraphObject, insertAsFirstChild, insertAsLastChild, listToArray} from '../syncgraph/utils'\nimport CubeDef from \"./defs/CubeDef\"\nimport SceneDef from \"./defs/SceneDef\"\nimport InputManager from \"../common/InputManager\"\nimport {DialogContainer, DialogManager, HBox, PopupContainer, PopupManager, VBox} from \"appy-comps\"\nimport {\n    ASSET_TYPES,\n    canBeDeleted,\n    canHaveBehavior,\n    canHaveScene,\n    canHaveShape,\n    get3DObjectDef,\n    HORIZONTAL_ALIGNMENT,\n    is3DObjectType,\n    isGLTFFile,\n    isImageType,\n    ITEM_ICONS,\n    NONE_ASSET,\n    OBJ_TYPES,\n    parseBehaviorScript,\n    PROP_DEFS,\n    REC_TYPES,\n    SIMPLE_COLORS,\n    TOTAL_OBJ_TYPES\n} from './Common'\nimport {AddImageAssetDialog} from './dialogs/AddImageAssetDialog'\nimport {AddGLTFAssetDialog} from './dialogs/AddGLTFAssetDialog'\nimport {AddGLBAssetDialog} from './dialogs/AddGLBAssetDialog'\nimport {AddAudioAssetDialog} from './dialogs/AddAudioAssetDialog'\nimport {UnsavedDocumentDialog} from \"./dialogs/UnsavedDocumentDialog\"\nimport AssetView from '../metadoc/AssetView'\nimport * as ToasterMananager from './ToasterManager'\nimport GraphAccessor from \"../syncgraph/GraphAccessor\"\nimport {toQueryString} from '../utils'\nimport {OpenFileDialog} from './dialogs/OpenFileDialog'\nimport {AuthModule, CONNECTED, USER_CHANGE} from './AuthModule'\nimport {OpenAssetDialog} from './dialogs/OpenAssetDialog'\nimport ScriptEditor from './ScriptEditor'\nimport {OpenScriptDialog} from './dialogs/OpenScriptDialog'\nimport {CUSTOM_BEHAVIOR_SCRIPT, CUSTOM_SCENE_SCRIPT} from './Templates'\nimport {\n    addScene,\n    deleteObject,\n    generateAddAssetPopup,\n    newDoc,\n    showAddAssetPopup,\n    showAddBehaviorPopup,\n    showAddPopup\n} from './Actions'\nimport {addGeoAnchorAsset, addGLBAssetFromFile, addImageAssetFromFile} from './AssetActions'\nimport {QRDialog} from './dialogs/QRDialog'\nimport {PasswordDialog} from './dialogs/PasswordDialog'\nimport {GithubAuthDialog} from './dialogs/GithubAuthDialog'\nimport {ErrorCatcher} from './ErrorCatcher'\nimport {AssetsManager} from './AssetsManager'\nimport {ConsoleLogger} from '../syncgraph/PubnubSyncWrapper'\n\n\nexport default class VREditor extends SyncGraphProvider {\n    constructor(options) {\n        super(options)\n        this.imagecache = {}\n        this.behaviorCache = {}\n        this.orbit_state = {}\n        this.assetsManager = new AssetsManager(this)\n    }\n    getDocType() { return \"vr\" }\n    getApp = () => {\n        if(this.mode === 'edit') return <VREditorApp provider={this}/>\n        if(this.mode === 'vredit') return <ImmersiveVREditor provider={this} editable={true}/>\n        if(this.mode === 'embed-view') return <ImmersiveVREditor provider={this} editable={false}/>\n        if(this.mode === 'vrview') return <ImmersiveVREditor provider={this} editable={false}/>\n        console.log(\"no mode!\")\n    }\n    getTitle = () => \"MrEd\"\n    getDocTitle = () => this.accessObject(this.getSceneRoot()).title\n    setDocTitle = (title) => this.accessObject(this.getSceneRoot()).set('title',title)\n    getLogger = () => {\n        if(this.pubnub) return this.pubnub.getLogger()\n        return new ConsoleLogger()\n    }\n\n    makeEmptyRoot(doc) {\n        //make root\n        const root = fetchGraphObject(doc,doc.createObject({ type:TOTAL_OBJ_TYPES.ROOT, title:'Untitled Project', defaultScene:0, children:doc.createArray() }))\n        //make scene\n        const scene1 = new SceneDef().make(doc,root)\n        //make cube\n        const obj = new CubeDef().make(doc,scene1)\n        //make assets\n        const assets = fetchGraphObject(doc,doc.createObject({type:TOTAL_OBJ_TYPES.ASSETS_LIST,\n            title:'Assets', children: doc.createArray(), parent:0}))\n        //make behaviors\n        const behaviors = fetchGraphObject(doc,doc.createObject({type:TOTAL_OBJ_TYPES.BEHAVIORS_LIST,\n            title:'Behaviors', children: doc.createArray(), parent:0}))\n        //tie it all together\n        insertAsFirstChild(doc,root,scene1)\n        insertAsFirstChild(doc,scene1,obj)\n        insertAsLastChild(doc,root,behaviors)\n        insertAsLastChild(doc,root,assets)\n    }\n    docLoaded = () => {\n        //pre-cache all of the behaviors\n        this.accessObject(this.getBehaviorsObject()).getChildren()\n            .filter(a => a.type === TOTAL_OBJ_TYPES.BEHAVIOR_SCRIPT)\n            .forEach((b)=>{\n                this.fetchBehaviorAssetContents(b.id).then((contents)=> {\n                    try {\n                        const info = parseBehaviorScript(contents)\n                        info.text = contents\n                        this.setCachedBehaviorAsset(b.id, info)\n                    } catch (e) {\n                        console.error(e)\n                    }\n                })\n            })\n        //get a list of assets for calculating the correct URLS.\n        return this.assetsManager.cacheAssetsList()\n    }\n\n    getRendererForItem = (item) => {\n        const obj = this.accessObject(item)\n        if(!obj.exists()) return <div>???</div>\n        if(obj.type === TOTAL_OBJ_TYPES.ASSET) return <div><i className={`fa fa-${ITEM_ICONS[obj.subtype]}`}/> {obj.title}</div>\n        if(ITEM_ICONS[obj.type]) return <div><i className={`fa fa-${ITEM_ICONS[obj.type]}`}/> {obj.title}</div>\n        return <div>{obj.title}</div>\n    }\n\n    getProperties(item) {\n        function copyPropDef(def,value) {\n            const out = {};\n            Object.keys(def).forEach((key) => out[key] = def[key])\n            out.value = value\n            return out;\n        }\n        let defs = []\n        if(!item) return defs\n\n        //show the ID for all objects\n        defs.push({\n            key:'id',\n            name:\"ID\",\n            type:TYPES.STRING,\n            value:item,\n            locked:true\n        })\n\n        const obj = this.accessObject(item)\n        //if a behavior object is selected, get the defs from the root behavior asset\n        if(obj.type === TOTAL_OBJ_TYPES.BEHAVIOR) {\n            const behaviorProps = this.getCachedBehaviorPropDefs(obj.behavior)\n            if(behaviorProps) {\n                Object.keys(behaviorProps).forEach(pname => {\n                    const propdef = behaviorProps[pname]\n                    const ndef = {\n                        key: pname,\n                        name: pname,\n                        type: propdef.type,\n                        value: obj[pname]\n                    }\n                    if(propdef.hints) ndef.hints = propdef.hints\n                    defs.push(ndef)\n                })\n            } else {\n                console.warn(\"Missing prop defs for behavior object\")\n            }\n            defs.push({\n                key:'behavior',\n                name:\"Script\",\n                type:TYPES.STRING,\n                value:obj.behavior,\n                locked:true,\n                custom:true,\n            })\n        }\n\n        const props = this.syncdoc.getPropertiesForObject(item)\n        if(props) {\n            props.forEach(key => {\n                if(key === 'type') return\n                if(key === 'children') return\n                if(key === 'parent') return\n                const value = this.syncdoc.getPropertyValue(item,key)\n                if(PROP_DEFS[key]) {\n                    const def = copyPropDef(PROP_DEFS[key],value)\n                    if(obj.type === TOTAL_OBJ_TYPES.BEHAVIOR_SCRIPT) {\n                        if(key === 'title' || key === 'description') def.locked = true\n                    }\n                    if(obj.type === TOTAL_OBJ_TYPES.ASSET && obj.subtype === ASSET_TYPES.IMAGE) {\n                        if(key === 'width' || key === 'height') def.locked = true\n                    }\n                    return defs.push(def)\n                }\n                // console.log(\"unknown property\",key)\n            })\n        }\n\n\n\n        if(is3DObjectType(obj.type)) {\n            defs.push({\n                key: 'scale',\n                name: 'Scale',\n                type: TYPES.GROUP,\n                group: ['sx','sy','sz'],\n                custom:true,\n            })\n        }\n\n        return defs\n    }\n    setPropertyValue(item, def, value) {\n        if(def.key === 'scale') {\n            super.setPropertyValue(item,{key:'sx'},value.sx)\n            super.setPropertyValue(item,{key:'sy'},value.sy)\n            super.setPropertyValue(item,{key:'sz'},value.sz)\n            return\n        }\n        super.setPropertyValue(item,def,value)\n        //size the plane to match the aspect ratio of the asset\n        if(def.key === PROP_DEFS.asset.key) {\n            const asset = this.accessObject(value)\n            if(asset.subtype === ASSET_TYPES.IMAGE) {\n                let height = (asset.height / asset.width) * this.accessObject(item).width\n                super.setPropertyValue(item, {key: 'height'}, height)\n            }\n            if(asset.subtype === ASSET_TYPES.GLTF) {\n                console.log(\"adjusting to a gtlf\")\n            }\n        }\n    }\n    getValuesForEnum(key,obj,def) {\n        const realobj = this.accessObject(obj)\n        //if this is a property on a behavior, then use the hints to generate a target list\n        if(realobj.exists() && realobj.type === TOTAL_OBJ_TYPES.BEHAVIOR) {\n            if(def.hasHints()) {\n                const hints = def.getHints()\n                if(hints.type === 'node') {\n                    return this.accessObject(this.getSceneRoot())\n                        .find(obj => obj.type === hints.nodeType)\n                        .map(ch => ch.id)\n                }\n                if(hints.type === 'audio') {\n                    return this.accessObject(this.getAssetsObject()).getChildren().filter(a => a.subtype === ASSET_TYPES.AUDIO).map(a => a.id)\n                }\n                if(hints.type === 'video') {\n                    return this.accessObject(this.getAssetsObject()).getChildren().filter(a => a.subtype === ASSET_TYPES.VIDEO).map(a => a.id)\n                }\n            }\n        }\n\n        if (key === PROP_DEFS.asset.key) {\n            const assets = this.accessObject(this.getAssetsObject()).getChildren()\n            if(acceptsImageAsset(realobj.type) && acceptsVideoAsset(realobj.type)) return withNone(assets.filter(a => a.subtype === ASSET_TYPES.VIDEO || a.subtype === ASSET_TYPES.IMAGE).map(a => a.id))\n            if(acceptsVideoAsset(realobj.type)) return withNone(assets.filter(a => a.subtype === ASSET_TYPES.VIDEO).map(a => a.id))\n            if(acceptsModelAsset(realobj.type)) return withNone(assets.filter(a => a.subtype === ASSET_TYPES.GLTF).map(a => a.id))\n            if(acceptsImageAsset(realobj.type)) return withNone(assets.filter(a => a.subtype === ASSET_TYPES.IMAGE).map(a => a.id))\n        }\n        if(key === PROP_DEFS.horizontalAlign.key) {\n            return Object.keys(HORIZONTAL_ALIGNMENT).map(key => HORIZONTAL_ALIGNMENT[key])\n        }\n        if(key === PROP_DEFS.defaultScene.key) {\n            return this.accessObject(this.getSceneRoot()).getChildren()\n                .filter(ch => ch.type === TOTAL_OBJ_TYPES.SCENE)\n                .map(ch => ch.id)\n        }\n        if(key === PROP_DEFS.texture.key) {\n            let assets = this.accessObject(this.getAssetsObject()).getChildren()\n            assets = assets.filter(a => a.subtype === ASSET_TYPES.IMAGE).map(a => a.id)\n            return withNone(assets)\n        }\n        if(key === PROP_DEFS.targetImage.key) {\n            let assets = this.accessObject(this.getAssetsObject()).getChildren()\n            assets = assets.filter(a => a.subtype === ASSET_TYPES.IMAGE).map(a => a.id)\n            return assets\n        }\n        if(key === PROP_DEFS.targetGeoLocation.key) {\n            let assets = this.accessObject(this.getAssetsObject()).getChildren()\n            assets = assets.filter(a => a.subtype === ASSET_TYPES.GEOLOCATION).map(a => a.id)\n            return assets\n        }\n        if(key === PROP_DEFS.recType.key) {\n            return Object.keys(REC_TYPES)\n        }\n    }\n    getRendererForEnum(key,obj) {\n        const realobj = this.accessObject(obj)\n        if(realobj.exists() && realobj.type === TOTAL_OBJ_TYPES.BEHAVIOR) return EnumTitleRenderer\n        switch(key) {\n            case PROP_DEFS.asset.key: return EnumTitleRenderer\n            case PROP_DEFS.defaultScene.key: return EnumTitleRenderer\n            case PROP_DEFS.texture.key: return EnumTitleRenderer\n            case PROP_DEFS.targetImage.key: return EnumTitleRenderer\n            case PROP_DEFS.targetGeoLocation.key: return EnumTitleRenderer\n            default: return null\n        }\n    }\n\n    getSelectedSceneObject() {\n        const sel = SelectionManager.getSelection()\n        if(sel === null) return this.getFirstSceneObject()\n        const selected = this.accessObject(sel)\n        if(selected.type === TOTAL_OBJ_TYPES.SCENE) return selected\n        if(is3DObjectType(selected.type))  return this.findSceneObjectParent(selected)\n        if(selected.type === TOTAL_OBJ_TYPES.BEHAVIOR) return this.findSceneObjectParent(selected)\n        return null\n    }\n    getFirstSceneObject() {\n        return this.accessObject(this.getSceneRoot()).getChildren()[0]\n    }\n    findSceneObjectParent(obj) {\n        if(obj === null) return null\n        if(!obj.exists()) return null\n        if(obj.type === TOTAL_OBJ_TYPES.SCENE) return obj\n        obj = this.accessObject(obj.parent)\n        return this.findSceneObjectParent(obj)\n    }\n\n    getAssetsObject = () => this.getDataGraph().getObjectByProperty('type',TOTAL_OBJ_TYPES.ASSETS_LIST)\n    getBehaviorsObject = () => this.getDataGraph().getObjectByProperty('type',TOTAL_OBJ_TYPES.BEHAVIORS_LIST)\n\n    quick_setPropertyValue(item, key, value) {\n        const ov = this.getDataGraph().getPropertyValue(item,key)\n        const op = this.cmd.setProperty(item,key,value)\n        op.prevValue = ov\n        if(op.value === op.prevValue) return\n        this.getRawGraph().process(op)\n        //TODO: this should be fired through the graph already. I shouldn't need to fire this\n        this.fire(TREE_ITEM_PROVIDER.PROPERTY_CHANGED,{\n            provider: this,\n            child:item,\n            propKey:key,\n            oldValue:ov,\n            newValue:value\n        })\n    }\n\n    editIn2D = () => {\n        this.save().then(()=>{\n            const opts = Object.assign({},this.options,{mode:'edit', switcher:false, doc:this.getDocId()})\n            const loc = document.location\n            const url = `${loc.protocol}//${loc.host}${loc.pathname}?${toQueryString(opts)}`\n            DialogManager.show(<QRDialog text={\"Edit in 2D\"} url={url}/>)\n        })\n    }\n\n    editInVR = () => {\n        this.save().then(()=>{\n            const opts = Object.assign({},this.options,{mode:'vredit', switcher:false, doc:this.getDocId()})\n            const loc = document.location\n            const url = `${loc.protocol}//${loc.host}${loc.pathname}?${toQueryString(opts)}`\n            DialogManager.show(<QRDialog text={\"Edit in AR/VR\"} url={url}/>)\n        })\n    }\n\n    viewInVR = () => {\n        this.save().then(()=> {\n            const opts = Object.assign({}, this.options, {mode: 'play', switcher: false, doc:this.getDocId()})\n            const loc = document.location\n            const url = `${loc.protocol}//${loc.host}${loc.pathname}?${toQueryString(opts)}`\n            DialogManager.show(<QRDialog text={\"View in AR/VR\"} url={url}/>)\n        })\n    }\n\n\n    add3DObject = (type, parent) => {\n        const obj = get3DObjectDef(type).make(this.getDataGraph(),parent)\n        parent.insertFirstChild(obj)\n        SelectionManager.setSelection(obj.id)\n        ToasterMananager.add('added '+type)\n    }\n\n    calculateContextMenu(item) {\n        const cmds = []\n        const obj = this.accessObject(item)\n        if(canBeDeleted(obj.type)) {\n            cmds.push({title: 'delete', icon: ITEM_ICONS.delete, fun: () => deleteObject(this)});\n        }\n        if(obj.type === TOTAL_OBJ_TYPES.ASSETS_LIST) {\n            return generateAddAssetPopup(this)\n        }\n        if(obj.type === TOTAL_OBJ_TYPES.BEHAVIORS_LIST) {\n            cmds.push({\n                title:'Add Behavior from Server',\n                enabled:AuthModule.isLoggedIn(),\n                icon: ITEM_ICONS.behavior_script,\n                fun: () => this.showOpenBehaviorDialog()\n            })\n        }\n        if(canHaveShape(obj.type)) {\n            cmds.push({ divider:true })\n            Object.keys(OBJ_TYPES).forEach(type => cmds.push({\n                title: type,\n                icon: ITEM_ICONS[type],\n                fun: () => this.add3DObject(type,obj)\n            }))\n        }\n        if(canHaveScene(obj.type)) {\n            cmds.push({title: 'scene', icon: ITEM_ICONS.scene, fun: ()=>addScene(this)})\n        }\n\n        if(canHaveBehavior(obj.type)) {\n            cmds.push({ divider:true })\n            this.accessObject(this.getBehaviorsObject()).getChildren()\n                .filter(a => a.type === TOTAL_OBJ_TYPES.BEHAVIOR_SCRIPT)\n                .forEach((b) => {\n                    cmds.push({\n                        title: b.title,\n                        icon: ITEM_ICONS.behavior_script,\n                        fun: () => this.addBehaviorToObject(b, item)\n                    })\n                })\n                cmds.push({\n                    title: 'Add Behavior from server',\n                    icon: ITEM_ICONS.behavior_script,\n                    enabled:AuthModule.isLoggedIn(),\n                    fun: () => {\n                        DialogManager.show(<OpenScriptDialog provider={this} onAdd={(beh)=>{\n                            this.addBehaviorToObject(beh,item).then(b=>{\n                                SelectionManager.setSelection(b.id)\n                            })\n                        }}/>)\n                    }\n                })\n        }\n        if(obj.type === TOTAL_OBJ_TYPES.SCENE) {\n            cmds.push({ divider:true })\n            if(AuthModule.scriptEditingSupported) {\n                cmds.push({title: 'Add Scene script', icon: ITEM_ICONS.behavior, fun: () => this.addSceneScript(item)})\n            }\n        }\n\n\n        if(obj.type === TOTAL_OBJ_TYPES.BEHAVIOR) {\n            cmds.push({ divider:true })\n            cmds.push({title:'view code', icon: ITEM_ICONS.behavior, fun: ()=>SelectionManager.setSelection(obj.behavior)})\n        }\n\n        if(canBeDeleted(obj.type)) {\n            cmds.push({divider: true})\n            cmds.push({title: 'cut', icon: ITEM_ICONS.cut, fun: this.cutSelection})\n            cmds.push({title: 'copy', icon: ITEM_ICONS.copy, fun: this.copySelection})\n            cmds.push({title: 'paste', icon: ITEM_ICONS.paste, fun: this.pasteSelection})\n        }\n        return cmds\n    }\n\n    cutSelection = (e) => {\n        if(e && e.target) {\n            if (e.target.getAttribute('type') === 'input') return\n            if (e.target.nodeName === 'INPUT') return\n            if (e.target.nodeName === 'TEXTAREA') return\n        }\n        if(SelectionManager.isEmpty()) return\n        const obj = this.accessObject(SelectionManager.getSelection())\n        SelectionManager.setClipboard(obj.id)\n        obj.removeFromParent()\n        SelectionManager.clearSelection()\n    }\n    copySelection = (e) => {\n        if(e && e.target) {\n            if (e.target.getAttribute('type') === 'input') return\n            if (e.target.nodeName === 'INPUT') return\n            if (e.target.nodeName === 'TEXTAREA') return\n        }\n        if(SelectionManager.isEmpty()) return\n        const obj = this.accessObject(SelectionManager.getSelection())\n        SelectionManager.setClipboard(obj.id)\n    }\n    pasteSelection = (e) => {\n        //don't intercept if this is a paste into a text field\n        if(e && e.target) {\n            if (e.target.getAttribute('type') === 'input') return\n            if (e.target.nodeName === 'INPUT') return\n            if (e.target.nodeName === 'TEXTAREA') return\n        }\n        const obj1 = this.accessObject(SelectionManager.getClipboard())\n        let parent = null\n        if(is3DObjectType(obj1.type)) parent = this.getSelectedSceneObject()\n        if(obj1.type === 'scene') parent = this.accessObject(this.getSceneRoot())\n        if (!parent) return console.error(\"no parent to ad too! bad obj type?\",obj1.type)\n        parent.insertChildLast(obj1.clone())\n    }\n\n    // ============ drag and drop ============\n    canBeMoved(node) {\n        const p = this.accessObject(node)\n        if(p.type === TOTAL_OBJ_TYPES.ROOT) return false\n        if(p.type === TOTAL_OBJ_TYPES.BEHAVIORS_LIST) return false\n        if(p.type === TOTAL_OBJ_TYPES.ASSETS_LIST) return false\n        return true\n    }\n    canAddChild(parent,child) {\n        const p = this.accessObject(parent)\n        const c = this.accessObject(child)\n        if(p.type === TOTAL_OBJ_TYPES.ROOT && c.type === TOTAL_OBJ_TYPES.SCENE) return true\n        if(p.type === TOTAL_OBJ_TYPES.SCENE && is3DObjectType(c.type)) return true\n        if(is3DObjectType(p.type) && c.type === TOTAL_OBJ_TYPES.BEHAVIOR) return true\n        if(canHaveShape(p.type) && is3DObjectType(c.type)) return true\n        return false\n    }\n    canBeSibling(src,tgt) {\n        const s = this.accessObject(src)\n        const t = this.accessObject(tgt)\n        if(s.type === TOTAL_OBJ_TYPES.SCENE && t.type === TOTAL_OBJ_TYPES.SCENE) return true\n        if(is3DObjectType(s.type) && is3DObjectType(t.type)) return true\n        return false\n    }\n    canAddExternalChild(parent,child) {\n        const obj = this.accessObject(parent)\n        if(obj.type === TOTAL_OBJ_TYPES.ASSETS_LIST) return true\n        return false\n    }\n    acceptDrop(e,tgt) {\n        const obj = this.accessObject(tgt)\n        if(obj.type === TOTAL_OBJ_TYPES.ASSETS_LIST) {\n            listToArray(e.dataTransfer.files).forEach(file => {\n                if(isImageType(file.type)) return addImageAssetFromFile(file,this)\n                if(isGLTFFile(file)) return addGLBAssetFromFile(file,this)\n            })\n        }\n    }\n    requestImageCache(src) {\n        const img = new Image()\n        this.imagecache[src] = img\n        return new Promise((res,rej) => {\n            img.src = src\n            img.onload = () => {\n                this.fire(TREE_ITEM_PROVIDER.STRUCTURE_CHANGED,{ provider: this })\n                res(img)\n            }\n        })\n    }\n\n    createCustomEditor(item,def,provider, value, onChange) {\n        if(def.key === PROP_DEFS.color.key\n            || def.key === PROP_DEFS.backgroundColor.key\n            || def.key === PROP_DEFS.borderColor.key\n            || def.key === PROP_DEFS.textColor.key\n            || def.key === PROP_DEFS.startColor.key\n            || def.key === PROP_DEFS.endColor.key\n        ) return <ColorEditor def={def} item={item} onChange={onChange} value={value}/>\n\n        if(def.key === 'scale') return <ScaleEditor def={def} item={item} onChange={onChange} provider={this}/>\n        if(def.key === 'behavior') return <button onClick={()=>SelectionManager.setSelection(value)}>view code</button>\n        return <i>no custom editor for {def.key}</i>\n    }\n\n    setColor = (color) => {\n        if(SelectionManager.isEmpty()) return\n        this.accessObject(SelectionManager.getSelection()).set('color',color)\n    }\n\n    showAddImageAssetDialog = () => DialogManager.show(<AddImageAssetDialog provider={this}/>)\n    showAddAudioAssetDialog = () => DialogManager.show(<AddAudioAssetDialog provider={this}/>)\n    showAddGLTFAssetDialog  = () => DialogManager.show(<AddGLTFAssetDialog provider={this}/>)\n    showAddGLBAssetDialog   = () => DialogManager.show(<AddGLBAssetDialog provider={this}/>)\n    showOpenDocumentDialog  = () => DialogManager.show(<OpenFileDialog provider={this}/>)\n    showOpenAssetDialog     = () => DialogManager.show(<OpenAssetDialog provider={this}/>)\n    showAddServerImageDialog= () => DialogManager.show(<OpenAssetDialog provider={this} filter={a => isImageType(a.mimeType)}/>)\n    showOpenBehaviorDialog  = () => DialogManager.show(<OpenScriptDialog provider={this}/>)\n    showAddGeoLocationAssetDialog = () => {\n        addGeoAnchorAsset({\n            latitude:0,\n            longitude:0,\n            altitude:0,\n            useAltitude:false,\n        },\"new geo location\",this)\n    }\n    showPasswordDialog = () => DialogManager.show(<PasswordDialog provider={this}/>)\n    showGithubDialog = () => DialogManager.show(<GithubAuthDialog provider={this}/>)\n\n    accessObject = (id) => {\n        return new GraphAccessor(this.getDataGraph()).object(id)\n    }\n\n    loadDocList() {\n        return AuthModule.getJSON(`${getDocsURL()}list`)\n    }\n    removeDoc(doc) {\n        return AuthModule.fetch(`${getDocsURL()}delete/${doc.id}`,{\n            method:'POST',\n            body:doc.id,\n        }).then(res => res.json())\n    }\n    loadAssetList() {\n        return AuthModule.getJSON(`${getAssetsURL()}list`)\n    }\n    removeAssetSource(info) {\n        return AuthModule.fetch(`${getAssetsURL()}delete/${info.id}`,{\n            method:'POST',\n            body:info.id,\n        }).then(res => res.json())\n    }\n    loadScriptList() {\n        return AuthModule.getJSON(`${getScriptsURL()}list`)\n    }\n\n\n    // ======== behaviors ===============\n    addBehaviorAssetFromURL = (info) => {\n        const graph = this.getDataGraph()\n        const behavior = fetchGraphObject(graph,graph.createObject({\n            type:TOTAL_OBJ_TYPES.BEHAVIOR_SCRIPT,\n            title:info.title,\n            description:info.description,\n            src:info.url,\n            parent:0\n        }))\n        this.accessObject(this.getBehaviorsObject()).insertChildLast(behavior)\n        SelectionManager.setSelection(behavior.id)\n        return behavior\n    }\n    removeBehaviorAssetSource(name) {\n        const url = `${getScriptsURL()}delete/${name}`\n        console.log(\"removing\",url)\n        return AuthModule.fetch(url,{\n            method:'POST',\n            body:name,\n        }).then(res => res.json())\n    }\n    addCustomBehaviorAsset = (TEMPLATE) => {\n        const randi = (Math.floor(Math.random()*100000000))\n        const fname =`behavior_${randi}.js`\n        const url = `${getScriptsURL()}${fname}`;\n        const contents = TEMPLATE?TEMPLATE:CUSTOM_BEHAVIOR_SCRIPT\n        console.log(\"posting it to\",url)\n        return AuthModule.fetch(url,{\n            method:'POST',\n            body:contents,\n        })\n            .then(res => res.json())\n            .then(ans => {\n                console.log(\"got back the answer\",ans)\n                const graph = this.getDataGraph()\n                const behavior = fetchGraphObject(graph,graph.createObject({\n                    type:TOTAL_OBJ_TYPES.BEHAVIOR_SCRIPT,\n                    title:ans.script.title,\n                    description:ans.script.description,\n                    src:url,\n                    parent:0\n                }))\n                this.accessObject(this.getBehaviorsObject()).insertChildLast(behavior)\n                SelectionManager.setSelection(behavior.id)\n                return behavior\n\n            })\n            .catch(err => console.error(err))\n    }\n    addSceneScript = (obj) => {\n        this.addCustomBehaviorAsset(CUSTOM_SCENE_SCRIPT)\n            .then((b)=>this.addBehaviorToObject(b,obj))\n    }\n    addBehaviorToObject = (b,item) => {\n        return this.fetchBehaviorAssetContents(b.id).then((contents)=>{\n            try {\n                const def = {\n                    type: TOTAL_OBJ_TYPES.BEHAVIOR,\n                    title: b.title,\n                    description: b.description,\n                    parent: 0,\n                    behavior:b.id,\n                }\n                const obj = parseBehaviorScript(contents)\n                this.setCachedBehaviorAsset(b.id,obj)\n                //copy properties to the behavior def\n                if(obj.properties) {\n                    Object.keys(obj.properties).forEach(name => {\n                        def[name] = obj.properties[name].value\n                    })\n                }\n                const graph = this.getDataGraph()\n                const behavior = fetchGraphObject(graph, graph.createObject(def))\n                this.accessObject(item).insertChildLast(behavior)\n                return behavior\n            } catch (e) {\n                console.error(e)\n            }\n        })\n    }\n    fetchBehaviorAssetContents(id) {\n        const obj = this.accessObject(id)\n        const url = getScriptsURL()+obj.src\n        return AuthModule.fetch(url,{\n            method:'GET',\n        }).then(res => res.text())\n    }\n    updateBehaviorAssetContents(id,text) {\n        if(!AuthModule.supportsScriptEdit()) return\n        //update the cache first\n        try {\n            const info = parseBehaviorScript(text)\n            info.text = text\n            this.setCachedBehaviorAsset(id, info)\n\n            const obj = this.accessObject(id)\n            const url = getScriptsURL() + obj.src\n            return AuthModule.fetch(url, {\n                method: 'POST',\n                body: text,\n            }).then(res => res.json())\n                .then(ans => {\n                    obj.set('title', ans.script.title)\n                    obj.set('description', ans.script.description)\n                })\n        } catch(e) {\n            console.error(\"error parsing the script\",e)\n            ToasterMananager.add('error parsing')\n        }\n    }\n    getCachedBehaviorPropDefs(behavior) {\n        if(!this.behaviorCache[behavior]) {\n            console.error(\"no parsed behavior in the cache\",behavior)\n            return null\n        }\n        return this.behaviorCache[behavior].properties;\n    }\n    getCachedBehaviorAsset(id) {\n        return this.behaviorCache[id]\n    }\n    setCachedBehaviorAsset(id, asset) {\n        this.behaviorCache[id] = asset\n    }\n}\n\nclass VREditorApp extends Component {\n\n    constructor(props) {\n        super(props)\n\n        this.state = {\n            mode:'canvas',\n            user:null,\n            running:false,\n            connected:false,\n            dirty:true\n        }\n\n        this.im = new InputManager()\n        this.im.addKeyBinding({id: 'save', key: InputManager.KEYS.S, modifiers: [InputManager.MODIFIERS.COMMAND]})\n        this.im.addKeyBinding({id: 'undo', key: InputManager.KEYS.Z, modifiers: [InputManager.MODIFIERS.COMMAND]})\n        this.im.addKeyBinding({\n            id: 'redo',\n            key: InputManager.KEYS.Z,\n            modifiers: [InputManager.MODIFIERS.COMMAND, InputManager.MODIFIERS.SHIFT]\n        })\n        this.im.addListener('save', this.props.provider.save)\n        this.im.addListener('undo', this.props.provider.performUndo)\n        this.im.addListener('redo', this.props.provider.performRedo)\n\n        this.im.addKeyBinding({id: 'cut', key: InputManager.KEYS.X, modifiers: [InputManager.MODIFIERS.COMMAND]})\n        this.im.addKeyBinding({id: 'copy', key: InputManager.KEYS.C, modifiers: [InputManager.MODIFIERS.COMMAND]})\n        this.im.addKeyBinding({id: 'paste', key: InputManager.KEYS.V, modifiers: [InputManager.MODIFIERS.COMMAND]})\n\n        this.im.addListener('cut', this.props.provider.cutSelection)\n        this.im.addListener('copy', this.props.provider.copySelection)\n        this.im.addListener('paste', this.props.provider.pasteSelection)\n\n    }\n\n    componentDidMount() {\n        this.im.attachKeyEvents(document)\n        SelectionManager.on(SELECTION_MANAGER.CHANGED,this.selectionChanged)\n        AuthModule.on(USER_CHANGE,()=>this.setState({user:AuthModule.getUsername()}))\n        AuthModule.on(CONNECTED,()=>this.setState({connected:true}))\n        if(AuthModule.isConnected()) this.setState({connected:true})\n        this.props.provider.on(TREE_ITEM_PROVIDER.CLEAR_DIRTY,()=>{\n            this.setState({dirty:false})\n        })\n        this.props.provider.on(TREE_ITEM_PROVIDER.PROPERTY_CHANGED, () => {\n            this.setState({dirty:true})\n        })\n        this.props.provider.on(TREE_ITEM_PROVIDER.SAVED, () => {\n            this.setState({dirty:false})\n        })\n    }\n    componentWillUnmount() {\n        SelectionManager.off(SELECTION_MANAGER.CHANGED,this.selectionChanged)\n    }\n\n    selectionChanged = () => {\n        if(!SelectionManager.isEmpty()) {\n            const item = this.props.provider.accessObject(SelectionManager.getSelection())\n            if(item.type === TOTAL_OBJ_TYPES.BEHAVIOR_SCRIPT) return this.setState({mode:'script'})\n            if(item.type === PROP_DEFS.asset.key) return this.setState({mode:'asset'})\n        }\n        this.setState({mode:'canvas'})\n    }\n\n    toggleRunning = () => {\n        this.setState({running:!this.state.running})\n    }\n\n    newDoc = () => {\n        if(this.state.dirty) {\n            console.log(\"can't create new becausue dirty\")\n            DialogManager.show(<UnsavedDocumentDialog onAnyway={()=>{\n                console.log(\"we are doing it anyway\")\n                newDoc(this.props.provider)\n            }}/>)\n\n        } else {\n            newDoc(this.props.provider)\n        }\n    }\n\n    showOpenDocumentDialog = () => {\n        if(this.state.dirty) {\n            DialogManager.show(<UnsavedDocumentDialog onAnyway={()=>{\n                console.log(\"we are doing it anyway\")\n                this.props.provider.showOpenDocumentDialog()\n            }}/>)\n        } else {\n            this.props.provider.showOpenDocumentDialog()\n        }\n    }\n\n    render() {\n        if(this.state.connected === false) {\n            return <div>\n                <h1>connecting to server</h1>\n                <DialogContainer/>\n            </div>\n        }\n        const prov = this.props.provider\n        const bot = <div>\n            doc id: <b>{prov.getDocId()}</b>\n        </div>\n        let logger = null\n        if(prov.pubnub) logger = prov.getLogger()\n        if(!prov.getDataGraph()) {\n            return <div>\n                <h1>connecting to server</h1>\n                <DialogContainer/>\n            </div>\n        }\n        return <ErrorCatcher logger={logger}><GridEditorApp bottomText={bot}>\n            <Toolbar left top><label>{prov.getTitle()} {this.state.dirty?\"dirty\":\"clean\"}</label></Toolbar>\n            <Panel scroll left middle><TreeTable root={prov.getSceneRoot()} provider={prov}/></Panel>\n\n            <Toolbar left bottom>\n                <button className=\"fa fa-cube\"        onClick={(e)=>showAddPopup(e,prov)}/>\n                <button className=\"fa fa-globe\"       onClick={(e)=>addScene(prov)}/>\n                <button className=\"fa fa-archive\"     onClick={(e)=>showAddAssetPopup(e,prov)}/>\n                <button className=\"fa fa-superpowers\" onClick={(e)=>showAddBehaviorPopup(e,prov)}/>\n            </Toolbar>\n\n\n            <Toolbar center top>\n                <button className=\"fa fa-file\" onClick={this.newDoc} title={'new project'}></button>\n                <button className=\"fa fa-save\" onClick={() => prov.save()} title={'save project'}></button>\n                <button className=\"fa fa-clone\" onClick={()=>prov.duplicateDocument()} title={\"duplicate project\"}></button>\n                <button onClick={() => prov.editIn2D()}>2D Edit</button>\n                <button onClick={() => prov.editInVR()}>AR Edit</button>\n                <button onClick={() => prov.viewInVR()}>XR View</button>\n                <Spacer/>\n                <RunButton onClick={this.toggleRunning} active={this.state.running}/>\n                <Spacer/>\n                <button className=\"fa fa-cut\" onClick={prov.cutSelection}/>\n                <button className=\"fa fa-copy\" onClick={prov.copySelection}/>\n                <button className=\"fa fa-paste\" onClick={prov.pasteSelection}/>\n                <button className=\"fa fa-undo\" onClick={prov.performUndo}/>\n                <button className=\"fa fa-repeat\" onClick={prov.performRedo}/>\n            </Toolbar>\n\n\n            <Panel center middle scroll transparent>\n                {this.renderCenterPane(this.state.mode)}\n            </Panel>\n\n            <Panel scroll right><PropSheet provider={prov}/></Panel>\n\n\n            <Toolbar right top>\n                {this.renderLoginButton()}\n            </Toolbar>\n            <Toolbar right bottom>\n            </Toolbar>\n            <DialogContainer/>\n            <PopupContainer/>\n\n        </GridEditorApp></ErrorCatcher>\n    }\n    renderCenterPane(mode) {\n        if (mode === 'script') return <ScriptEditor provider={this.props.provider}/>\n        if (mode === 'canvas') return <VRCanvas provider={this.props.provider} running={this.state.running}/>\n        return <AssetView provider={this.props.provider} asset={SelectionManager.getSelection()}/>\n    }\n\n    renderLoginButton() {\n        const buttons = []\n\n        if(AuthModule.supportsAuth()) {\n            if(AuthModule.isLoggedIn()) {\n                buttons.push(<button key=\"logout\" className=\"fa fa-user\" onClick={AuthModule.logout} title={'logout'}>logout</button>)\n            } else {\n                buttons.push(<button key=\"login\" className=\"fa fa-user\" onClick={()=>{\n                    if(AuthModule.supportsPassword()) {\n                        this.props.provider.showPasswordDialog()\n                    } else {\n                        this.props.provider.showGithubDialog()\n//                        AuthModule.login()\n                    }\n                }} title={'login'}/>)\n            }\n        }\n        if(AuthModule.supportsDocList()) {\n            buttons.push(<button key=\"open\" className=\"fa fa-folder-open\" onClick={this.showOpenDocumentDialog} title={\"open\"}/>)\n        }\n        return buttons\n    }\n}\nconst EnumTitleRenderer = (props) => {\n    let value = \"---\"\n    if(props.value && props.provider)  value = props.provider.accessObject(props.value).title\n    if(props.value === NONE_ASSET.id)  value = NONE_ASSET.title\n    return <b>{value}</b>\n}\n\nclass ScaleEditor extends Component {\n    constructor(props) {\n        super(props)\n        this.state = {\n            sync:false,\n        }\n    }\n    syncChanged = (e) => this.setState({sync: !this.state.sync})\n    changed = (e, key) =>{\n        const obj = this.props.provider.accessObject(this.props.item)\n        const newvals = {\n            sx:obj.sx,\n            sy:obj.sy,\n            sz:obj.sz\n        }\n        const val = parseFloat(e.target.value)\n        newvals[key] = val\n        if(this.state.sync) {\n            newvals.sx = val\n            newvals.sy = val\n            newvals.sz = val\n        }\n        this.props.onChange(newvals)\n    }\n    render() {\n        const obj = this.props.provider.accessObject(this.props.item)\n        return <HBox className=\"scale-editor\">\n            <input type=\"checkbox\" checked={this.state.sync} onChange={this.syncChanged}/>\n            <input type=\"number\" value={obj.sx} onChange={(e)=>this.changed(e,'sx')} step={0.1}/>\n            <input type=\"number\" value={obj.sy} onChange={(e)=>this.changed(e,'sy')} step={0.1}/>\n            <input type=\"number\" value={obj.sz} onChange={(e)=>this.changed(e,'sz')} step={0.1}/>\n        </HBox>\n    }\n}\n\nfunction acceptsModelAsset(type) {\n    if(type=== OBJ_TYPES.model) return true\n    return false\n}\nfunction acceptsImageAsset(type) {\n    if(type === OBJ_TYPES.plane\n        || type === OBJ_TYPES.bg360\n        || type === OBJ_TYPES.img2d\n        || type === OBJ_TYPES.cube\n        || type === OBJ_TYPES.sphere\n    ) return true\n    return false\n}\nfunction acceptsVideoAsset(type) {\n    if(type === OBJ_TYPES.plane\n        || type === OBJ_TYPES.bg360\n        || type === OBJ_TYPES.img2d\n    ) return true\n    return false\n}\n\nconst RunButton = (props) => {\n    const clss = props.active?\"run-button active fa fa-stop\":\"run-button fa fa-play\"\n    return <button onClick={props.onClick} className={clss}/>\n}\n\nfunction withNone(array) {\n    array.push(NONE_ASSET.id)\n    return array\n}\n\nclass ColorEditor extends Component {\n    showPopup = (e) =>{\n        PopupManager.show(<ColorPopup onChange={this.props.onChange} value={this.props.value}/>, e.target)\n    }\n    render() {\n        return <button\n            style={{backgroundColor:this.props.value}}\n            onClick={this.showPopup}\n        >{this.props.value}</button>\n\n    }\n}\n\nclass ColorPopup extends Component {\n    constructor(props) {\n        super(props)\n        this.state = {\n            value:props.value\n        }\n    }\n    onChange = (e) => {\n        this.setState({value:e.target.value})\n        const v = e.target.value\n        if(v.indexOf('#')>=0 && v.length === 7) this.props.onChange(v)\n    }\n    done = () => {\n        this.props.onChange(this.state.value)\n        PopupManager.hide()\n    }\n    render() {\n        return <VBox style={{\n            width: '130px',\n            height: '100px',\n            backgroundColor: 'white'\n        }}>\n            <HBox>\n                {\n                    SIMPLE_COLORS\n                        .map(c => <button\n                            key={c}\n                            onClick={() => {\n                                this.props.onChange(c)\n                            }}\n                            style={{color: c, padding: '1px', margin: 0, borderWidth: 0,}}\n                            className={\"fa fa-square\"}/>)\n                }\n            </HBox>\n            <input type=\"text\" value={this.state.value}\n                   onChange={this.onChange}/>\n            <button onClick={this.done}>done</button>\n        </VBox>\n    }\n}\n","import React, {Component} from 'react'\nimport ScriptManager, {SceneGraphProvider} from './ScriptManager'\nimport TreeItemProvider, {getAssetsURL, getDocsURL, getScriptsURL} from '../TreeItemProvider'\nimport {on, parseOptions, toFlatString} from '../utils'\nimport {TweenManager} from '../common/tween'\nimport * as THREE from 'three'\nimport {Group} from \"three\"\nimport {VRManager, VR_DETECTED, Pointer} from 'webxr-boilerplate'\nimport SceneDef from './defs/SceneDef'\nimport {ASSET_TYPES, get3DObjectDef, is3DObjectType, parseBehaviorScript, TOTAL_OBJ_TYPES} from './Common'\nimport {AuthModule} from './AuthModule'\nimport {XRSupport} from './XRSupport'\nimport {PubnubLogger} from '../syncgraph/PubnubSyncWrapper'\nimport {ErrorCatcher} from './ErrorCatcher'\nimport {AssetsManager} from './AssetsManager'\n\n\nfunction attachUtilFunctions(obj) {\n    obj.find = (match,list) => {\n        if(!list) list = []\n        if(match(obj)) list.push(obj)\n        if(obj.children) obj.children.forEach(ch => {\n            ch.find(match,list)\n        })\n        return list\n    }\n    obj.exists = ()=>true\n}\n\nexport class ImmersivePlayer extends Component {\n    constructor(props) {\n        super(props)\n        const opts = parseOptions({})\n        if(!opts.doc) throw new Error(\"doc not specified\")\n        new TreeItemProvider(props.options)\n        this.obj_map = {}\n        this.three_map = {}\n        this.title_map = {}\n        this.previewUpdateNodes = []\n        this.current_scene = null\n        this.root = null\n        this.behavior_map = {}\n        this.behavior_assets = {}\n        this.assets_url_map = {}\n        this.pendingAssets = []\n        this.playing_audio = {}\n\n        this.sceneAnchor = null\n\n        this.logger = new PubnubLogger(opts.doc)\n        this.scriptManager = new ScriptManager(new Adapter(this),this.logger)\n        this.provider = {\n            accessObject:(id)=>{\n                if(!this.obj_map[id]) return {\n                    exists:()=>false,\n                }\n                return this.obj_map[id]\n            },\n            getLogger:() => this.logger\n        }\n        this.assetsManager = new AssetsManager(this.provider)\n        this.provider.assetsManager = this.assetsManager\n    }\n\n    componentDidMount() {\n        this.logger.log(\"mounted ImmersivePlayer\")\n        // const canvas = this.canvas\n        // if(XRSupport.supportsARKit()) {\n        //     this.xr = new XRSupport()\n        //     this.xr.getContext(canvas).then((context) => {\n        //         this.initThreeJS(canvas,context)\n        //         this.xr.setAnimationLoop( this.renderThreeWithCamera.bind(this))\n        //         this.startScene()\n        //     }).catch(err => {\n        //         console.error('Error', err)\n        //     })\n        // } else {\n        //     this.initThreeJS(canvas,0)\n        //     this.renderer.setAnimationLoop(this.renderThree.bind(this))\n        //     this.startScene()\n        // }\n\n    }\n\n    startScene() {\n        const opts = parseOptions({})\n        this.assetsManager.cacheAssetsList().then(()=> {\n            AuthModule.getJSON(getDocsURL() + opts.doc).then((payload) => {\n                this.root = payload.graph\n                this.logger.log(\"loaded payload\", this.root)\n                this.buildRoot(this.root)\n                this.logger.log(this.root)\n                Promise.all(this.pendingAssets).then(() => {\n                    this.logger.log(\"all assets loaded now. starting script manager\")\n                    this.scriptManager.startRunning()\n                    if (this.root.defaultScene) {\n                        const sc = this.root.children.find(ch => ch.id === this.root.defaultScene)\n                        this.setCurrentScene(sc)\n                    } else {\n                        const sc = this.root.children[0]\n                        this.setCurrentScene(sc)\n                    }\n                    this.scriptManager.startFirstScene()\n                })\n            })\n        })\n    }\n\n    clickedStart = () => {\n        console.log(\"clicked. play the sample audio\")\n        const $ = (sel) => document.querySelector(sel)\n        $(\"#overlay\").style.display = 'none'\n        $(\"#test-audio\").play()\n\n        const canvas = this.canvas\n        if(XRSupport.supportsARKit()) {\n            this.xr = new XRSupport()\n            this.xr.getContext(canvas).then((context) => {\n                this.initThreeJS(canvas,context)\n                this.xr.setAnimationLoop( this.renderThreeWithCamera.bind(this))\n                this.startScene()\n            }).catch(err => {\n                console.error('Error', err)\n            })\n        } else {\n            this.initThreeJS(canvas,0)\n            this.renderer.setAnimationLoop(this.renderThree.bind(this))\n            this.startScene()\n        }\n\n    }\n\n    render() {\n        return <div>\n            <audio id={\"test-audio\"} src={\"https://vr.josh.earth/assets/sounds/clang.mp3\"}/>\n            <div id=\"overlay\">\n                <div id=\"inner\">\n                    <button onClick={this.clickedStart}>click to start</button>\n                    {/*<div id=\"loading-indicator\">*/}\n                    {/*    <label>loading</label>*/}\n                    {/*    <progress max=\"100\" value=\"0\" id=\"progress\"></progress>*/}\n                    {/*</div>*/}\n                    {/*<button id=\"enter-button\" disabled>VR not supported, play anyway</button>*/}\n                </div>\n            </div>\n            <ErrorCatcher logger={this.logger}>\n                <canvas ref={c => this.canvas = c} width={600} height={400}\n                    onClick={this.clickedCanvas}\n                />\n            </ErrorCatcher>\n        </div>\n    }\n\n    clickedCanvas = (e) => {\n        function findKnownParent(node) {\n            if(!node) return null\n            if(node.userData.graphid) return node\n            return findKnownParent(node.parent)\n        }\n\n        this.logger.log(\"clicked on the canvas\")\n        this.canvas.focus()\n        const rect = this.canvas.getBoundingClientRect();\n        const pointer = {\n            x: ( e.clientX - rect.left ) / rect.width * 2 - 1,\n            y: - ( e.clientY - rect.top ) / rect.height * 2 + 1,\n        }\n        this.raycaster.setFromCamera(pointer, this.camera);\n        const scene = this.three_map[this.current_scene.id]\n        const intersect = this.raycaster.intersectObjects(scene.children, true)\n        if(intersect && intersect.length >= 1) {\n            const inter = intersect.find(inter => inter.distance > 0)\n            if(inter) {\n                //this.logger.log(\"found the interesction\", inter)\n                //this.logger.log(\"intersections\", intersect)\n                // let obj = inter.object\n                let obj = findKnownParent(inter.object)\n\n                //this.logger.log(\"obj\", obj)\n               // if (obj.userData && obj.userData.graphid) { \n                    const gobj = this.obj_map[obj.userData.graphid]\n                    //this.logger.log(\"jobj\", gobj)\n                 //   if (gobj) {\n                        this.scriptManager.performClickAction(gobj, e)\n                  // }\n               // }\n            }\n        }\n    }\n\n    buildRoot(graph) {\n        //init assets first\n        graph.children.forEach(ch => {\n            if(ch.type === TOTAL_OBJ_TYPES.ASSETS_LIST) return this.initAssets(ch)\n        })\n        graph.children.forEach(ch => {\n            attachUtilFunctions(ch)\n            if(ch.type === TOTAL_OBJ_TYPES.SCENE) return this.initObject(ch)\n            if(ch.type === TOTAL_OBJ_TYPES.BEHAVIORS_LIST) return this.initBehaviors(ch)\n        })\n    }\n\n    initObject(obj) {\n        attachUtilFunctions(obj)\n        this.obj_map[obj.id] = obj\n        if(obj.title) this.title_map[obj.title] = obj\n        let node = null\n        if(obj.type === TOTAL_OBJ_TYPES.SCENE) {\n            const scene = new SceneDef().makeNode(obj, this.provider)\n            this.three_map[obj.id] = scene\n            scene.userData.graphid = obj.id\n            this.scenes.add(scene)\n            scene.visible = false\n            node = scene\n        }\n        obj.props = () => obj\n\n        if(is3DObjectType(obj.type)) {\n            node = get3DObjectDef(obj.type).makeNode(obj, this.provider)\n            if(node.previewUpdate) this.previewUpdateNodes.push(node)\n            this.three_map[obj.id] = node\n            node.userData.graphid = obj.id\n            on(node, 'click', (e) => {\n                this.scriptManager.performClickAction(obj, e)\n            })\n        }\n        if(obj.type === TOTAL_OBJ_TYPES.BEHAVIOR) {\n            this.behavior_map[obj.id] = obj\n        }\n\n        if(obj.children) {\n            obj.children.forEach(ch => {\n                const chnode = this.initObject(ch)\n                if(chnode) node.add(chnode)\n            })\n        }\n\n        return node\n    }\n\n    initThreeJS(canvas, context) {\n        this.tweenManager = new TweenManager()\n        this.scene = new THREE.Scene();\n        this.camera = new THREE.PerspectiveCamera( 70, window.innerWidth / window.innerHeight, 0.1, 50 );\n        this.renderer = new THREE.WebGLRenderer( { antialias: true, canvas:canvas, context:context } );\n        this.renderer.setPixelRatio( window.devicePixelRatio );\n        this.renderer.setSize( window.innerWidth, window.innerHeight );\n        this.renderer.gammaOutput = true\n        this.renderer.vr.enabled = true;\n        // this.sceneContainer.appendChild( this.renderer.domElement );\n        this.vrmanager = new VRManager(this.renderer)\n        this.audioListener = new THREE.AudioListener()\n        this.camera.add(this.audioListener)\n        if(!this.xr) this.scene.background = new THREE.Color(0x000000);\n        this.camera.matrixAutoUpdate = false\n        this.scene.add(this.camera)\n        window.addEventListener( 'resize', ()=>{\n            // const body = document.querySelector(\"body\")\n            const body = document.documentElement\n            this.logger.log(\"doc test\",document.documentElement.clientWidth,document.documentElement.clientHeight)\n            this.camera.aspect = body.clientWidth / body.clientHeight;\n            // this.camera.aspect = window.innerWidth / window.innerHeight;\n            this.camera.updateProjectionMatrix();\n            this.renderer.setSize( body.clientWidth, body.clientHeight);\n            // this.renderer.setSize( window.innerWidth, window.innerHeight );\n        }, false );\n        const light = new THREE.DirectionalLight( 0xffffff, 1.0 );\n        light.position.set( 1, 1, 1 ).normalize();\n        this.scene.add( light );\n        this.scene.add(new THREE.AmbientLight(0xffffff,0.2))\n\n        this.scenes = new Group()\n        this.scene.add(this.scenes)\n\n        this.raycaster = new THREE.Raycaster();\n\n        // const $ = (sel) => document.querySelector(sel)\n        // const on = (elem, type, cb) => elem.addEventListener(type,cb)\n\n        // on($(\"#enter-button\"),'click',()=>{\n        //     $(\"#overlay\").style.display = 'none'\n        //     //we can start playing sound now\n        // })\n        /*\n        this.vrmanager.addEventListener(VR_DETECTED,()=>{\n            console.log(\"VR detected\")\n            $(\"#enter-button\").removeAttribute('disabled',false)\n            $(\"#enter-button\").innerText = \"enter vr\"\n            on($(\"#enter-button\"),'click',()=> this.vrmanager.enterVR())\n        })\n         */\n\n        // const WAIT_FOR_LOAD = false\n        /*\n        if(!WAIT_FOR_LOAD) {\n            $(\"#loading-indicator\").style.display = 'none'\n            $(\"#enter-button\").style.display = 'block'\n            $(\"#enter-button\").removeAttribute('disabled')\n        }\n         */\n\n        /*\n        //class which handles mouse and VR controller\n        this.pointer = new Pointer(this, {\n            intersectionFilter: ((o) => o.userData.clickable),\n            cameraFollowMouse:false,\n            mouseSimulatesController:false,\n            enableLaser: true,\n            laserLength: 20,\n        })\n         */\n\n    }\n\n    renderThreeWithCamera = (bounds,projectionMatrix,viewMatrix, time,frame) => {\n        if(!this.scene || !this.camera) return\n        this.camera.matrix.fromArray(viewMatrix)\n        this.camera.matrixWorldNeedsUpdate = true\n        this.camera.updateMatrixWorld()\n        this.camera.projectionMatrix.fromArray(projectionMatrix)\n        this.renderThree(time,frame)\n    }\n\n    renderThree = (time, frame) => {\n        if(this.tweenManager) this.tweenManager.update(time)\n        this.previewUpdateNodes.forEach(n => n.previewUpdate())\n        if(this.pointer) this.pointer.tick(time)\n        if(this.stats) this.stats.update(time)\n        if(this.controller) this.controller.update(time)\n        let session = null\n        if(this.xr) session = this.xr.session\n        this.scriptManager.tick(time, session)\n        this.renderer.render( this.scene, this.camera );\n    }\n\n    initAssets(assets) {\n        assets.children.forEach(obj => {\n            this.logger.log(\"loading asset\",obj)\n            attachUtilFunctions(obj)\n            this.obj_map[obj.id] =  obj\n            if(obj.title) this.title_map[obj.title] = obj\n            this.assets_url_map[obj.id] = obj.url\n        })\n    }\n\n    initBehaviors(behaviors) {\n        behaviors.children.forEach(ch => {\n            attachUtilFunctions(ch)\n            this.obj_map[ch.id] =  ch\n            if(ch.type === TOTAL_OBJ_TYPES.BEHAVIOR_SCRIPT) {\n                const url = getScriptsURL()+ch.src\n                this.logger.log(\"loading behavior\",ch,'from',url)\n                const prom = AuthModule.fetch(url,{\n                    method:'GET'\n                }) .then(res => res.text())\n                    .then(text => {\n                        const info = parseBehaviorScript(text)\n                        info.text = text\n                        this.behavior_assets[ch.id] = info\n                        return text\n                    })\n                this.pendingAssets.push(prom)\n            }\n        })\n    }\n\n    setCurrentScene(scene) {\n        // @blair\n        const sceneNode = this.three_map[scene.id]\n        // this.logger.log(\"the scene node is\",sceneNode)\n        // this.logger.log(\"if it exists, scene anchor is\", sceneNode.userData.sceneAnchor)\n        if (sceneNode) {\n            const sceneAnchorNode = sceneNode.userData.sceneAnchor\n            if (!sceneAnchorNode) {\n                this.logger.error(\"no sceneNode? so no children?\")\n            } else {\n                if (sceneAnchorNode.children) {\n                    this.logger.log(\"scene has children: \", sceneNode.children.length)\n                    this.logger.log(\"scene anchor has children: \", sceneAnchorNode.children.length)\n                } else {\n                    this.logger.log(\"no sceneNode children?\")\n                }\n\n                if (!this.sceneAnchor || (this.sceneAnchor && scene.autoRecenter)) {\n                    // create a new scene anchor\n                    if (this.sceneAnchor) {\n                        this.xr.removeSceneAnchor(this.sceneAnchor, this.logger)\n                        this.sceneAnchor = null\n                    }\n                    this.xr.createSceneAnchor(sceneAnchorNode, this.logger).then(anchor => {\n                        this.sceneAnchor = anchor\n                    }).catch(error => {\n                        this.logger.error(`error creating new scene anchor: ${error}`)\n                    })\n                } else {\n                    this.xr.updateAnchoredSceneNode(this.sceneAnchor, sceneAnchorNode, this.logger)\n                }\n            }\n        }\n        this.scenes.children.forEach(sc => sc.visible = false)\n        if(this.three_map[scene.id]) this.three_map[scene.id].visible = true\n        this.current_scene = scene\n    }\n\n}\n\n// ================  SGP implementation =====================\n\nclass Adapter extends SceneGraphProvider {\n    constructor(player) {\n        super()\n        this.player = player\n        this.logger = this.player.logger\n    }\n\n    getCurrentScene() {\n        return this.player.current_scene\n    }\n    getSceneObjects(sc) {\n        return sc.children.filter(ch => is3DObjectType(ch.type))\n    }\n    getBehaviorsForObject (obj) {\n        if(!obj.children) return []\n        return obj.children.filter(ch => ch.type === TOTAL_OBJ_TYPES.BEHAVIOR)\n    }\n    getThreeObject (obj)  {\n        if (!obj) {\n            this.logger.error(\"getThreeObject got invalid obj\")\n        } else {\n            if(obj.id) return this.player.three_map[obj.id]\n        }\n        return this.player.three_map[obj]\n    }\n    getParsedBehaviorAsset (b) {\n        return this.player.behavior_assets[b.behavior]\n    }\n    getAllBehaviors () {\n        return Object.keys(this.player.behavior_map).map(key => this.player.behavior_map[key])\n    }\n    getAllScenes() {\n        return Object.keys(this.player.obj_map)\n            .map(key => this.player.obj_map[key])\n            .filter(obj => obj.type === TOTAL_OBJ_TYPES.SCENE)\n    }\n\n    navigateScene (sceneid) {\n        this.logger.log(\"navigating to \",sceneid)\n        const scene = this.player.obj_map[sceneid]\n        if(!scene) return this.logger.error(\"couldn't find scene for\",sceneid)\n\n        this.player.setCurrentScene(scene)\n    }\n    playMediaAsset (asset, trusted=false)  {\n        console.log(\"playing the media asset\",asset)\n        if(asset.subtype === ASSET_TYPES.AUDIO) {\n            if(this.player.playing_audio[asset.id]) {\n                this.logger.log(\"already playing. restarting it\")\n                const sound = this.player.playing_audio[asset.id]\n                if(sound.isPlaying) {\n                    sound.stop()\n                    sound.play()\n                } else {\n                    sound.play()\n                }\n            } else {\n                this.logger.log(\"ImmersivePlayer playing audio\", asset)\n                const sound = new THREE.Audio(this.player.audioListener)\n                const audioLoader = new THREE.AudioLoader()\n                audioLoader.load(asset.src, (buffer) => {\n                    this.logger.log(\"loaded the buffer\", buffer.length)\n                    sound.setBuffer(buffer);\n                    sound.setLoop(false);\n                    sound.setVolume(0.5);\n                    sound.play();\n                });\n                this.player.playing_audio[asset.id] = sound\n            }\n        }\n        if(asset.subtype === ASSET_TYPES.VIDEO) {\n            this.player.provider.assetsManager.playMediaAsset(asset,trusted)\n        }\n    }\n\n    stopMediaAsset(asset) {\n        if(asset.subtype === ASSET_TYPES.AUDIO) {\n            if(this.player.playing_audio[asset.id]) {\n                this.player.playing_audio[asset.id].stop()\n                delete this.player.playing_audio[asset.id]\n                this.player.playing_audio[asset.id] = null\n            }\n        }\n    }\n\n\n    getGraphObjectByName(title) {\n        return this.player.title_map[title]\n    }\n    getGraphObjectById (id) {\n        return this.player.obj_map[id]\n    }\n    getCamera() {\n        return this.player.camera\n    }\n\n    getTweenManager() {\n        return this.player.tweenManager\n    }\n\n    startImageRecognizer(info) {\n        this.logger.log(\"starting the image recognizer\")\n        return new Promise((res,rej) => {\n            //called when an anchor is started that wants to recognize an image\n            // WebXR loaded?\n            if(!this.player.xr || !this.player.xr.session) {\n                this.logger.log(\"XR is not active?\")\n                return\n            }\n\n            this.player.xr.createDetectionImage(info,this.logger).then((name) => {\n                // decorate the info.node with an xr anchor\n                this.player.xr.startImageRecognizer(info, name, this.logger)\n            })\n        })\n    }\n\n    startGeoTracker(info) {\n        // WebXR loaded?\n        return new Promise((res, rej) => {\n            if(!this.player.xr || !this.player.xr.session) {\n                this.logger.log(\"XR is not active?\")\n                return\n            }\n\n            this.player.xr.createGeoAnchor(info, this.logger).then(() => {\n                // decorate the info.node with an xr anchor\n                this.player.xr.addGeoAnchoredNode(info, this.logger)\n            })\n        })\n    }\n\n    stopImageRecognizer(info) {\n        this.logger.log(\"stopping the image recognizer\")\n\n        if(!this.player.xr || !this.player.xr.session) {\n            this.logger.log(\"XR is not active?\")\n            return\n        }\n\n        this.player.xr.stopImageRecognizer(info, this.logger)\n    }\n\n    stopGeoTracker(info) {\n        // WebXR loaded?\n        if(!this.player.xr || !this.player.xr.session) {\n            this.logger.log(\"XR is not active?\")\n            return\n        }\n\n        // decorate the info.node with an xr anchor\n        this.player.xr.stopGeoTracker(info, this.logger)\n    }\n\n}\n","import React, {Component} from 'react'\nimport './App.css'\nimport {DialogContainer, PopupContainer, PopupManager, VBox} from \"appy-comps\"\n\nimport MetadocEditor from \"./metadoc/Editor1\"\nimport VREditor from './vr/VREditor'\nimport {ImmersivePlayer} from './vr/ImmersivePlayer'\n\nexport default class App extends Component {\n    constructor(props) {\n        super(props)\n\n        this.state = {\n            switcher:false,\n        }\n        this.providers = ['vr','metadoc']\n        const sw = this.props.options.switcher\n        if(typeof sw !== 'undefined' && (sw === true || sw === 'true')) {\n            this.state.switcher = true\n        }\n    }\n\n    getApp() {\n        const doctype = this.props.options.doctype || \"vr\"\n        if(doctype === 'vr') {\n            if(this.props.options.mode === 'play') {\n                console.log(\"doing play instead\")\n                return <ImmersivePlayer options={this.props.options}/>\n            }\n            this.provider = new VREditor(this.props.options)\n            return this.provider.getApp()\n        }\n        if(doctype === 'metadoc') {\n            this.provider = new MetadocEditor(this.props.options)\n            return this.provider.getApp()\n        }\n    }\n\n\n//        provider.loadDoc(this.props.options.doc)\n\n    openNewProvider(name){\n        PopupManager.hide()\n        window.open(`./?mode=edit&doctype=${name}`)\n    }\n\n    showProviderList = (e) => {\n        PopupManager.show(\n            <VBox>\n                {this.providers.map((name)=>{\n                    return <button key={name} onClick={()=>this.openNewProvider(name)}>{name}</button>\n                })}\n            </VBox>,\n            e.target\n        )\n    }\n    render() {\n        if(!this.state.switcher) return this.getApp()\n        return (\n            <VBox fill>\n                <button\n                    style={{position:'absolute',zIndex: 10,}}\n                    onClick={this.showProviderList}\n                    >\n                    <img src=\"icon.png\" alt=\"switch apps\" height=\"20\" style={{padding:'0em'}}/>\n                </button>\n                <div style={{position: 'relative', flex: '1'}}>{this.getApp()}</div>\n                <DialogContainer/>\n                <PopupContainer/>\n            </VBox>\n        );\n    }\n}\n\n\n\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport 'font-awesome/css/font-awesome.css'\nimport App from './App';\nimport {parseOptions} from './utils'\n\nconst default_options = {\n    mode: 'edit',\n}\nconst options = parseOptions(default_options)\nconsole.log(\"options is\",options);\n\nfunction init() {\n    return <App options={options}/>;\n}\n\nReactDOM.render(init(), document.getElementById(\"root\"));\n\n"],"sourceRoot":""}