<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="https://aframe.io/releases/0.8.0/aframe.min.js"></script>
    <script src="./viewer.js"></script>
</head>
<body>
<a-scene>
    <a-entity camera look-controls wasd-cotnrols>
        <a-entity cursor="fuse: true; maxDistance: 30;"
                  id="cursor"
                  position="0 0 -3"
                  geometry="primitive:ring; radiusInner: 0.2; radiusOuter:0.3"
                  material="color:cyan; shader:flat"
                  >
            <a-animation begin="click" easing="ease-in" attribute="scale" dur="150"
                         fill="forwards" from="0.2 0.2 0.2" to="1 1 1"></a-animation>
            <a-animation begin="fusing" easing="ease-in" attribute="scale" dur="1500"
                         fill="backwards" from="1 1 1" to="0.2 0.2 0.2"></a-animation>

        </a-entity>
    </a-entity>
    <a-entity id="children">
    </a-entity>

    <a-entity laser-controls="hand: right"></a-entity>

</a-scene>

<script>
    window.addEventListener('load',()=>{
        console.log("done loading=======")
        $('#cursor').addEventListener('fusing',()=>{
            console.log("fusing")
        })
        $('#cursor').addEventListener('mouseenter',()=>{
            console.log("entering")
        })
        $('#cursor').addEventListener('mouseleave',()=>{
            console.log("leaving")
        })
        $('#cursor').addEventListener('click',(e)=>{
            console.log("clicked",e.detail)
            const node = getNodeForAFrameObject(e.detail.intersectedEl)
            console.log("the node is",node)
            if(node.children) {
                const nav = node.children.find(ch=>ch.type==='nav-action')
                if(nav) {
                    console.log("found the nav",nav)
                    loadScene(nav.targetScene)
                }
                const play = node.children.find(ch=>ch.type === 'playsound-action')
                if(play) {
                    const asset = findAssetById(play.assetid)
                    const url = getURLForResourceId(asset.resourceId)
                    const audio = document.createElement('audio')
                    audio.autoplay = true
                    audio.src = url
                }
            }
        })

    })
</script>
</body>
</html>